import"../chunks/DsnmJJEf.js";import{p as te,ab as pe,a4 as ie,z as Ee,a as E,b as ae,f as G,a6 as b,a8 as P,a7 as f,a5 as Pe,a3 as We,R as rt,B as we,d as ye,h as c,ac as ee,n as nt,t as st}from"../chunks/ZmOcAfe1.js";import{I as Ie,X as Ue,s as ft,e as Be,r as je,a as M,B as pt,b as Le}from"../chunks/BPhQ1Ot-.js";import{a as o,s as _e,b as ke}from"../chunks/FHFy0IG3.js";import{w as bt,d as ht,c as Oe,f as it,b as Fe,i as gt}from"../chunks/DXbKMHJn.js";import{s as xe,r as Ce,i as se,p as mt}from"../chunks/DbDyctlH.js";import{t as Je,o as yt,w as _t,p as $t,q as wt,m as ve,e as Ge,b as Te,k as Se,c as kt,r as Ke,v as Ne,x as Pt,y as Et,z as It,n as be,A as Ot,B as xt,u as Ct,C as Qe,D as Rt,a as Xe,f as L,j as qt,E as Tt,L as St}from"../chunks/CVgv9TCp.js";import{h as Ye,F as he,a as ge,T as me}from"../chunks/DUS_f0YX.js";import{h as Ae,i as ot,j as Nt,k as Ze,b as De,l as jt,u as lt,m as Dt,a as Mt}from"../chunks/CFXNJ6MW.js";import{s as Lt}from"../chunks/DMjnpqdT.js";import{c as Wt,P as Bt}from"../chunks/DbH0YAOb.js";import{f as Ft,a as Ut,q as At,r as Vt,s as zt}from"../chunks/DqqTwD6Q.js";import{P as Ht}from"../chunks/QQGWQ7NY.js";import{P as Jt}from"../chunks/BzEzGBMK.js";const{name:fe}=kt("dialog"),Gt={preventScroll:!0,escapeBehavior:"close",closeOnOutsideClick:!0,role:"dialog",defaultOpen:!1,portal:"body",forceVisible:!1,openFocus:void 0,closeFocus:void 0,onOutsideClick:void 0},Kt=["content","title","description"];function ct(m){const e={...Gt,...m},t=Je(yt(e,"ids")),{preventScroll:h,escapeBehavior:r,closeOnOutsideClick:I,role:s,portal:n,forceVisible:U,openFocus:z,closeFocus:N,onOutsideClick:_}=t,O=_t.writable(null),x=Je({...$t(Kt),...e.ids}),H=e.open??bt(e.defaultOpen),q=wt(H,e?.onOpenChange),W=ht([q,U],([a,d])=>a||d);let J=be;function C(a){const d=a.currentTarget,u=a.currentTarget;!Xe(d)||!Xe(u)||(q.set(!0),O.set(u))}function B(){q.set(!1)}const Y=ve(fe("trigger"),{stores:[q],returned:([a])=>({"aria-haspopup":"dialog","aria-expanded":a,type:"button"}),action:a=>({destroy:Ge(Te(a,"click",u=>{C(u)}),Te(a,"keydown",u=>{u.key!==Se.ENTER&&u.key!==Se.SPACE||(u.preventDefault(),C(u))}))})}),$=ve(fe("overlay"),{stores:[W,q],returned:([a,d])=>({hidden:a?void 0:!0,tabindex:-1,style:a?void 0:Ke({display:"none"}),"aria-hidden":!0,"data-state":d?"open":"closed"})}),K=ve(fe("content"),{stores:[W,x.content,x.description,x.title,q],returned:([a,d,u,A,le])=>({id:d,role:s.get(),"aria-describedby":u,"aria-labelledby":A,"aria-modal":a?"true":void 0,"data-state":le?"open":"closed",tabindex:-1,hidden:a?void 0:!0,style:a?void 0:Ke({display:"none"})}),action:a=>{let d=be,u=be,A=be;const le=Ne([W,I],([p,l])=>{u(),d(),A(),p&&(u=Pt(a,{closeOnInteractOutside:l,onClose:B,shouldCloseOnInteractOutside(v){return _.get()?.(v),!v.defaultPrevented}}).destroy,d=Et(a,{handler:B,behaviorType:r}).destroy,A=It(a,{fallbackFocus:a}).destroy)});return{destroy:()=>{J(),le(),u(),d(),A()}}}}),w=ve(fe("portalled"),{stores:n,returned:a=>({"data-portal":Ot(a)}),action:a=>{const d=Ne([n],([u])=>{if(u===null)return be;const A=xt(a,u);return A===null?be:Ct(a,A).destroy});return{destroy(){d()}}}}),re=ve(fe("title"),{stores:[x.title],returned:([a])=>({id:a})}),oe=ve(fe("description"),{stores:[x.description],returned:([a])=>({id:a})}),ne=ve(fe("close"),{returned:()=>({type:"button"}),action:a=>({destroy:Ge(Te(a,"click",()=>{B()}),Te(a,"keydown",u=>{u.key!==Se.SPACE&&u.key!==Se.ENTER||(u.preventDefault(),B())}))})});return Ne([q,h],([a,d])=>{if(Qe){if(d&&a&&(J=Rt()),a){const u=document.getElementById(x.content.get());Ye({prop:z.get(),defaultEl:u})}return()=>{U.get()||J()}}}),Ne(q,a=>{!Qe||a||Ye({prop:N.get(),defaultEl:O.get()})},{skipFirstRun:!0}),{ids:x,elements:{content:K,trigger:Y,title:re,description:oe,overlay:$,close:ne,portalled:w},states:{open:q},options:t}}function et(m,e){te(e,!0);/**
 * @license @lucide/svelte v0.535.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let t=Ce(e,["$$slots","$$events","$$legacy"]);const h=[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3a2 2 0 0 1 2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2c0-1.1.9-2 2-2h3.17"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05"}],["circle",{cx:"12",cy:"12",r:"10"}]];Ie(m,xe({name:"earth"},()=>t,{get iconNode(){return h},children:(r,I)=>{var s=pe(),n=ie(s);Oe(n,()=>e.children??Ee),E(r,s)},$$slots:{default:!0}})),ae()}function tt(m,e){te(e,!0);/**
 * @license @lucide/svelte v0.535.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let t=Ce(e,["$$slots","$$events","$$legacy"]);const h=[["circle",{cx:"12",cy:"16",r:"1"}],["rect",{x:"3",y:"10",width:"18",height:"12",rx:"2"}],["path",{d:"M7 10V7a5 5 0 0 1 10 0v3"}]];Ie(m,xe({name:"lock-keyhole"},()=>t,{get iconNode(){return h},children:(r,I)=>{var s=pe(),n=ie(s);Oe(n,()=>e.children??Ee),E(r,s)},$$slots:{default:!0}})),ae()}function Qt(m,e){te(e,!0);/**
 * @license @lucide/svelte v0.535.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let t=Ce(e,["$$slots","$$events","$$legacy"]);const h=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];Ie(m,xe({name:"pencil"},()=>t,{get iconNode(){return h},children:(r,I)=>{var s=pe(),n=ie(s);Oe(n,()=>e.children??Ee),E(r,s)},$$slots:{default:!0}})),ae()}function Xt(m,e){te(e,!0);/**
 * @license @lucide/svelte v0.535.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let t=Ce(e,["$$slots","$$events","$$legacy"]);const h=[["path",{d:"M10 11v6"}],["path",{d:"M14 11v6"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];Ie(m,xe({name:"trash-2"},()=>t,{get iconNode(){return h},children:(r,I)=>{var s=pe(),n=ie(s);Oe(n,()=>e.children??Ee),E(r,s)},$$slots:{default:!0}})),ae()}function at(m,e){te(e,!0);/**
 * @license @lucide/svelte v0.535.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let t=Ce(e,["$$slots","$$events","$$legacy"]);const h=[["path",{d:"M18 21a8 8 0 0 0-16 0"}],["circle",{cx:"10",cy:"8",r:"5"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3"}]];Ie(m,xe({name:"users-round"},()=>t,{get iconNode(){return h},children:(r,I)=>{var s=pe(),n=ie(s);Oe(n,()=>e.children??Ee),E(r,s)},$$slots:{default:!0}})),ae()}var Yt=(m,e,t,h)=>e.onClickRemove(t()),Zt=G('<button type="button"><!></button>'),ea=G('<div class="tag svelte-nisp7u"> <!></div>');function ta(m,e){te(e,!0);const[t,h]=_e(),r=()=>o(I,"$person",t);Ae(e.webId);let I=ot(he,e.webId);var s=ea(),n=b(s),U=P(n);{var z=N=>{var _=Zt();_.__click=[Yt,e,r,I];var O=b(_);Ue(O,{"aria-hidden":"true",size:"1.25rem"}),f(_),Pe(()=>ft(_,"aria-label",`Remove ${r().name}`)),E(N,_)};se(U,N=>{e.onClickRemove&&N(z)})}f(s),Pe(()=>Fe(n,`${r().name??""} `)),E(m,s),ae(),h()}it(["click"]);var aa=G("<li> </li>"),ra=G('<li><div><span class="font-medium"> </span></div></li>'),na=G(`<li class="relative cursor-pointer rounded-md py-1 pl-8 pr-4
        data-[highlighted]:bg-magnum-100 data-[highlighted]:text-magnum-700">No results found</li>`),sa=G("<ul><!> <!></ul>"),ia=G('<div><div><div class="selected-people svelte-8dggyk"></div> <input/></div></div> <!>',1);function oa(m,e){te(e,!0);const[t,h]=_e(),r=()=>o(K,"$inputValue",t),I=()=>o($,"$open",t),s=()=>o(re,"$selected",t),n=()=>o(De,"$session",t),U=()=>o(w,"$touchedInput",t),z=()=>o(a,"$friends",t),N=()=>o(B,"$input",t),_=()=>o(C,"$menu",t),O=()=>o(c(le),"$personByWebId",t),x=()=>o(c(A),"$personResourceResult",t),H=()=>o(Y,"$option",t),q=()=>o(c(p),"$matched",t);let W=mt(e,"value",15),J=We(rt([]));const{elements:{menu:C,input:B,option:Y},states:{open:$,inputValue:K,touchedInput:w,selected:re}}=Wt({multiple:!0,onSelectedChange:i=>{const y=i.next?.map(F=>F.value)??[];return we(J,y,!0),W(y),ke(K,""),ke($,!1),i.next}});ye(()=>{W().length!==s()?.length&&ke(re,W().map(i=>({value:i,label:""})))});let oe;const ne=i=>{clearTimeout(oe),oe=setTimeout(i,450)};Nt(he,n().info.webId,n().info.webId,{name:!0,knows:{name:!0}});let a=Ze(he,n().info.webId,Ft.knows),d=We("");ye(()=>{const i=r();U()?ne(()=>{we(d,i,!0)}):we(d,i,!0)});let u=ee(()=>z().filter(i=>i.name?.toLowerCase().includes(r().toLowerCase())||i["@id"]?.toLowerCase().includes(r().toLowerCase()))),A=ee(()=>Ae(c(d))),le=ee(()=>ot(he,c(d))),p=ee(()=>Ze(he,c(d),Ut.oidcIssuer));const l=i=>{W(W().filter(y=>y!==i["@id"]))};var v=ia(),j=ie(v),V=b(j),g=b(V);Be(g,20,()=>c(J),i=>i,(i,y)=>{ta(i,{get webId(){return y},onClickRemove:l})}),f(g);var R=P(g,2);je(R),M(R,()=>({...N(),disabled:e.disabled||N().disabled,placeholder:"Name or webId"}),void 0,void 0,"svelte-8dggyk"),L(R,i=>B?.(i)),f(V),f(j);var Q=P(j,2);{var Z=i=>{var y=sa();M(y,()=>({class:"menu",..._()}),void 0,void 0,"svelte-8dggyk");var F=b(y);{var T=D=>{var S=aa();M(S,ue=>({...ue}),[()=>H()({value:O()["@id"],label:O().name??O()["@id"],disabled:x().isPresent()!==!0||q().size===0})],void 0,"svelte-8dggyk");var ce=b(S,!0);f(S),L(S,ue=>Y?.(ue)),Pe(()=>Fe(ce,O().name??O()["@id"])),E(D,S)};se(F,D=>{O()?.["@id"]&&!x()?.isError&&D(T)})}var X=P(F,2);Be(X,17,()=>c(u),D=>D["@id"],(D,S)=>{var ce=ra();M(ce,de=>({...de}),[()=>H()({value:c(S)["@id"],label:c(S).name??c(S)["@id"]})],void 0,"svelte-8dggyk");var ue=b(ce),Re=b(ue),$e=b(Re,!0);f(Re),f(ue),f(ce),L(ce,de=>Y?.(de)),Pe(()=>Fe($e,c(S).name??c(S)["@id"])),E(D,ce)},D=>{var S=na();E(D,S)}),f(y),L(y,D=>C?.(D)),qt(3,y,()=>Tt,()=>({duration:150,y:-5})),E(i,y)};se(Q,i=>{I()&&i(Z)})}E(m,v),ae(),h()}var la=G("<button><!></button>"),ca=G('<div><div></div> <div><h2>Visibility</h2> <p></p> <form class="svelte-1r4q63y"><div class="option svelte-1r4q63y"><input type="radio" name="visibility" id="private"/><label for="private" aria-label="Private"><!></label></div> <div class="option svelte-1r4q63y"><input type="radio" name="visibility" id="shared" aria-label="Shared"/><label for="shared" aria-label="Shared"><!></label> <!></div> <div class="option svelte-1r4q63y"><input type="radio" name="visibility" id="public" aria-label="Public"/><label for="public" aria-label="Public"><!></label></div> <!></form> <button><!></button></div></div>'),da=G("<!> <!>",1);function ua(m,e){te(e,!0);const[t,h]=_e(),r=()=>o(Y,"$open",t),I=()=>o(x,"$trigger",t),s=()=>o(H,"$portalled",t),n=()=>o(q,"$overlay",t),U=()=>o(W,"$content",t),z=()=>o(J,"$title",t),N=()=>o(C,"$description",t),_=()=>o(B,"$close",t),O=[],{elements:{trigger:x,portalled:H,overlay:q,content:W,title:J,description:C,close:B},states:{open:Y}}=ct();var $=(p=>(p.private="private",p.shared="shared",p.public="public",p))($||{});let K=ee(()=>e.wac?e.wac.public.read?"public":Object.entries(e.wac.agent).some(([p,l])=>p!==e.self&&l.read)?"shared":"private":void 0);const w=rt({visibility:void 0,selected:[]});ye(()=>{w.visibility=c(K)});let re=ee(()=>!!e.wac?.agent[e.self].control);ye(()=>{if(!e.wac)return;const p=Object.entries(e.wac.agent).filter(([l,v])=>l!==e.self&&v.read===!0).map(([l])=>l);w.selected=p});const oe=async p=>{if(p.preventDefault(),!e.wac)throw new Error;let l=JSON.parse(JSON.stringify(e.wac));if(w.visibility==="public")l.public.read=!0;else if(w.visibility==="shared"&&w.selected.length>0){l.public.read=!1;for(let v in l.agent)v!==e.self&&(l.agent[v].read=!1);w.selected.forEach(v=>{l.agent[v]??={read:!1,append:!1,write:!1,control:!1},l.agent[v].read=!0})}else l=void 0;await e.onchangewac(l),ke(Y,!1)};var ne=da(),a=ie(ne);{var d=p=>{var l=la();M(l,()=>({"aria-label":`Privacy and sharing: ${c(K)}`,...I()}),void 0,void 0,"svelte-1r4q63y");var v=b(l);{var j=g=>{{let R=ee(()=>c(re)?"green":"black");tt(g,{"aria-hidden":"true",get color(){return c(R)}})}},V=g=>{var R=pe(),Q=ie(R);{var Z=y=>{{let F=ee(()=>c(re)?"green":"black");at(y,{"aria-hidden":"true",get color(){return c(F)}})}},i=y=>{var F=pe(),T=ie(F);{var X=D=>{{let S=ee(()=>c(re)?"green":"black");et(D,{"aria-hidden":"true",get color(){return c(S)}})}};se(T,D=>{c(K)===$.public&&D(X)},!0)}E(y,F)};se(Q,y=>{c(K)===$.shared?y(Z):y(i,!1)},!0)}E(g,R)};se(v,g=>{c(K)===$.private?g(j):g(V,!1)})}f(l),L(l,g=>x?.(g)),E(p,l)},u=p=>{St(p,{class:"spinning"})};se(a,p=>{e.wac?p(d):p(u,!1)})}var A=P(a,2);{var le=p=>{var l=ca();M(l,()=>({...s()}),void 0,void 0,"svelte-1r4q63y");var v=b(l);M(v,()=>({class:"overlay",...n()}),void 0,void 0,"svelte-1r4q63y"),L(v,k=>q?.(k));var j=P(v,2);M(j,()=>({class:"content",...U()}),void 0,void 0,"svelte-1r4q63y");var V=b(j);M(V,()=>({class:"title",...z()}),void 0,void 0,"svelte-1r4q63y"),L(V,k=>J?.(k));var g=P(V,2);M(g,()=>({...N()}),void 0,void 0,"svelte-1r4q63y"),L(g,k=>C?.(k));var R=P(g,2),Q=b(R),Z=b(Q);je(Z);var i,y=P(Z),F=b(y);tt(F,{"aria-hidden":"true"}),f(y),f(Q);var T=P(Q,2),X=b(T);je(X);var D,S=P(X),ce=b(S);at(ce,{"aria-hidden":"true"}),f(S);var ue=P(S,2);{var Re=k=>{{let He=ee(()=>w.visibility!==$.shared);oa(k,{get disabled(){return c(He)},get value(){return w.selected},set value(Me){w.selected=Me}})}};se(ue,k=>{w.visibility===$.shared&&k(Re)})}f(T);var $e=P(T,2),de=b($e);je(de);var Ve,ze=P(de),dt=b(ze);et(dt,{"aria-hidden":"true"}),f(ze),f($e);var ut=P($e,2);pt(ut,{type:"submit",variant:"primary",children:(k,He)=>{nt();var Me=st("Confirm");E(k,Me)},$$slots:{default:!0}}),f(R);var qe=P(R,2);M(qe,()=>({class:"close",..._()}),void 0,void 0,"svelte-1r4q63y");var vt=b(qe);Ue(vt,{}),f(qe),L(qe,k=>B?.(k)),f(j),L(j,k=>W?.(k)),f(l),L(l,k=>H?.(k)),Pe(()=>{i!==(i=$.private)&&(Z.value=(Z.__value=$.private)??""),D!==(D=$.shared)&&(X.value=(X.__value=$.shared)??""),Ve!==(Ve=$.public)&&(de.value=(de.__value=$.public)??"")}),gt("submit",R,oe),Le(O,[],Z,()=>($.private,w.visibility),k=>w.visibility=k),Le(O,[],X,()=>($.shared,w.visibility),k=>w.visibility=k),Le(O,[],de,()=>($.public,w.visibility),k=>w.visibility=k),E(p,l)};se(A,p=>{r()&&p(le)})}E(m,ne),ae(),h()}function va(m,e){te(e,!0);const[t,h]=_e(),r=()=>o(s,"$resource",t),I=()=>o(De,"$session",t),s=Ae(e.uri);let n=We(void 0);ye(()=>{r().getWac().then(_=>{if(_.isError)throw _;we(n,_,!0)})});const{getResource:U,getSubject:z}=lt(),N=async _=>{if(r()?.type!=="SolidLeaf")throw new Error("not a leaf");if(!c(n))throw new Error;let O=JSON.parse(JSON.stringify(c(n).wacRule));if(_===void 0){const C=await jt(r(),{fetch:I().fetch});if(C.isError)throw C;const B=C.wacUri;await U(B).delete()}else await r().setWac(_);const x=await r().getWac({ignoreCache:!0});if(x.isError)throw x;we(n,x,!0);const H=x.wacRule,q=H.public.read?"public":Object.entries(H.agent).some(([C,B])=>C!==I().info.webId&&B.read)?"shared":"private";ge({data:{title:"Update successful",description:`Access was updated to ${q}`,type:me.success}}),O.public.read!==H.public.read&&ge({data:{title:"TODO Notification successful",description:"Public geoindex was notified",type:me.success}});const W=Object.keys(H.agent),J=Object.keys(O.agent);for(let C of W)J.includes(C)||ge({data:{title:"TODO Notification successful",description:`${z(he,C)?.name} was notified`,type:me.success}})};{let _=ee(()=>c(n)?.wacRule);ua(m,{get wac(){return c(_)},get self(){return I().info.webId},onchangewac:N})}ae(),h()}const fa=async(m,e,t,h)=>{const{name:r}=e.place;if(globalThis.confirm(`Do you really want to delete place ${r} (${e.place["@id"]})?`)){const s=t.getResource(e.place["@id"]);if(s.isError)throw s;const n=await Dt(s,{fetch:h().fetch,dataset:t});n.isError?ge({data:{type:me.error,title:"Deletion failed",description:n.name}}):ge({data:{type:me.success,title:"Deletion successful",description:`Deleted place ${r}`}})}};var pa=G("<div><div></div> <div><h2>Update Place</h2> <p></p> <!> <button><!></button></div></div>"),ba=G('<div class="controls svelte-1hcqejf"><!> <button><!></button> <button aria-label="Delete place"><!></button></div> <!>',1);function ha(m,e){te(e,!0);const[t,h]=_e(),r=()=>o(w,"$open",t),I=()=>o(De,"$session",t),s=()=>o(W,"$trigger",t),n=()=>o(J,"$portalled",t),U=()=>o(C,"$overlay",t),z=()=>o(B,"$content",t),N=()=>o(Y,"$title",t),_=()=>o($,"$description",t),O=()=>o(K,"$close",t),{changeData:x,commitData:H,dataset:q}=lt(),{elements:{trigger:W,portalled:J,overlay:C,content:B,title:Y,description:$,close:K},states:{open:w}}=ct(),re=async v=>{const{name:j}=e.place,V=q.getResource(e.place["@id"]);if(V.isError)throw V;const g=x(e.place,V);g.name=v.name,g.description=v.description,g.topic=Lt(...v.topics.map(Q=>({"@id":Q})));const R=await H(g);if(R.isError)throw R;ke(w,!1),ge({data:{title:"Update successful",description:`Updated place ${j}`,type:me.success}})};var oe=ba(),ne=ie(oe),a=b(ne);va(a,{get uri(){return e.place["@id"]}});var d=P(a,2);M(d,()=>({"aria-label":"Edit place",...s()}),void 0,void 0,"svelte-1hcqejf");var u=b(d);Qt(u,{"aria-hidden":"true"}),f(d),L(d,v=>W?.(v));var A=P(d,2);A.__click=[fa,e,q,I];var le=b(A);Xt(le,{"aria-hidden":"true"}),f(A),f(ne);var p=P(ne,2);{var l=v=>{var j=pa();M(j,()=>({...n()}),void 0,void 0,"svelte-1hcqejf");var V=b(j);M(V,()=>({class:"overlay",...U()}),void 0,void 0,"svelte-1hcqejf"),L(V,F=>C?.(F));var g=P(V,2);M(g,()=>({class:"content",...z()}),void 0,void 0,"svelte-1hcqejf");{const F=T=>{nt();var X=st("Update place");E(T,X)};var R=b(g);M(R,()=>({class:"title",...N()}),void 0,void 0,"svelte-1hcqejf"),L(R,T=>Y?.(T));var Q=P(R,2);M(Q,()=>({..._()}),void 0,void 0,"svelte-1hcqejf"),L(Q,T=>$?.(T));var Z=P(Q,2);{let T=ee(()=>({name:e.place.name,description:e.place.description,latitude:e.place.geo.latitude,longitude:e.place.geo.longitude,topics:e.place.topic?.map(X=>X["@id"])??[]}));Bt(Z,{get place(){return c(T)},onsubmit:re,get submit(){return F}})}var i=P(Z,2);M(i,()=>({class:"close",...O()}),void 0,void 0,"svelte-1hcqejf");var y=b(i);Ue(y,{}),f(i),L(i,T=>K?.(T)),f(g),L(g,T=>B?.(T))}f(j),L(j,F=>J?.(F)),E(v,j)};se(p,v=>{r()&&v(l)})}E(m,oe),ae(),h()}it(["click"]);var ga=G("<li><!></li>"),ma=G('<ul data-testid="place-list"></ul>');function Sa(m,e){te(e,!0);const[t,h]=_e(),r=()=>o(De,"$session",t),I=()=>o(s,"$places",t);ye(()=>{r().info.webId&&At(r().info.webId,r().fetch).then(()=>{console.log("query run and finished")})});const s=Mt(Jt,Vt.type,zt.Place);var n=ma();Be(n,5,I,U=>U["@id"],(U,z)=>{var N=ga(),_=b(N);Ht(_,{get place(){return c(z)},children:(O,x)=>{ha(O,{get place(){return c(z)}})},$$slots:{default:!0}}),f(N),E(U,N)}),f(n),E(m,n),ae(),h()}export{Sa as component};
