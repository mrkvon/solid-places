import{b as Ya,w as Xa,t as ol}from"./BhkdwHEz.js";function al(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in n)){const u=Object.getOwnPropertyDescriptor(r,o);u&&Object.defineProperty(n,o,u.get?u:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var On=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function kn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Si={},vt={},br={},an={},po;function Za(){if(po)return an;po=1,Object.defineProperty(an,"__esModule",{value:!0}),an.BlankNode=void 0;class n{constructor(t){this.termType="BlankNode",this.value=t}equals(t){return!!t&&t.termType==="BlankNode"&&t.value===this.value}}return an.BlankNode=n,an}var un={},cn={},go;function eu(){if(go)return cn;go=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.DefaultGraph=void 0;class n{constructor(){this.termType="DefaultGraph",this.value=""}equals(t){return!!t&&t.termType==="DefaultGraph"}}return cn.DefaultGraph=n,n.INSTANCE=new n,cn}var ln={},hn={},yo;function Us(){if(yo)return hn;yo=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.NamedNode=void 0;class n{constructor(t){this.termType="NamedNode",this.value=t}equals(t){return!!t&&t.termType==="NamedNode"&&t.value===this.value}}return hn.NamedNode=n,hn}var mo;function tu(){if(mo)return ln;mo=1,Object.defineProperty(ln,"__esModule",{value:!0}),ln.Literal=void 0;const n=Us();class e{constructor(r,o){this.termType="Literal",this.value=r,typeof o=="string"?(this.language=o,this.datatype=e.RDF_LANGUAGE_STRING):o?(this.language="",this.datatype=o):(this.language="",this.datatype=e.XSD_STRING)}equals(r){return!!r&&r.termType==="Literal"&&r.value===this.value&&r.language===this.language&&this.datatype.equals(r.datatype)}}return ln.Literal=e,e.RDF_LANGUAGE_STRING=new n.NamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"),e.XSD_STRING=new n.NamedNode("http://www.w3.org/2001/XMLSchema#string"),ln}var fn={},wo;function ru(){if(wo)return fn;wo=1,Object.defineProperty(fn,"__esModule",{value:!0}),fn.Quad=void 0;class n{constructor(t,r,o,u){this.termType="Quad",this.value="",this.subject=t,this.predicate=r,this.object=o,this.graph=u}equals(t){return!!t&&(t.termType==="Quad"||!t.termType)&&this.subject.equals(t.subject)&&this.predicate.equals(t.predicate)&&this.object.equals(t.object)&&this.graph.equals(t.graph)}}return fn.Quad=n,fn}var dn={},_o;function nu(){if(_o)return dn;_o=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.Variable=void 0;class n{constructor(t){this.termType="Variable",this.value=t}equals(t){return!!t&&t.termType==="Variable"&&t.value===this.value}}return dn.Variable=n,dn}var bo;function ul(){if(bo)return un;bo=1,Object.defineProperty(un,"__esModule",{value:!0}),un.DataFactory=void 0;const n=Za(),e=eu(),t=tu(),r=Us(),o=ru(),u=nu();let c=0;class l{constructor(h){this.blankNodeCounter=0,h=h||{},this.blankNodePrefix=h.blankNodePrefix||`df_${c++}_`}namedNode(h){return new r.NamedNode(h)}blankNode(h){return new n.BlankNode(h||`${this.blankNodePrefix}${this.blankNodeCounter++}`)}literal(h,d){return new t.Literal(h,d)}variable(h){return new u.Variable(h)}defaultGraph(){return e.DefaultGraph.INSTANCE}quad(h,d,p,x){return new o.Quad(h,d,p,x||this.defaultGraph())}fromTerm(h){switch(h.termType){case"NamedNode":return this.namedNode(h.value);case"BlankNode":return this.blankNode(h.value);case"Literal":return h.language?this.literal(h.value,h.language):h.datatype.equals(t.Literal.XSD_STRING)?this.literal(h.value):this.literal(h.value,this.fromTerm(h.datatype));case"Variable":return this.variable(h.value);case"DefaultGraph":return this.defaultGraph();case"Quad":return this.quad(this.fromTerm(h.subject),this.fromTerm(h.predicate),this.fromTerm(h.object),this.fromTerm(h.graph))}}fromQuad(h){return this.fromTerm(h)}resetBlankNodeCounter(){this.blankNodeCounter=0}}return un.DataFactory=l,un}var vo;function cl(){return vo||(vo=1,function(n){var e=br&&br.__createBinding||(Object.create?function(r,o,u,c){c===void 0&&(c=u);var l=Object.getOwnPropertyDescriptor(o,u);(!l||("get"in l?!o.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return o[u]}}),Object.defineProperty(r,c,l)}:function(r,o,u,c){c===void 0&&(c=u),r[c]=o[u]}),t=br&&br.__exportStar||function(r,o){for(var u in r)u!=="default"&&!Object.prototype.hasOwnProperty.call(o,u)&&e(o,r,u)};Object.defineProperty(n,"__esModule",{value:!0}),t(Za(),n),t(ul(),n),t(eu(),n),t(tu(),n),t(Us(),n),t(ru(),n),t(nu(),n)}(br)),br}var So;function ll(){if(So)return vt;So=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.stringQuadToQuad=vt.quadToStringQuad=vt.stringToTerm=vt.getLiteralLanguage=vt.getLiteralType=vt.getLiteralValue=vt.termToString=void 0;const n=cl(),e=new n.DataFactory;function t(h){if(h)switch(h.termType){case"NamedNode":return h.value;case"BlankNode":return"_:"+h.value;case"Literal":const d=h;return'"'+d.value+'"'+(d.datatype&&d.datatype.value!=="http://www.w3.org/2001/XMLSchema#string"&&d.datatype.value!=="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"?"^^"+d.datatype.value:"")+(d.language?"@"+d.language:"");case"Quad":return`<<${t(h.subject)} ${t(h.predicate)} ${t(h.object)}${h.graph.termType==="DefaultGraph"?"":" "+t(h.graph)}>>`;case"Variable":return"?"+h.value;case"DefaultGraph":return h.value}}vt.termToString=t;function r(h){const d=/^"([^]*)"/.exec(h);if(!d)throw new Error(h+" is not a literal");return d[1]}vt.getLiteralValue=r;function o(h){const d=/^"[^]*"(?:\^\^([^"]+)|(@)[^@"]+)?$/.exec(h);if(!d)throw new Error(h+" is not a literal");return d[1]||(d[2]?"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString":"http://www.w3.org/2001/XMLSchema#string")}vt.getLiteralType=o;function u(h){const d=/^"[^]*"(?:@([^@"]+)|\^\^[^"]+)?$/.exec(h);if(!d)throw new Error(h+" is not a literal");return d[1]?d[1].toLowerCase():""}vt.getLiteralLanguage=u;function c(h,d){if(d=d||e,!h||!h.length)return d.defaultGraph();switch(h[0]){case"_":return d.blankNode(h.substr(2));case"?":if(!d.variable)throw new Error("Missing 'variable()' method on the given DataFactory");return d.variable(h.substr(1));case'"':const p=u(h),x=d.namedNode(o(h));return d.literal(r(h),p||x);case"<":default:if(h[0]==="<"&&h.length>4&&h[1]==="<"&&h[h.length-1]===">"&&h[h.length-2]===">"){const T=h.slice(2,-2).trim();let S=[],v=0,R=0,b=!1;for(let E=0;E<T.length;E++){const A=T[E];if(A==="<"&&v++,A===">"){if(v===0)throw new Error("Found closing tag without opening tag in "+h);v--}if(A==='"'){let k=!1,D=E;for(;D-- >0&&T[D]==="\\";)k=!k;k||(b=!b)}if(A===" "&&!b&&v===0){for(S.push(T.slice(R,E));T[E+1]===" ";)E+=1;R=E+1}}if(v!==0)throw new Error("Found opening tag without closing tag in "+h);if(S.push(T.slice(R,T.length)),S.length!==3&&S.length!==4)throw new Error("Nested quad syntax error "+h);return S=S.map(E=>E.startsWith("<")&&!E.includes(" ")?E.slice(1,-1):E),d.quad(c(S[0]),c(S[1]),c(S[2]),S[3]?c(S[3]):void 0)}return d.namedNode(h)}}vt.stringToTerm=c;function l(h){return{subject:t(h.subject),predicate:t(h.predicate),object:t(h.object),graph:t(h.graph)}}vt.quadToStringQuad=l;function g(h,d){return d=d||e,d.quad(c(h.subject,d),c(h.predicate,d),c(h.object,d),c(h.graph,d))}return vt.stringQuadToQuad=g,vt}var Eo;function hl(){return Eo||(Eo=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.termToString=n.stringToTerm=n.stringQuadToQuad=n.quadToStringQuad=n.getLiteralValue=n.getLiteralType=n.getLiteralLanguage=void 0;const e=ll();Object.defineProperty(n,"getLiteralLanguage",{enumerable:!0,get:function(){return e.getLiteralLanguage}}),Object.defineProperty(n,"getLiteralType",{enumerable:!0,get:function(){return e.getLiteralType}}),Object.defineProperty(n,"getLiteralValue",{enumerable:!0,get:function(){return e.getLiteralValue}}),Object.defineProperty(n,"quadToStringQuad",{enumerable:!0,get:function(){return e.quadToStringQuad}}),Object.defineProperty(n,"stringQuadToQuad",{enumerable:!0,get:function(){return e.stringQuadToQuad}}),Object.defineProperty(n,"stringToTerm",{enumerable:!0,get:function(){return e.stringToTerm}}),Object.defineProperty(n,"termToString",{enumerable:!0,get:function(){return e.termToString}})}(Si)),Si}var iu=hl();const fl=new Set(["NamedNode","BlankNode"]),dl=new Set(["NamedNode"]),pl=new Set(["NamedNode","BlankNode","Literal"]),gl=new Set(["NamedNode","BlankNode","DefaultGraph"]);function yl(n){return ri(n)}function ml(n){return ri(n)}function wl(n){return ri(n)}function _l(n){return ri(n)}function ri(n){return iu.termToString(n)}function Wt(n){return JSON.stringify({subject:n[0]?yl(n[0]):void 0,predicate:n[1]?ml(n[1]):void 0,object:n[2]?wl(n[2]):void 0,graph:n[3]?_l(n[3]):void 0})}function bl(n){return ni(n,fl)}function vl(n){return ni(n,dl)}function Sl(n){return ni(n,pl)}function El(n){return ni(n,gl)}function ni(n,e){const t=iu.stringToTerm(n);if(e&&!e.has(t.termType))throw new Error(`Expected term to be one of term type: [${Array.from(e).reduce((r,o)=>`${r}${o}, `,"")}], but got ${t.termType}.`);return t}function xl(n){try{const e=JSON.parse(n);return[e.subject!=null?bl(e.subject):void 0,e.predicate!=null?vl(e.predicate):void 0,e.object!=null?Sl(e.object):void 0,e.graph!=null?El(e.graph):void 0]}catch{throw new Error("Invalid Quad Match String")}}var Ei,xo;function Fl(){if(xo)return Ei;xo=1;class n{constructor(t){this.value=t||"b"+ ++n.nextId}equals(t){return!!t&&t.termType===this.termType&&t.value===this.value}}return n.prototype.termType="BlankNode",n.nextId=0,Ei=n,Ei}var xi,Fo;function su(){if(Fo)return xi;Fo=1;class n{equals(t){return!!t&&t.termType===this.termType}}return n.prototype.termType="DefaultGraph",n.prototype.value="",xi=n,xi}var Fi,Ro;function Rl(){if(Ro)return Fi;Ro=1;function n(e){if(!e)return null;if(e.termType==="BlankNode")return this.blankNode(e.value);if(e.termType==="DefaultGraph")return this.defaultGraph();if(e.termType==="Literal")return this.literal(e.value,e.language||this.namedNode(e.datatype.value));if(e.termType==="NamedNode")return this.namedNode(e.value);if(e.termType==="Quad"){const t=this.fromTerm(e.subject),r=this.fromTerm(e.predicate),o=this.fromTerm(e.object),u=this.fromTerm(e.graph);return this.quad(t,r,o,u)}if(e.termType==="Variable")return this.variable(e.value);throw new Error(`unknown termType ${e.termType}`)}return Fi=n,Fi}var Ri,To;function ou(){if(To)return Ri;To=1;class n{constructor(t){this.value=t}equals(t){return!!t&&t.termType===this.termType&&t.value===this.value}}return n.prototype.termType="NamedNode",Ri=n,Ri}var Ti,Ao;function Tl(){if(Ao)return Ti;Ao=1;const n=ou();class e{constructor(r,o,u){this.value=r,this.datatype=e.stringDatatype,this.language="",o?(this.language=o,this.datatype=e.langStringDatatype):u&&(this.datatype=u)}equals(r){return!!r&&r.termType===this.termType&&r.value===this.value&&r.language===this.language&&r.datatype.equals(this.datatype)}}return e.prototype.termType="Literal",e.langStringDatatype=new n("http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"),e.stringDatatype=new n("http://www.w3.org/2001/XMLSchema#string"),Ti=e,Ti}var Ai,Io;function Al(){if(Io)return Ai;Io=1;const n=su();class e{constructor(r,o,u,c){this.subject=r,this.predicate=o,this.object=u,c?this.graph=c:this.graph=new n}equals(r){return!!r&&(r.termType==="Quad"||!r.termType)&&r.subject.equals(this.subject)&&r.predicate.equals(this.predicate)&&r.object.equals(this.object)&&r.graph.equals(this.graph)}}return e.prototype.termType="Quad",e.prototype.value="",Ai=e,Ai}var Ii,Po;function Il(){if(Po)return Ii;Po=1;class n{constructor(t){this.value=t}equals(t){return!!t&&t.termType===this.termType&&t.value===this.value}}return n.prototype.termType="Variable",Ii=n,Ii}var Pi,Co;function Pl(){if(Co)return Pi;Co=1;const n=Fl(),e=su(),t=Rl(),r=Tl(),o=ou(),u=Al(),c=Il();function l(b){return new o(b)}function g(b){return new n(b)}function h(b,E){return typeof E=="string"?E.indexOf(":")===-1?new r(b,E):new r(b,null,R.namedNode(E)):new r(b,null,E)}function d(b){return new c(b)}function p(){return R.defaultGraphInstance}function x(b,E,A){return R.quad(b,E,A)}function T(b,E,A,k){return new u(b,E,A,k||R.defaultGraphInstance)}function S(b){return t.call(R,b)}function v(b){return t.call(R,b)}const R={namedNode:l,blankNode:g,literal:h,variable:d,defaultGraph:p,triple:x,quad:T,fromTerm:S,fromQuad:v,defaultGraphInstance:new e};return Pi=R,Pi}var Ci,ko;function au(){return ko||(ko=1,Ci=Pl()),Ci}var uu=au();const Qn=kn(uu),Cl=al({__proto__:null,default:Qn},[uu]);let Fr;Qn&&typeof Qn.namedNode=="function"?Fr=Qn:Fr=Cl;const Pt=Fr.quad,st=Fr.namedNode,ii=Fr.blankNode,cu=Fr.literal,si=Fr.defaultGraph;var ki={},pn={},No;function kl(){if(No)return pn;No=1,pn.byteLength=l,pn.toByteArray=h,pn.fromByteArray=x;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,u=r.length;o<u;++o)n[o]=r[o],e[r.charCodeAt(o)]=o;e[45]=62,e[95]=63;function c(T){var S=T.length;if(S%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var v=T.indexOf("=");v===-1&&(v=S);var R=v===S?0:4-v%4;return[v,R]}function l(T){var S=c(T),v=S[0],R=S[1];return(v+R)*3/4-R}function g(T,S,v){return(S+v)*3/4-v}function h(T){var S,v=c(T),R=v[0],b=v[1],E=new t(g(T,R,b)),A=0,k=b>0?R-4:R,D;for(D=0;D<k;D+=4)S=e[T.charCodeAt(D)]<<18|e[T.charCodeAt(D+1)]<<12|e[T.charCodeAt(D+2)]<<6|e[T.charCodeAt(D+3)],E[A++]=S>>16&255,E[A++]=S>>8&255,E[A++]=S&255;return b===2&&(S=e[T.charCodeAt(D)]<<2|e[T.charCodeAt(D+1)]>>4,E[A++]=S&255),b===1&&(S=e[T.charCodeAt(D)]<<10|e[T.charCodeAt(D+1)]<<4|e[T.charCodeAt(D+2)]>>2,E[A++]=S>>8&255,E[A++]=S&255),E}function d(T){return n[T>>18&63]+n[T>>12&63]+n[T>>6&63]+n[T&63]}function p(T,S,v){for(var R,b=[],E=S;E<v;E+=3)R=(T[E]<<16&16711680)+(T[E+1]<<8&65280)+(T[E+2]&255),b.push(d(R));return b.join("")}function x(T){for(var S,v=T.length,R=v%3,b=[],E=16383,A=0,k=v-R;A<k;A+=E)b.push(p(T,A,A+E>k?k:A+E));return R===1?(S=T[v-1],b.push(n[S>>2]+n[S<<4&63]+"==")):R===2&&(S=(T[v-2]<<8)+T[v-1],b.push(n[S>>10]+n[S>>4&63]+n[S<<2&63]+"=")),b.join("")}return pn}var Bn={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var Do;function Nl(){return Do||(Do=1,Bn.read=function(n,e,t,r,o){var u,c,l=o*8-r-1,g=(1<<l)-1,h=g>>1,d=-7,p=t?o-1:0,x=t?-1:1,T=n[e+p];for(p+=x,u=T&(1<<-d)-1,T>>=-d,d+=l;d>0;u=u*256+n[e+p],p+=x,d-=8);for(c=u&(1<<-d)-1,u>>=-d,d+=r;d>0;c=c*256+n[e+p],p+=x,d-=8);if(u===0)u=1-h;else{if(u===g)return c?NaN:(T?-1:1)*(1/0);c=c+Math.pow(2,r),u=u-h}return(T?-1:1)*c*Math.pow(2,u-r)},Bn.write=function(n,e,t,r,o,u){var c,l,g,h=u*8-o-1,d=(1<<h)-1,p=d>>1,x=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=r?0:u-1,S=r?1:-1,v=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,c=d):(c=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-c))<1&&(c--,g*=2),c+p>=1?e+=x/g:e+=x*Math.pow(2,1-p),e*g>=2&&(c++,g/=2),c+p>=d?(l=0,c=d):c+p>=1?(l=(e*g-1)*Math.pow(2,o),c=c+p):(l=e*Math.pow(2,p-1)*Math.pow(2,o),c=0));o>=8;n[t+T]=l&255,T+=S,l/=256,o-=8);for(c=c<<o|l,h+=o;h>0;n[t+T]=c&255,T+=S,c/=256,h-=8);n[t+T-S]|=v*128}),Bn}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Lo;function ir(){return Lo||(Lo=1,function(n){const e=kl(),t=Nl(),r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=l,n.SlowBuffer=E,n.INSPECT_MAX_BYTES=50;const o=2147483647;n.kMaxLength=o,l.TYPED_ARRAY_SUPPORT=u(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function u(){try{const N=new Uint8Array(1),w={foo:function(){return 42}};return Object.setPrototypeOf(w,Uint8Array.prototype),Object.setPrototypeOf(N,w),N.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function c(N){if(N>o)throw new RangeError('The value "'+N+'" is invalid for option "size"');const w=new Uint8Array(N);return Object.setPrototypeOf(w,l.prototype),w}function l(N,w,F){if(typeof N=="number"){if(typeof w=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(N)}return g(N,w,F)}l.poolSize=8192;function g(N,w,F){if(typeof N=="string")return x(N,w);if(ArrayBuffer.isView(N))return S(N);if(N==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof N);if(ye(N,ArrayBuffer)||N&&ye(N.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ye(N,SharedArrayBuffer)||N&&ye(N.buffer,SharedArrayBuffer)))return v(N,w,F);if(typeof N=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const _=N.valueOf&&N.valueOf();if(_!=null&&_!==N)return l.from(_,w,F);const ae=R(N);if(ae)return ae;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof N[Symbol.toPrimitive]=="function")return l.from(N[Symbol.toPrimitive]("string"),w,F);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof N)}l.from=function(N,w,F){return g(N,w,F)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function h(N){if(typeof N!="number")throw new TypeError('"size" argument must be of type number');if(N<0)throw new RangeError('The value "'+N+'" is invalid for option "size"')}function d(N,w,F){return h(N),N<=0?c(N):w!==void 0?typeof F=="string"?c(N).fill(w,F):c(N).fill(w):c(N)}l.alloc=function(N,w,F){return d(N,w,F)};function p(N){return h(N),c(N<0?0:b(N)|0)}l.allocUnsafe=function(N){return p(N)},l.allocUnsafeSlow=function(N){return p(N)};function x(N,w){if((typeof w!="string"||w==="")&&(w="utf8"),!l.isEncoding(w))throw new TypeError("Unknown encoding: "+w);const F=A(N,w)|0;let _=c(F);const ae=_.write(N,w);return ae!==F&&(_=_.slice(0,ae)),_}function T(N){const w=N.length<0?0:b(N.length)|0,F=c(w);for(let _=0;_<w;_+=1)F[_]=N[_]&255;return F}function S(N){if(ye(N,Uint8Array)){const w=new Uint8Array(N);return v(w.buffer,w.byteOffset,w.byteLength)}return T(N)}function v(N,w,F){if(w<0||N.byteLength<w)throw new RangeError('"offset" is outside of buffer bounds');if(N.byteLength<w+(F||0))throw new RangeError('"length" is outside of buffer bounds');let _;return w===void 0&&F===void 0?_=new Uint8Array(N):F===void 0?_=new Uint8Array(N,w):_=new Uint8Array(N,w,F),Object.setPrototypeOf(_,l.prototype),_}function R(N){if(l.isBuffer(N)){const w=b(N.length)|0,F=c(w);return F.length===0||N.copy(F,0,0,w),F}if(N.length!==void 0)return typeof N.length!="number"||We(N.length)?c(0):T(N);if(N.type==="Buffer"&&Array.isArray(N.data))return T(N.data)}function b(N){if(N>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return N|0}function E(N){return+N!=N&&(N=0),l.alloc(+N)}l.isBuffer=function(w){return w!=null&&w._isBuffer===!0&&w!==l.prototype},l.compare=function(w,F){if(ye(w,Uint8Array)&&(w=l.from(w,w.offset,w.byteLength)),ye(F,Uint8Array)&&(F=l.from(F,F.offset,F.byteLength)),!l.isBuffer(w)||!l.isBuffer(F))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(w===F)return 0;let _=w.length,ae=F.length;for(let ge=0,ce=Math.min(_,ae);ge<ce;++ge)if(w[ge]!==F[ge]){_=w[ge],ae=F[ge];break}return _<ae?-1:ae<_?1:0},l.isEncoding=function(w){switch(String(w).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(w,F){if(!Array.isArray(w))throw new TypeError('"list" argument must be an Array of Buffers');if(w.length===0)return l.alloc(0);let _;if(F===void 0)for(F=0,_=0;_<w.length;++_)F+=w[_].length;const ae=l.allocUnsafe(F);let ge=0;for(_=0;_<w.length;++_){let ce=w[_];if(ye(ce,Uint8Array))ge+ce.length>ae.length?(l.isBuffer(ce)||(ce=l.from(ce)),ce.copy(ae,ge)):Uint8Array.prototype.set.call(ae,ce,ge);else if(l.isBuffer(ce))ce.copy(ae,ge);else throw new TypeError('"list" argument must be an Array of Buffers');ge+=ce.length}return ae};function A(N,w){if(l.isBuffer(N))return N.length;if(ArrayBuffer.isView(N)||ye(N,ArrayBuffer))return N.byteLength;if(typeof N!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof N);const F=N.length,_=arguments.length>2&&arguments[2]===!0;if(!_&&F===0)return 0;let ae=!1;for(;;)switch(w){case"ascii":case"latin1":case"binary":return F;case"utf8":case"utf-8":return se(N).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F*2;case"hex":return F>>>1;case"base64":return Ee(N).length;default:if(ae)return _?-1:se(N).length;w=(""+w).toLowerCase(),ae=!0}}l.byteLength=A;function k(N,w,F){let _=!1;if((w===void 0||w<0)&&(w=0),w>this.length||((F===void 0||F>this.length)&&(F=this.length),F<=0)||(F>>>=0,w>>>=0,F<=w))return"";for(N||(N="utf8");;)switch(N){case"hex":return Te(this,w,F);case"utf8":case"utf-8":return ke(this,w,F);case"ascii":return Ne(this,w,F);case"latin1":case"binary":return pe(this,w,F);case"base64":return ue(this,w,F);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return K(this,w,F);default:if(_)throw new TypeError("Unknown encoding: "+N);N=(N+"").toLowerCase(),_=!0}}l.prototype._isBuffer=!0;function D(N,w,F){const _=N[w];N[w]=N[F],N[F]=_}l.prototype.swap16=function(){const w=this.length;if(w%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let F=0;F<w;F+=2)D(this,F,F+1);return this},l.prototype.swap32=function(){const w=this.length;if(w%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let F=0;F<w;F+=4)D(this,F,F+3),D(this,F+1,F+2);return this},l.prototype.swap64=function(){const w=this.length;if(w%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let F=0;F<w;F+=8)D(this,F,F+7),D(this,F+1,F+6),D(this,F+2,F+5),D(this,F+3,F+4);return this},l.prototype.toString=function(){const w=this.length;return w===0?"":arguments.length===0?ke(this,0,w):k.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(w){if(!l.isBuffer(w))throw new TypeError("Argument must be a Buffer");return this===w?!0:l.compare(this,w)===0},l.prototype.inspect=function(){let w="";const F=n.INSPECT_MAX_BYTES;return w=this.toString("hex",0,F).replace(/(.{2})/g,"$1 ").trim(),this.length>F&&(w+=" ... "),"<Buffer "+w+">"},r&&(l.prototype[r]=l.prototype.inspect),l.prototype.compare=function(w,F,_,ae,ge){if(ye(w,Uint8Array)&&(w=l.from(w,w.offset,w.byteLength)),!l.isBuffer(w))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof w);if(F===void 0&&(F=0),_===void 0&&(_=w?w.length:0),ae===void 0&&(ae=0),ge===void 0&&(ge=this.length),F<0||_>w.length||ae<0||ge>this.length)throw new RangeError("out of range index");if(ae>=ge&&F>=_)return 0;if(ae>=ge)return-1;if(F>=_)return 1;if(F>>>=0,_>>>=0,ae>>>=0,ge>>>=0,this===w)return 0;let ce=ge-ae,Ve=_-F;const rt=Math.min(ce,Ve),Ye=this.slice(ae,ge),Qe=w.slice(F,_);for(let ze=0;ze<rt;++ze)if(Ye[ze]!==Qe[ze]){ce=Ye[ze],Ve=Qe[ze];break}return ce<Ve?-1:Ve<ce?1:0};function B(N,w,F,_,ae){if(N.length===0)return-1;if(typeof F=="string"?(_=F,F=0):F>2147483647?F=2147483647:F<-2147483648&&(F=-2147483648),F=+F,We(F)&&(F=ae?0:N.length-1),F<0&&(F=N.length+F),F>=N.length){if(ae)return-1;F=N.length-1}else if(F<0)if(ae)F=0;else return-1;if(typeof w=="string"&&(w=l.from(w,_)),l.isBuffer(w))return w.length===0?-1:M(N,w,F,_,ae);if(typeof w=="number")return w=w&255,typeof Uint8Array.prototype.indexOf=="function"?ae?Uint8Array.prototype.indexOf.call(N,w,F):Uint8Array.prototype.lastIndexOf.call(N,w,F):M(N,[w],F,_,ae);throw new TypeError("val must be string, number or Buffer")}function M(N,w,F,_,ae){let ge=1,ce=N.length,Ve=w.length;if(_!==void 0&&(_=String(_).toLowerCase(),_==="ucs2"||_==="ucs-2"||_==="utf16le"||_==="utf-16le")){if(N.length<2||w.length<2)return-1;ge=2,ce/=2,Ve/=2,F/=2}function rt(Qe,ze){return ge===1?Qe[ze]:Qe.readUInt16BE(ze*ge)}let Ye;if(ae){let Qe=-1;for(Ye=F;Ye<ce;Ye++)if(rt(N,Ye)===rt(w,Qe===-1?0:Ye-Qe)){if(Qe===-1&&(Qe=Ye),Ye-Qe+1===Ve)return Qe*ge}else Qe!==-1&&(Ye-=Ye-Qe),Qe=-1}else for(F+Ve>ce&&(F=ce-Ve),Ye=F;Ye>=0;Ye--){let Qe=!0;for(let ze=0;ze<Ve;ze++)if(rt(N,Ye+ze)!==rt(w,ze)){Qe=!1;break}if(Qe)return Ye}return-1}l.prototype.includes=function(w,F,_){return this.indexOf(w,F,_)!==-1},l.prototype.indexOf=function(w,F,_){return B(this,w,F,_,!0)},l.prototype.lastIndexOf=function(w,F,_){return B(this,w,F,_,!1)};function ie(N,w,F,_){F=Number(F)||0;const ae=N.length-F;_?(_=Number(_),_>ae&&(_=ae)):_=ae;const ge=w.length;_>ge/2&&(_=ge/2);let ce;for(ce=0;ce<_;++ce){const Ve=parseInt(w.substr(ce*2,2),16);if(We(Ve))return ce;N[F+ce]=Ve}return ce}function he(N,w,F,_){return Ae(se(w,N.length-F),N,F,_)}function L(N,w,F,_){return Ae(_e(w),N,F,_)}function re(N,w,F,_){return Ae(Ee(w),N,F,_)}function be(N,w,F,_){return Ae(te(w,N.length-F),N,F,_)}l.prototype.write=function(w,F,_,ae){if(F===void 0)ae="utf8",_=this.length,F=0;else if(_===void 0&&typeof F=="string")ae=F,_=this.length,F=0;else if(isFinite(F))F=F>>>0,isFinite(_)?(_=_>>>0,ae===void 0&&(ae="utf8")):(ae=_,_=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ge=this.length-F;if((_===void 0||_>ge)&&(_=ge),w.length>0&&(_<0||F<0)||F>this.length)throw new RangeError("Attempt to write outside buffer bounds");ae||(ae="utf8");let ce=!1;for(;;)switch(ae){case"hex":return ie(this,w,F,_);case"utf8":case"utf-8":return he(this,w,F,_);case"ascii":case"latin1":case"binary":return L(this,w,F,_);case"base64":return re(this,w,F,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return be(this,w,F,_);default:if(ce)throw new TypeError("Unknown encoding: "+ae);ae=(""+ae).toLowerCase(),ce=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ue(N,w,F){return w===0&&F===N.length?e.fromByteArray(N):e.fromByteArray(N.slice(w,F))}function ke(N,w,F){F=Math.min(N.length,F);const _=[];let ae=w;for(;ae<F;){const ge=N[ae];let ce=null,Ve=ge>239?4:ge>223?3:ge>191?2:1;if(ae+Ve<=F){let rt,Ye,Qe,ze;switch(Ve){case 1:ge<128&&(ce=ge);break;case 2:rt=N[ae+1],(rt&192)===128&&(ze=(ge&31)<<6|rt&63,ze>127&&(ce=ze));break;case 3:rt=N[ae+1],Ye=N[ae+2],(rt&192)===128&&(Ye&192)===128&&(ze=(ge&15)<<12|(rt&63)<<6|Ye&63,ze>2047&&(ze<55296||ze>57343)&&(ce=ze));break;case 4:rt=N[ae+1],Ye=N[ae+2],Qe=N[ae+3],(rt&192)===128&&(Ye&192)===128&&(Qe&192)===128&&(ze=(ge&15)<<18|(rt&63)<<12|(Ye&63)<<6|Qe&63,ze>65535&&ze<1114112&&(ce=ze))}}ce===null?(ce=65533,Ve=1):ce>65535&&(ce-=65536,_.push(ce>>>10&1023|55296),ce=56320|ce&1023),_.push(ce),ae+=Ve}return fe(_)}const ne=4096;function fe(N){const w=N.length;if(w<=ne)return String.fromCharCode.apply(String,N);let F="",_=0;for(;_<w;)F+=String.fromCharCode.apply(String,N.slice(_,_+=ne));return F}function Ne(N,w,F){let _="";F=Math.min(N.length,F);for(let ae=w;ae<F;++ae)_+=String.fromCharCode(N[ae]&127);return _}function pe(N,w,F){let _="";F=Math.min(N.length,F);for(let ae=w;ae<F;++ae)_+=String.fromCharCode(N[ae]);return _}function Te(N,w,F){const _=N.length;(!w||w<0)&&(w=0),(!F||F<0||F>_)&&(F=_);let ae="";for(let ge=w;ge<F;++ge)ae+=Xe[N[ge]];return ae}function K(N,w,F){const _=N.slice(w,F);let ae="";for(let ge=0;ge<_.length-1;ge+=2)ae+=String.fromCharCode(_[ge]+_[ge+1]*256);return ae}l.prototype.slice=function(w,F){const _=this.length;w=~~w,F=F===void 0?_:~~F,w<0?(w+=_,w<0&&(w=0)):w>_&&(w=_),F<0?(F+=_,F<0&&(F=0)):F>_&&(F=_),F<w&&(F=w);const ae=this.subarray(w,F);return Object.setPrototypeOf(ae,l.prototype),ae};function me(N,w,F){if(N%1!==0||N<0)throw new RangeError("offset is not uint");if(N+w>F)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(w,F,_){w=w>>>0,F=F>>>0,_||me(w,F,this.length);let ae=this[w],ge=1,ce=0;for(;++ce<F&&(ge*=256);)ae+=this[w+ce]*ge;return ae},l.prototype.readUintBE=l.prototype.readUIntBE=function(w,F,_){w=w>>>0,F=F>>>0,_||me(w,F,this.length);let ae=this[w+--F],ge=1;for(;F>0&&(ge*=256);)ae+=this[w+--F]*ge;return ae},l.prototype.readUint8=l.prototype.readUInt8=function(w,F){return w=w>>>0,F||me(w,1,this.length),this[w]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(w,F){return w=w>>>0,F||me(w,2,this.length),this[w]|this[w+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(w,F){return w=w>>>0,F||me(w,2,this.length),this[w]<<8|this[w+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(w,F){return w=w>>>0,F||me(w,4,this.length),(this[w]|this[w+1]<<8|this[w+2]<<16)+this[w+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(w,F){return w=w>>>0,F||me(w,4,this.length),this[w]*16777216+(this[w+1]<<16|this[w+2]<<8|this[w+3])},l.prototype.readBigUInt64LE=je(function(w){w=w>>>0,y(w,"offset");const F=this[w],_=this[w+7];(F===void 0||_===void 0)&&C(w,this.length-8);const ae=F+this[++w]*2**8+this[++w]*2**16+this[++w]*2**24,ge=this[++w]+this[++w]*2**8+this[++w]*2**16+_*2**24;return BigInt(ae)+(BigInt(ge)<<BigInt(32))}),l.prototype.readBigUInt64BE=je(function(w){w=w>>>0,y(w,"offset");const F=this[w],_=this[w+7];(F===void 0||_===void 0)&&C(w,this.length-8);const ae=F*2**24+this[++w]*2**16+this[++w]*2**8+this[++w],ge=this[++w]*2**24+this[++w]*2**16+this[++w]*2**8+_;return(BigInt(ae)<<BigInt(32))+BigInt(ge)}),l.prototype.readIntLE=function(w,F,_){w=w>>>0,F=F>>>0,_||me(w,F,this.length);let ae=this[w],ge=1,ce=0;for(;++ce<F&&(ge*=256);)ae+=this[w+ce]*ge;return ge*=128,ae>=ge&&(ae-=Math.pow(2,8*F)),ae},l.prototype.readIntBE=function(w,F,_){w=w>>>0,F=F>>>0,_||me(w,F,this.length);let ae=F,ge=1,ce=this[w+--ae];for(;ae>0&&(ge*=256);)ce+=this[w+--ae]*ge;return ge*=128,ce>=ge&&(ce-=Math.pow(2,8*F)),ce},l.prototype.readInt8=function(w,F){return w=w>>>0,F||me(w,1,this.length),this[w]&128?(255-this[w]+1)*-1:this[w]},l.prototype.readInt16LE=function(w,F){w=w>>>0,F||me(w,2,this.length);const _=this[w]|this[w+1]<<8;return _&32768?_|4294901760:_},l.prototype.readInt16BE=function(w,F){w=w>>>0,F||me(w,2,this.length);const _=this[w+1]|this[w]<<8;return _&32768?_|4294901760:_},l.prototype.readInt32LE=function(w,F){return w=w>>>0,F||me(w,4,this.length),this[w]|this[w+1]<<8|this[w+2]<<16|this[w+3]<<24},l.prototype.readInt32BE=function(w,F){return w=w>>>0,F||me(w,4,this.length),this[w]<<24|this[w+1]<<16|this[w+2]<<8|this[w+3]},l.prototype.readBigInt64LE=je(function(w){w=w>>>0,y(w,"offset");const F=this[w],_=this[w+7];(F===void 0||_===void 0)&&C(w,this.length-8);const ae=this[w+4]+this[w+5]*2**8+this[w+6]*2**16+(_<<24);return(BigInt(ae)<<BigInt(32))+BigInt(F+this[++w]*2**8+this[++w]*2**16+this[++w]*2**24)}),l.prototype.readBigInt64BE=je(function(w){w=w>>>0,y(w,"offset");const F=this[w],_=this[w+7];(F===void 0||_===void 0)&&C(w,this.length-8);const ae=(F<<24)+this[++w]*2**16+this[++w]*2**8+this[++w];return(BigInt(ae)<<BigInt(32))+BigInt(this[++w]*2**24+this[++w]*2**16+this[++w]*2**8+_)}),l.prototype.readFloatLE=function(w,F){return w=w>>>0,F||me(w,4,this.length),t.read(this,w,!0,23,4)},l.prototype.readFloatBE=function(w,F){return w=w>>>0,F||me(w,4,this.length),t.read(this,w,!1,23,4)},l.prototype.readDoubleLE=function(w,F){return w=w>>>0,F||me(w,8,this.length),t.read(this,w,!0,52,8)},l.prototype.readDoubleBE=function(w,F){return w=w>>>0,F||me(w,8,this.length),t.read(this,w,!1,52,8)};function Ie(N,w,F,_,ae,ge){if(!l.isBuffer(N))throw new TypeError('"buffer" argument must be a Buffer instance');if(w>ae||w<ge)throw new RangeError('"value" argument is out of bounds');if(F+_>N.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(w,F,_,ae){if(w=+w,F=F>>>0,_=_>>>0,!ae){const Ve=Math.pow(2,8*_)-1;Ie(this,w,F,_,Ve,0)}let ge=1,ce=0;for(this[F]=w&255;++ce<_&&(ge*=256);)this[F+ce]=w/ge&255;return F+_},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(w,F,_,ae){if(w=+w,F=F>>>0,_=_>>>0,!ae){const Ve=Math.pow(2,8*_)-1;Ie(this,w,F,_,Ve,0)}let ge=_-1,ce=1;for(this[F+ge]=w&255;--ge>=0&&(ce*=256);)this[F+ge]=w/ce&255;return F+_},l.prototype.writeUint8=l.prototype.writeUInt8=function(w,F,_){return w=+w,F=F>>>0,_||Ie(this,w,F,1,255,0),this[F]=w&255,F+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(w,F,_){return w=+w,F=F>>>0,_||Ie(this,w,F,2,65535,0),this[F]=w&255,this[F+1]=w>>>8,F+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(w,F,_){return w=+w,F=F>>>0,_||Ie(this,w,F,2,65535,0),this[F]=w>>>8,this[F+1]=w&255,F+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(w,F,_){return w=+w,F=F>>>0,_||Ie(this,w,F,4,4294967295,0),this[F+3]=w>>>24,this[F+2]=w>>>16,this[F+1]=w>>>8,this[F]=w&255,F+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(w,F,_){return w=+w,F=F>>>0,_||Ie(this,w,F,4,4294967295,0),this[F]=w>>>24,this[F+1]=w>>>16,this[F+2]=w>>>8,this[F+3]=w&255,F+4};function Fe(N,w,F,_,ae){I(w,_,ae,N,F,7);let ge=Number(w&BigInt(4294967295));N[F++]=ge,ge=ge>>8,N[F++]=ge,ge=ge>>8,N[F++]=ge,ge=ge>>8,N[F++]=ge;let ce=Number(w>>BigInt(32)&BigInt(4294967295));return N[F++]=ce,ce=ce>>8,N[F++]=ce,ce=ce>>8,N[F++]=ce,ce=ce>>8,N[F++]=ce,F}function De(N,w,F,_,ae){I(w,_,ae,N,F,7);let ge=Number(w&BigInt(4294967295));N[F+7]=ge,ge=ge>>8,N[F+6]=ge,ge=ge>>8,N[F+5]=ge,ge=ge>>8,N[F+4]=ge;let ce=Number(w>>BigInt(32)&BigInt(4294967295));return N[F+3]=ce,ce=ce>>8,N[F+2]=ce,ce=ce>>8,N[F+1]=ce,ce=ce>>8,N[F]=ce,F+8}l.prototype.writeBigUInt64LE=je(function(w,F=0){return Fe(this,w,F,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=je(function(w,F=0){return De(this,w,F,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(w,F,_,ae){if(w=+w,F=F>>>0,!ae){const rt=Math.pow(2,8*_-1);Ie(this,w,F,_,rt-1,-rt)}let ge=0,ce=1,Ve=0;for(this[F]=w&255;++ge<_&&(ce*=256);)w<0&&Ve===0&&this[F+ge-1]!==0&&(Ve=1),this[F+ge]=(w/ce>>0)-Ve&255;return F+_},l.prototype.writeIntBE=function(w,F,_,ae){if(w=+w,F=F>>>0,!ae){const rt=Math.pow(2,8*_-1);Ie(this,w,F,_,rt-1,-rt)}let ge=_-1,ce=1,Ve=0;for(this[F+ge]=w&255;--ge>=0&&(ce*=256);)w<0&&Ve===0&&this[F+ge+1]!==0&&(Ve=1),this[F+ge]=(w/ce>>0)-Ve&255;return F+_},l.prototype.writeInt8=function(w,F,_){return w=+w,F=F>>>0,_||Ie(this,w,F,1,127,-128),w<0&&(w=255+w+1),this[F]=w&255,F+1},l.prototype.writeInt16LE=function(w,F,_){return w=+w,F=F>>>0,_||Ie(this,w,F,2,32767,-32768),this[F]=w&255,this[F+1]=w>>>8,F+2},l.prototype.writeInt16BE=function(w,F,_){return w=+w,F=F>>>0,_||Ie(this,w,F,2,32767,-32768),this[F]=w>>>8,this[F+1]=w&255,F+2},l.prototype.writeInt32LE=function(w,F,_){return w=+w,F=F>>>0,_||Ie(this,w,F,4,2147483647,-2147483648),this[F]=w&255,this[F+1]=w>>>8,this[F+2]=w>>>16,this[F+3]=w>>>24,F+4},l.prototype.writeInt32BE=function(w,F,_){return w=+w,F=F>>>0,_||Ie(this,w,F,4,2147483647,-2147483648),w<0&&(w=4294967295+w+1),this[F]=w>>>24,this[F+1]=w>>>16,this[F+2]=w>>>8,this[F+3]=w&255,F+4},l.prototype.writeBigInt64LE=je(function(w,F=0){return Fe(this,w,F,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=je(function(w,F=0){return De(this,w,F,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Oe(N,w,F,_,ae,ge){if(F+_>N.length)throw new RangeError("Index out of range");if(F<0)throw new RangeError("Index out of range")}function $e(N,w,F,_,ae){return w=+w,F=F>>>0,ae||Oe(N,w,F,4),t.write(N,w,F,_,23,4),F+4}l.prototype.writeFloatLE=function(w,F,_){return $e(this,w,F,!0,_)},l.prototype.writeFloatBE=function(w,F,_){return $e(this,w,F,!1,_)};function He(N,w,F,_,ae){return w=+w,F=F>>>0,ae||Oe(N,w,F,8),t.write(N,w,F,_,52,8),F+8}l.prototype.writeDoubleLE=function(w,F,_){return He(this,w,F,!0,_)},l.prototype.writeDoubleBE=function(w,F,_){return He(this,w,F,!1,_)},l.prototype.copy=function(w,F,_,ae){if(!l.isBuffer(w))throw new TypeError("argument should be a Buffer");if(_||(_=0),!ae&&ae!==0&&(ae=this.length),F>=w.length&&(F=w.length),F||(F=0),ae>0&&ae<_&&(ae=_),ae===_||w.length===0||this.length===0)return 0;if(F<0)throw new RangeError("targetStart out of bounds");if(_<0||_>=this.length)throw new RangeError("Index out of range");if(ae<0)throw new RangeError("sourceEnd out of bounds");ae>this.length&&(ae=this.length),w.length-F<ae-_&&(ae=w.length-F+_);const ge=ae-_;return this===w&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(F,_,ae):Uint8Array.prototype.set.call(w,this.subarray(_,ae),F),ge},l.prototype.fill=function(w,F,_,ae){if(typeof w=="string"){if(typeof F=="string"?(ae=F,F=0,_=this.length):typeof _=="string"&&(ae=_,_=this.length),ae!==void 0&&typeof ae!="string")throw new TypeError("encoding must be a string");if(typeof ae=="string"&&!l.isEncoding(ae))throw new TypeError("Unknown encoding: "+ae);if(w.length===1){const ce=w.charCodeAt(0);(ae==="utf8"&&ce<128||ae==="latin1")&&(w=ce)}}else typeof w=="number"?w=w&255:typeof w=="boolean"&&(w=Number(w));if(F<0||this.length<F||this.length<_)throw new RangeError("Out of range index");if(_<=F)return this;F=F>>>0,_=_===void 0?this.length:_>>>0,w||(w=0);let ge;if(typeof w=="number")for(ge=F;ge<_;++ge)this[ge]=w;else{const ce=l.isBuffer(w)?w:l.from(w,ae),Ve=ce.length;if(Ve===0)throw new TypeError('The value "'+w+'" is invalid for argument "value"');for(ge=0;ge<_-F;++ge)this[ge+F]=ce[ge%Ve]}return this};const Se={};function Re(N,w,F){Se[N]=class extends F{constructor(){super(),Object.defineProperty(this,"message",{value:w.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${N}]`,this.stack,delete this.name}get code(){return N}set code(ae){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:ae,writable:!0})}toString(){return`${this.name} [${N}]: ${this.message}`}}}Re("ERR_BUFFER_OUT_OF_BOUNDS",function(N){return N?`${N} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Re("ERR_INVALID_ARG_TYPE",function(N,w){return`The "${N}" argument must be of type number. Received type ${typeof w}`},TypeError),Re("ERR_OUT_OF_RANGE",function(N,w,F){let _=`The value of "${N}" is out of range.`,ae=F;return Number.isInteger(F)&&Math.abs(F)>2**32?ae=Ce(String(F)):typeof F=="bigint"&&(ae=String(F),(F>BigInt(2)**BigInt(32)||F<-(BigInt(2)**BigInt(32)))&&(ae=Ce(ae)),ae+="n"),_+=` It must be ${w}. Received ${ae}`,_},RangeError);function Ce(N){let w="",F=N.length;const _=N[0]==="-"?1:0;for(;F>=_+4;F-=3)w=`_${N.slice(F-3,F)}${w}`;return`${N.slice(0,F)}${w}`}function V(N,w,F){y(w,"offset"),(N[w]===void 0||N[w+F]===void 0)&&C(w,N.length-(F+1))}function I(N,w,F,_,ae,ge){if(N>F||N<w){const ce=typeof w=="bigint"?"n":"";let Ve;throw w===0||w===BigInt(0)?Ve=`>= 0${ce} and < 2${ce} ** ${(ge+1)*8}${ce}`:Ve=`>= -(2${ce} ** ${(ge+1)*8-1}${ce}) and < 2 ** ${(ge+1)*8-1}${ce}`,new Se.ERR_OUT_OF_RANGE("value",Ve,N)}V(_,ae,ge)}function y(N,w){if(typeof N!="number")throw new Se.ERR_INVALID_ARG_TYPE(w,"number",N)}function C(N,w,F){throw Math.floor(N)!==N?(y(N,F),new Se.ERR_OUT_OF_RANGE("offset","an integer",N)):w<0?new Se.ERR_BUFFER_OUT_OF_BOUNDS:new Se.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${w}`,N)}const O=/[^+/0-9A-Za-z-_]/g;function X(N){if(N=N.split("=")[0],N=N.trim().replace(O,""),N.length<2)return"";for(;N.length%4!==0;)N=N+"=";return N}function se(N,w){w=w||1/0;let F;const _=N.length;let ae=null;const ge=[];for(let ce=0;ce<_;++ce){if(F=N.charCodeAt(ce),F>55295&&F<57344){if(!ae){if(F>56319){(w-=3)>-1&&ge.push(239,191,189);continue}else if(ce+1===_){(w-=3)>-1&&ge.push(239,191,189);continue}ae=F;continue}if(F<56320){(w-=3)>-1&&ge.push(239,191,189),ae=F;continue}F=(ae-55296<<10|F-56320)+65536}else ae&&(w-=3)>-1&&ge.push(239,191,189);if(ae=null,F<128){if((w-=1)<0)break;ge.push(F)}else if(F<2048){if((w-=2)<0)break;ge.push(F>>6|192,F&63|128)}else if(F<65536){if((w-=3)<0)break;ge.push(F>>12|224,F>>6&63|128,F&63|128)}else if(F<1114112){if((w-=4)<0)break;ge.push(F>>18|240,F>>12&63|128,F>>6&63|128,F&63|128)}else throw new Error("Invalid code point")}return ge}function _e(N){const w=[];for(let F=0;F<N.length;++F)w.push(N.charCodeAt(F)&255);return w}function te(N,w){let F,_,ae;const ge=[];for(let ce=0;ce<N.length&&!((w-=2)<0);++ce)F=N.charCodeAt(ce),_=F>>8,ae=F%256,ge.push(ae),ge.push(_);return ge}function Ee(N){return e.toByteArray(X(N))}function Ae(N,w,F,_){let ae;for(ae=0;ae<_&&!(ae+F>=w.length||ae>=N.length);++ae)w[ae+F]=N[ae];return ae}function ye(N,w){return N instanceof w||N!=null&&N.constructor!=null&&N.constructor.name!=null&&N.constructor.name===w.name}function We(N){return N!==N}const Xe=function(){const N="0123456789abcdef",w=new Array(256);for(let F=0;F<16;++F){const _=F*16;for(let ae=0;ae<16;++ae)w[_+ae]=N[F]+N[ae]}return w}();function je(N){return typeof BigInt>"u"?Je:N}function Je(){throw new Error("BigInt not supported")}}(ki)),ki}var Dl=ir();const gn="http://www.w3.org/1999/02/22-rdf-syntax-ns#",yn="http://www.w3.org/2001/XMLSchema#",Mn="http://www.w3.org/2000/10/swap/",Et={xsd:{decimal:`${yn}decimal`,boolean:`${yn}boolean`,double:`${yn}double`,integer:`${yn}integer`,string:`${yn}string`},rdf:{type:`${gn}type`,nil:`${gn}nil`,first:`${gn}first`,rest:`${gn}rest`,langString:`${gn}langString`},owl:{sameAs:"http://www.w3.org/2002/07/owl#sameAs"},r:{forSome:`${Mn}reify#forSome`,forAll:`${Mn}reify#forAll`},log:{implies:`${Mn}log#implies`,isImpliedBy:`${Mn}log#isImpliedBy`}},{xsd:Hn}=Et,Ll=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\([^])/g,jo={"\\":"\\","'":"'",'"':'"',n:`
`,r:"\r",t:"	",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},jl=/[\x00-\x20<>\\"\{\}\|\^\`]/,Ul={},Ol=/$0^/;class Bl{constructor(e){if(this._iri=/^<((?:[^ <>{}\\]|\\[uU])+)>[ \t]*/,this._unescapedIri=/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>[ \t]*/,this._simpleQuotedString=/^"([^"\\\r\n]*)"(?=[^"])/,this._simpleApostropheString=/^'([^'\\\r\n]*)'(?=[^'])/,this._langcode=/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,this._prefix=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,this._prefixed=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?:[ \t]+|(?=\.?[,;!\^\s#()\[\]\{\}"'<>]))/,this._variable=/^\?(?:(?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=[.,;!\^\s#()\[\]\{\}"'<>])/,this._blank=/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?:[ \t]+|(?=\.?[,;:\s#()\[\]\{\}"'<>]))/,this._number=/^[\-+]?(?:(\d+\.\d*|\.?\d+)[eE][\-+]?|\d*(\.)?)\d+(?=\.?[,;:\s#()\[\]\{\}"'<>])/,this._boolean=/^(?:true|false)(?=[.,;\s#()\[\]\{\}"'<>])/,this._keyword=/^@[a-z]+(?=[\s#<:])/i,this._sparqlKeyword=/^(?:PREFIX|BASE|GRAPH)(?=[\s#<])/i,this._shortPredicates=/^a(?=[\s#()\[\]\{\}"'<>])/,this._newline=/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,this._comment=/#([^\n\r]*)/,this._whitespace=/^[ \t]+/,this._endOfFile=/^(?:#[^\n\r]*)?$/,e=e||{},this._isImpliedBy=e.isImpliedBy,this._lineMode=!!e.lineMode){this._n3Mode=!1;for(const t in this)!(t in Ul)&&this[t]instanceof RegExp&&(this[t]=Ol)}else this._n3Mode=e.n3!==!1;this.comments=!!e.comments,this._literalClosingPos=0}_tokenizeToEnd(e,t){let r=this._input,o=r.length;for(;;){let l,g;for(;l=this._newline.exec(r);)this.comments&&(g=this._comment.exec(l[0]))&&u("comment",g[1],"",this._line,l[0].length),r=r.substr(l[0].length,r.length),o=r.length,this._line++;if(!l&&(l=this._whitespace.exec(r))&&(r=r.substr(l[0].length,r.length)),this._endOfFile.test(r))return t&&(this.comments&&(g=this._comment.exec(r))&&u("comment",g[1],"",this._line,r.length),r=null,u("eof","","",this._line,0)),this._input=r;const h=this._line,d=r[0];let p="",x="",T="",S=null,v=0,R=!1;switch(d){case"^":if(r.length<3)break;if(r[1]==="^"){if(this._previousMarker="^^",r=r.substr(2),r[0]!=="<"){R=!0;break}}else{this._n3Mode&&(v=1,p="^");break}case"<":if(S=this._unescapedIri.exec(r))p="IRI",x=S[1];else if(S=this._iri.exec(r)){if(x=this._unescape(S[1]),x===null||jl.test(x))return c(this);p="IRI"}else r.length>1&&r[1]==="<"?(p="<<",v=2):this._n3Mode&&r.length>1&&r[1]==="="&&(v=2,this._isImpliedBy?(p="abbreviation",x="<"):(p="inverse",x=">"));break;case">":r.length>1&&r[1]===">"&&(p=">>",v=2);break;case"_":((S=this._blank.exec(r))||t&&(S=this._blank.exec(`${r} `)))&&(p="blank",T="_",x=S[1]);break;case'"':if(S=this._simpleQuotedString.exec(r))x=S[1];else if({value:x,matchLength:v}=this._parseLiteral(r),x===null)return c(this);(S!==null||v!==0)&&(p="literal",this._literalClosingPos=0);break;case"'":if(!this._lineMode){if(S=this._simpleApostropheString.exec(r))x=S[1];else if({value:x,matchLength:v}=this._parseLiteral(r),x===null)return c(this);(S!==null||v!==0)&&(p="literal",this._literalClosingPos=0)}break;case"?":this._n3Mode&&(S=this._variable.exec(r))&&(p="var",x=S[0]);break;case"@":this._previousMarker==="literal"&&(S=this._langcode.exec(r))?(p="langcode",x=S[1]):(S=this._keyword.exec(r))&&(p=S[0]);break;case".":if(r.length===1?t:r[1]<"0"||r[1]>"9"){p=".",v=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(S=this._number.exec(r)||t&&(S=this._number.exec(`${r} `)))&&(p="literal",x=S[0],T=typeof S[1]=="string"?Hn.double:typeof S[2]=="string"?Hn.decimal:Hn.integer);break;case"B":case"b":case"p":case"P":case"G":case"g":(S=this._sparqlKeyword.exec(r))?p=S[0].toUpperCase():R=!0;break;case"f":case"t":(S=this._boolean.exec(r))?(p="literal",x=S[0],T=Hn.boolean):R=!0;break;case"a":(S=this._shortPredicates.exec(r))?(p="abbreviation",x="a"):R=!0;break;case"=":this._n3Mode&&r.length>1&&(p="abbreviation",r[1]!==">"?(v=1,x="="):(v=2,x=">"));break;case"!":if(!this._n3Mode)break;case",":case";":case"[":case"]":case"(":case")":case"}":this._lineMode||(v=1,p=d);break;case"{":!this._lineMode&&r.length>=2&&(r[1]==="|"?(p="{|",v=2):(p=d,v=1));break;case"|":r.length>=2&&r[1]==="}"&&(p="|}",v=2);break;default:R=!0}if(R&&((this._previousMarker==="@prefix"||this._previousMarker==="PREFIX")&&(S=this._prefix.exec(r))?(p="prefix",x=S[1]||""):((S=this._prefixed.exec(r))||t&&(S=this._prefixed.exec(`${r} `)))&&(p="prefixed",T=S[1]||"",x=this._unescape(S[2]))),this._previousMarker==="^^")switch(p){case"prefixed":p="type";break;case"IRI":p="typeIRI";break;default:p=""}if(!p)return t||!/^'''|^"""/.test(r)&&/\n|\r/.test(r)?c(this):this._input=r;const b=v||S[0].length,E=u(p,x,T,h,b);this.previousToken=E,this._previousMarker=p,r=r.substr(b,r.length)}function u(l,g,h,d,p){const x=r?o-r.length:o,T=x+p,S={type:l,value:g,prefix:h,line:d,start:x,end:T};return e(null,S),S}function c(l){e(l._syntaxError(/^\S*/.exec(r)[0]))}}_unescape(e){let t=!1;const r=e.replace(Ll,(o,u,c,l)=>{if(typeof u=="string")return String.fromCharCode(Number.parseInt(u,16));if(typeof c=="string"){let g=Number.parseInt(c,16);return g<=65535?String.fromCharCode(Number.parseInt(c,16)):String.fromCharCode(55296+((g-=65536)>>10),56320+(g&1023))}return l in jo?jo[l]:(t=!0,"")});return t?null:r}_parseLiteral(e){if(e.length>=3){const t=e.match(/^(?:"""|"|'''|'|)/)[0],r=t.length;let o=Math.max(this._literalClosingPos,r);for(;(o=e.indexOf(t,o))>0;){let u=0;for(;e[o-u-1]==="\\";)u++;if(u%2===0){const c=e.substring(r,o),l=c.split(/\r\n|\r|\n/).length-1,g=o+r;if(r===1&&l!==0||r===3&&this._lineMode)break;return this._line+=l,{value:this._unescape(c),matchLength:g}}o++}this._literalClosingPos=e.length-r+1}return{value:"",matchLength:0}}_syntaxError(e){this._input=null;const t=new Error(`Unexpected "${e}" on line ${this._line}.`);return t.context={token:void 0,line:this._line,previousToken:this.previousToken},t}_readStartingBom(e){return e.startsWith("\uFEFF")?e.substr(1):e}tokenize(e,t){if(this._line=1,typeof e=="string")if(this._input=this._readStartingBom(e),typeof t=="function")queueMicrotask(()=>this._tokenizeToEnd(t,!0));else{const r=[];let o;if(this._tokenizeToEnd((u,c)=>u?o=u:r.push(c),!0),o)throw o;return r}else this._pendingBuffer=null,typeof e.setEncoding=="function"&&e.setEncoding("utf8"),e.on("data",r=>{this._input!==null&&r.length!==0&&(this._pendingBuffer&&(r=Dl.Buffer.concat([this._pendingBuffer,r]),this._pendingBuffer=null),r[r.length-1]&128?this._pendingBuffer=r:(typeof this._input>"u"?this._input=this._readStartingBom(typeof r=="string"?r:r.toString()):this._input+=r,this._tokenizeToEnd(t,!1)))}),e.on("end",()=>{typeof this._input=="string"&&this._tokenizeToEnd(t,!0)}),e.on("error",t)}}const{rdf:Ml,xsd:Sr}=Et;let Vr,Hl=0;const mt={namedNode:fu,blankNode:du,variable:gu,literal:pu,defaultGraph:$l,quad:vs,triple:vs,fromTerm:Sn,fromQuad:yu};class Vt{constructor(e){this.id=e}get value(){return this.id}equals(e){return e instanceof Vt?this.id===e.id:!!e&&this.termType===e.termType&&this.value===e.value}hashCode(){return 0}toJSON(){return{termType:this.termType,value:this.value}}}class lu extends Vt{get termType(){return"NamedNode"}}class Kr extends Vt{get termType(){return"Literal"}get value(){return this.id.substring(1,this.id.lastIndexOf('"'))}get language(){const e=this.id;let t=e.lastIndexOf('"')+1;return t<e.length&&e[t++]==="@"?e.substr(t).toLowerCase():""}get datatype(){return new lu(this.datatypeString)}get datatypeString(){const e=this.id,t=e.lastIndexOf('"')+1,r=t<e.length?e[t]:"";return r==="^"?e.substr(t+2):r!=="@"?Sr.string:Ml.langString}equals(e){return e instanceof Kr?this.id===e.id:!!e&&!!e.datatype&&this.termType===e.termType&&this.value===e.value&&this.language===e.language&&this.datatype.value===e.datatype.value}toJSON(){return{termType:this.termType,value:this.value,language:this.language,datatype:{termType:"NamedNode",value:this.datatypeString}}}}class Kl extends Vt{constructor(e){super(`_:${e}`)}get termType(){return"BlankNode"}get value(){return this.id.substr(2)}}class ql extends Vt{constructor(e){super(`?${e}`)}get termType(){return"Variable"}get value(){return this.id.substr(1)}}class Wl extends Vt{constructor(){return super(""),Vr||this}get termType(){return"DefaultGraph"}equals(e){return this===e||!!e&&this.termType===e.termType}}Vr=new Wl;function vn(n,e,t){if(e=e||mt,!n)return e.defaultGraph();switch(n[0]){case"?":return e.variable(n.substr(1));case"_":return e.blankNode(n.substr(2));case'"':if(e===mt)return new Kr(n);if(n[n.length-1]==='"')return e.literal(n.substr(1,n.length-2));const r=n.lastIndexOf('"',n.length-1);return e.literal(n.substr(1,r-1),n[r+1]==="@"?n.substr(r+2):e.namedNode(n.substr(r+3)));case"[":n=JSON.parse(n);break;default:if(!t||!Array.isArray(n))return e.namedNode(n)}return e.quad(vn(n[0],e,!0),vn(n[1],e,!0),vn(n[2],e,!0),n[3]&&vn(n[3],e,!0))}function Mr(n,e){if(typeof n=="string")return n;if(n instanceof Vt&&n.termType!=="Quad")return n.id;if(!n)return Vr.id;switch(n.termType){case"NamedNode":return n.value;case"BlankNode":return`_:${n.value}`;case"Variable":return`?${n.value}`;case"DefaultGraph":return"";case"Literal":return`"${n.value}"${n.language?`@${n.language}`:n.datatype&&n.datatype.value!==Sr.string?`^^${n.datatype.value}`:""}`;case"Quad":const t=[Mr(n.subject,!0),Mr(n.predicate,!0),Mr(n.object,!0)];return n.graph&&n.graph.termType!=="DefaultGraph"&&t.push(Mr(n.graph,!0)),e?t:JSON.stringify(t);default:throw new Error(`Unexpected termType: ${n.termType}`)}}class hu extends Vt{constructor(e,t,r,o){super(""),this._subject=e,this._predicate=t,this._object=r,this._graph=o||Vr}get termType(){return"Quad"}get subject(){return this._subject}get predicate(){return this._predicate}get object(){return this._object}get graph(){return this._graph}toJSON(){return{termType:this.termType,subject:this._subject.toJSON(),predicate:this._predicate.toJSON(),object:this._object.toJSON(),graph:this._graph.toJSON()}}equals(e){return!!e&&this._subject.equals(e.subject)&&this._predicate.equals(e.predicate)&&this._object.equals(e.object)&&this._graph.equals(e.graph)}}function fu(n){return new lu(n)}function du(n){return new Kl(n||`n3-${Hl++}`)}function pu(n,e){if(typeof e=="string")return new Kr(`"${n}"@${e.toLowerCase()}`);let t=e?e.value:"";return t===""&&(typeof n=="boolean"?t=Sr.boolean:typeof n=="number"&&(Number.isFinite(n)?t=Number.isInteger(n)?Sr.integer:Sr.double:(t=Sr.double,Number.isNaN(n)||(n=n>0?"INF":"-INF")))),t===""||t===Sr.string?new Kr(`"${n}"`):new Kr(`"${n}"^^${t}`)}function gu(n){return new ql(n)}function $l(){return Vr}function vs(n,e,t,r){return new hu(n,e,t,r)}function Sn(n){if(n instanceof Vt)return n;switch(n.termType){case"NamedNode":return fu(n.value);case"BlankNode":return du(n.value);case"Variable":return gu(n.value);case"DefaultGraph":return Vr;case"Literal":return pu(n.value,n.language||n.datatype);case"Quad":return yu(n);default:throw new Error(`Unexpected termType: ${n.termType}`)}}function yu(n){if(n instanceof hu)return n;if(n.termType!=="Quad")throw new Error(`Unexpected termType: ${n.termType}`);return vs(Sn(n.subject),Sn(n.predicate),Sn(n.object),Sn(n.graph))}let Uo=0;class Os{constructor(e){this._contextStack=[],this._graph=null,e=e||{},this._setBase(e.baseIRI),e.factory&&mu(this,e.factory);const t=typeof e.format=="string"?e.format.match(/\w*$/)[0].toLowerCase():"",r=/turtle/.test(t),o=/trig/.test(t),u=/triple/.test(t),c=/quad/.test(t),l=this._n3Mode=/n3/.test(t),g=u||c;(this._supportsNamedGraphs=!(r||l))||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(r||o||u||l),this._isImpliedBy=e.isImpliedBy,this._supportsRDFStar=t===""||/star|\*$/.test(t),g&&(this._resolveRelativeIRI=h=>null),this._blankNodePrefix=typeof e.blankNodePrefix!="string"?"":e.blankNodePrefix.replace(/^(?!_:)/,"_:"),this._lexer=e.lexer||new Bl({lineMode:g,n3:l,isImpliedBy:this._isImpliedBy}),this._explicitQuantifiers=!!e.explicitQuantifiers}static _resetBlankNodePrefix(){Uo=0}_setBase(e){if(!e)this._base="",this._basePath="";else{const t=e.indexOf("#");t>=0&&(e=e.substr(0,t)),this._base=e,this._basePath=e.indexOf("/")<0?e:e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i),this._baseRoot=e[0],this._baseScheme=e[1]}}_saveContext(e,t,r,o,u){const c=this._n3Mode;this._contextStack.push({type:e,subject:r,predicate:o,object:u,graph:t,inverse:c?this._inversePredicate:!1,blankPrefix:c?this._prefixes._:"",quantified:c?this._quantified:null}),c&&(this._inversePredicate=!1,this._prefixes._=this._graph?`${this._graph.value}.`:".",this._quantified=Object.create(this._quantified))}_restoreContext(e,t){const r=this._contextStack.pop();if(!r||r.type!==e)return this._error(`Unexpected ${t.type}`,t);this._subject=r.subject,this._predicate=r.predicate,this._object=r.object,this._graph=r.graph,this._n3Mode&&(this._inversePredicate=r.inverse,this._prefixes._=r.blankPrefix,this._quantified=r.quantified)}_readInTopContext(e){switch(e.type){case"eof":return this._graph!==null?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"PREFIX":this._sparqlStyle=!0;case"@prefix":return this._readPrefix;case"BASE":this._sparqlStyle=!0;case"@base":return this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}}_readEntity(e,t){let r;switch(e.type){case"IRI":case"typeIRI":const o=this._resolveIRI(e.value);if(o===null)return this._error("Invalid IRI",e);r=this._factory.namedNode(o);break;case"type":case"prefixed":const u=this._prefixes[e.prefix];if(u===void 0)return this._error(`Undefined prefix "${e.prefix}:"`,e);r=this._factory.namedNode(u+e.value);break;case"blank":r=this._factory.blankNode(this._prefixes[e.prefix]+e.value);break;case"var":r=this._factory.variable(e.value.substr(1));break;default:return this._error(`Expected entity but got ${e.type}`,e)}return!t&&this._n3Mode&&r.id in this._quantified&&(r=this._quantified[r.id]),r}_readSubject(e){switch(this._predicate=null,e.type){case"[":return this._saveContext("blank",this._graph,this._subject=this._factory.blankNode(),null,null),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this.RDF_NIL,null,null),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._graph=this._factory.blankNode(),null,null),this._readSubject):this._error("Unexpected graph",e);case"}":return this._readPunctuation(e);case"@forSome":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORSOME,this._quantifier="blankNode",this._readQuantifierList):this._error('Unexpected "@forSome"',e);case"@forAll":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORALL,this._quantifier="variable",this._readQuantifierList):this._error('Unexpected "@forAll"',e);case"literal":if(!this._n3Mode)return this._error("Unexpected literal",e);if(e.prefix.length===0)return this._literalValue=e.value,this._completeSubjectLiteral;this._subject=this._factory.literal(e.value,this._factory.namedNode(e.prefix));break;case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,null,null,null),this._graph=null,this._readSubject):this._error("Unexpected RDF-star syntax",e);default:if((this._subject=this._readEntity(e))===void 0)return;if(this._n3Mode)return this._getPathReader(this._readPredicateOrNamedGraph)}return this._readPredicateOrNamedGraph}_readPredicate(e){const t=e.type;switch(t){case"inverse":this._inversePredicate=!0;case"abbreviation":this._predicate=this.ABBREVIATIONS[e.value];break;case".":case"]":case"}":return this._predicate===null?this._error(`Unexpected ${t}`,e):(this._subject=null,t==="]"?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return this._predicate!==null?this._readPredicate:this._error("Expected predicate but got ;",e);case"[":if(this._n3Mode)return this._saveContext("blank",this._graph,this._subject,this._subject=this._factory.blankNode(),null),this._readBlankNodeHead;case"blank":if(!this._n3Mode)return this._error("Disallowed blank node as predicate",e);default:if((this._predicate=this._readEntity(e))===void 0)return}return this._readObject}_readObject(e){switch(e.type){case"literal":if(e.prefix.length===0)return this._literalValue=e.value,this._readDataTypeOrLang;this._object=this._factory.literal(e.value,this._factory.namedNode(e.prefix));break;case"[":return this._saveContext("blank",this._graph,this._subject,this._predicate,this._subject=this._factory.blankNode()),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this._subject,this._predicate,this.RDF_NIL),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._factory.blankNode()),this._readSubject):this._error("Unexpected graph",e);case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,this._subject,this._predicate,null),this._graph=null,this._readSubject):this._error("Unexpected RDF-star syntax",e);default:if((this._object=this._readEntity(e))===void 0)return;if(this._n3Mode)return this._getPathReader(this._getContextEndReader())}return this._getContextEndReader()}_readPredicateOrNamedGraph(e){return e.type==="{"?this._readGraph(e):this._readPredicate(e)}_readGraph(e){return e.type!=="{"?this._error(`Expected graph but got ${e.type}`,e):(this._graph=this._subject,this._subject=null,this._readSubject)}_readBlankNodeHead(e){return e.type==="]"?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))}_readBlankNodeTail(e){if(e.type!=="]")return this._readBlankNodePunctuation(e);this._subject!==null&&this._emit(this._subject,this._predicate,this._object,this._graph);const t=this._predicate===null;return this._restoreContext("blank",e),this._object!==null?this._getContextEndReader():this._predicate!==null?this._readObject:t?this._readPredicateOrNamedGraph:this._readPredicateAfterBlank}_readPredicateAfterBlank(e){switch(e.type){case".":case"}":return this._subject=null,this._readPunctuation(e);default:return this._readPredicate(e)}}_readListItem(e){let t=null,r=null,o=this._readListItem;const u=this._subject,c=this._contextStack,l=c[c.length-1];switch(e.type){case"[":this._saveContext("blank",this._graph,r=this._factory.blankNode(),this.RDF_FIRST,this._subject=t=this._factory.blankNode()),o=this._readBlankNodeHead;break;case"(":this._saveContext("list",this._graph,r=this._factory.blankNode(),this.RDF_FIRST,this.RDF_NIL),this._subject=null;break;case")":if(this._restoreContext("list",e),c.length!==0&&c[c.length-1].type==="list"&&this._emit(this._subject,this._predicate,this._object,this._graph),this._predicate===null){if(o=this._readPredicate,this._subject===this.RDF_NIL)return o}else if(o=this._getContextEndReader(),this._object===this.RDF_NIL)return o;r=this.RDF_NIL;break;case"literal":e.prefix.length===0?(this._literalValue=e.value,o=this._readListItemDataTypeOrLang):(t=this._factory.literal(e.value,this._factory.namedNode(e.prefix)),o=this._getContextEndReader());break;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._factory.blankNode()),this._readSubject):this._error("Unexpected graph",e);default:if((t=this._readEntity(e))===void 0)return}if(r===null&&(this._subject=r=this._factory.blankNode()),u===null?l.predicate===null?l.subject=r:l.object=r:this._emit(u,this.RDF_REST,r,this._graph),t!==null){if(this._n3Mode&&(e.type==="IRI"||e.type==="prefixed"))return this._saveContext("item",this._graph,r,this.RDF_FIRST,t),this._subject=t,this._predicate=null,this._getPathReader(this._readListItem);this._emit(r,this.RDF_FIRST,t,this._graph)}return o}_readDataTypeOrLang(e){return this._completeObjectLiteral(e,!1)}_readListItemDataTypeOrLang(e){return this._completeObjectLiteral(e,!0)}_completeLiteral(e){let t=this._factory.literal(this._literalValue);switch(e.type){case"type":case"typeIRI":const r=this._readEntity(e);if(r===void 0)return;t=this._factory.literal(this._literalValue,r),e=null;break;case"langcode":t=this._factory.literal(this._literalValue,e.value),e=null;break}return{token:e,literal:t}}_completeSubjectLiteral(e){return this._subject=this._completeLiteral(e).literal,this._readPredicateOrNamedGraph}_completeObjectLiteral(e,t){const r=this._completeLiteral(e);if(r)return this._object=r.literal,t&&this._emit(this._subject,this.RDF_FIRST,this._object,this._graph),r.token===null?this._getContextEndReader():(this._readCallback=this._getContextEndReader(),this._readCallback(r.token))}_readFormulaTail(e){return e.type!=="}"?this._readPunctuation(e):(this._subject!==null&&this._emit(this._subject,this._predicate,this._object,this._graph),this._restoreContext("formula",e),this._object===null?this._readPredicate:this._getContextEndReader())}_readPunctuation(e){let t,r=this._graph;const o=this._subject,u=this._inversePredicate;switch(e.type){case"}":if(this._graph===null)return this._error("Unexpected graph closing",e);if(this._n3Mode)return this._readFormulaTail(e);this._graph=null;case".":this._subject=null,t=this._contextStack.length?this._readSubject:this._readInTopContext,u&&(this._inversePredicate=!1);break;case";":t=this._readPredicate;break;case",":t=this._readObject;break;case"{|":if(!this._supportsRDFStar)return this._error("Unexpected RDF-star syntax",e);const c=this._predicate,l=this._object;this._subject=this._factory.quad(o,c,l,this.DEFAULTGRAPH),t=this._readPredicate;break;case"|}":if(this._subject.termType!=="Quad")return this._error("Unexpected asserted triple closing",e);this._subject=null,t=this._readPunctuation;break;default:if(this._supportsQuads&&this._graph===null&&(r=this._readEntity(e))!==void 0){t=this._readQuadPunctuation;break}return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}if(o!==null){const c=this._predicate,l=this._object;u?this._emit(l,c,o,r):this._emit(o,c,l,r)}return t}_readBlankNodePunctuation(e){let t;switch(e.type){case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}return this._emit(this._subject,this._predicate,this._object,this._graph),t}_readQuadPunctuation(e){return e.type!=="."?this._error("Expected dot to follow quad",e):this._readInTopContext}_readPrefix(e){return e.type!=="prefix"?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)}_readPrefixIRI(e){if(e.type!=="IRI")return this._error(`Expected IRI to follow prefix "${this._prefix}:"`,e);const t=this._readEntity(e);return this._prefixes[this._prefix]=t.value,this._prefixCallback(this._prefix,t),this._readDeclarationPunctuation}_readBaseIRI(e){const t=e.type==="IRI"&&this._resolveIRI(e.value);return t?(this._setBase(t),this._readDeclarationPunctuation):this._error("Expected valid IRI to follow base declaration",e)}_readNamedGraphLabel(e){switch(e.type){case"IRI":case"blank":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}}_readNamedGraphBlankLabel(e){return e.type!=="]"?this._error("Invalid graph label",e):(this._subject=this._factory.blankNode(),this._readGraph)}_readDeclarationPunctuation(e){return this._sparqlStyle?(this._sparqlStyle=!1,this._readInTopContext(e)):e.type!=="."?this._error("Expected declaration to end with a dot",e):this._readInTopContext}_readQuantifierList(e){let t;switch(e.type){case"IRI":case"prefixed":if((t=this._readEntity(e,!0))!==void 0)break;default:return this._error(`Unexpected ${e.type}`,e)}return this._explicitQuantifiers?(this._subject===null?this._emit(this._graph||this.DEFAULTGRAPH,this._predicate,this._subject=this._factory.blankNode(),this.QUANTIFIERS_GRAPH):this._emit(this._subject,this.RDF_REST,this._subject=this._factory.blankNode(),this.QUANTIFIERS_GRAPH),this._emit(this._subject,this.RDF_FIRST,t,this.QUANTIFIERS_GRAPH)):this._quantified[t.id]=this._factory[this._quantifier](this._factory.blankNode().value),this._readQuantifierPunctuation}_readQuantifierPunctuation(e){return e.type===","?this._readQuantifierList:(this._explicitQuantifiers&&(this._emit(this._subject,this.RDF_REST,this.RDF_NIL,this.QUANTIFIERS_GRAPH),this._subject=null),this._readCallback=this._getContextEndReader(),this._readCallback(e))}_getPathReader(e){return this._afterPath=e,this._readPath}_readPath(e){switch(e.type){case"!":return this._readForwardPath;case"^":return this._readBackwardPath;default:const t=this._contextStack,r=t.length&&t[t.length-1];if(r&&r.type==="item"){const o=this._subject;this._restoreContext("item",e),this._emit(this._subject,this.RDF_FIRST,o,this._graph)}return this._afterPath(e)}}_readForwardPath(e){let t,r;const o=this._factory.blankNode();if((r=this._readEntity(e))!==void 0)return this._predicate===null?(t=this._subject,this._subject=o):(t=this._object,this._object=o),this._emit(t,r,o,this._graph),this._readPath}_readBackwardPath(e){const t=this._factory.blankNode();let r,o;if((r=this._readEntity(e))!==void 0)return this._predicate===null?(o=this._subject,this._subject=t):(o=this._object,this._object=t),this._emit(t,r,o,this._graph),this._readPath}_readRDFStarTailOrGraph(e){return e.type!==">>"?this._supportsQuads&&this._graph===null&&(this._graph=this._readEntity(e))!==void 0?this._readRDFStarTail:this._error(`Expected >> to follow "${this._object.id}"`,e):this._readRDFStarTail(e)}_readRDFStarTail(e){if(e.type!==">>")return this._error(`Expected >> but got ${e.type}`,e);const t=this._factory.quad(this._subject,this._predicate,this._object,this._graph||this.DEFAULTGRAPH);return this._restoreContext("<<",e),this._subject===null?(this._subject=t,this._readPredicate):(this._object=t,this._getContextEndReader())}_getContextEndReader(){const e=this._contextStack;if(!e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem;case"formula":return this._readFormulaTail;case"<<":return this._readRDFStarTailOrGraph}}_emit(e,t,r,o){this._callback(null,this._factory.quad(e,t,r,o||this.DEFAULTGRAPH))}_error(e,t){const r=new Error(`${e} on line ${t.line}.`);r.context={token:t,line:t.line,previousToken:this._lexer.previousToken},this._callback(r),this._callback=Kn}_resolveIRI(e){return/^[a-z][a-z0-9+.-]*:/i.test(e)?e:this._resolveRelativeIRI(e)}_resolveRelativeIRI(e){if(!e.length)return this._base;switch(e[0]){case"#":return this._base+e;case"?":return this._base.replace(/(?:\?.*)?$/,e);case"/":return(e[1]==="/"?this._baseScheme:this._baseRoot)+this._removeDotSegments(e);default:return/^[^/:]*:/.test(e)?null:this._removeDotSegments(this._basePath+e)}}_removeDotSegments(e){if(!/(^|\/)\.\.?($|[/#?])/.test(e))return e;const t=e.length;let r="",o=-1,u=-1,c=0,l="/";for(;o<t;){switch(l){case":":if(u<0&&e[++o]==="/"&&e[++o]==="/")for(;(u=o+1)<t&&e[u]!=="/";)o=u;break;case"?":case"#":o=t;break;case"/":if(e[o+1]===".")switch(l=e[++o+1],l){case"/":r+=e.substring(c,o-1),c=o+1;break;case void 0:case"?":case"#":return r+e.substring(c,o)+e.substr(o+1);case".":if(l=e[++o+1],l===void 0||l==="/"||l==="?"||l==="#"){if(r+=e.substring(c,o-2),(c=r.lastIndexOf("/"))>=u&&(r=r.substr(0,c)),l!=="/")return`${r}/${e.substr(o+1)}`;c=o+1}}}l=e[++o]}return r+e.substring(c)}parse(e,t,r){let o,u,c;if(t&&(t.onQuad||t.onPrefix||t.onComment)?(o=t.onQuad,u=t.onPrefix,c=t.onComment):(o=t,u=r),this._readCallback=this._readInTopContext,this._sparqlStyle=!1,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix?this._blankNodePrefix.substr(2):`b${Uo++}_`,this._prefixCallback=u||Kn,this._inversePredicate=!1,this._quantified=Object.create(null),!o){const g=[];let h;if(this._callback=(d,p)=>{d?h=d:p&&g.push(p)},this._lexer.tokenize(e).every(d=>this._readCallback=this._readCallback(d)),h)throw h;return g}let l=(g,h)=>{g!==null?(this._callback(g),this._callback=Kn):this._readCallback&&(this._readCallback=this._readCallback(h))};c&&(this._lexer.comments=!0,l=(g,h)=>{g!==null?(this._callback(g),this._callback=Kn):this._readCallback&&(h.type==="comment"?c(h.value):this._readCallback=this._readCallback(h))}),this._callback=o,this._lexer.tokenize(e,l)}}function Kn(){}function mu(n,e){n._factory=e,n.DEFAULTGRAPH=e.defaultGraph(),n.RDF_FIRST=e.namedNode(Et.rdf.first),n.RDF_REST=e.namedNode(Et.rdf.rest),n.RDF_NIL=e.namedNode(Et.rdf.nil),n.N3_FORALL=e.namedNode(Et.r.forAll),n.N3_FORSOME=e.namedNode(Et.r.forSome),n.ABBREVIATIONS={a:e.namedNode(Et.rdf.type),"=":e.namedNode(Et.owl.sameAs),">":e.namedNode(Et.log.implies),"<":e.namedNode(Et.log.isImpliedBy)},n.QUANTIFIERS_GRAPH=e.namedNode("urn:n3:quantifiers")}mu(Os.prototype,mt);function Ss(n){return!!n&&n.termType==="DefaultGraph"}function Yn(n){return n.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&")}const Vl=/^:?[^:?#]*(?:[?#]|$)|^file:|^[^:]*:\/*[^?#]+?\/(?:\.\.?(?:\/|$)|\/)/i,Jl=/^(?:(?:[^/?#]{3,}|\.?[^/?#.]\.?)(?:\/[^/?#]{3,}|\.?[^/?#.]\.?)*\/?)?(?:[?#]|$)/,Oo="./",Gl="../",Ni="?",Bo="#";class Bs{constructor(e){this.base=e,this._baseLength=0,this._baseMatcher=null,this._pathReplacements=new Array(e.length+1)}static supports(e){return!Vl.test(e)}_getBaseMatcher(){if(this._baseMatcher)return this._baseMatcher;if(!Bs.supports(this.base))return this._baseMatcher=/.^/;const e=/^[^:]*:\/*/.exec(this.base)[0],t=["^",Yn(e)],r=[],o=[],u=/[^/?#]*([/?#])/y;let c,l=0,g=0,h=u.lastIndex=e.length;for(;!l&&!g&&(c=u.exec(this.base));)c[1]===Bo?g=u.lastIndex-1:(t.push(Yn(c[0]),"(?:"),r.push(")?"),c[1]!==Ni?o.push(h=u.lastIndex):(l=h=u.lastIndex,g=this.base.indexOf(Bo,l),this._pathReplacements[l]=Ni));for(let d=0;d<o.length;d++)this._pathReplacements[o[d]]=Gl.repeat(o.length-d-1);return this._pathReplacements[o[o.length-1]]=Oo,this._baseLength=g>0?g:this.base.length,t.push(Yn(this.base.substring(h,this._baseLength)),l?"(?:#|$)":"(?:[?#]|$)"),this._baseMatcher=new RegExp([...t,...r].join(""))}toRelative(e){const t=this._getBaseMatcher().exec(e);if(!t)return e;const r=t[0].length;if(r===this._baseLength&&r===e.length)return"";const o=this._pathReplacements[r];if(o){const u=e.substring(r);return o!==Ni&&!Jl.test(u)?e:o===Oo&&/^[^?#]/.test(u)?u:o+u}return e.substring(r-1)}}const mn=mt.defaultGraph(),{rdf:zl,xsd:Lr}=Et,Mo=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,Ho=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,Ql={"\\":"\\\\",'"':'\\"',"	":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};class wn extends Vt{equals(e){return e===this}}class oi{constructor(e,t){if(this._prefixRegex=/$0^/,e&&typeof e.write!="function"&&(t=e,e=null),t=t||{},this._lists=t.lists,e)this._outputStream=e,this._endStream=t.end===void 0?!0:!!t.end;else{let r="";this._outputStream={write(o,u,c){r+=o,c&&c()},end:o=>{o&&o(null,r)}},this._endStream=!0}this._subject=null,/triple|quad/i.test(t.format)?(this._lineMode=!0,this._writeQuad=this._writeQuadLine):(this._lineMode=!1,this._graph=mn,this._prefixIRIs=Object.create(null),t.prefixes&&this.addPrefixes(t.prefixes),t.baseIRI&&(this._baseIri=new Bs(t.baseIRI)))}get _inDefaultGraph(){return mn.equals(this._graph)}_write(e,t){this._outputStream.write(e,"utf8",t)}_writeQuad(e,t,r,o,u){try{o.equals(this._graph)||(this._write((this._subject===null?"":this._inDefaultGraph?`.
`:`
}
`)+(mn.equals(o)?"":`${this._encodeIriOrBlank(o)} {
`)),this._graph=o,this._subject=null),e.equals(this._subject)?t.equals(this._predicate)?this._write(`, ${this._encodeObject(r)}`,u):this._write(`;
    ${this._encodePredicate(this._predicate=t)} ${this._encodeObject(r)}`,u):this._write(`${(this._subject===null?"":`.
`)+this._encodeSubject(this._subject=e)} ${this._encodePredicate(this._predicate=t)} ${this._encodeObject(r)}`,u)}catch(c){u&&u(c)}}_writeQuadLine(e,t,r,o,u){delete this._prefixMatch,this._write(this.quadToString(e,t,r,o),u)}quadToString(e,t,r,o){return`${this._encodeSubject(e)} ${this._encodeIriOrBlank(t)} ${this._encodeObject(r)}${o&&o.value?` ${this._encodeIriOrBlank(o)} .
`:` .
`}`}quadsToString(e){let t="";for(const r of e)t+=this.quadToString(r.subject,r.predicate,r.object,r.graph);return t}_encodeSubject(e){return e.termType==="Quad"?this._encodeQuad(e):this._encodeIriOrBlank(e)}_encodeIriOrBlank(e){if(e.termType!=="NamedNode")return this._lists&&e.value in this._lists&&(e=this.list(this._lists[e.value])),"id"in e?e.id:`_:${e.value}`;let t=e.value;this._baseIri&&(t=this._baseIri.toRelative(t)),Mo.test(t)&&(t=t.replace(Ho,Ko));const r=this._prefixRegex.exec(t);return r?r[1]?this._prefixIRIs[r[1]]+r[2]:t:`<${t}>`}_encodeLiteral(e){let t=e.value;if(Mo.test(t)&&(t=t.replace(Ho,Ko)),e.language)return`"${t}"@${e.language}`;if(this._lineMode){if(e.datatype.value===Lr.string)return`"${t}"`}else switch(e.datatype.value){case Lr.string:return`"${t}"`;case Lr.boolean:if(t==="true"||t==="false")return t;break;case Lr.integer:if(/^[+-]?\d+$/.test(t))return t;break;case Lr.decimal:if(/^[+-]?\d*\.\d+$/.test(t))return t;break;case Lr.double:if(/^[+-]?(?:\d+\.\d*|\.?\d+)[eE][+-]?\d+$/.test(t))return t;break}return`"${t}"^^${this._encodeIriOrBlank(e.datatype)}`}_encodePredicate(e){return e.value===zl.type?"a":this._encodeIriOrBlank(e)}_encodeObject(e){switch(e.termType){case"Quad":return this._encodeQuad(e);case"Literal":return this._encodeLiteral(e);default:return this._encodeIriOrBlank(e)}}_encodeQuad({subject:e,predicate:t,object:r,graph:o}){return`<<${this._encodeSubject(e)} ${this._encodePredicate(t)} ${this._encodeObject(r)}${Ss(o)?"":` ${this._encodeIriOrBlank(o)}`}>>`}_blockedWrite(){throw new Error("Cannot write because the writer has been closed.")}addQuad(e,t,r,o,u){r===void 0?this._writeQuad(e.subject,e.predicate,e.object,e.graph,t):typeof o=="function"?this._writeQuad(e,t,r,mn,o):this._writeQuad(e,t,r,o||mn,u)}addQuads(e){for(let t=0;t<e.length;t++)this.addQuad(e[t])}addPrefix(e,t,r){const o={};o[e]=t,this.addPrefixes(o,r)}addPrefixes(e,t){if(!this._prefixIRIs)return t&&t();let r=!1;for(let o in e){let u=e[o];typeof u!="string"&&(u=u.value),r=!0,this._subject!==null&&(this._write(this._inDefaultGraph?`.
`:`
}
`),this._subject=null,this._graph=""),this._prefixIRIs[u]=o+=":",this._write(`@prefix ${o} <${u}>.
`)}if(r){let o="",u="";for(const c in this._prefixIRIs)o+=o?`|${c}`:c,u+=(u?"|":"")+this._prefixIRIs[c];o=Yn(o),this._prefixRegex=new RegExp(`^(?:${u})[^/]*$|^(${o})([_a-zA-Z0-9][\\-_a-zA-Z0-9]*)$`)}this._write(r?`
`:"",t)}blank(e,t){let r=e,o,u;switch(e===void 0?r=[]:e.termType?r=[{predicate:e,object:t}]:"length"in e||(r=[e]),u=r.length){case 0:return new wn("[]");case 1:if(o=r[0],!(o.object instanceof wn))return new wn(`[ ${this._encodePredicate(o.predicate)} ${this._encodeObject(o.object)} ]`);default:let c="[";for(let l=0;l<u;l++)o=r[l],o.predicate.equals(e)?c+=`, ${this._encodeObject(o.object)}`:(c+=`${(l?`;
  `:`
  `)+this._encodePredicate(o.predicate)} ${this._encodeObject(o.object)}`,e=o.predicate);return new wn(`${c}
]`)}}list(e){const t=e&&e.length||0,r=new Array(t);for(let o=0;o<t;o++)r[o]=this._encodeObject(e[o]);return new wn(`(${r.join(" ")})`)}end(e){this._subject!==null&&(this._write(this._inDefaultGraph?`.
`:`
}
`),this._subject=null),this._write=this._blockedWrite;let t=e&&((r,o)=>{t=null,e(r,o)});if(this._endStream)try{return this._outputStream.end(t)}catch{}t&&t()}}function Ko(n){let e=Ql[n];return e===void 0&&(n.length===1?(e=n.charCodeAt(0).toString(16),e="\\u0000".substr(0,6-e.length)+e):(e=((n.charCodeAt(0)-55296)*1024+n.charCodeAt(1)+9216).toString(16),e="\\U00000000".substr(0,10-e.length)+e)),e}var Di={exports:{}},Li={exports:{}},ji,qo;function ct(){if(qo)return ji;qo=1;class n extends Error{constructor(t){if(!Array.isArray(t))throw new TypeError(`Expected input to be an Array, got ${typeof t}`);let r="";for(let o=0;o<t.length;o++)r+=`    ${t[o].stack}
`;super(r),this.name="AggregateError",this.errors=t}}return ji={AggregateError:n,ArrayIsArray(e){return Array.isArray(e)},ArrayPrototypeIncludes(e,t){return e.includes(t)},ArrayPrototypeIndexOf(e,t){return e.indexOf(t)},ArrayPrototypeJoin(e,t){return e.join(t)},ArrayPrototypeMap(e,t){return e.map(t)},ArrayPrototypePop(e,t){return e.pop(t)},ArrayPrototypePush(e,t){return e.push(t)},ArrayPrototypeSlice(e,t,r){return e.slice(t,r)},Error,FunctionPrototypeCall(e,t,...r){return e.call(t,...r)},FunctionPrototypeSymbolHasInstance(e,t){return Function.prototype[Symbol.hasInstance].call(e,t)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(e,t){return Object.defineProperties(e,t)},ObjectDefineProperty(e,t,r){return Object.defineProperty(e,t,r)},ObjectGetOwnPropertyDescriptor(e,t){return Object.getOwnPropertyDescriptor(e,t)},ObjectKeys(e){return Object.keys(e)},ObjectSetPrototypeOf(e,t){return Object.setPrototypeOf(e,t)},Promise,PromisePrototypeCatch(e,t){return e.catch(t)},PromisePrototypeThen(e,t,r){return e.then(t,r)},PromiseReject(e){return Promise.reject(e)},PromiseResolve(e){return Promise.resolve(e)},ReflectApply:Reflect.apply,RegExpPrototypeTest(e,t){return e.test(t)},SafeSet:Set,String,StringPrototypeSlice(e,t,r){return e.slice(t,r)},StringPrototypeToLowerCase(e){return e.toLowerCase()},StringPrototypeToUpperCase(e){return e.toUpperCase()},StringPrototypeTrim(e){return e.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(e,t,r){return e.set(t,r)},Boolean,Uint8Array},ji}var Ui={exports:{}},Oi,Wo;function wu(){return Wo||(Wo=1,Oi={format(n,...e){return n.replace(/%([sdifj])/g,function(...[t,r]){const o=e.shift();return r==="f"?o.toFixed(6):r==="j"?JSON.stringify(o):r==="s"&&typeof o=="object"?`${o.constructor!==Object?o.constructor.name:""} {}`.trim():o.toString()})},inspect(n){switch(typeof n){case"string":if(n.includes("'"))if(n.includes('"')){if(!n.includes("`")&&!n.includes("${"))return`\`${n}\``}else return`"${n}"`;return`'${n}'`;case"number":return isNaN(n)?"NaN":Object.is(n,-0)?String(n):n;case"bigint":return`${String(n)}n`;case"boolean":case"undefined":return String(n);case"object":return"{}"}}}),Oi}var Bi,$o;function Ct(){if($o)return Bi;$o=1;const{format:n,inspect:e}=wu(),{AggregateError:t}=ct(),r=globalThis.AggregateError||t,o=Symbol("kIsNodeError"),u=["string","function","number","object","Function","Object","boolean","bigint","symbol"],c=/^([A-Z][a-z0-9]*)+$/,l="__node_internal_",g={};function h(R,b){if(!R)throw new g.ERR_INTERNAL_ASSERTION(b)}function d(R){let b="",E=R.length;const A=R[0]==="-"?1:0;for(;E>=A+4;E-=3)b=`_${R.slice(E-3,E)}${b}`;return`${R.slice(0,E)}${b}`}function p(R,b,E){if(typeof b=="function")return h(b.length<=E.length,`Code: ${R}; The provided arguments length (${E.length}) does not match the required ones (${b.length}).`),b(...E);const A=(b.match(/%[dfijoOs]/g)||[]).length;return h(A===E.length,`Code: ${R}; The provided arguments length (${E.length}) does not match the required ones (${A}).`),E.length===0?b:n(b,...E)}function x(R,b,E){E||(E=Error);class A extends E{constructor(...D){super(p(R,b,D))}toString(){return`${this.name} [${R}]: ${this.message}`}}Object.defineProperties(A.prototype,{name:{value:E.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${R}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),A.prototype.code=R,A.prototype[o]=!0,g[R]=A}function T(R){const b=l+R.name;return Object.defineProperty(R,"name",{value:b}),R}function S(R,b){if(R&&b&&R!==b){if(Array.isArray(b.errors))return b.errors.push(R),b;const E=new r([b,R],b.message);return E.code=b.code,E}return R||b}class v extends Error{constructor(b="The operation was aborted",E=void 0){if(E!==void 0&&typeof E!="object")throw new g.ERR_INVALID_ARG_TYPE("options","Object",E);super(b,E),this.code="ABORT_ERR",this.name="AbortError"}}return x("ERR_ASSERTION","%s",Error),x("ERR_INVALID_ARG_TYPE",(R,b,E)=>{h(typeof R=="string","'name' must be a string"),Array.isArray(b)||(b=[b]);let A="The ";R.endsWith(" argument")?A+=`${R} `:A+=`"${R}" ${R.includes(".")?"property":"argument"} `,A+="must be ";const k=[],D=[],B=[];for(const ie of b)h(typeof ie=="string","All expected entries have to be of type string"),u.includes(ie)?k.push(ie.toLowerCase()):c.test(ie)?D.push(ie):(h(ie!=="object",'The value "object" should be written as "Object"'),B.push(ie));if(D.length>0){const ie=k.indexOf("object");ie!==-1&&(k.splice(k,ie,1),D.push("Object"))}if(k.length>0){switch(k.length){case 1:A+=`of type ${k[0]}`;break;case 2:A+=`one of type ${k[0]} or ${k[1]}`;break;default:{const ie=k.pop();A+=`one of type ${k.join(", ")}, or ${ie}`}}(D.length>0||B.length>0)&&(A+=" or ")}if(D.length>0){switch(D.length){case 1:A+=`an instance of ${D[0]}`;break;case 2:A+=`an instance of ${D[0]} or ${D[1]}`;break;default:{const ie=D.pop();A+=`an instance of ${D.join(", ")}, or ${ie}`}}B.length>0&&(A+=" or ")}switch(B.length){case 0:break;case 1:B[0].toLowerCase()!==B[0]&&(A+="an "),A+=`${B[0]}`;break;case 2:A+=`one of ${B[0]} or ${B[1]}`;break;default:{const ie=B.pop();A+=`one of ${B.join(", ")}, or ${ie}`}}if(E==null)A+=`. Received ${E}`;else if(typeof E=="function"&&E.name)A+=`. Received function ${E.name}`;else if(typeof E=="object"){var M;if((M=E.constructor)!==null&&M!==void 0&&M.name)A+=`. Received an instance of ${E.constructor.name}`;else{const ie=e(E,{depth:-1});A+=`. Received ${ie}`}}else{let ie=e(E,{colors:!1});ie.length>25&&(ie=`${ie.slice(0,25)}...`),A+=`. Received type ${typeof E} (${ie})`}return A},TypeError),x("ERR_INVALID_ARG_VALUE",(R,b,E="is invalid")=>{let A=e(b);return A.length>128&&(A=A.slice(0,128)+"..."),`The ${R.includes(".")?"property":"argument"} '${R}' ${E}. Received ${A}`},TypeError),x("ERR_INVALID_RETURN_VALUE",(R,b,E)=>{var A;const k=E!=null&&(A=E.constructor)!==null&&A!==void 0&&A.name?`instance of ${E.constructor.name}`:`type ${typeof E}`;return`Expected ${R} to be returned from the "${b}" function but got ${k}.`},TypeError),x("ERR_MISSING_ARGS",(...R)=>{h(R.length>0,"At least one arg needs to be specified");let b;const E=R.length;switch(R=(Array.isArray(R)?R:[R]).map(A=>`"${A}"`).join(" or "),E){case 1:b+=`The ${R[0]} argument`;break;case 2:b+=`The ${R[0]} and ${R[1]} arguments`;break;default:{const A=R.pop();b+=`The ${R.join(", ")}, and ${A} arguments`}break}return`${b} must be specified`},TypeError),x("ERR_OUT_OF_RANGE",(R,b,E)=>{h(b,'Missing "range" argument');let A;if(Number.isInteger(E)&&Math.abs(E)>2**32)A=d(String(E));else if(typeof E=="bigint"){A=String(E);const k=BigInt(2)**BigInt(32);(E>k||E<-k)&&(A=d(A)),A+="n"}else A=e(E);return`The value of "${R}" is out of range. It must be ${b}. Received ${A}`},RangeError),x("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),x("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),x("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),x("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),x("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),x("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),x("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),x("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),x("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),x("ERR_STREAM_WRITE_AFTER_END","write after end",Error),x("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),Bi={AbortError:v,aggregateTwoErrors:T(S),hideStackFrames:T,codes:g},Bi}var _n={exports:{}},Vo;function Rn(){if(Vo)return _n.exports;Vo=1;const{AbortController:n,AbortSignal:e}=typeof self<"u"?self:typeof window<"u"?window:void 0;return _n.exports=n,_n.exports.AbortSignal=e,_n.exports.default=n,_n.exports}var qn={exports:{}},Jo;function Nn(){if(Jo)return qn.exports;Jo=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(D,B,M){return Function.prototype.apply.call(D,B,M)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(D){return Object.getOwnPropertyNames(D).concat(Object.getOwnPropertySymbols(D))}:t=function(D){return Object.getOwnPropertyNames(D)};function r(k){console&&console.warn&&console.warn(k)}var o=Number.isNaN||function(D){return D!==D};function u(){u.init.call(this)}qn.exports=u,qn.exports.once=b,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var c=10;function l(k){if(typeof k!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(k){if(typeof k!="number"||k<0||o(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");c=k}}),u.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(D){if(typeof D!="number"||D<0||o(D))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+D+".");return this._maxListeners=D,this};function g(k){return k._maxListeners===void 0?u.defaultMaxListeners:k._maxListeners}u.prototype.getMaxListeners=function(){return g(this)},u.prototype.emit=function(D){for(var B=[],M=1;M<arguments.length;M++)B.push(arguments[M]);var ie=D==="error",he=this._events;if(he!==void 0)ie=ie&&he.error===void 0;else if(!ie)return!1;if(ie){var L;if(B.length>0&&(L=B[0]),L instanceof Error)throw L;var re=new Error("Unhandled error."+(L?" ("+L.message+")":""));throw re.context=L,re}var be=he[D];if(be===void 0)return!1;if(typeof be=="function")e(be,this,B);else for(var ue=be.length,ke=S(be,ue),M=0;M<ue;++M)e(ke[M],this,B);return!0};function h(k,D,B,M){var ie,he,L;if(l(B),he=k._events,he===void 0?(he=k._events=Object.create(null),k._eventsCount=0):(he.newListener!==void 0&&(k.emit("newListener",D,B.listener?B.listener:B),he=k._events),L=he[D]),L===void 0)L=he[D]=B,++k._eventsCount;else if(typeof L=="function"?L=he[D]=M?[B,L]:[L,B]:M?L.unshift(B):L.push(B),ie=g(k),ie>0&&L.length>ie&&!L.warned){L.warned=!0;var re=new Error("Possible EventEmitter memory leak detected. "+L.length+" "+String(D)+" listeners added. Use emitter.setMaxListeners() to increase limit");re.name="MaxListenersExceededWarning",re.emitter=k,re.type=D,re.count=L.length,r(re)}return k}u.prototype.addListener=function(D,B){return h(this,D,B,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(D,B){return h(this,D,B,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(k,D,B){var M={fired:!1,wrapFn:void 0,target:k,type:D,listener:B},ie=d.bind(M);return ie.listener=B,M.wrapFn=ie,ie}u.prototype.once=function(D,B){return l(B),this.on(D,p(this,D,B)),this},u.prototype.prependOnceListener=function(D,B){return l(B),this.prependListener(D,p(this,D,B)),this},u.prototype.removeListener=function(D,B){var M,ie,he,L,re;if(l(B),ie=this._events,ie===void 0)return this;if(M=ie[D],M===void 0)return this;if(M===B||M.listener===B)--this._eventsCount===0?this._events=Object.create(null):(delete ie[D],ie.removeListener&&this.emit("removeListener",D,M.listener||B));else if(typeof M!="function"){for(he=-1,L=M.length-1;L>=0;L--)if(M[L]===B||M[L].listener===B){re=M[L].listener,he=L;break}if(he<0)return this;he===0?M.shift():v(M,he),M.length===1&&(ie[D]=M[0]),ie.removeListener!==void 0&&this.emit("removeListener",D,re||B)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(D){var B,M,ie;if(M=this._events,M===void 0)return this;if(M.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):M[D]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete M[D]),this;if(arguments.length===0){var he=Object.keys(M),L;for(ie=0;ie<he.length;++ie)L=he[ie],L!=="removeListener"&&this.removeAllListeners(L);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(B=M[D],typeof B=="function")this.removeListener(D,B);else if(B!==void 0)for(ie=B.length-1;ie>=0;ie--)this.removeListener(D,B[ie]);return this};function x(k,D,B){var M=k._events;if(M===void 0)return[];var ie=M[D];return ie===void 0?[]:typeof ie=="function"?B?[ie.listener||ie]:[ie]:B?R(ie):S(ie,ie.length)}u.prototype.listeners=function(D){return x(this,D,!0)},u.prototype.rawListeners=function(D){return x(this,D,!1)},u.listenerCount=function(k,D){return typeof k.listenerCount=="function"?k.listenerCount(D):T.call(k,D)},u.prototype.listenerCount=T;function T(k){var D=this._events;if(D!==void 0){var B=D[k];if(typeof B=="function")return 1;if(B!==void 0)return B.length}return 0}u.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function S(k,D){for(var B=new Array(D),M=0;M<D;++M)B[M]=k[M];return B}function v(k,D){for(;D+1<k.length;D++)k[D]=k[D+1];k.pop()}function R(k){for(var D=new Array(k.length),B=0;B<D.length;++B)D[B]=k[B].listener||k[B];return D}function b(k,D){return new Promise(function(B,M){function ie(L){k.removeListener(D,he),M(L)}function he(){typeof k.removeListener=="function"&&k.removeListener("error",ie),B([].slice.call(arguments))}A(k,D,he,{once:!0}),D!=="error"&&E(k,ie,{once:!0})})}function E(k,D,B){typeof k.on=="function"&&A(k,"error",D,B)}function A(k,D,B,M){if(typeof k.on=="function")M.once?k.once(D,B):k.on(D,B);else if(typeof k.addEventListener=="function")k.addEventListener(D,function ie(he){M.once&&k.removeEventListener(D,ie),B(he)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k)}return qn.exports}var Go;function jt(){return Go||(Go=1,function(n){const e=ir(),{format:t,inspect:r}=wu(),{codes:{ERR_INVALID_ARG_TYPE:o}}=Ct(),{kResistStopPropagation:u,AggregateError:c,SymbolDispose:l}=ct(),g=globalThis.AbortSignal||Rn().AbortSignal,h=globalThis.AbortController||Rn().AbortController,d=Object.getPrototypeOf(async function(){}).constructor,p=globalThis.Blob||e.Blob,x=typeof p<"u"?function(R){return R instanceof p}:function(R){return!1},T=(v,R)=>{if(v!==void 0&&(v===null||typeof v!="object"||!("aborted"in v)))throw new o(R,"AbortSignal",v)},S=(v,R)=>{if(typeof v!="function")throw new o(R,"Function",v)};n.exports={AggregateError:c,kEmptyObject:Object.freeze({}),once(v){let R=!1;return function(...b){R||(R=!0,v.apply(this,b))}},createDeferredPromise:function(){let v,R;return{promise:new Promise((E,A)=>{v=E,R=A}),resolve:v,reject:R}},promisify(v){return new Promise((R,b)=>{v((E,...A)=>E?b(E):R(...A))})},debuglog(){return function(){}},format:t,inspect:r,types:{isAsyncFunction(v){return v instanceof d},isArrayBufferView(v){return ArrayBuffer.isView(v)}},isBlob:x,deprecate(v,R){return v},addAbortListener:Nn().addAbortListener||function(R,b){if(R===void 0)throw new o("signal","AbortSignal",R);T(R,"signal"),S(b,"listener");let E;return R.aborted?queueMicrotask(()=>b()):(R.addEventListener("abort",b,{__proto__:null,once:!0,[u]:!0}),E=()=>{R.removeEventListener("abort",b)}),{__proto__:null,[l](){var A;(A=E)===null||A===void 0||A()}}},AbortSignalAny:g.any||function(R){if(R.length===1)return R[0];const b=new h,E=()=>b.abort();return R.forEach(A=>{T(A,"signals"),A.addEventListener("abort",E,{once:!0})}),b.signal.addEventListener("abort",()=>{R.forEach(A=>A.removeEventListener("abort",E))},{once:!0}),b.signal}},n.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")}(Ui)),Ui.exports}var Wn={},Mi,zo;function Dn(){if(zo)return Mi;zo=1;const{ArrayIsArray:n,ArrayPrototypeIncludes:e,ArrayPrototypeJoin:t,ArrayPrototypeMap:r,NumberIsInteger:o,NumberIsNaN:u,NumberMAX_SAFE_INTEGER:c,NumberMIN_SAFE_INTEGER:l,NumberParseInt:g,ObjectPrototypeHasOwnProperty:h,RegExpPrototypeExec:d,String:p,StringPrototypeToUpperCase:x,StringPrototypeTrim:T}=ct(),{hideStackFrames:S,codes:{ERR_SOCKET_BAD_PORT:v,ERR_INVALID_ARG_TYPE:R,ERR_INVALID_ARG_VALUE:b,ERR_OUT_OF_RANGE:E,ERR_UNKNOWN_SIGNAL:A}}=Ct(),{normalizeEncoding:k}=jt(),{isAsyncFunction:D,isArrayBufferView:B}=jt().types,M={};function ie(te){return te===(te|0)}function he(te){return te===te>>>0}const L=/^[0-7]+$/,re="must be a 32-bit unsigned integer or an octal string";function be(te,Ee,Ae){if(typeof te>"u"&&(te=Ae),typeof te=="string"){if(d(L,te)===null)throw new b(Ee,te,re);te=g(te,8)}return ne(te,Ee),te}const ue=S((te,Ee,Ae=l,ye=c)=>{if(typeof te!="number")throw new R(Ee,"number",te);if(!o(te))throw new E(Ee,"an integer",te);if(te<Ae||te>ye)throw new E(Ee,`>= ${Ae} && <= ${ye}`,te)}),ke=S((te,Ee,Ae=-2147483648,ye=2147483647)=>{if(typeof te!="number")throw new R(Ee,"number",te);if(!o(te))throw new E(Ee,"an integer",te);if(te<Ae||te>ye)throw new E(Ee,`>= ${Ae} && <= ${ye}`,te)}),ne=S((te,Ee,Ae=!1)=>{if(typeof te!="number")throw new R(Ee,"number",te);if(!o(te))throw new E(Ee,"an integer",te);const ye=Ae?1:0,We=4294967295;if(te<ye||te>We)throw new E(Ee,`>= ${ye} && <= ${We}`,te)});function fe(te,Ee){if(typeof te!="string")throw new R(Ee,"string",te)}function Ne(te,Ee,Ae=void 0,ye){if(typeof te!="number")throw new R(Ee,"number",te);if(Ae!=null&&te<Ae||ye!=null&&te>ye||(Ae!=null||ye!=null)&&u(te))throw new E(Ee,`${Ae!=null?`>= ${Ae}`:""}${Ae!=null&&ye!=null?" && ":""}${ye!=null?`<= ${ye}`:""}`,te)}const pe=S((te,Ee,Ae)=>{if(!e(Ae,te)){const We="must be one of: "+t(r(Ae,Xe=>typeof Xe=="string"?`'${Xe}'`:p(Xe)),", ");throw new b(Ee,te,We)}});function Te(te,Ee){if(typeof te!="boolean")throw new R(Ee,"boolean",te)}function K(te,Ee,Ae){return te==null||!h(te,Ee)?Ae:te[Ee]}const me=S((te,Ee,Ae=null)=>{const ye=K(Ae,"allowArray",!1),We=K(Ae,"allowFunction",!1);if(!K(Ae,"nullable",!1)&&te===null||!ye&&n(te)||typeof te!="object"&&(!We||typeof te!="function"))throw new R(Ee,"Object",te)}),Ie=S((te,Ee)=>{if(te!=null&&typeof te!="object"&&typeof te!="function")throw new R(Ee,"a dictionary",te)}),Fe=S((te,Ee,Ae=0)=>{if(!n(te))throw new R(Ee,"Array",te);if(te.length<Ae){const ye=`must be longer than ${Ae}`;throw new b(Ee,te,ye)}});function De(te,Ee){Fe(te,Ee);for(let Ae=0;Ae<te.length;Ae++)fe(te[Ae],`${Ee}[${Ae}]`)}function Oe(te,Ee){Fe(te,Ee);for(let Ae=0;Ae<te.length;Ae++)Te(te[Ae],`${Ee}[${Ae}]`)}function $e(te,Ee){Fe(te,Ee);for(let Ae=0;Ae<te.length;Ae++){const ye=te[Ae],We=`${Ee}[${Ae}]`;if(ye==null)throw new R(We,"AbortSignal",ye);V(ye,We)}}function He(te,Ee="signal"){if(fe(te,Ee),M[te]===void 0)throw M[x(te)]!==void 0?new A(te+" (signals must use all capital letters)"):new A(te)}const Se=S((te,Ee="buffer")=>{if(!B(te))throw new R(Ee,["Buffer","TypedArray","DataView"],te)});function Re(te,Ee){const Ae=k(Ee),ye=te.length;if(Ae==="hex"&&ye%2!==0)throw new b("encoding",Ee,`is invalid for data of length ${ye}`)}function Ce(te,Ee="Port",Ae=!0){if(typeof te!="number"&&typeof te!="string"||typeof te=="string"&&T(te).length===0||+te!==+te>>>0||te>65535||te===0&&!Ae)throw new v(Ee,te,Ae);return te|0}const V=S((te,Ee)=>{if(te!==void 0&&(te===null||typeof te!="object"||!("aborted"in te)))throw new R(Ee,"AbortSignal",te)}),I=S((te,Ee)=>{if(typeof te!="function")throw new R(Ee,"Function",te)}),y=S((te,Ee)=>{if(typeof te!="function"||D(te))throw new R(Ee,"Function",te)}),C=S((te,Ee)=>{if(te!==void 0)throw new R(Ee,"undefined",te)});function O(te,Ee,Ae){if(!e(Ae,te))throw new R(Ee,`('${t(Ae,"|")}')`,te)}const X=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function se(te,Ee){if(typeof te>"u"||!d(X,te))throw new b(Ee,te,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function _e(te){if(typeof te=="string")return se(te,"hints"),te;if(n(te)){const Ee=te.length;let Ae="";if(Ee===0)return Ae;for(let ye=0;ye<Ee;ye++){const We=te[ye];se(We,"hints"),Ae+=We,ye!==Ee-1&&(Ae+=", ")}return Ae}throw new b("hints",te,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}return Mi={isInt32:ie,isUint32:he,parseFileMode:be,validateArray:Fe,validateStringArray:De,validateBooleanArray:Oe,validateAbortSignalArray:$e,validateBoolean:Te,validateBuffer:Se,validateDictionary:Ie,validateEncoding:Re,validateFunction:I,validateInt32:ke,validateInteger:ue,validateNumber:Ne,validateObject:me,validateOneOf:pe,validatePlainFunction:y,validatePort:Ce,validateSignalName:He,validateString:fe,validateUint32:ne,validateUndefined:C,validateUnion:O,validateAbortSignal:V,validateLinkHeaderValue:_e},Mi}var $n={exports:{}},Hi={exports:{}},Qo;function Tr(){if(Qo)return Hi.exports;Qo=1;var n=Hi.exports={},e,t;function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?e=setTimeout:e=r}catch{e=r}try{typeof clearTimeout=="function"?t=clearTimeout:t=o}catch{t=o}})();function u(v){if(e===setTimeout)return setTimeout(v,0);if((e===r||!e)&&setTimeout)return e=setTimeout,setTimeout(v,0);try{return e(v,0)}catch{try{return e.call(null,v,0)}catch{return e.call(this,v,0)}}}function c(v){if(t===clearTimeout)return clearTimeout(v);if((t===o||!t)&&clearTimeout)return t=clearTimeout,clearTimeout(v);try{return t(v)}catch{try{return t.call(null,v)}catch{return t.call(this,v)}}}var l=[],g=!1,h,d=-1;function p(){!g||!h||(g=!1,h.length?l=h.concat(l):d=-1,l.length&&x())}function x(){if(!g){var v=u(p);g=!0;for(var R=l.length;R;){for(h=l,l=[];++d<R;)h&&h[d].run();d=-1,R=l.length}h=null,g=!1,c(v)}}n.nextTick=function(v){var R=new Array(arguments.length-1);if(arguments.length>1)for(var b=1;b<arguments.length;b++)R[b-1]=arguments[b];l.push(new T(v,R)),l.length===1&&!g&&u(x)};function T(v,R){this.fun=v,this.array=R}T.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={};function S(){}return n.on=S,n.addListener=S,n.once=S,n.off=S,n.removeListener=S,n.removeAllListeners=S,n.emit=S,n.prependListener=S,n.prependOnceListener=S,n.listeners=function(v){return[]},n.binding=function(v){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(v){throw new Error("process.chdir is not supported")},n.umask=function(){return 0},Hi.exports}var Ki,Yo;function sr(){if(Yo)return Ki;Yo=1;const{SymbolAsyncIterator:n,SymbolIterator:e,SymbolFor:t}=ct(),r=t("nodejs.stream.destroyed"),o=t("nodejs.stream.errored"),u=t("nodejs.stream.readable"),c=t("nodejs.stream.writable"),l=t("nodejs.stream.disturbed"),g=t("nodejs.webstream.isClosedPromise"),h=t("nodejs.webstream.controllerErrorFunction");function d(K,me=!1){var Ie;return!!(K&&typeof K.pipe=="function"&&typeof K.on=="function"&&(!me||typeof K.pause=="function"&&typeof K.resume=="function")&&(!K._writableState||((Ie=K._readableState)===null||Ie===void 0?void 0:Ie.readable)!==!1)&&(!K._writableState||K._readableState))}function p(K){var me;return!!(K&&typeof K.write=="function"&&typeof K.on=="function"&&(!K._readableState||((me=K._writableState)===null||me===void 0?void 0:me.writable)!==!1))}function x(K){return!!(K&&typeof K.pipe=="function"&&K._readableState&&typeof K.on=="function"&&typeof K.write=="function")}function T(K){return K&&(K._readableState||K._writableState||typeof K.write=="function"&&typeof K.on=="function"||typeof K.pipe=="function"&&typeof K.on=="function")}function S(K){return!!(K&&!T(K)&&typeof K.pipeThrough=="function"&&typeof K.getReader=="function"&&typeof K.cancel=="function")}function v(K){return!!(K&&!T(K)&&typeof K.getWriter=="function"&&typeof K.abort=="function")}function R(K){return!!(K&&!T(K)&&typeof K.readable=="object"&&typeof K.writable=="object")}function b(K){return S(K)||v(K)||R(K)}function E(K,me){return K==null?!1:me===!0?typeof K[n]=="function":me===!1?typeof K[e]=="function":typeof K[n]=="function"||typeof K[e]=="function"}function A(K){if(!T(K))return null;const me=K._writableState,Ie=K._readableState,Fe=me||Ie;return!!(K.destroyed||K[r]||Fe!=null&&Fe.destroyed)}function k(K){if(!p(K))return null;if(K.writableEnded===!0)return!0;const me=K._writableState;return me!=null&&me.errored?!1:typeof me?.ended!="boolean"?null:me.ended}function D(K,me){if(!p(K))return null;if(K.writableFinished===!0)return!0;const Ie=K._writableState;return Ie!=null&&Ie.errored?!1:typeof Ie?.finished!="boolean"?null:!!(Ie.finished||me===!1&&Ie.ended===!0&&Ie.length===0)}function B(K){if(!d(K))return null;if(K.readableEnded===!0)return!0;const me=K._readableState;return!me||me.errored?!1:typeof me?.ended!="boolean"?null:me.ended}function M(K,me){if(!d(K))return null;const Ie=K._readableState;return Ie!=null&&Ie.errored?!1:typeof Ie?.endEmitted!="boolean"?null:!!(Ie.endEmitted||me===!1&&Ie.ended===!0&&Ie.length===0)}function ie(K){return K&&K[u]!=null?K[u]:typeof K?.readable!="boolean"?null:A(K)?!1:d(K)&&K.readable&&!M(K)}function he(K){return K&&K[c]!=null?K[c]:typeof K?.writable!="boolean"?null:A(K)?!1:p(K)&&K.writable&&!k(K)}function L(K,me){return T(K)?A(K)?!0:!(me?.readable!==!1&&ie(K)||me?.writable!==!1&&he(K)):null}function re(K){var me,Ie;return T(K)?K.writableErrored?K.writableErrored:(me=(Ie=K._writableState)===null||Ie===void 0?void 0:Ie.errored)!==null&&me!==void 0?me:null:null}function be(K){var me,Ie;return T(K)?K.readableErrored?K.readableErrored:(me=(Ie=K._readableState)===null||Ie===void 0?void 0:Ie.errored)!==null&&me!==void 0?me:null:null}function ue(K){if(!T(K))return null;if(typeof K.closed=="boolean")return K.closed;const me=K._writableState,Ie=K._readableState;return typeof me?.closed=="boolean"||typeof Ie?.closed=="boolean"?me?.closed||Ie?.closed:typeof K._closed=="boolean"&&ke(K)?K._closed:null}function ke(K){return typeof K._closed=="boolean"&&typeof K._defaultKeepAlive=="boolean"&&typeof K._removedConnection=="boolean"&&typeof K._removedContLen=="boolean"}function ne(K){return typeof K._sent100=="boolean"&&ke(K)}function fe(K){var me;return typeof K._consuming=="boolean"&&typeof K._dumped=="boolean"&&((me=K.req)===null||me===void 0?void 0:me.upgradeOrConnect)===void 0}function Ne(K){if(!T(K))return null;const me=K._writableState,Ie=K._readableState,Fe=me||Ie;return!Fe&&ne(K)||!!(Fe&&Fe.autoDestroy&&Fe.emitClose&&Fe.closed===!1)}function pe(K){var me;return!!(K&&((me=K[l])!==null&&me!==void 0?me:K.readableDidRead||K.readableAborted))}function Te(K){var me,Ie,Fe,De,Oe,$e,He,Se,Re,Ce;return!!(K&&((me=(Ie=(Fe=(De=(Oe=($e=K[o])!==null&&$e!==void 0?$e:K.readableErrored)!==null&&Oe!==void 0?Oe:K.writableErrored)!==null&&De!==void 0?De:(He=K._readableState)===null||He===void 0?void 0:He.errorEmitted)!==null&&Fe!==void 0?Fe:(Se=K._writableState)===null||Se===void 0?void 0:Se.errorEmitted)!==null&&Ie!==void 0?Ie:(Re=K._readableState)===null||Re===void 0?void 0:Re.errored)!==null&&me!==void 0?me:!((Ce=K._writableState)===null||Ce===void 0)&&Ce.errored))}return Ki={isDestroyed:A,kIsDestroyed:r,isDisturbed:pe,kIsDisturbed:l,isErrored:Te,kIsErrored:o,isReadable:ie,kIsReadable:u,kIsClosedPromise:g,kControllerErrorFunction:h,kIsWritable:c,isClosed:ue,isDuplexNodeStream:x,isFinished:L,isIterable:E,isReadableNodeStream:d,isReadableStream:S,isReadableEnded:B,isReadableFinished:M,isReadableErrored:be,isNodeStream:T,isWebStream:b,isWritable:he,isWritableNodeStream:p,isWritableStream:v,isWritableEnded:k,isWritableFinished:D,isWritableErrored:re,isServerRequest:fe,isServerResponse:ne,willEmitClose:Ne,isTransformStream:R},Ki}var Xo;function hr(){if(Xo)return $n.exports;Xo=1;const n=Tr(),{AbortError:e,codes:t}=Ct(),{ERR_INVALID_ARG_TYPE:r,ERR_STREAM_PREMATURE_CLOSE:o}=t,{kEmptyObject:u,once:c}=jt(),{validateAbortSignal:l,validateFunction:g,validateObject:h,validateBoolean:d}=Dn(),{Promise:p,PromisePrototypeThen:x,SymbolDispose:T}=ct(),{isClosed:S,isReadable:v,isReadableNodeStream:R,isReadableStream:b,isReadableFinished:E,isReadableErrored:A,isWritable:k,isWritableNodeStream:D,isWritableStream:B,isWritableFinished:M,isWritableErrored:ie,isNodeStream:he,willEmitClose:L,kIsClosedPromise:re}=sr();let be;function ue(pe){return pe.setHeader&&typeof pe.abort=="function"}const ke=()=>{};function ne(pe,Te,K){var me,Ie;if(arguments.length===2?(K=Te,Te=u):Te==null?Te=u:h(Te,"options"),g(K,"callback"),l(Te.signal,"options.signal"),K=c(K),b(pe)||B(pe))return fe(pe,Te,K);if(!he(pe))throw new r("stream",["ReadableStream","WritableStream","Stream"],pe);const Fe=(me=Te.readable)!==null&&me!==void 0?me:R(pe),De=(Ie=Te.writable)!==null&&Ie!==void 0?Ie:D(pe),Oe=pe._writableState,$e=pe._readableState,He=()=>{pe.writable||Ce()};let Se=L(pe)&&R(pe)===Fe&&D(pe)===De,Re=M(pe,!1);const Ce=()=>{Re=!0,pe.destroyed&&(Se=!1),!(Se&&(!pe.readable||Fe))&&(!Fe||V)&&K.call(pe)};let V=E(pe,!1);const I=()=>{V=!0,pe.destroyed&&(Se=!1),!(Se&&(!pe.writable||De))&&(!De||Re)&&K.call(pe)},y=te=>{K.call(pe,te)};let C=S(pe);const O=()=>{C=!0;const te=ie(pe)||A(pe);if(te&&typeof te!="boolean")return K.call(pe,te);if(Fe&&!V&&R(pe,!0)&&!E(pe,!1))return K.call(pe,new o);if(De&&!Re&&!M(pe,!1))return K.call(pe,new o);K.call(pe)},X=()=>{C=!0;const te=ie(pe)||A(pe);if(te&&typeof te!="boolean")return K.call(pe,te);K.call(pe)},se=()=>{pe.req.on("finish",Ce)};ue(pe)?(pe.on("complete",Ce),Se||pe.on("abort",O),pe.req?se():pe.on("request",se)):De&&!Oe&&(pe.on("end",He),pe.on("close",He)),!Se&&typeof pe.aborted=="boolean"&&pe.on("aborted",O),pe.on("end",I),pe.on("finish",Ce),Te.error!==!1&&pe.on("error",y),pe.on("close",O),C?n.nextTick(O):Oe!=null&&Oe.errorEmitted||$e!=null&&$e.errorEmitted?Se||n.nextTick(X):(!Fe&&(!Se||v(pe))&&(Re||k(pe)===!1)||!De&&(!Se||k(pe))&&(V||v(pe)===!1)||$e&&pe.req&&pe.aborted)&&n.nextTick(X);const _e=()=>{K=ke,pe.removeListener("aborted",O),pe.removeListener("complete",Ce),pe.removeListener("abort",O),pe.removeListener("request",se),pe.req&&pe.req.removeListener("finish",Ce),pe.removeListener("end",He),pe.removeListener("close",He),pe.removeListener("finish",Ce),pe.removeListener("end",I),pe.removeListener("error",y),pe.removeListener("close",O)};if(Te.signal&&!C){const te=()=>{const Ee=K;_e(),Ee.call(pe,new e(void 0,{cause:Te.signal.reason}))};if(Te.signal.aborted)n.nextTick(te);else{be=be||jt().addAbortListener;const Ee=be(Te.signal,te),Ae=K;K=c((...ye)=>{Ee[T](),Ae.apply(pe,ye)})}}return _e}function fe(pe,Te,K){let me=!1,Ie=ke;if(Te.signal)if(Ie=()=>{me=!0,K.call(pe,new e(void 0,{cause:Te.signal.reason}))},Te.signal.aborted)n.nextTick(Ie);else{be=be||jt().addAbortListener;const De=be(Te.signal,Ie),Oe=K;K=c((...$e)=>{De[T](),Oe.apply(pe,$e)})}const Fe=(...De)=>{me||n.nextTick(()=>K.apply(pe,De))};return x(pe[re].promise,Fe,Fe),ke}function Ne(pe,Te){var K;let me=!1;return Te===null&&(Te=u),(K=Te)!==null&&K!==void 0&&K.cleanup&&(d(Te.cleanup,"cleanup"),me=Te.cleanup),new p((Ie,Fe)=>{const De=ne(pe,Te,Oe=>{me&&De(),Oe?Fe(Oe):Ie()})})}return $n.exports=ne,$n.exports.finished=Ne,$n.exports}var qi,Zo;function Jr(){if(Zo)return qi;Zo=1;const n=Tr(),{aggregateTwoErrors:e,codes:{ERR_MULTIPLE_CALLBACK:t},AbortError:r}=Ct(),{Symbol:o}=ct(),{kIsDestroyed:u,isDestroyed:c,isFinished:l,isServerRequest:g}=sr(),h=o("kDestroy"),d=o("kConstruct");function p(L,re,be){L&&(L.stack,re&&!re.errored&&(re.errored=L),be&&!be.errored&&(be.errored=L))}function x(L,re){const be=this._readableState,ue=this._writableState,ke=ue||be;return ue!=null&&ue.destroyed||be!=null&&be.destroyed?(typeof re=="function"&&re(),this):(p(L,ue,be),ue&&(ue.destroyed=!0),be&&(be.destroyed=!0),ke.constructed?T(this,L,re):this.once(h,function(ne){T(this,e(ne,L),re)}),this)}function T(L,re,be){let ue=!1;function ke(ne){if(ue)return;ue=!0;const fe=L._readableState,Ne=L._writableState;p(ne,Ne,fe),Ne&&(Ne.closed=!0),fe&&(fe.closed=!0),typeof be=="function"&&be(ne),ne?n.nextTick(S,L,ne):n.nextTick(v,L)}try{L._destroy(re||null,ke)}catch(ne){ke(ne)}}function S(L,re){R(L,re),v(L)}function v(L){const re=L._readableState,be=L._writableState;be&&(be.closeEmitted=!0),re&&(re.closeEmitted=!0),(be!=null&&be.emitClose||re!=null&&re.emitClose)&&L.emit("close")}function R(L,re){const be=L._readableState,ue=L._writableState;ue!=null&&ue.errorEmitted||be!=null&&be.errorEmitted||(ue&&(ue.errorEmitted=!0),be&&(be.errorEmitted=!0),L.emit("error",re))}function b(){const L=this._readableState,re=this._writableState;L&&(L.constructed=!0,L.closed=!1,L.closeEmitted=!1,L.destroyed=!1,L.errored=null,L.errorEmitted=!1,L.reading=!1,L.ended=L.readable===!1,L.endEmitted=L.readable===!1),re&&(re.constructed=!0,re.destroyed=!1,re.closed=!1,re.closeEmitted=!1,re.errored=null,re.errorEmitted=!1,re.finalCalled=!1,re.prefinished=!1,re.ended=re.writable===!1,re.ending=re.writable===!1,re.finished=re.writable===!1)}function E(L,re,be){const ue=L._readableState,ke=L._writableState;if(ke!=null&&ke.destroyed||ue!=null&&ue.destroyed)return this;ue!=null&&ue.autoDestroy||ke!=null&&ke.autoDestroy?L.destroy(re):re&&(re.stack,ke&&!ke.errored&&(ke.errored=re),ue&&!ue.errored&&(ue.errored=re),be?n.nextTick(R,L,re):R(L,re))}function A(L,re){if(typeof L._construct!="function")return;const be=L._readableState,ue=L._writableState;be&&(be.constructed=!1),ue&&(ue.constructed=!1),L.once(d,re),!(L.listenerCount(d)>1)&&n.nextTick(k,L)}function k(L){let re=!1;function be(ue){if(re){E(L,ue??new t);return}re=!0;const ke=L._readableState,ne=L._writableState,fe=ne||ke;ke&&(ke.constructed=!0),ne&&(ne.constructed=!0),fe.destroyed?L.emit(h,ue):ue?E(L,ue,!0):n.nextTick(D,L)}try{L._construct(ue=>{n.nextTick(be,ue)})}catch(ue){n.nextTick(be,ue)}}function D(L){L.emit(d)}function B(L){return L?.setHeader&&typeof L.abort=="function"}function M(L){L.emit("close")}function ie(L,re){L.emit("error",re),n.nextTick(M,L)}function he(L,re){!L||c(L)||(!re&&!l(L)&&(re=new r),g(L)?(L.socket=null,L.destroy(re)):B(L)?L.abort():B(L.req)?L.req.abort():typeof L.destroy=="function"?L.destroy(re):typeof L.close=="function"?L.close():re?n.nextTick(ie,L,re):n.nextTick(M,L),L.destroyed||(L[u]=!0))}return qi={construct:A,destroyer:he,destroy:x,undestroy:b,errorOrDestroy:E},qi}var Wi,ea;function Ms(){if(ea)return Wi;ea=1;const{ArrayIsArray:n,ObjectSetPrototypeOf:e}=ct(),{EventEmitter:t}=Nn();function r(u){t.call(this,u)}e(r.prototype,t.prototype),e(r,t),r.prototype.pipe=function(u,c){const l=this;function g(v){u.writable&&u.write(v)===!1&&l.pause&&l.pause()}l.on("data",g);function h(){l.readable&&l.resume&&l.resume()}u.on("drain",h),!u._isStdio&&(!c||c.end!==!1)&&(l.on("end",p),l.on("close",x));let d=!1;function p(){d||(d=!0,u.end())}function x(){d||(d=!0,typeof u.destroy=="function"&&u.destroy())}function T(v){S(),t.listenerCount(this,"error")===0&&this.emit("error",v)}o(l,"error",T),o(u,"error",T);function S(){l.removeListener("data",g),u.removeListener("drain",h),l.removeListener("end",p),l.removeListener("close",x),l.removeListener("error",T),u.removeListener("error",T),l.removeListener("end",S),l.removeListener("close",S),u.removeListener("close",S)}return l.on("end",S),l.on("close",S),u.on("close",S),u.emit("pipe",l),u};function o(u,c,l){if(typeof u.prependListener=="function")return u.prependListener(c,l);!u._events||!u._events[c]?u.on(c,l):n(u._events[c])?u._events[c].unshift(l):u._events[c]=[l,u._events[c]]}return Wi={Stream:r,prependListener:o},Wi}var $i={exports:{}},ta;function ai(){return ta||(ta=1,function(n){const{SymbolDispose:e}=ct(),{AbortError:t,codes:r}=Ct(),{isNodeStream:o,isWebStream:u,kControllerErrorFunction:c}=sr(),l=hr(),{ERR_INVALID_ARG_TYPE:g}=r;let h;const d=(p,x)=>{if(typeof p!="object"||!("aborted"in p))throw new g(x,"AbortSignal",p)};n.exports.addAbortSignal=function(x,T){if(d(x,"signal"),!o(T)&&!u(T))throw new g("stream",["ReadableStream","WritableStream","Stream"],T);return n.exports.addAbortSignalNoValidate(x,T)},n.exports.addAbortSignalNoValidate=function(p,x){if(typeof p!="object"||!("aborted"in p))return x;const T=o(x)?()=>{x.destroy(new t(void 0,{cause:p.reason}))}:()=>{x[c](new t(void 0,{cause:p.reason}))};if(p.aborted)T();else{h=h||jt().addAbortListener;const S=h(p,T);l(x,S[e])}return x}}($i)),$i.exports}var Vi,ra;function Yl(){if(ra)return Vi;ra=1;const{StringPrototypeSlice:n,SymbolIterator:e,TypedArrayPrototypeSet:t,Uint8Array:r}=ct(),{Buffer:o}=ir(),{inspect:u}=jt();return Vi=class{constructor(){this.head=null,this.tail=null,this.length=0}push(l){const g={data:l,next:null};this.length>0?this.tail.next=g:this.head=g,this.tail=g,++this.length}unshift(l){const g={data:l,next:this.head};this.length===0&&(this.tail=g),this.head=g,++this.length}shift(){if(this.length===0)return;const l=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,l}clear(){this.head=this.tail=null,this.length=0}join(l){if(this.length===0)return"";let g=this.head,h=""+g.data;for(;(g=g.next)!==null;)h+=l+g.data;return h}concat(l){if(this.length===0)return o.alloc(0);const g=o.allocUnsafe(l>>>0);let h=this.head,d=0;for(;h;)t(g,h.data,d),d+=h.data.length,h=h.next;return g}consume(l,g){const h=this.head.data;if(l<h.length){const d=h.slice(0,l);return this.head.data=h.slice(l),d}return l===h.length?this.shift():g?this._getString(l):this._getBuffer(l)}first(){return this.head.data}*[e](){for(let l=this.head;l;l=l.next)yield l.data}_getString(l){let g="",h=this.head,d=0;do{const p=h.data;if(l>p.length)g+=p,l-=p.length;else{l===p.length?(g+=p,++d,h.next?this.head=h.next:this.head=this.tail=null):(g+=n(p,0,l),this.head=h,h.data=n(p,l));break}++d}while((h=h.next)!==null);return this.length-=d,g}_getBuffer(l){const g=o.allocUnsafe(l),h=l;let d=this.head,p=0;do{const x=d.data;if(l>x.length)t(g,x,h-l),l-=x.length;else{l===x.length?(t(g,x,h-l),++p,d.next?this.head=d.next:this.head=this.tail=null):(t(g,new r(x.buffer,x.byteOffset,l),h-l),this.head=d,d.data=x.slice(l));break}++p}while((d=d.next)!==null);return this.length-=p,g}[Symbol.for("nodejs.util.inspect.custom")](l,g){return u(this,{...g,depth:0,customInspect:!1})}},Vi}var Ji,na;function ui(){if(na)return Ji;na=1;const{MathFloor:n,NumberIsInteger:e}=ct(),{validateInteger:t}=Dn(),{ERR_INVALID_ARG_VALUE:r}=Ct().codes;let o=16*1024,u=16;function c(d,p,x){return d.highWaterMark!=null?d.highWaterMark:p?d[x]:null}function l(d){return d?u:o}function g(d,p){t(p,"value",0),d?u=p:o=p}function h(d,p,x,T){const S=c(p,T,x);if(S!=null){if(!e(S)||S<0){const v=T?`options.${x}`:"options.highWaterMark";throw new r(v,S)}return n(S)}return l(d.objectMode)}return Ji={getHighWaterMark:h,getDefaultHighWaterMark:l,setDefaultHighWaterMark:g},Ji}var Gi={},Vn={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var ia;function Xl(){return ia||(ia=1,function(n,e){var t=ir(),r=t.Buffer;function o(c,l){for(var g in c)l[g]=c[g]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?n.exports=t:(o(t,e),e.Buffer=u);function u(c,l,g){return r(c,l,g)}u.prototype=Object.create(r.prototype),o(r,u),u.from=function(c,l,g){if(typeof c=="number")throw new TypeError("Argument must not be a number");return r(c,l,g)},u.alloc=function(c,l,g){if(typeof c!="number")throw new TypeError("Argument must be a number");var h=r(c);return l!==void 0?typeof g=="string"?h.fill(l,g):h.fill(l):h.fill(0),h},u.allocUnsafe=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return r(c)},u.allocUnsafeSlow=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(c)}}(Vn,Vn.exports)),Vn.exports}var sa;function Zl(){if(sa)return Gi;sa=1;var n=Xl().Buffer,e=n.isEncoding||function(b){switch(b=""+b,b&&b.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(b){if(!b)return"utf8";for(var E;;)switch(b){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return b;default:if(E)return;b=(""+b).toLowerCase(),E=!0}}function r(b){var E=t(b);if(typeof E!="string"&&(n.isEncoding===e||!e(b)))throw new Error("Unknown encoding: "+b);return E||b}Gi.StringDecoder=o;function o(b){this.encoding=r(b);var E;switch(this.encoding){case"utf16le":this.text=p,this.end=x,E=4;break;case"utf8":this.fillLast=g,E=4;break;case"base64":this.text=T,this.end=S,E=3;break;default:this.write=v,this.end=R;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(E)}o.prototype.write=function(b){if(b.length===0)return"";var E,A;if(this.lastNeed){if(E=this.fillLast(b),E===void 0)return"";A=this.lastNeed,this.lastNeed=0}else A=0;return A<b.length?E?E+this.text(b,A):this.text(b,A):E||""},o.prototype.end=d,o.prototype.text=h,o.prototype.fillLast=function(b){if(this.lastNeed<=b.length)return b.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);b.copy(this.lastChar,this.lastTotal-this.lastNeed,0,b.length),this.lastNeed-=b.length};function u(b){return b<=127?0:b>>5===6?2:b>>4===14?3:b>>3===30?4:b>>6===2?-1:-2}function c(b,E,A){var k=E.length-1;if(k<A)return 0;var D=u(E[k]);return D>=0?(D>0&&(b.lastNeed=D-1),D):--k<A||D===-2?0:(D=u(E[k]),D>=0?(D>0&&(b.lastNeed=D-2),D):--k<A||D===-2?0:(D=u(E[k]),D>=0?(D>0&&(D===2?D=0:b.lastNeed=D-3),D):0))}function l(b,E,A){if((E[0]&192)!==128)return b.lastNeed=0,"�";if(b.lastNeed>1&&E.length>1){if((E[1]&192)!==128)return b.lastNeed=1,"�";if(b.lastNeed>2&&E.length>2&&(E[2]&192)!==128)return b.lastNeed=2,"�"}}function g(b){var E=this.lastTotal-this.lastNeed,A=l(this,b);if(A!==void 0)return A;if(this.lastNeed<=b.length)return b.copy(this.lastChar,E,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);b.copy(this.lastChar,E,0,b.length),this.lastNeed-=b.length}function h(b,E){var A=c(this,b,E);if(!this.lastNeed)return b.toString("utf8",E);this.lastTotal=A;var k=b.length-(A-this.lastNeed);return b.copy(this.lastChar,0,k),b.toString("utf8",E,k)}function d(b){var E=b&&b.length?this.write(b):"";return this.lastNeed?E+"�":E}function p(b,E){if((b.length-E)%2===0){var A=b.toString("utf16le",E);if(A){var k=A.charCodeAt(A.length-1);if(k>=55296&&k<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=b[b.length-2],this.lastChar[1]=b[b.length-1],A.slice(0,-1)}return A}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=b[b.length-1],b.toString("utf16le",E,b.length-1)}function x(b){var E=b&&b.length?this.write(b):"";if(this.lastNeed){var A=this.lastTotal-this.lastNeed;return E+this.lastChar.toString("utf16le",0,A)}return E}function T(b,E){var A=(b.length-E)%3;return A===0?b.toString("base64",E):(this.lastNeed=3-A,this.lastTotal=3,A===1?this.lastChar[0]=b[b.length-1]:(this.lastChar[0]=b[b.length-2],this.lastChar[1]=b[b.length-1]),b.toString("base64",E,b.length-A))}function S(b){var E=b&&b.length?this.write(b):"";return this.lastNeed?E+this.lastChar.toString("base64",0,3-this.lastNeed):E}function v(b){return b.toString(this.encoding)}function R(b){return b&&b.length?this.write(b):""}return Gi}var zi,oa;function _u(){if(oa)return zi;oa=1;const n=Tr(),{PromisePrototypeThen:e,SymbolAsyncIterator:t,SymbolIterator:r}=ct(),{Buffer:o}=ir(),{ERR_INVALID_ARG_TYPE:u,ERR_STREAM_NULL_VALUES:c}=Ct().codes;function l(g,h,d){let p;if(typeof h=="string"||h instanceof o)return new g({objectMode:!0,...d,read(){this.push(h),this.push(null)}});let x;if(h&&h[t])x=!0,p=h[t]();else if(h&&h[r])x=!1,p=h[r]();else throw new u("iterable",["Iterable"],h);const T=new g({objectMode:!0,highWaterMark:1,...d});let S=!1;T._read=function(){S||(S=!0,R())},T._destroy=function(b,E){e(v(b),()=>n.nextTick(E,b),A=>n.nextTick(E,A||b))};async function v(b){const E=b!=null,A=typeof p.throw=="function";if(E&&A){const{value:k,done:D}=await p.throw(b);if(await k,D)return}if(typeof p.return=="function"){const{value:k}=await p.return();await k}}async function R(){for(;;){try{const{value:b,done:E}=x?await p.next():p.next();if(E)T.push(null);else{const A=b&&typeof b.then=="function"?await b:b;if(A===null)throw S=!1,new c;if(T.push(A))continue;S=!1}}catch(b){T.destroy(b)}break}}return T}return zi=l,zi}var Qi,aa;function ci(){if(aa)return Qi;aa=1;const n=Tr(),{ArrayPrototypeIndexOf:e,NumberIsInteger:t,NumberIsNaN:r,NumberParseInt:o,ObjectDefineProperties:u,ObjectKeys:c,ObjectSetPrototypeOf:l,Promise:g,SafeSet:h,SymbolAsyncDispose:d,SymbolAsyncIterator:p,Symbol:x}=ct();Qi=ye,ye.ReadableState=Ae;const{EventEmitter:T}=Nn(),{Stream:S,prependListener:v}=Ms(),{Buffer:R}=ir(),{addAbortSignal:b}=ai(),E=hr();let A=jt().debuglog("stream",W=>{A=W});const k=Yl(),D=Jr(),{getHighWaterMark:B,getDefaultHighWaterMark:M}=ui(),{aggregateTwoErrors:ie,codes:{ERR_INVALID_ARG_TYPE:he,ERR_METHOD_NOT_IMPLEMENTED:L,ERR_OUT_OF_RANGE:re,ERR_STREAM_PUSH_AFTER_EOF:be,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:ue},AbortError:ke}=Ct(),{validateObject:ne}=Dn(),fe=x("kPaused"),{StringDecoder:Ne}=Zl(),pe=_u();l(ye.prototype,S.prototype),l(ye,S);const Te=()=>{},{errorOrDestroy:K}=D,me=1,Ie=2,Fe=4,De=8,Oe=16,$e=32,He=64,Se=128,Re=256,Ce=512,V=1024,I=2048,y=4096,C=8192,O=16384,X=32768,se=65536,_e=1<<17,te=1<<18;function Ee(W){return{enumerable:!1,get(){return(this.state&W)!==0},set(Y){Y?this.state|=W:this.state&=~W}}}u(Ae.prototype,{objectMode:Ee(me),ended:Ee(Ie),endEmitted:Ee(Fe),reading:Ee(De),constructed:Ee(Oe),sync:Ee($e),needReadable:Ee(He),emittedReadable:Ee(Se),readableListening:Ee(Re),resumeScheduled:Ee(Ce),errorEmitted:Ee(V),emitClose:Ee(I),autoDestroy:Ee(y),destroyed:Ee(C),closed:Ee(O),closeEmitted:Ee(X),multiAwaitDrain:Ee(se),readingMore:Ee(_e),dataEmitted:Ee(te)});function Ae(W,Y,Le){typeof Le!="boolean"&&(Le=Y instanceof rr()),this.state=I|y|Oe|$e,W&&W.objectMode&&(this.state|=me),Le&&W&&W.readableObjectMode&&(this.state|=me),this.highWaterMark=W?B(this,W,"readableHighWaterMark",Le):M(!1),this.buffer=new k,this.length=0,this.pipes=[],this.flowing=null,this[fe]=null,W&&W.emitClose===!1&&(this.state&=~I),W&&W.autoDestroy===!1&&(this.state&=~y),this.errored=null,this.defaultEncoding=W&&W.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,W&&W.encoding&&(this.decoder=new Ne(W.encoding),this.encoding=W.encoding)}function ye(W){if(!(this instanceof ye))return new ye(W);const Y=this instanceof rr();this._readableState=new Ae(W,this,Y),W&&(typeof W.read=="function"&&(this._read=W.read),typeof W.destroy=="function"&&(this._destroy=W.destroy),typeof W.construct=="function"&&(this._construct=W.construct),W.signal&&!Y&&b(W.signal,this)),S.call(this,W),D.construct(this,()=>{this._readableState.needReadable&&ae(this,this._readableState)})}ye.prototype.destroy=D.destroy,ye.prototype._undestroy=D.undestroy,ye.prototype._destroy=function(W,Y){Y(W)},ye.prototype[T.captureRejectionSymbol]=function(W){this.destroy(W)},ye.prototype[d]=function(){let W;return this.destroyed||(W=this.readableEnded?null:new ke,this.destroy(W)),new g((Y,Le)=>E(this,Ue=>Ue&&Ue!==W?Le(Ue):Y(null)))},ye.prototype.push=function(W,Y){return We(this,W,Y,!1)},ye.prototype.unshift=function(W,Y){return We(this,W,Y,!0)};function We(W,Y,Le,Ue){A("readableAddChunk",Y);const Ke=W._readableState;let dt;if((Ke.state&me)===0&&(typeof Y=="string"?(Le=Le||Ke.defaultEncoding,Ke.encoding!==Le&&(Ue&&Ke.encoding?Y=R.from(Y,Le).toString(Ke.encoding):(Y=R.from(Y,Le),Le=""))):Y instanceof R?Le="":S._isUint8Array(Y)?(Y=S._uint8ArrayToBuffer(Y),Le=""):Y!=null&&(dt=new he("chunk",["string","Buffer","Uint8Array"],Y))),dt)K(W,dt);else if(Y===null)Ke.state&=~De,w(W,Ke);else if((Ke.state&me)!==0||Y&&Y.length>0)if(Ue)if((Ke.state&Fe)!==0)K(W,new ue);else{if(Ke.destroyed||Ke.errored)return!1;Xe(W,Ke,Y,!0)}else if(Ke.ended)K(W,new be);else{if(Ke.destroyed||Ke.errored)return!1;Ke.state&=~De,Ke.decoder&&!Le?(Y=Ke.decoder.write(Y),Ke.objectMode||Y.length!==0?Xe(W,Ke,Y,!1):ae(W,Ke)):Xe(W,Ke,Y,!1)}else Ue||(Ke.state&=~De,ae(W,Ke));return!Ke.ended&&(Ke.length<Ke.highWaterMark||Ke.length===0)}function Xe(W,Y,Le,Ue){Y.flowing&&Y.length===0&&!Y.sync&&W.listenerCount("data")>0?((Y.state&se)!==0?Y.awaitDrainWriters.clear():Y.awaitDrainWriters=null,Y.dataEmitted=!0,W.emit("data",Le)):(Y.length+=Y.objectMode?1:Le.length,Ue?Y.buffer.unshift(Le):Y.buffer.push(Le),(Y.state&He)!==0&&F(W)),ae(W,Y)}ye.prototype.isPaused=function(){const W=this._readableState;return W[fe]===!0||W.flowing===!1},ye.prototype.setEncoding=function(W){const Y=new Ne(W);this._readableState.decoder=Y,this._readableState.encoding=this._readableState.decoder.encoding;const Le=this._readableState.buffer;let Ue="";for(const Ke of Le)Ue+=Y.write(Ke);return Le.clear(),Ue!==""&&Le.push(Ue),this._readableState.length=Ue.length,this};const je=1073741824;function Je(W){if(W>je)throw new re("size","<= 1GiB",W);return W--,W|=W>>>1,W|=W>>>2,W|=W>>>4,W|=W>>>8,W|=W>>>16,W++,W}function N(W,Y){return W<=0||Y.length===0&&Y.ended?0:(Y.state&me)!==0?1:r(W)?Y.flowing&&Y.length?Y.buffer.first().length:Y.length:W<=Y.length?W:Y.ended?Y.length:0}ye.prototype.read=function(W){A("read",W),W===void 0?W=NaN:t(W)||(W=o(W,10));const Y=this._readableState,Le=W;if(W>Y.highWaterMark&&(Y.highWaterMark=Je(W)),W!==0&&(Y.state&=~Se),W===0&&Y.needReadable&&((Y.highWaterMark!==0?Y.length>=Y.highWaterMark:Y.length>0)||Y.ended))return A("read: emitReadable",Y.length,Y.ended),Y.length===0&&Y.ended?dr(this):F(this),null;if(W=N(W,Y),W===0&&Y.ended)return Y.length===0&&dr(this),null;let Ue=(Y.state&He)!==0;if(A("need readable",Ue),(Y.length===0||Y.length-W<Y.highWaterMark)&&(Ue=!0,A("length less than watermark",Ue)),Y.ended||Y.reading||Y.destroyed||Y.errored||!Y.constructed)Ue=!1,A("reading, ended or constructing",Ue);else if(Ue){A("do read"),Y.state|=De|$e,Y.length===0&&(Y.state|=He);try{this._read(Y.highWaterMark)}catch(dt){K(this,dt)}Y.state&=~$e,Y.reading||(W=N(Le,Y))}let Ke;return W>0?Ke=Ze(W,Y):Ke=null,Ke===null?(Y.needReadable=Y.length<=Y.highWaterMark,W=0):(Y.length-=W,Y.multiAwaitDrain?Y.awaitDrainWriters.clear():Y.awaitDrainWriters=null),Y.length===0&&(Y.ended||(Y.needReadable=!0),Le!==W&&Y.ended&&dr(this)),Ke!==null&&!Y.errorEmitted&&!Y.closeEmitted&&(Y.dataEmitted=!0,this.emit("data",Ke)),Ke};function w(W,Y){if(A("onEofChunk"),!Y.ended){if(Y.decoder){const Le=Y.decoder.end();Le&&Le.length&&(Y.buffer.push(Le),Y.length+=Y.objectMode?1:Le.length)}Y.ended=!0,Y.sync?F(W):(Y.needReadable=!1,Y.emittedReadable=!0,_(W))}}function F(W){const Y=W._readableState;A("emitReadable",Y.needReadable,Y.emittedReadable),Y.needReadable=!1,Y.emittedReadable||(A("emitReadable",Y.flowing),Y.emittedReadable=!0,n.nextTick(_,W))}function _(W){const Y=W._readableState;A("emitReadable_",Y.destroyed,Y.length,Y.ended),!Y.destroyed&&!Y.errored&&(Y.length||Y.ended)&&(W.emit("readable"),Y.emittedReadable=!1),Y.needReadable=!Y.flowing&&!Y.ended&&Y.length<=Y.highWaterMark,ze(W)}function ae(W,Y){!Y.readingMore&&Y.constructed&&(Y.readingMore=!0,n.nextTick(ge,W,Y))}function ge(W,Y){for(;!Y.reading&&!Y.ended&&(Y.length<Y.highWaterMark||Y.flowing&&Y.length===0);){const Le=Y.length;if(A("maybeReadMore read 0"),W.read(0),Le===Y.length)break}Y.readingMore=!1}ye.prototype._read=function(W){throw new L("_read()")},ye.prototype.pipe=function(W,Y){const Le=this,Ue=this._readableState;Ue.pipes.length===1&&(Ue.multiAwaitDrain||(Ue.multiAwaitDrain=!0,Ue.awaitDrainWriters=new h(Ue.awaitDrainWriters?[Ue.awaitDrainWriters]:[]))),Ue.pipes.push(W),A("pipe count=%d opts=%j",Ue.pipes.length,Y);const dt=(!Y||Y.end!==!1)&&W!==n.stdout&&W!==n.stderr?pr:et;Ue.endEmitted?n.nextTick(dt):Le.once("end",dt),W.on("unpipe",_t);function _t(tt,Bt){A("onunpipe"),tt===Le&&Bt&&Bt.hasUnpiped===!1&&(Bt.hasUnpiped=!0,Xr())}function pr(){A("onend"),W.end()}let Gt,Yr=!1;function Xr(){A("cleanup"),W.removeListener("close",yr),W.removeListener("finish",Cr),Gt&&W.removeListener("drain",Gt),W.removeListener("error",Pr),W.removeListener("unpipe",_t),Le.removeListener("end",pr),Le.removeListener("end",et),Le.removeListener("data",gr),Yr=!0,Gt&&Ue.awaitDrainWriters&&(!W._writableState||W._writableState.needDrain)&&Gt()}function Zr(){Yr||(Ue.pipes.length===1&&Ue.pipes[0]===W?(A("false write response, pause",0),Ue.awaitDrainWriters=W,Ue.multiAwaitDrain=!1):Ue.pipes.length>1&&Ue.pipes.includes(W)&&(A("false write response, pause",Ue.awaitDrainWriters.size),Ue.awaitDrainWriters.add(W)),Le.pause()),Gt||(Gt=ce(Le,W),W.on("drain",Gt))}Le.on("data",gr);function gr(tt){A("ondata");const Bt=W.write(tt);A("dest.write",Bt),Bt===!1&&Zr()}function Pr(tt){if(A("onerror",tt),et(),W.removeListener("error",Pr),W.listenerCount("error")===0){const Bt=W._writableState||W._readableState;Bt&&!Bt.errorEmitted?K(W,tt):W.emit("error",tt)}}v(W,"error",Pr);function yr(){W.removeListener("finish",Cr),et()}W.once("close",yr);function Cr(){A("onfinish"),W.removeListener("close",yr),et()}W.once("finish",Cr);function et(){A("unpipe"),Le.unpipe(W)}return W.emit("pipe",Le),W.writableNeedDrain===!0?Zr():Ue.flowing||(A("pipe resume"),Le.resume()),W};function ce(W,Y){return function(){const Ue=W._readableState;Ue.awaitDrainWriters===Y?(A("pipeOnDrain",1),Ue.awaitDrainWriters=null):Ue.multiAwaitDrain&&(A("pipeOnDrain",Ue.awaitDrainWriters.size),Ue.awaitDrainWriters.delete(Y)),(!Ue.awaitDrainWriters||Ue.awaitDrainWriters.size===0)&&W.listenerCount("data")&&W.resume()}}ye.prototype.unpipe=function(W){const Y=this._readableState,Le={hasUnpiped:!1};if(Y.pipes.length===0)return this;if(!W){const Ke=Y.pipes;Y.pipes=[],this.pause();for(let dt=0;dt<Ke.length;dt++)Ke[dt].emit("unpipe",this,{hasUnpiped:!1});return this}const Ue=e(Y.pipes,W);return Ue===-1?this:(Y.pipes.splice(Ue,1),Y.pipes.length===0&&this.pause(),W.emit("unpipe",this,Le),this)},ye.prototype.on=function(W,Y){const Le=S.prototype.on.call(this,W,Y),Ue=this._readableState;return W==="data"?(Ue.readableListening=this.listenerCount("readable")>0,Ue.flowing!==!1&&this.resume()):W==="readable"&&!Ue.endEmitted&&!Ue.readableListening&&(Ue.readableListening=Ue.needReadable=!0,Ue.flowing=!1,Ue.emittedReadable=!1,A("on readable",Ue.length,Ue.reading),Ue.length?F(this):Ue.reading||n.nextTick(rt,this)),Le},ye.prototype.addListener=ye.prototype.on,ye.prototype.removeListener=function(W,Y){const Le=S.prototype.removeListener.call(this,W,Y);return W==="readable"&&n.nextTick(Ve,this),Le},ye.prototype.off=ye.prototype.removeListener,ye.prototype.removeAllListeners=function(W){const Y=S.prototype.removeAllListeners.apply(this,arguments);return(W==="readable"||W===void 0)&&n.nextTick(Ve,this),Y};function Ve(W){const Y=W._readableState;Y.readableListening=W.listenerCount("readable")>0,Y.resumeScheduled&&Y[fe]===!1?Y.flowing=!0:W.listenerCount("data")>0?W.resume():Y.readableListening||(Y.flowing=null)}function rt(W){A("readable nexttick read 0"),W.read(0)}ye.prototype.resume=function(){const W=this._readableState;return W.flowing||(A("resume"),W.flowing=!W.readableListening,Ye(this,W)),W[fe]=!1,this};function Ye(W,Y){Y.resumeScheduled||(Y.resumeScheduled=!0,n.nextTick(Qe,W,Y))}function Qe(W,Y){A("resume",Y.reading),Y.reading||W.read(0),Y.resumeScheduled=!1,W.emit("resume"),ze(W),Y.flowing&&!Y.reading&&W.read(0)}ye.prototype.pause=function(){return A("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(A("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[fe]=!0,this};function ze(W){const Y=W._readableState;for(A("flow",Y.flowing);Y.flowing&&W.read()!==null;);}ye.prototype.wrap=function(W){let Y=!1;W.on("data",Ue=>{!this.push(Ue)&&W.pause&&(Y=!0,W.pause())}),W.on("end",()=>{this.push(null)}),W.on("error",Ue=>{K(this,Ue)}),W.on("close",()=>{this.destroy()}),W.on("destroy",()=>{this.destroy()}),this._read=()=>{Y&&W.resume&&(Y=!1,W.resume())};const Le=c(W);for(let Ue=1;Ue<Le.length;Ue++){const Ke=Le[Ue];this[Ke]===void 0&&typeof W[Ke]=="function"&&(this[Ke]=W[Ke].bind(W))}return this},ye.prototype[p]=function(){return or(this)},ye.prototype.iterator=function(W){return W!==void 0&&ne(W,"options"),or(this,W)};function or(W,Y){typeof W.read!="function"&&(W=ye.wrap(W,{objectMode:!0}));const Le=lt(W,Y);return Le.stream=W,Le}async function*lt(W,Y){let Le=Te;function Ue(_t){this===W?(Le(),Le=Te):Le=_t}W.on("readable",Ue);let Ke;const dt=E(W,{writable:!1},_t=>{Ke=_t?ie(Ke,_t):null,Le(),Le=Te});try{for(;;){const _t=W.destroyed?null:W.read();if(_t!==null)yield _t;else{if(Ke)throw Ke;if(Ke===null)return;await new g(Ue)}}}catch(_t){throw Ke=ie(Ke,_t),Ke}finally{(Ke||Y?.destroyOnReturn!==!1)&&(Ke===void 0||W._readableState.autoDestroy)?D.destroyer(W,null):(W.off("readable",Ue),dt())}}u(ye.prototype,{readable:{__proto__:null,get(){const W=this._readableState;return!!W&&W.readable!==!1&&!W.destroyed&&!W.errorEmitted&&!W.endEmitted},set(W){this._readableState&&(this._readableState.readable=!!W)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(W){this._readableState&&(this._readableState.flowing=W)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(W){this._readableState&&(this._readableState.destroyed=W)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),u(Ae.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[fe]!==!1},set(W){this[fe]=!!W}}}),ye._fromList=Ze;function Ze(W,Y){if(Y.length===0)return null;let Le;return Y.objectMode?Le=Y.buffer.shift():!W||W>=Y.length?(Y.decoder?Le=Y.buffer.join(""):Y.buffer.length===1?Le=Y.buffer.first():Le=Y.buffer.concat(Y.length),Y.buffer.clear()):Le=Y.buffer.consume(W,Y.decoder),Le}function dr(W){const Y=W._readableState;A("endReadable",Y.endEmitted),Y.endEmitted||(Y.ended=!0,n.nextTick(ht,Y,W))}function ht(W,Y){if(A("endReadableNT",W.endEmitted,W.length),!W.errored&&!W.closeEmitted&&!W.endEmitted&&W.length===0){if(W.endEmitted=!0,Y.emit("end"),Y.writable&&Y.allowHalfOpen===!1)n.nextTick(kt,Y);else if(W.autoDestroy){const Le=Y._writableState;(!Le||Le.autoDestroy&&(Le.finished||Le.writable===!1))&&Y.destroy()}}}function kt(W){W.writable&&!W.writableEnded&&!W.destroyed&&W.end()}ye.from=function(W,Y){return pe(ye,W,Y)};let Nt;function Qr(){return Nt===void 0&&(Nt={}),Nt}return ye.fromWeb=function(W,Y){return Qr().newStreamReadableFromReadableStream(W,Y)},ye.toWeb=function(W,Y){return Qr().newReadableStreamFromStreamReadable(W,Y)},ye.wrap=function(W,Y){var Le,Ue;return new ye({objectMode:(Le=(Ue=W.readableObjectMode)!==null&&Ue!==void 0?Ue:W.objectMode)!==null&&Le!==void 0?Le:!0,...Y,destroy(Ke,dt){D.destroyer(W,Ke),dt(Ke)}}).wrap(W)},Qi}var Yi,ua;function Hs(){if(ua)return Yi;ua=1;const n=Tr(),{ArrayPrototypeSlice:e,Error:t,FunctionPrototypeSymbolHasInstance:r,ObjectDefineProperty:o,ObjectDefineProperties:u,ObjectSetPrototypeOf:c,StringPrototypeToLowerCase:l,Symbol:g,SymbolHasInstance:h}=ct();Yi=ne,ne.WritableState=ue;const{EventEmitter:d}=Nn(),p=Ms().Stream,{Buffer:x}=ir(),T=Jr(),{addAbortSignal:S}=ai(),{getHighWaterMark:v,getDefaultHighWaterMark:R}=ui(),{ERR_INVALID_ARG_TYPE:b,ERR_METHOD_NOT_IMPLEMENTED:E,ERR_MULTIPLE_CALLBACK:A,ERR_STREAM_CANNOT_PIPE:k,ERR_STREAM_DESTROYED:D,ERR_STREAM_ALREADY_FINISHED:B,ERR_STREAM_NULL_VALUES:M,ERR_STREAM_WRITE_AFTER_END:ie,ERR_UNKNOWN_ENCODING:he}=Ct().codes,{errorOrDestroy:L}=T;c(ne.prototype,p.prototype),c(ne,p);function re(){}const be=g("kOnFinished");function ue(y,C,O){typeof O!="boolean"&&(O=C instanceof rr()),this.objectMode=!!(y&&y.objectMode),O&&(this.objectMode=this.objectMode||!!(y&&y.writableObjectMode)),this.highWaterMark=y?v(this,y,"writableHighWaterMark",O):R(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const X=!!(y&&y.decodeStrings===!1);this.decodeStrings=!X,this.defaultEncoding=y&&y.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=K.bind(void 0,C),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,ke(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!y||y.emitClose!==!1,this.autoDestroy=!y||y.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[be]=[]}function ke(y){y.buffered=[],y.bufferedIndex=0,y.allBuffers=!0,y.allNoop=!0}ue.prototype.getBuffer=function(){return e(this.buffered,this.bufferedIndex)},o(ue.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function ne(y){const C=this instanceof rr();if(!C&&!r(ne,this))return new ne(y);this._writableState=new ue(y,this,C),y&&(typeof y.write=="function"&&(this._write=y.write),typeof y.writev=="function"&&(this._writev=y.writev),typeof y.destroy=="function"&&(this._destroy=y.destroy),typeof y.final=="function"&&(this._final=y.final),typeof y.construct=="function"&&(this._construct=y.construct),y.signal&&S(y.signal,this)),p.call(this,y),T.construct(this,()=>{const O=this._writableState;O.writing||De(this,O),Se(this,O)})}o(ne,h,{__proto__:null,value:function(y){return r(this,y)?!0:this!==ne?!1:y&&y._writableState instanceof ue}}),ne.prototype.pipe=function(){L(this,new k)};function fe(y,C,O,X){const se=y._writableState;if(typeof O=="function")X=O,O=se.defaultEncoding;else{if(!O)O=se.defaultEncoding;else if(O!=="buffer"&&!x.isEncoding(O))throw new he(O);typeof X!="function"&&(X=re)}if(C===null)throw new M;if(!se.objectMode)if(typeof C=="string")se.decodeStrings!==!1&&(C=x.from(C,O),O="buffer");else if(C instanceof x)O="buffer";else if(p._isUint8Array(C))C=p._uint8ArrayToBuffer(C),O="buffer";else throw new b("chunk",["string","Buffer","Uint8Array"],C);let _e;return se.ending?_e=new ie:se.destroyed&&(_e=new D("write")),_e?(n.nextTick(X,_e),L(y,_e,!0),_e):(se.pendingcb++,Ne(y,se,C,O,X))}ne.prototype.write=function(y,C,O){return fe(this,y,C,O)===!0},ne.prototype.cork=function(){this._writableState.corked++},ne.prototype.uncork=function(){const y=this._writableState;y.corked&&(y.corked--,y.writing||De(this,y))},ne.prototype.setDefaultEncoding=function(C){if(typeof C=="string"&&(C=l(C)),!x.isEncoding(C))throw new he(C);return this._writableState.defaultEncoding=C,this};function Ne(y,C,O,X,se){const _e=C.objectMode?1:O.length;C.length+=_e;const te=C.length<C.highWaterMark;return te||(C.needDrain=!0),C.writing||C.corked||C.errored||!C.constructed?(C.buffered.push({chunk:O,encoding:X,callback:se}),C.allBuffers&&X!=="buffer"&&(C.allBuffers=!1),C.allNoop&&se!==re&&(C.allNoop=!1)):(C.writelen=_e,C.writecb=se,C.writing=!0,C.sync=!0,y._write(O,X,C.onwrite),C.sync=!1),te&&!C.errored&&!C.destroyed}function pe(y,C,O,X,se,_e,te){C.writelen=X,C.writecb=te,C.writing=!0,C.sync=!0,C.destroyed?C.onwrite(new D("write")):O?y._writev(se,C.onwrite):y._write(se,_e,C.onwrite),C.sync=!1}function Te(y,C,O,X){--C.pendingcb,X(O),Fe(C),L(y,O)}function K(y,C){const O=y._writableState,X=O.sync,se=O.writecb;if(typeof se!="function"){L(y,new A);return}O.writing=!1,O.writecb=null,O.length-=O.writelen,O.writelen=0,C?(C.stack,O.errored||(O.errored=C),y._readableState&&!y._readableState.errored&&(y._readableState.errored=C),X?n.nextTick(Te,y,O,C,se):Te(y,O,C,se)):(O.buffered.length>O.bufferedIndex&&De(y,O),X?O.afterWriteTickInfo!==null&&O.afterWriteTickInfo.cb===se?O.afterWriteTickInfo.count++:(O.afterWriteTickInfo={count:1,cb:se,stream:y,state:O},n.nextTick(me,O.afterWriteTickInfo)):Ie(y,O,1,se))}function me({stream:y,state:C,count:O,cb:X}){return C.afterWriteTickInfo=null,Ie(y,C,O,X)}function Ie(y,C,O,X){for(!C.ending&&!y.destroyed&&C.length===0&&C.needDrain&&(C.needDrain=!1,y.emit("drain"));O-- >0;)C.pendingcb--,X();C.destroyed&&Fe(C),Se(y,C)}function Fe(y){if(y.writing)return;for(let se=y.bufferedIndex;se<y.buffered.length;++se){var C;const{chunk:_e,callback:te}=y.buffered[se],Ee=y.objectMode?1:_e.length;y.length-=Ee,te((C=y.errored)!==null&&C!==void 0?C:new D("write"))}const O=y[be].splice(0);for(let se=0;se<O.length;se++){var X;O[se]((X=y.errored)!==null&&X!==void 0?X:new D("end"))}ke(y)}function De(y,C){if(C.corked||C.bufferProcessing||C.destroyed||!C.constructed)return;const{buffered:O,bufferedIndex:X,objectMode:se}=C,_e=O.length-X;if(!_e)return;let te=X;if(C.bufferProcessing=!0,_e>1&&y._writev){C.pendingcb-=_e-1;const Ee=C.allNoop?re:ye=>{for(let We=te;We<O.length;++We)O[We].callback(ye)},Ae=C.allNoop&&te===0?O:e(O,te);Ae.allBuffers=C.allBuffers,pe(y,C,!0,C.length,Ae,"",Ee),ke(C)}else{do{const{chunk:Ee,encoding:Ae,callback:ye}=O[te];O[te++]=null;const We=se?1:Ee.length;pe(y,C,!1,We,Ee,Ae,ye)}while(te<O.length&&!C.writing);te===O.length?ke(C):te>256?(O.splice(0,te),C.bufferedIndex=0):C.bufferedIndex=te}C.bufferProcessing=!1}ne.prototype._write=function(y,C,O){if(this._writev)this._writev([{chunk:y,encoding:C}],O);else throw new E("_write()")},ne.prototype._writev=null,ne.prototype.end=function(y,C,O){const X=this._writableState;typeof y=="function"?(O=y,y=null,C=null):typeof C=="function"&&(O=C,C=null);let se;if(y!=null){const _e=fe(this,y,C);_e instanceof t&&(se=_e)}return X.corked&&(X.corked=1,this.uncork()),se||(!X.errored&&!X.ending?(X.ending=!0,Se(this,X,!0),X.ended=!0):X.finished?se=new B("end"):X.destroyed&&(se=new D("end"))),typeof O=="function"&&(se||X.finished?n.nextTick(O,se):X[be].push(O)),this};function Oe(y){return y.ending&&!y.destroyed&&y.constructed&&y.length===0&&!y.errored&&y.buffered.length===0&&!y.finished&&!y.writing&&!y.errorEmitted&&!y.closeEmitted}function $e(y,C){let O=!1;function X(se){if(O){L(y,se??A());return}if(O=!0,C.pendingcb--,se){const _e=C[be].splice(0);for(let te=0;te<_e.length;te++)_e[te](se);L(y,se,C.sync)}else Oe(C)&&(C.prefinished=!0,y.emit("prefinish"),C.pendingcb++,n.nextTick(Re,y,C))}C.sync=!0,C.pendingcb++;try{y._final(X)}catch(se){X(se)}C.sync=!1}function He(y,C){!C.prefinished&&!C.finalCalled&&(typeof y._final=="function"&&!C.destroyed?(C.finalCalled=!0,$e(y,C)):(C.prefinished=!0,y.emit("prefinish")))}function Se(y,C,O){Oe(C)&&(He(y,C),C.pendingcb===0&&(O?(C.pendingcb++,n.nextTick((X,se)=>{Oe(se)?Re(X,se):se.pendingcb--},y,C)):Oe(C)&&(C.pendingcb++,Re(y,C))))}function Re(y,C){C.pendingcb--,C.finished=!0;const O=C[be].splice(0);for(let X=0;X<O.length;X++)O[X]();if(y.emit("finish"),C.autoDestroy){const X=y._readableState;(!X||X.autoDestroy&&(X.endEmitted||X.readable===!1))&&y.destroy()}}u(ne.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(y){this._writableState&&(this._writableState.destroyed=y)}},writable:{__proto__:null,get(){const y=this._writableState;return!!y&&y.writable!==!1&&!y.destroyed&&!y.errored&&!y.ending&&!y.ended},set(y){this._writableState&&(this._writableState.writable=!!y)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const y=this._writableState;return y?!y.destroyed&&!y.ending&&y.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const Ce=T.destroy;ne.prototype.destroy=function(y,C){const O=this._writableState;return!O.destroyed&&(O.bufferedIndex<O.buffered.length||O[be].length)&&n.nextTick(Fe,O),Ce.call(this,y,C),this},ne.prototype._undestroy=T.undestroy,ne.prototype._destroy=function(y,C){C(y)},ne.prototype[d.captureRejectionSymbol]=function(y){this.destroy(y)};let V;function I(){return V===void 0&&(V={}),V}return ne.fromWeb=function(y,C){return I().newStreamWritableFromWritableStream(y,C)},ne.toWeb=function(y){return I().newWritableStreamFromStreamWritable(y)},Yi}var Xi,ca;function eh(){if(ca)return Xi;ca=1;const n=Tr(),e=ir(),{isReadable:t,isWritable:r,isIterable:o,isNodeStream:u,isReadableNodeStream:c,isWritableNodeStream:l,isDuplexNodeStream:g,isReadableStream:h,isWritableStream:d}=sr(),p=hr(),{AbortError:x,codes:{ERR_INVALID_ARG_TYPE:T,ERR_INVALID_RETURN_VALUE:S}}=Ct(),{destroyer:v}=Jr(),R=rr(),b=ci(),E=Hs(),{createDeferredPromise:A}=jt(),k=_u(),D=globalThis.Blob||e.Blob,B=typeof D<"u"?function(ue){return ue instanceof D}:function(ue){return!1},M=globalThis.AbortController||Rn().AbortController,{FunctionPrototypeCall:ie}=ct();class he extends R{constructor(ue){super(ue),ue?.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),ue?.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}Xi=function be(ue,ke){if(g(ue))return ue;if(c(ue))return re({readable:ue});if(l(ue))return re({writable:ue});if(u(ue))return re({writable:!1,readable:!1});if(h(ue))return re({readable:b.fromWeb(ue)});if(d(ue))return re({writable:E.fromWeb(ue)});if(typeof ue=="function"){const{value:fe,write:Ne,final:pe,destroy:Te}=L(ue);if(o(fe))return k(he,fe,{objectMode:!0,write:Ne,final:pe,destroy:Te});const K=fe?.then;if(typeof K=="function"){let me;const Ie=ie(K,fe,Fe=>{if(Fe!=null)throw new S("nully","body",Fe)},Fe=>{v(me,Fe)});return me=new he({objectMode:!0,readable:!1,write:Ne,final(Fe){pe(async()=>{try{await Ie,n.nextTick(Fe,null)}catch(De){n.nextTick(Fe,De)}})},destroy:Te})}throw new S("Iterable, AsyncIterable or AsyncFunction",ke,fe)}if(B(ue))return be(ue.arrayBuffer());if(o(ue))return k(he,ue,{objectMode:!0,writable:!1});if(h(ue?.readable)&&d(ue?.writable))return he.fromWeb(ue);if(typeof ue?.writable=="object"||typeof ue?.readable=="object"){const fe=ue!=null&&ue.readable?c(ue?.readable)?ue?.readable:be(ue.readable):void 0,Ne=ue!=null&&ue.writable?l(ue?.writable)?ue?.writable:be(ue.writable):void 0;return re({readable:fe,writable:Ne})}const ne=ue?.then;if(typeof ne=="function"){let fe;return ie(ne,ue,Ne=>{Ne!=null&&fe.push(Ne),fe.push(null)},Ne=>{v(fe,Ne)}),fe=new he({objectMode:!0,writable:!1,read(){}})}throw new T(ke,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],ue)};function L(be){let{promise:ue,resolve:ke}=A();const ne=new M,fe=ne.signal;return{value:be(async function*(){for(;;){const pe=ue;ue=null;const{chunk:Te,done:K,cb:me}=await pe;if(n.nextTick(me),K)return;if(fe.aborted)throw new x(void 0,{cause:fe.reason});({promise:ue,resolve:ke}=A()),yield Te}}(),{signal:fe}),write(pe,Te,K){const me=ke;ke=null,me({chunk:pe,done:!1,cb:K})},final(pe){const Te=ke;ke=null,Te({done:!0,cb:pe})},destroy(pe,Te){ne.abort(),Te(pe)}}}function re(be){const ue=be.readable&&typeof be.readable.read!="function"?b.wrap(be.readable):be.readable,ke=be.writable;let ne=!!t(ue),fe=!!r(ke),Ne,pe,Te,K,me;function Ie(Fe){const De=K;K=null,De?De(Fe):Fe&&me.destroy(Fe)}return me=new he({readableObjectMode:!!(ue!=null&&ue.readableObjectMode),writableObjectMode:!!(ke!=null&&ke.writableObjectMode),readable:ne,writable:fe}),fe&&(p(ke,Fe=>{fe=!1,Fe&&v(ue,Fe),Ie(Fe)}),me._write=function(Fe,De,Oe){ke.write(Fe,De)?Oe():Ne=Oe},me._final=function(Fe){ke.end(),pe=Fe},ke.on("drain",function(){if(Ne){const Fe=Ne;Ne=null,Fe()}}),ke.on("finish",function(){if(pe){const Fe=pe;pe=null,Fe()}})),ne&&(p(ue,Fe=>{ne=!1,Fe&&v(ue,Fe),Ie(Fe)}),ue.on("readable",function(){if(Te){const Fe=Te;Te=null,Fe()}}),ue.on("end",function(){me.push(null)}),me._read=function(){for(;;){const Fe=ue.read();if(Fe===null){Te=me._read;return}if(!me.push(Fe))return}}),me._destroy=function(Fe,De){!Fe&&K!==null&&(Fe=new x),Te=null,Ne=null,pe=null,K===null?De(Fe):(K=De,v(ke,Fe),v(ue,Fe))},me}return Xi}var Zi,la;function rr(){if(la)return Zi;la=1;const{ObjectDefineProperties:n,ObjectGetOwnPropertyDescriptor:e,ObjectKeys:t,ObjectSetPrototypeOf:r}=ct();Zi=c;const o=ci(),u=Hs();r(c.prototype,o.prototype),r(c,o);{const d=t(u.prototype);for(let p=0;p<d.length;p++){const x=d[p];c.prototype[x]||(c.prototype[x]=u.prototype[x])}}function c(d){if(!(this instanceof c))return new c(d);o.call(this,d),u.call(this,d),d?(this.allowHalfOpen=d.allowHalfOpen!==!1,d.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),d.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}n(c.prototype,{writable:{__proto__:null,...e(u.prototype,"writable")},writableHighWaterMark:{__proto__:null,...e(u.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...e(u.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...e(u.prototype,"writableBuffer")},writableLength:{__proto__:null,...e(u.prototype,"writableLength")},writableFinished:{__proto__:null,...e(u.prototype,"writableFinished")},writableCorked:{__proto__:null,...e(u.prototype,"writableCorked")},writableEnded:{__proto__:null,...e(u.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...e(u.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(d){this._readableState&&this._writableState&&(this._readableState.destroyed=d,this._writableState.destroyed=d)}}});let l;function g(){return l===void 0&&(l={}),l}c.fromWeb=function(d,p){return g().newStreamDuplexFromReadableWritablePair(d,p)},c.toWeb=function(d){return g().newReadableWritablePairFromDuplex(d)};let h;return c.from=function(d){return h||(h=eh()),h(d,"body")},Zi}var es,ha;function bu(){if(ha)return es;ha=1;const{ObjectSetPrototypeOf:n,Symbol:e}=ct();es=c;const{ERR_METHOD_NOT_IMPLEMENTED:t}=Ct().codes,r=rr(),{getHighWaterMark:o}=ui();n(c.prototype,r.prototype),n(c,r);const u=e("kCallback");function c(h){if(!(this instanceof c))return new c(h);const d=h?o(this,h,"readableHighWaterMark",!0):null;d===0&&(h={...h,highWaterMark:null,readableHighWaterMark:d,writableHighWaterMark:h.writableHighWaterMark||0}),r.call(this,h),this._readableState.sync=!1,this[u]=null,h&&(typeof h.transform=="function"&&(this._transform=h.transform),typeof h.flush=="function"&&(this._flush=h.flush)),this.on("prefinish",g)}function l(h){typeof this._flush=="function"&&!this.destroyed?this._flush((d,p)=>{if(d){h?h(d):this.destroy(d);return}p!=null&&this.push(p),this.push(null),h&&h()}):(this.push(null),h&&h())}function g(){this._final!==l&&l.call(this)}return c.prototype._final=l,c.prototype._transform=function(h,d,p){throw new t("_transform()")},c.prototype._write=function(h,d,p){const x=this._readableState,T=this._writableState,S=x.length;this._transform(h,d,(v,R)=>{if(v){p(v);return}R!=null&&this.push(R),T.ended||S===x.length||x.length<x.highWaterMark?p():this[u]=p})},c.prototype._read=function(){if(this[u]){const h=this[u];this[u]=null,h()}},es}var ts,fa;function vu(){if(fa)return ts;fa=1;const{ObjectSetPrototypeOf:n}=ct();ts=t;const e=bu();n(t.prototype,e.prototype),n(t,e);function t(r){if(!(this instanceof t))return new t(r);e.call(this,r)}return t.prototype._transform=function(r,o,u){u(null,r)},ts}var rs,da;function Ks(){if(da)return rs;da=1;const n=Tr(),{ArrayIsArray:e,Promise:t,SymbolAsyncIterator:r,SymbolDispose:o}=ct(),u=hr(),{once:c}=jt(),l=Jr(),g=rr(),{aggregateTwoErrors:h,codes:{ERR_INVALID_ARG_TYPE:d,ERR_INVALID_RETURN_VALUE:p,ERR_MISSING_ARGS:x,ERR_STREAM_DESTROYED:T,ERR_STREAM_PREMATURE_CLOSE:S},AbortError:v}=Ct(),{validateFunction:R,validateAbortSignal:b}=Dn(),{isIterable:E,isReadable:A,isReadableNodeStream:k,isNodeStream:D,isTransformStream:B,isWebStream:M,isReadableStream:ie,isReadableFinished:he}=sr(),L=globalThis.AbortController||Rn().AbortController;let re,be,ue;function ke(Fe,De,Oe){let $e=!1;Fe.on("close",()=>{$e=!0});const He=u(Fe,{readable:De,writable:Oe},Se=>{$e=!Se});return{destroy:Se=>{$e||($e=!0,l.destroyer(Fe,Se||new T("pipe")))},cleanup:He}}function ne(Fe){return R(Fe[Fe.length-1],"streams[stream.length - 1]"),Fe.pop()}function fe(Fe){if(E(Fe))return Fe;if(k(Fe))return Ne(Fe);throw new d("val",["Readable","Iterable","AsyncIterable"],Fe)}async function*Ne(Fe){be||(be=ci()),yield*be.prototype[r].call(Fe)}async function pe(Fe,De,Oe,{end:$e}){let He,Se=null;const Re=I=>{if(I&&(He=I),Se){const y=Se;Se=null,y()}},Ce=()=>new t((I,y)=>{He?y(He):Se=()=>{He?y(He):I()}});De.on("drain",Re);const V=u(De,{readable:!1},Re);try{De.writableNeedDrain&&await Ce();for await(const I of Fe)De.write(I)||await Ce();$e&&(De.end(),await Ce()),Oe()}catch(I){Oe(He!==I?h(He,I):I)}finally{V(),De.off("drain",Re)}}async function Te(Fe,De,Oe,{end:$e}){B(De)&&(De=De.writable);const He=De.getWriter();try{for await(const Se of Fe)await He.ready,He.write(Se).catch(()=>{});await He.ready,$e&&await He.close(),Oe()}catch(Se){try{await He.abort(Se),Oe(Se)}catch(Re){Oe(Re)}}}function K(...Fe){return me(Fe,c(ne(Fe)))}function me(Fe,De,Oe){if(Fe.length===1&&e(Fe[0])&&(Fe=Fe[0]),Fe.length<2)throw new x("streams");const $e=new L,He=$e.signal,Se=Oe?.signal,Re=[];b(Se,"options.signal");function Ce(){se(new v)}ue=ue||jt().addAbortListener;let V;Se&&(V=ue(Se,Ce));let I,y;const C=[];let O=0;function X(Ae){se(Ae,--O===0)}function se(Ae,ye){var We;if(Ae&&(!I||I.code==="ERR_STREAM_PREMATURE_CLOSE")&&(I=Ae),!(!I&&!ye)){for(;C.length;)C.shift()(I);(We=V)===null||We===void 0||We[o](),$e.abort(),ye&&(I||Re.forEach(Xe=>Xe()),n.nextTick(De,I,y))}}let _e;for(let Ae=0;Ae<Fe.length;Ae++){const ye=Fe[Ae],We=Ae<Fe.length-1,Xe=Ae>0,je=We||Oe?.end!==!1,Je=Ae===Fe.length-1;if(D(ye)){let N=function(w){w&&w.name!=="AbortError"&&w.code!=="ERR_STREAM_PREMATURE_CLOSE"&&X(w)};if(je){const{destroy:w,cleanup:F}=ke(ye,We,Xe);C.push(w),A(ye)&&Je&&Re.push(F)}ye.on("error",N),A(ye)&&Je&&Re.push(()=>{ye.removeListener("error",N)})}if(Ae===0)if(typeof ye=="function"){if(_e=ye({signal:He}),!E(_e))throw new p("Iterable, AsyncIterable or Stream","source",_e)}else E(ye)||k(ye)||B(ye)?_e=ye:_e=g.from(ye);else if(typeof ye=="function"){if(B(_e)){var te;_e=fe((te=_e)===null||te===void 0?void 0:te.readable)}else _e=fe(_e);if(_e=ye(_e,{signal:He}),We){if(!E(_e,!0))throw new p("AsyncIterable",`transform[${Ae-1}]`,_e)}else{var Ee;re||(re=vu());const N=new re({objectMode:!0}),w=(Ee=_e)===null||Ee===void 0?void 0:Ee.then;if(typeof w=="function")O++,w.call(_e,ae=>{y=ae,ae!=null&&N.write(ae),je&&N.end(),n.nextTick(X)},ae=>{N.destroy(ae),n.nextTick(X,ae)});else if(E(_e,!0))O++,pe(_e,N,X,{end:je});else if(ie(_e)||B(_e)){const ae=_e.readable||_e;O++,pe(ae,N,X,{end:je})}else throw new p("AsyncIterable or Promise","destination",_e);_e=N;const{destroy:F,cleanup:_}=ke(_e,!1,!0);C.push(F),Je&&Re.push(_)}}else if(D(ye)){if(k(_e)){O+=2;const N=Ie(_e,ye,X,{end:je});A(ye)&&Je&&Re.push(N)}else if(B(_e)||ie(_e)){const N=_e.readable||_e;O++,pe(N,ye,X,{end:je})}else if(E(_e))O++,pe(_e,ye,X,{end:je});else throw new d("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],_e);_e=ye}else if(M(ye)){if(k(_e))O++,Te(fe(_e),ye,X,{end:je});else if(ie(_e)||E(_e))O++,Te(_e,ye,X,{end:je});else if(B(_e))O++,Te(_e.readable,ye,X,{end:je});else throw new d("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],_e);_e=ye}else _e=g.from(ye)}return(He!=null&&He.aborted||Se!=null&&Se.aborted)&&n.nextTick(Ce),_e}function Ie(Fe,De,Oe,{end:$e}){let He=!1;if(De.on("close",()=>{He||Oe(new S)}),Fe.pipe(De,{end:!1}),$e){let Se=function(){He=!0,De.end()};he(Fe)?n.nextTick(Se):Fe.once("end",Se)}else Oe();return u(Fe,{readable:!0,writable:!1},Se=>{const Re=Fe._readableState;Se&&Se.code==="ERR_STREAM_PREMATURE_CLOSE"&&Re&&Re.ended&&!Re.errored&&!Re.errorEmitted?Fe.once("end",Oe).once("error",Oe):Oe(Se)}),u(De,{readable:!1,writable:!0},Oe)}return rs={pipelineImpl:me,pipeline:K},rs}var ns,pa;function Su(){if(pa)return ns;pa=1;const{pipeline:n}=Ks(),e=rr(),{destroyer:t}=Jr(),{isNodeStream:r,isReadable:o,isWritable:u,isWebStream:c,isTransformStream:l,isWritableStream:g,isReadableStream:h}=sr(),{AbortError:d,codes:{ERR_INVALID_ARG_VALUE:p,ERR_MISSING_ARGS:x}}=Ct(),T=hr();return ns=function(...v){if(v.length===0)throw new x("streams");if(v.length===1)return e.from(v[0]);const R=[...v];if(typeof v[0]=="function"&&(v[0]=e.from(v[0])),typeof v[v.length-1]=="function"){const re=v.length-1;v[re]=e.from(v[re])}for(let re=0;re<v.length;++re)if(!(!r(v[re])&&!c(v[re]))){if(re<v.length-1&&!(o(v[re])||h(v[re])||l(v[re])))throw new p(`streams[${re}]`,R[re],"must be readable");if(re>0&&!(u(v[re])||g(v[re])||l(v[re])))throw new p(`streams[${re}]`,R[re],"must be writable")}let b,E,A,k,D;function B(re){const be=k;k=null,be?be(re):re?D.destroy(re):!L&&!he&&D.destroy()}const M=v[0],ie=n(v,B),he=!!(u(M)||g(M)||l(M)),L=!!(o(ie)||h(ie)||l(ie));if(D=new e({writableObjectMode:!!(M!=null&&M.writableObjectMode),readableObjectMode:!!(ie!=null&&ie.readableObjectMode),writable:he,readable:L}),he){if(r(M))D._write=function(be,ue,ke){M.write(be,ue)?ke():b=ke},D._final=function(be){M.end(),E=be},M.on("drain",function(){if(b){const be=b;b=null,be()}});else if(c(M)){const ue=(l(M)?M.writable:M).getWriter();D._write=async function(ke,ne,fe){try{await ue.ready,ue.write(ke).catch(()=>{}),fe()}catch(Ne){fe(Ne)}},D._final=async function(ke){try{await ue.ready,ue.close().catch(()=>{}),E=ke}catch(ne){ke(ne)}}}const re=l(ie)?ie.readable:ie;T(re,()=>{if(E){const be=E;E=null,be()}})}if(L){if(r(ie))ie.on("readable",function(){if(A){const re=A;A=null,re()}}),ie.on("end",function(){D.push(null)}),D._read=function(){for(;;){const re=ie.read();if(re===null){A=D._read;return}if(!D.push(re))return}};else if(c(ie)){const be=(l(ie)?ie.readable:ie).getReader();D._read=async function(){for(;;)try{const{value:ue,done:ke}=await be.read();if(!D.push(ue))return;if(ke){D.push(null);return}}catch{return}}}}return D._destroy=function(re,be){!re&&k!==null&&(re=new d),A=null,b=null,E=null,k===null?be(re):(k=be,r(ie)&&t(ie,re))},D},ns}var ga;function th(){if(ga)return Wn;ga=1;const n=globalThis.AbortController||Rn().AbortController,{codes:{ERR_INVALID_ARG_VALUE:e,ERR_INVALID_ARG_TYPE:t,ERR_MISSING_ARGS:r,ERR_OUT_OF_RANGE:o},AbortError:u}=Ct(),{validateAbortSignal:c,validateInteger:l,validateObject:g}=Dn(),h=ct().Symbol("kWeak"),d=ct().Symbol("kResistStopPropagation"),{finished:p}=hr(),x=Su(),{addAbortSignalNoValidate:T}=ai(),{isWritable:S,isNodeStream:v}=sr(),{deprecate:R}=jt(),{ArrayPrototypePush:b,Boolean:E,MathFloor:A,Number:k,NumberIsNaN:D,Promise:B,PromiseReject:M,PromiseResolve:ie,PromisePrototypeThen:he,Symbol:L}=ct(),re=L("kEmpty"),be=L("kEof");function ue(Se,Re){if(Re!=null&&g(Re,"options"),Re?.signal!=null&&c(Re.signal,"options.signal"),v(Se)&&!S(Se))throw new e("stream",Se,"must be writable");const Ce=x(this,Se);return Re!=null&&Re.signal&&T(Re.signal,Ce),Ce}function ke(Se,Re){if(typeof Se!="function")throw new t("fn",["Function","AsyncFunction"],Se);Re!=null&&g(Re,"options"),Re?.signal!=null&&c(Re.signal,"options.signal");let Ce=1;Re?.concurrency!=null&&(Ce=A(Re.concurrency));let V=Ce-1;return Re?.highWaterMark!=null&&(V=A(Re.highWaterMark)),l(Ce,"options.concurrency",1),l(V,"options.highWaterMark",0),V+=Ce,(async function*(){const y=jt().AbortSignalAny([Re?.signal].filter(E)),C=this,O=[],X={signal:y};let se,_e,te=!1,Ee=0;function Ae(){te=!0,ye()}function ye(){Ee-=1,We()}function We(){_e&&!te&&Ee<Ce&&O.length<V&&(_e(),_e=null)}async function Xe(){try{for await(let je of C){if(te)return;if(y.aborted)throw new u;try{if(je=Se(je,X),je===re)continue;je=ie(je)}catch(Je){je=M(Je)}Ee+=1,he(je,ye,Ae),O.push(je),se&&(se(),se=null),!te&&(O.length>=V||Ee>=Ce)&&await new B(Je=>{_e=Je})}O.push(be)}catch(je){const Je=M(je);he(Je,ye,Ae),O.push(Je)}finally{te=!0,se&&(se(),se=null)}}Xe();try{for(;;){for(;O.length>0;){const je=await O[0];if(je===be)return;if(y.aborted)throw new u;je!==re&&(yield je),O.shift(),We()}await new B(je=>{se=je})}}finally{te=!0,_e&&(_e(),_e=null)}}).call(this)}function ne(Se=void 0){return Se!=null&&g(Se,"options"),Se?.signal!=null&&c(Se.signal,"options.signal"),(async function*(){let Ce=0;for await(const I of this){var V;if(Se!=null&&(V=Se.signal)!==null&&V!==void 0&&V.aborted)throw new u({cause:Se.signal.reason});yield[Ce++,I]}}).call(this)}async function fe(Se,Re=void 0){for await(const Ce of K.call(this,Se,Re))return!0;return!1}async function Ne(Se,Re=void 0){if(typeof Se!="function")throw new t("fn",["Function","AsyncFunction"],Se);return!await fe.call(this,async(...Ce)=>!await Se(...Ce),Re)}async function pe(Se,Re){for await(const Ce of K.call(this,Se,Re))return Ce}async function Te(Se,Re){if(typeof Se!="function")throw new t("fn",["Function","AsyncFunction"],Se);async function Ce(V,I){return await Se(V,I),re}for await(const V of ke.call(this,Ce,Re));}function K(Se,Re){if(typeof Se!="function")throw new t("fn",["Function","AsyncFunction"],Se);async function Ce(V,I){return await Se(V,I)?V:re}return ke.call(this,Ce,Re)}class me extends r{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function Ie(Se,Re,Ce){var V;if(typeof Se!="function")throw new t("reducer",["Function","AsyncFunction"],Se);Ce!=null&&g(Ce,"options"),Ce?.signal!=null&&c(Ce.signal,"options.signal");let I=arguments.length>1;if(Ce!=null&&(V=Ce.signal)!==null&&V!==void 0&&V.aborted){const se=new u(void 0,{cause:Ce.signal.reason});throw this.once("error",()=>{}),await p(this.destroy(se)),se}const y=new n,C=y.signal;if(Ce!=null&&Ce.signal){const se={once:!0,[h]:this,[d]:!0};Ce.signal.addEventListener("abort",()=>y.abort(),se)}let O=!1;try{for await(const se of this){var X;if(O=!0,Ce!=null&&(X=Ce.signal)!==null&&X!==void 0&&X.aborted)throw new u;I?Re=await Se(Re,se,{signal:C}):(Re=se,I=!0)}if(!O&&!I)throw new me}finally{y.abort()}return Re}async function Fe(Se){Se!=null&&g(Se,"options"),Se?.signal!=null&&c(Se.signal,"options.signal");const Re=[];for await(const V of this){var Ce;if(Se!=null&&(Ce=Se.signal)!==null&&Ce!==void 0&&Ce.aborted)throw new u(void 0,{cause:Se.signal.reason});b(Re,V)}return Re}function De(Se,Re){const Ce=ke.call(this,Se,Re);return(async function*(){for await(const I of Ce)yield*I}).call(this)}function Oe(Se){if(Se=k(Se),D(Se))return 0;if(Se<0)throw new o("number",">= 0",Se);return Se}function $e(Se,Re=void 0){return Re!=null&&g(Re,"options"),Re?.signal!=null&&c(Re.signal,"options.signal"),Se=Oe(Se),(async function*(){var V;if(Re!=null&&(V=Re.signal)!==null&&V!==void 0&&V.aborted)throw new u;for await(const y of this){var I;if(Re!=null&&(I=Re.signal)!==null&&I!==void 0&&I.aborted)throw new u;Se--<=0&&(yield y)}}).call(this)}function He(Se,Re=void 0){return Re!=null&&g(Re,"options"),Re?.signal!=null&&c(Re.signal,"options.signal"),Se=Oe(Se),(async function*(){var V;if(Re!=null&&(V=Re.signal)!==null&&V!==void 0&&V.aborted)throw new u;for await(const y of this){var I;if(Re!=null&&(I=Re.signal)!==null&&I!==void 0&&I.aborted)throw new u;if(Se-- >0&&(yield y),Se<=0)return}}).call(this)}return Wn.streamReturningOperators={asIndexedPairs:R(ne,"readable.asIndexedPairs will be removed in a future version."),drop:$e,filter:K,flatMap:De,map:ke,take:He,compose:ue},Wn.promiseReturningOperators={every:Ne,forEach:Te,reduce:Ie,toArray:Fe,some:fe,find:pe},Wn}var is,ya;function Eu(){if(ya)return is;ya=1;const{ArrayPrototypePop:n,Promise:e}=ct(),{isIterable:t,isNodeStream:r,isWebStream:o}=sr(),{pipelineImpl:u}=Ks(),{finished:c}=hr();xu();function l(...g){return new e((h,d)=>{let p,x;const T=g[g.length-1];if(T&&typeof T=="object"&&!r(T)&&!t(T)&&!o(T)){const S=n(g);p=S.signal,x=S.end}u(g,(S,v)=>{S?d(S):h(v)},{signal:p,end:x})})}return is={finished:c,pipeline:l},is}var ma;function xu(){if(ma)return Li.exports;ma=1;const{Buffer:n}=ir(),{ObjectDefineProperty:e,ObjectKeys:t,ReflectApply:r}=ct(),{promisify:{custom:o}}=jt(),{streamReturningOperators:u,promiseReturningOperators:c}=th(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:l}}=Ct(),g=Su(),{setDefaultHighWaterMark:h,getDefaultHighWaterMark:d}=ui(),{pipeline:p}=Ks(),{destroyer:x}=Jr(),T=hr(),S=Eu(),v=sr(),R=Li.exports=Ms().Stream;R.isDestroyed=v.isDestroyed,R.isDisturbed=v.isDisturbed,R.isErrored=v.isErrored,R.isReadable=v.isReadable,R.isWritable=v.isWritable,R.Readable=ci();for(const E of t(u)){let k=function(...D){if(new.target)throw l();return R.Readable.from(r(A,this,D))};const A=u[E];e(k,"name",{__proto__:null,value:A.name}),e(k,"length",{__proto__:null,value:A.length}),e(R.Readable.prototype,E,{__proto__:null,value:k,enumerable:!1,configurable:!0,writable:!0})}for(const E of t(c)){let k=function(...D){if(new.target)throw l();return r(A,this,D)};const A=c[E];e(k,"name",{__proto__:null,value:A.name}),e(k,"length",{__proto__:null,value:A.length}),e(R.Readable.prototype,E,{__proto__:null,value:k,enumerable:!1,configurable:!0,writable:!0})}R.Writable=Hs(),R.Duplex=rr(),R.Transform=bu(),R.PassThrough=vu(),R.pipeline=p;const{addAbortSignal:b}=ai();return R.addAbortSignal=b,R.finished=T,R.destroy=x,R.compose=g,R.setDefaultHighWaterMark=h,R.getDefaultHighWaterMark=d,e(R,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return S}}),e(p,o,{__proto__:null,enumerable:!0,get(){return S.pipeline}}),e(T,o,{__proto__:null,enumerable:!0,get(){return S.finished}}),R.Stream=R,R._isUint8Array=function(A){return A instanceof Uint8Array},R._uint8ArrayToBuffer=function(A){return n.from(A.buffer,A.byteOffset,A.byteLength)},Li.exports}var wa;function rh(){return wa||(wa=1,function(n){const e=xu(),t=Eu(),r=e.Readable.destroy;n.exports=e.Readable,n.exports._uint8ArrayToBuffer=e._uint8ArrayToBuffer,n.exports._isUint8Array=e._isUint8Array,n.exports.isDisturbed=e.isDisturbed,n.exports.isErrored=e.isErrored,n.exports.isReadable=e.isReadable,n.exports.Readable=e.Readable,n.exports.Writable=e.Writable,n.exports.Duplex=e.Duplex,n.exports.Transform=e.Transform,n.exports.PassThrough=e.PassThrough,n.exports.addAbortSignal=e.addAbortSignal,n.exports.finished=e.finished,n.exports.destroy=e.destroy,n.exports.destroy=r,n.exports.pipeline=e.pipeline,n.exports.compose=e.compose,Object.defineProperty(e,"promises",{configurable:!0,enumerable:!0,get(){return t}}),n.exports.Stream=e.Stream,n.exports.default=n.exports}(Di)),Di.exports}var qs=rh();const ss=Symbol("iter");function xn(n,e,t=4){if(t===0)return Object.assign(n,e);for(const r in e)n[r]=xn(n[r]||Object.create(null),e[r],t-1);return n}function Fu(n,e,t=4){let r=!1;for(const o in n)if(o in e){const u=t===0?null:Fu(n[o],e[o],t-1);if(u!==!1)r=r||Object.create(null),r[o]=u;else if(t===3)return!1}return r}function Ru(n,e,t=4){let r=!1;for(const o in n)if(!(o in e))r=r||Object.create(null),r[o]=t===0?null:xn({},n[o],t-1);else if(t!==0){const u=Ru(n[o],e[o],t-1);if(u!==!1)r=r||Object.create(null),r[o]=u;else if(t===3)return!1}return r}class nh{constructor(e={}){this._id=1,this._ids=Object.create(null),this._ids[""]=1,this._entities=Object.create(null),this._entities[1]="",this._blankNodeIndex=0,this._factory=e.factory||mt}_termFromId(e){if(e[0]==="."){const t=this._entities,r=e.split(".");return this._factory.quad(this._termFromId(t[r[1]]),this._termFromId(t[r[2]]),this._termFromId(t[r[3]]),r[4]&&this._termFromId(t[r[4]]))}return vn(e,this._factory)}_termToNumericId(e){if(e.termType==="Quad"){const t=this._termToNumericId(e.subject),r=this._termToNumericId(e.predicate),o=this._termToNumericId(e.object);let u;return t&&r&&o&&(Ss(e.graph)||(u=this._termToNumericId(e.graph)))&&this._ids[u?`.${t}.${r}.${o}.${u}`:`.${t}.${r}.${o}`]}return this._ids[Mr(e)]}_termToNewNumericId(e){const t=e&&e.termType==="Quad"?`.${this._termToNewNumericId(e.subject)}.${this._termToNewNumericId(e.predicate)}.${this._termToNewNumericId(e.object)}${Ss(e.graph)?"":`.${this._termToNewNumericId(e.graph)}`}`:Mr(e);return this._ids[t]||(this._ids[this._entities[++this._id]=t]=this._id)}createBlankNode(e){let t,r;if(e)for(t=e=`_:${e}`,r=1;this._ids[t];)t=e+r++;else do t=`_:b${this._blankNodeIndex++}`;while(this._ids[t]);return this._ids[t]=++this._id,this._entities[this._id]=t,this._factory.blankNode(t.substr(2))}}class Rt{constructor(e,t){this._size=0,this._graphs=Object.create(null),!t&&e&&!e[0]&&typeof e.match!="function"&&(t=e,e=null),t=t||{},this._factory=t.factory||mt,this._entityIndex=t.entityIndex||new nh({factory:this._factory}),this._entities=this._entityIndex._entities,this._termFromId=this._entityIndex._termFromId.bind(this._entityIndex),this._termToNumericId=this._entityIndex._termToNumericId.bind(this._entityIndex),this._termToNewNumericId=this._entityIndex._termToNewNumericId.bind(this._entityIndex),e&&this.addAll(e)}get size(){let e=this._size;if(e!==null)return e;e=0;const t=this._graphs;let r,o;for(const u in t)for(const c in r=t[u].subjects)for(const l in o=r[c])e+=Object.keys(o[l]).length;return this._size=e}_addToIndex(e,t,r,o){const u=e[t]||(e[t]={}),c=u[r]||(u[r]={}),l=o in c;return l||(c[o]=null),!l}_removeFromIndex(e,t,r,o){const u=e[t],c=u[r];delete c[o];for(const l in c)return;delete u[r];for(const l in u)return;delete e[t]}*_findInIndex(e,t,r,o,u,c,l,g){let h,d,p;const x=this._entities,T=this._termFromId(x[g]),S={subject:null,predicate:null,object:null};t&&((h=e,e={})[t]=h[t]);for(const v in e)if(d=e[v]){S[u]=this._termFromId(x[v]),r&&((h=d,d={})[r]=h[r]);for(const R in d)if(p=d[R]){S[c]=this._termFromId(x[R]);const b=o?o in p?[o]:[]:Object.keys(p);for(let E=0;E<b.length;E++)S[l]=this._termFromId(x[b[E]]),yield this._factory.quad(S.subject,S.predicate,S.object,T)}}}_loop(e,t){for(const r in e)t(r)}_loopByKey0(e,t,r){let o,u;if(o=e[t])for(u in o)r(u)}_loopByKey1(e,t,r){let o,u;for(o in e)u=e[o],u[t]&&r(o)}_loopBy2Keys(e,t,r,o){let u,c,l;if((u=e[t])&&(c=u[r]))for(l in c)o(l)}_countInIndex(e,t,r,o){let u=0,c,l,g;t&&((c=e,e={})[t]=c[t]);for(const h in e)if(l=e[h]){r&&((c=l,l={})[r]=c[r]);for(const d in l)(g=l[d])&&(o?o in g&&u++:u+=Object.keys(g).length)}return u}_getGraphs(e){return e=e===""?1:e&&(this._termToNumericId(e)||-1),typeof e!="number"?this._graphs:{[e]:this._graphs[e]}}_uniqueEntities(e){const t=Object.create(null);return r=>{r in t||(t[r]=!0,e(this._termFromId(this._entities[r],this._factory)))}}add(e){return this.addQuad(e),this}addQuad(e,t,r,o){t||(o=e.graph,r=e.object,t=e.predicate,e=e.subject),o=o?this._termToNewNumericId(o):1;let u=this._graphs[o];return u||(u=this._graphs[o]={subjects:{},predicates:{},objects:{}},Object.freeze(u)),e=this._termToNewNumericId(e),t=this._termToNewNumericId(t),r=this._termToNewNumericId(r),this._addToIndex(u.subjects,e,t,r)?(this._addToIndex(u.predicates,t,r,e),this._addToIndex(u.objects,r,e,t),this._size=null,!0):!1}addQuads(e){for(let t=0;t<e.length;t++)this.addQuad(e[t])}delete(e){return this.removeQuad(e),this}has(e,t,r,o){return e&&e.subject&&({subject:e,predicate:t,object:r,graph:o}=e),!this.readQuads(e,t,r,o).next().done}import(e){return e.on("data",t=>{this.addQuad(t)}),e}removeQuad(e,t,r,o){t||({subject:e,predicate:t,object:r,graph:o}=e),o=o?this._termToNumericId(o):1;const u=this._graphs;let c,l,g;if(!(e=e&&this._termToNumericId(e))||!(t=t&&this._termToNumericId(t))||!(r=r&&this._termToNumericId(r))||!(c=u[o])||!(l=c.subjects[e])||!(g=l[t])||!(r in g))return!1;this._removeFromIndex(c.subjects,e,t,r),this._removeFromIndex(c.predicates,t,r,e),this._removeFromIndex(c.objects,r,e,t),this._size!==null&&this._size--;for(e in c.subjects)return!0;return delete u[o],!0}removeQuads(e){for(let t=0;t<e.length;t++)this.removeQuad(e[t])}remove(e){return e.on("data",t=>{this.removeQuad(t)}),e}removeMatches(e,t,r,o){const u=new qs.Readable({objectMode:!0}),c=this.readQuads(e,t,r,o);return u._read=l=>{for(;--l>=0;){const{done:g,value:h}=c.next();if(g){u.push(null);return}u.push(h)}},this.remove(u)}deleteGraph(e){return this.removeMatches(null,null,null,e)}getQuads(e,t,r,o){return[...this.readQuads(e,t,r,o)]}*readQuads(e,t,r,o){const u=this._getGraphs(o);let c,l,g,h;if(!(e&&!(l=this._termToNumericId(e))||t&&!(g=this._termToNumericId(t))||r&&!(h=this._termToNumericId(r))))for(const d in u)(c=u[d])&&(l?h?yield*this._findInIndex(c.objects,h,l,g,"object","subject","predicate",d):yield*this._findInIndex(c.subjects,l,g,null,"subject","predicate","object",d):g?yield*this._findInIndex(c.predicates,g,h,null,"predicate","object","subject",d):h?yield*this._findInIndex(c.objects,h,null,null,"object","subject","predicate",d):yield*this._findInIndex(c.subjects,null,null,null,"subject","predicate","object",d))}match(e,t,r,o){return new cr(this,e,t,r,o,{entityIndex:this._entityIndex})}countQuads(e,t,r,o){const u=this._getGraphs(o);let c=0,l,g,h,d;if(e&&!(g=this._termToNumericId(e))||t&&!(h=this._termToNumericId(t))||r&&!(d=this._termToNumericId(r)))return 0;for(const p in u)(l=u[p])&&(e?r?c+=this._countInIndex(l.objects,d,g,h):c+=this._countInIndex(l.subjects,g,h,d):t?c+=this._countInIndex(l.predicates,h,d,g):c+=this._countInIndex(l.objects,d,g,h));return c}forEach(e,t,r,o,u){this.some(c=>(e(c,this),!1),t,r,o,u)}every(e,t,r,o,u){return!this.some(c=>!e(c,this),t,r,o,u)}some(e,t,r,o,u){for(const c of this.readQuads(t,r,o,u))if(e(c,this))return!0;return!1}getSubjects(e,t,r){const o=[];return this.forSubjects(u=>{o.push(u)},e,t,r),o}forSubjects(e,t,r,o){const u=this._getGraphs(o);let c,l,g;if(e=this._uniqueEntities(e),!(t&&!(l=this._termToNumericId(t))||r&&!(g=this._termToNumericId(r))))for(o in u)(c=u[o])&&(l?g?this._loopBy2Keys(c.predicates,l,g,e):this._loopByKey1(c.subjects,l,e):g?this._loopByKey0(c.objects,g,e):this._loop(c.subjects,e))}getPredicates(e,t,r){const o=[];return this.forPredicates(u=>{o.push(u)},e,t,r),o}forPredicates(e,t,r,o){const u=this._getGraphs(o);let c,l,g;if(e=this._uniqueEntities(e),!(t&&!(l=this._termToNumericId(t))||r&&!(g=this._termToNumericId(r))))for(o in u)(c=u[o])&&(l?g?this._loopBy2Keys(c.objects,g,l,e):this._loopByKey0(c.subjects,l,e):g?this._loopByKey1(c.predicates,g,e):this._loop(c.predicates,e))}getObjects(e,t,r){const o=[];return this.forObjects(u=>{o.push(u)},e,t,r),o}forObjects(e,t,r,o){const u=this._getGraphs(o);let c,l,g;if(e=this._uniqueEntities(e),!(t&&!(l=this._termToNumericId(t))||r&&!(g=this._termToNumericId(r))))for(o in u)(c=u[o])&&(l?g?this._loopBy2Keys(c.subjects,l,g,e):this._loopByKey1(c.objects,l,e):g?this._loopByKey0(c.predicates,g,e):this._loop(c.objects,e))}getGraphs(e,t,r){const o=[];return this.forGraphs(u=>{o.push(u)},e,t,r),o}forGraphs(e,t,r,o){for(const u in this._graphs)this.some(c=>(e(c.graph),!0),t,r,o,this._termFromId(this._entities[u]))}createBlankNode(e){return this._entityIndex.createBlankNode(e)}extractLists({remove:e=!1,ignoreErrors:t=!1}={}){const r={},o=t?()=>!0:(l,g)=>{throw new Error(`${l.value} ${g}`)},u=this.getQuads(null,Et.rdf.rest,Et.rdf.nil,null),c=e?[...u]:[];return u.forEach(l=>{const g=[];let h=!1,d,p;const x=l.graph;let T=l.subject;for(;T&&!h;){const S=this.getQuads(null,null,T,null),v=this.getQuads(T,null,null,null);let R,b=null,E=null,A=null;for(let k=0;k<v.length&&!h;k++)R=v[k],R.graph.equals(x)?d?h=o(T,"has non-list arcs out"):R.predicate.value===Et.rdf.first?b?h=o(T,"has multiple rdf:first arcs"):c.push(b=R):R.predicate.value===Et.rdf.rest?E?h=o(T,"has multiple rdf:rest arcs"):c.push(E=R):S.length?h=o(T,"can't be subject and object"):(d=R,p="subject"):h=o(T,"not confined to single graph");for(let k=0;k<S.length&&!h;++k)R=S[k],d?h=o(T,"can't have coreferences"):R.predicate.value===Et.rdf.rest?A?h=o(T,"has incoming rdf:rest arcs"):A=R:(d=R,p="object");b?g.unshift(b.object):h=o(T,"has no list head"),T=A&&A.subject}h?e=!1:d&&(r[d[p].value]=g)}),e&&this.removeQuads(c),r}addAll(e){if(e instanceof cr&&(e=e.filtered),Array.isArray(e))this.addQuads(e);else if(e instanceof Rt&&e._entityIndex===this._entityIndex)e._size!==0&&(this._graphs=xn(this._graphs,e._graphs),this._size=null);else for(const t of e)this.add(t);return this}contains(e){if(e instanceof cr&&(e=e.filtered),e===this)return!0;if(!(e instanceof Rt)||this._entityIndex!==e._entityIndex)return e.every(h=>this.has(h));const t=this._graphs,r=e._graphs;let o,u,c,l,g;for(const h in r){if(!(o=t[h]))return!1;o=o.subjects;for(const d in u=r[h].subjects){if(!(c=o[d]))return!1;for(const p in l=u[d]){if(!(g=c[p]))return!1;for(const x in l[p])if(!(x in g))return!1}}}return!0}deleteMatches(e,t,r,o){for(const u of this.match(e,t,r,o))this.removeQuad(u);return this}difference(e){if(e&&e instanceof cr&&(e=e.filtered),e===this)return new Rt({entityIndex:this._entityIndex});if(e instanceof Rt&&e._entityIndex===this._entityIndex){const t=new Rt({entityIndex:this._entityIndex}),r=Ru(this._graphs,e._graphs);return r&&(t._graphs=r,t._size=null),t}return this.filter(t=>!e.has(t))}equals(e){return e instanceof cr&&(e=e.filtered),e===this||this.size===e.size&&this.contains(e)}filter(e){const t=new Rt({entityIndex:this._entityIndex});for(const r of this)e(r,this)&&t.add(r);return t}intersection(e){if(e instanceof cr&&(e=e.filtered),e===this){const t=new Rt({entityIndex:this._entityIndex});return t._graphs=xn(Object.create(null),this._graphs),t._size=this._size,t}else if(e instanceof Rt&&this._entityIndex===e._entityIndex){const t=new Rt({entityIndex:this._entityIndex}),r=Fu(e._graphs,this._graphs);return r&&(t._graphs=r,t._size=null),t}return this.filter(t=>e.has(t))}map(e){const t=new Rt({entityIndex:this._entityIndex});for(const r of this)t.add(e(r,this));return t}reduce(e,t){const r=this.readQuads();let o=t===void 0?r.next().value:t;for(const u of r)o=e(o,u,this);return o}toArray(){return this.getQuads()}toCanonical(){throw new Error("not implemented")}toStream(){return this.match()}toString(){return new oi().quadsToString(this)}union(e){const t=new Rt({entityIndex:this._entityIndex});return t._graphs=xn(Object.create(null),this._graphs),t._size=this._size,t.addAll(e),t}*[Symbol.iterator](){yield*this.readQuads()}}function Qt(n,e,t=0){const r=e[t];if(r&&!(r in n))return!1;let o=!1;for(const u in r?{[r]:n[r]}:n){const c=t===2?null:Qt(n[u],e,t+1);c!==!1&&(o=o||Object.create(null),o[u]=c)}return o}class cr extends qs.Readable{constructor(e,t,r,o,u,c){super({objectMode:!0}),Object.assign(this,{n3Store:e,subject:t,predicate:r,object:o,graph:u,options:c})}get filtered(){if(!this._filtered){const{n3Store:e,graph:t,object:r,predicate:o,subject:u}=this,c=this._filtered=new Rt({factory:e._factory,entityIndex:this.options.entityIndex});let l,g,h;if(u&&!(l=c._termToNumericId(u))||o&&!(g=c._termToNumericId(o))||r&&!(h=c._termToNumericId(r)))return c;const d=e._getGraphs(t);for(const p in d){let x,T,S,v;(v=d[p])&&(!l&&g?(T=Qt(v.predicates,[g,h,l]))&&(x=Qt(v.subjects,[l,g,h]),S=Qt(v.objects,[h,l,g])):h?(S=Qt(v.objects,[h,l,g]))&&(x=Qt(v.subjects,[l,g,h]),T=Qt(v.predicates,[g,h,l])):(x=Qt(v.subjects,[l,g,h]))&&(T=Qt(v.predicates,[g,h,l]),S=Qt(v.objects,[h,l,g])),x&&(c._graphs[p]={subjects:x,predicates:T,objects:S}))}c._size=null}return this._filtered}get size(){return this.filtered.size}_read(e){e>0&&!this[ss]&&(this[ss]=this[Symbol.iterator]());const t=this[ss];for(;--e>=0;){const{done:r,value:o}=t.next();if(r){this.push(null);return}this.push(o)}}addAll(e){return this.filtered.addAll(e)}contains(e){return this.filtered.contains(e)}deleteMatches(e,t,r,o){return this.filtered.deleteMatches(e,t,r,o)}difference(e){return this.filtered.difference(e)}equals(e){return this.filtered.equals(e)}every(e,t,r,o,u){return this.filtered.every(e,t,r,o,u)}filter(e){return this.filtered.filter(e)}forEach(e,t,r,o,u){return this.filtered.forEach(e,t,r,o,u)}import(e){return this.filtered.import(e)}intersection(e){return this.filtered.intersection(e)}map(e){return this.filtered.map(e)}some(e,t,r,o,u){return this.filtered.some(e,t,r,o,u)}toCanonical(){return this.filtered.toCanonical()}toStream(){return this._filtered?this._filtered.toStream():this.n3Store.match(this.subject,this.predicate,this.object,this.graph)}union(e){return this._filtered?this._filtered.union(e):this.n3Store.match(this.subject,this.predicate,this.object,this.graph).addAll(e)}toArray(){return this._filtered?this._filtered.toArray():this.n3Store.getQuads(this.subject,this.predicate,this.object,this.graph)}reduce(e,t){return this.filtered.reduce(e,t)}toString(){return new oi().quadsToString(this)}add(e){return this.filtered.add(e)}delete(e){return this.filtered.delete(e)}has(e){return this.filtered.has(e)}match(e,t,r,o){return new cr(this.filtered,e,t,r,o,this.options)}*[Symbol.iterator](){yield*this._filtered||this.n3Store.readQuads(this.subject,this.predicate,this.object,this.graph)}}function Es(n,e){const t=new oi(e),r=[];for(const o of n)r.push(o);return t.quadsToString(r)}async function ih(n){let e="";if(n.removed){const t=n.removed.map(r=>Pt(r.subject,r.predicate,r.object));e+=`DELETE DATA { ${await Es(t,{format:"N-Triples"})} }`}if(n.added&&n.removed&&(e+="; "),n.added){const t=n.added.map(r=>Pt(r.subject,r.predicate,r.object));e+=`INSERT DATA { ${await Es(t,{format:"N-Triples"})} }`}return e.replaceAll(`
`," ")}async function sh(n,e){if(e&&e.format==="application/ld+json")throw new Error("Not Implemented");return new Os(e).parse(n)}class Tn{constructor(e,t){this.dataset=e,this.datasetCoreFactory=t}createBlankDataset(){return new Tn(this.datasetCoreFactory.dataset(),this.datasetCoreFactory)}addAll(e){for(const t of e)this.add(t);return this}contains(e){if(e.size>this.size)return!1;for(const t of e)if(!this.has(t))return!1;return!0}deleteMatches(e,t,r,o){const u=this.match(e,t,r,o);for(const c of u)this.dataset.delete(c);return this}difference(e){const t=this.createBlankDataset();for(const r of this)e.has(r)||t.add(r);return t}equals(e){if(this.size!==e.size)return!1;for(const t of this)if(!e.has(t))return!1;return!0}every(e){for(const t of this)if(!e(t,this))return!1;return!0}filter(e){const t=this.createBlankDataset();for(const r of this)e(r,this)&&t.add(r);return t}forEach(e){for(const t of this)e(t,this)}import(e){return new Promise((t,r)=>{e.on("data",o=>{this.add(o)}).on("end",()=>{t(this)}).on("error",o=>r(o))})}intersection(e){const t=this.createBlankDataset(),r=this.size<e.size?this:e,o=this.size<e.size?e:this;for(const u of r)o.has(u)&&t.add(u);return t}map(e){const t=this.createBlankDataset();for(const r of this)t.add(e(r,this));return t}reduce(e,t){if(this.size===0&&t==null)throw new Error("Cannot reduce an empty Dataset without an initial value.");const r=this[Symbol.iterator]();let o=r.next(),u=t;for(;!o.done;)u=e(u,o.value,this),o=r.next();return u}some(e){for(const t of this)if(e(t,this))return!0;return!1}toArray(){const e=[];for(const t of this)e.push(t);return e}toCanonical(){throw new Error("Method not implemented.")}toStream(){const e=this[Symbol.iterator]();let t=e.next();return new qs.Readable({objectMode:!0,read(){if(t.done||!t.value){this.push(null);return}this.push(t.value),t=e.next()}})}toString(){return Es(this,{format:"N-Triples"})}union(e){const t=this.createBlankDataset();for(const r of this)t.add(r);for(const r of e)t.add(r);return t}match(e,t,r,o){return new Tn(this.dataset.match(e,t,r,o),this.datasetCoreFactory)}get size(){return this.dataset.size}add(e){return this.dataset.add(e),this}delete(e){return this.dataset.delete(e),this}has(e){return!!this.dataset.has(e)}[Symbol.iterator](){return this.dataset[Symbol.iterator]()}}class oh{constructor(e){this.datasetCoreFactory=e}dataset(e){return new Tn(this.datasetCoreFactory.dataset(e),this.datasetCoreFactory)}}var os,_a;function ah(){if(_a)return os;_a=1;function n(c){return typeof c=="string"||c instanceof String}const e="http://www.w3.org/2001/XMLSchema#string";function t(c){if(typeof c=="string")return c;if(!c)return"";if(typeof c.id<"u"&&c.termType!=="Quad")return c.id;let l,g,h,d;switch(c.termType){case"NamedNode":return c.value;case"BlankNode":return`_:${c.value}`;case"Variable":return`?${c.value}`;case"DefaultGraph":return"";case"Literal":return c.language?`"${c.value}"@${c.language}`:`"${c.value}"${c.datatype&&c.datatype.value!==e?`^^${c.datatype.value}`:""}`;case"Quad":return l=o(t(c.subject)),g=o(t(c.predicate)),h=o(t(c.object)),d=c.graph.termType==="DefaultGraph"?"":` ${t(c.graph)}`,`<<${l} ${g} ${h}${d}>>`;default:throw new Error(`Unexpected termType: ${c.termType}`)}}const r=/^"(.*".*)(?="[^"]*$)/;function o(c){return c.replace(r,(l,g)=>`"${g.replace(/"/g,'""')}`)}class u{constructor(l){if(this._size=0,this._graphs=Object.create(null),this._id=0,this._ids=Object.create(null),this._ids["><"]=0,this._entities=Object.create(null),this._quads=new Map,l)for(const g of l)this.add(g)}get size(){let l=this._size;if(l!==null)return l;l=0;const g=this._graphs;let h,d;for(const p in g)for(const x in h=g[p].subjects)for(const T in d=h[x])l+=Object.keys(d[T]).length;return this._size=l,this._size}add(l){let g=t(l.subject),h=t(l.predicate),d=t(l.object);const p=t(l.graph);let x=this._graphs[p];x||(x=this._graphs[p]={subjects:{},predicates:{},objects:{}},Object.freeze(x));const T=this._ids,S=this._entities;return g=T[g]||(T[S[++this._id]=g]=this._id),h=T[h]||(T[S[++this._id]=h]=this._id),d=T[d]||(T[S[++this._id]=d]=this._id),this._addToIndex(x.subjects,g,h,d),this._addToIndex(x.predicates,h,d,g),this._addToIndex(x.objects,d,g,h),this._setQuad(g,h,d,p,l),this._size=null,this}delete(l){let g=t(l.subject),h=t(l.predicate),d=t(l.object);const p=t(l.graph),x=this._ids,T=this._graphs;let S,v,R;if(!(g=x[g])||!(h=x[h])||!(d=x[d])||!(S=T[p])||!(v=S.subjects[g])||!(R=v[h])||!(d in R))return this;this._removeFromIndex(S.subjects,g,h,d),this._removeFromIndex(S.predicates,h,d,g),this._removeFromIndex(S.objects,d,g,h),this._size!==null&&this._size--,this._deleteQuad(g,h,d,p);for(g in S.subjects)return this;return delete T[p],this}has(l){const g=t(l.subject),h=t(l.predicate),d=t(l.object),p=t(l.graph),x=this._graphs[p];if(!x)return!1;const T=this._ids;let S,v,R;return n(g)&&!(S=T[g])||n(h)&&!(v=T[h])||n(d)&&!(R=T[d])?!1:this._countInIndex(x.objects,R,S,v)===1}match(l,g,h,d){return this._createDataset(this._match(l,g,h,d))}[Symbol.iterator](){return this._match()[Symbol.iterator]()}_addToIndex(l,g,h,d){const p=l[g]||(l[g]={}),x=p[h]||(p[h]={}),T=d in x;return T||(x[d]=null),!T}_removeFromIndex(l,g,h,d){const p=l[g],x=p[h];delete x[d];for(const T in x)return;delete p[h];for(const T in p)return;delete l[g]}_findInIndex(l,g,h,d,p,x,T,S,v,R){let b,E,A;g&&((b=l,l={})[g]=b[g]);for(const k in l)if(E=l[k],E){h&&((b=E,E={})[h]=b[h]);for(const D in E)if(A=E[D],A){const B=d?d in A?[d]:[]:Object.keys(A);for(let M=0;M<B.length;M++){const ie={[p]:k,[x]:D,[T]:B[M]},he=this._getQuad(ie.subject,ie.predicate,ie.object,S);if(R)R.push(he);else if(v(he))return!0}}}return R}_countInIndex(l,g,h,d){let p=0,x,T,S;g&&((x=l,l={})[g]=x[g]);for(const v in l)if(T=l[v],T){h&&((x=T,T={})[h]=x[h]);for(const R in T)S=T[R],S&&(d?d in S&&p++:p+=Object.keys(S).length)}return p}_getGraphs(l){return n(l)?{[l]:this._graphs[l]}:this._graphs}_match(l,g,h,d){l=l&&t(l),g=g&&t(g),h=h&&t(h),d=d&&t(d);const p=[],x=this._getGraphs(d),T=this._ids;let S,v,R,b;if(n(l)&&!(v=T[l])||n(g)&&!(R=T[g])||n(h)&&!(b=T[h]))return p;for(const E in x)S=x[E],S&&(v?b?this._findInIndex(S.objects,b,v,R,"object","subject","predicate",E,null,p):this._findInIndex(S.subjects,v,R,null,"subject","predicate","object",E,null,p):R?this._findInIndex(S.predicates,R,b,null,"predicate","object","subject",E,null,p):b?this._findInIndex(S.objects,b,null,null,"object","subject","predicate",E,null,p):this._findInIndex(S.subjects,null,null,null,"subject","predicate","object",E,null,p));return p}_getQuad(l,g,h,d){return this._quads.get(this._toId(l,g,h,d))}_setQuad(l,g,h,d,p){this._quads.set(this._toId(l,g,h,d),p)}_deleteQuad(l,g,h,d){this._quads.delete(this._toId(l,g,h,d))}_createDataset(l){return new this.constructor(l)}_toId(l,g,h,d){return`${l}:${g}:${h}:${d}`}}return os=u,os}var as,ba;function uh(){if(ba)return as;ba=1;const n=au(),e=ah();function t(r){return new e(r)}return as=Object.assign({dataset:t},n),as}var Tu=uh();const ch=kn(Tu),lh=ch?.dataset||Tu.dataset;function Ws(){const n={dataset:e=>lh(Array.isArray(e)?e:e?.toArray())};return new oh(n)}function qr(n){return Ws().dataset(n)}async function va(n,e,t){const r=await sh(e,t);return n.dataset(r)}var Au=Nn();const $s=kn(Au),St=[];for(let n=0;n<256;++n)St.push((n+256).toString(16).slice(1));function hh(n,e=0){return(St[n[e+0]]+St[n[e+1]]+St[n[e+2]]+St[n[e+3]]+"-"+St[n[e+4]]+St[n[e+5]]+"-"+St[n[e+6]]+St[n[e+7]]+"-"+St[n[e+8]]+St[n[e+9]]+"-"+St[n[e+10]]+St[n[e+11]]+St[n[e+12]]+St[n[e+13]]+St[n[e+14]]+St[n[e+15]]).toLowerCase()}let us;const fh=new Uint8Array(16);function dh(){if(!us){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");us=crypto.getRandomValues.bind(crypto)}return us(fh)}const ph=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Sa={randomUUID:ph};function Ar(n,e,t){if(Sa.randomUUID&&!n)return Sa.randomUUID();n=n||{};const r=n.random??n.rng?.()??dh();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,hh(r)}class Vs extends Tn{constructor(e,t,r){super(r||e.dataset(),e),this.listenerHashMap=new Map,this.transactionDatasetFactory=t,this.eventEmitter=new Au.EventEmitter,this.datasetFactory=e}superAddAll(e){for(const t of e)super.add(t);return this}addAll(e){return this.superAddAll(e),this.triggerSubscriptionForQuads({added:this.datasetFactory.dataset(e)}),this}bulk(e){return e.added&&this.superAddAll(e.added),e.removed&&e.removed.forEach(t=>{super.delete(t)}),this.triggerSubscriptionForQuads(e),this}deleteMatches(e,t,r,o){const u=super.match(e,t,r,o);for(const c of u)super.delete(c);return this.triggerSubscriptionForQuads({removed:u}),this}add(e){return super.add(e),this.triggerSubscriptionForQuads({added:this.datasetFactory.dataset([e])}),this}delete(e){return super.delete(e),this.triggerSubscriptionForQuads({removed:this.datasetFactory.dataset([e])}),this}triggerSubscriptionForQuads(e){const t={},r=u=>{e[u]?.forEach(l=>{const g=l;[[null,null,null,null],[g.subject,null,null,null],[g.subject,g.predicate,null,null],[g.subject,null,g.object,null],[null,g.predicate,null,null],[null,g.predicate,g.object,null],[null,null,g.object,null],[g.subject,g.predicate,g.object,null],[null,null,null,g.graph],[g.subject,null,null,g.graph],[g.subject,g.predicate,null,g.graph],[g.subject,null,g.object,g.graph],[null,g.predicate,null,g.graph],[null,g.predicate,g.object,g.graph],[null,null,g.object,g.graph],[g.subject,g.predicate,g.object,g.graph]].forEach(d=>{const p=Wt(d);this.eventEmitter.listenerCount(p)>0&&(t[p]||(t[p]={triggerQuadMatch:d,changes:{}}),t[p].changes[u]||(t[p].changes[u]=this.datasetFactory.dataset()),t[p].changes[u]?.add(l))})})};r("added"),r("removed");const o=Ar();Object.entries(t).forEach(([u,c])=>{this.eventEmitter.emit(u,c.changes,o,c.triggerQuadMatch)})}addListener(e,t){return this.on(e,t)}emit(e,t){return this.eventEmitter.emit(Wt(e),t)}eventNames(){return this.eventEmitter.eventNames().map(e=>xl(e))}getMaxListeners(){return this.eventEmitter.getMaxListeners()}listenerCount(e){return this.eventEmitter.listenerCount(Wt(e))}listeners(e){return this.eventEmitter.listeners(Wt(e))}off(e,t){this.removeListener(e,t)}on(e,t){const r=Wt(e);return this.listenerHashMap.has(t)||this.listenerHashMap.set(t,new Set),this.listenerHashMap.get(t)?.add(r),this.eventEmitter.on(r,t),this}once(e,t){return this.eventEmitter.once(Wt(e),t),this}prependListener(e,t){return this.eventEmitter.prependListener(Wt(e),t),this}prependOnceListener(e,t){return this.eventEmitter.prependOnceListener(Wt(e),t),this}removeAllListeners(e){return this.eventEmitter.removeAllListeners(Wt(e)),this}removeListener(e,t){return this.eventEmitter.removeListener(Wt(e),t),this}removeListenerFromAllEvents(e){const t=this.listenerHashMap.get(e);return t&&t.forEach(r=>{this.eventEmitter.off(r,e)}),this}setMaxListeners(e){return this.eventEmitter.setMaxListeners(e),this}rawListeners(e){return this.eventEmitter.rawListeners(Wt(e))}startTransaction(){return this.transactionDatasetFactory.transactionDataset(this)}}class gh{constructor(e,t){this.datasetFactory=e,this.transactionDatasetFactory=t}dataset(e){return new Vs(this.datasetFactory,this.transactionDatasetFactory,e?this.datasetFactory.dataset(e):void 0)}}function Iu(n,e){if(e.added){n.added?n.added.addAll(e.added):n.added=e.added;const t=n.removed?.intersection(e.added);t&&t.size>0&&(n.removed=n.removed?.difference(t))}if(e.removed){n.removed?n.removed.addAll(e.removed):n.removed=e.removed;const t=n.added?.intersection(e.removed);t&&t.size>0&&(n.added=n.added?.difference(t))}n.added&&n.added.size===0&&(n.added=void 0),n.removed&&n.removed.size===0&&(n.removed=void 0)}function Pu(n,e){n.bulk?n.bulk(e):(e.added&&n.addAll(e.added),e.removed&&e.removed.forEach(t=>{n.delete(t)}))}class Js extends Vs{constructor(e,t,r){super(t,r,t.dataset()),this.parentDataset=e,this.datasetChanges={}}addAll(e){return this.updateDatasetChanges({added:e}),this}bulk(e){return this.updateDatasetChanges(e),this}deleteMatches(e,t,r,o){this.checkIfTransactionCommitted();const u=this.match(e,t,r,o);for(const c of u)this.delete(c);return this}match(e,t,r,o){let u=this.parentDataset.match(e,t,r,o);return this.datasetChanges.removed&&(u=u.difference(this.datasetChanges.removed)),this.datasetChanges.added&&(u=u.union(this.datasetChanges.added.match(e,t,r,o))),u}get size(){return this.parentDataset.size+(this.datasetChanges.added?.difference(this.parentDataset).size||0)-(this.datasetChanges.removed?.intersection(this.parentDataset).size||0)}add(e){return this.updateDatasetChanges({added:[e]}),this}delete(e){return this.updateDatasetChanges({removed:[e]}),this}has(e){return!this.datasetChanges.removed?.has(e)&&(this.datasetChanges.added?.has(e)||this.parentDataset.has(e))}[Symbol.iterator](){const e=(this.datasetChanges.added||[])[Symbol.iterator]();let t=e.next();const r=this.parentDataset[Symbol.iterator]();let o=r.next();return{next:()=>{if(!t||!t.done){const u=t;return t=e.next(),u}for(;!o.done;){const u=o;if(o=r.next(),!(this.datasetChanges.added&&this.datasetChanges.added.has(u.value))&&!(this.datasetChanges.removed&&this.datasetChanges.removed.has(u.value)))return u}return{value:void 0,done:!0}}}}checkIfTransactionCommitted(){if(this.committedDatasetChanges)throw new Error("Transaction has already committed")}updateDatasetChanges(e){this.checkIfTransactionCommitted(),Iu(this.datasetChanges,{added:e.added?this.datasetFactory.dataset(e.added):void 0,removed:e.removed?this.datasetFactory.dataset(e.removed):void 0})}updateParentDataset(e){return Pu(this.parentDataset,e)}commit(){this.checkIfTransactionCommitted(),this.committedDatasetChanges={added:this.datasetChanges.added?.difference(this.parentDataset),removed:this.datasetChanges.removed?.intersection(this.parentDataset)},this.updateParentDataset(this.committedDatasetChanges)}rollback(){if(!this.committedDatasetChanges)throw new Error("Cannot rollback. Transaction has not yet been committed");this.updateParentDataset({added:this.committedDatasetChanges.removed,removed:this.committedDatasetChanges.added}),this.committedDatasetChanges=void 0}getChanges(){return this.datasetChanges}}class yh{constructor(e,t){this.datasetFactory=e,this.transactionDatasetFactory=t||this}transactionDataset(e){return new Js(e,this.datasetFactory,this.transactionDatasetFactory)}}const mh={dataset:n=>qr(n)};function Gs(){return new yh(mh)}const xs="any";class wh{constructor(e){this.lastRequestTimestampMap={},this.currentlyProcessing=void 0,this.processQueue=[],this.batchMillis=e?.batchMillis||1e3}isLoading(e){return e===xs?!!this.currentlyProcessing:this.currentlyProcessing?.name===e}triggerOrWaitProcess(){if(!this.processQueue[0]||this.currentlyProcessing)return;this.currentlyProcessing=this.processQueue.shift();const e=this.currentlyProcessing.name;this.lastRequestTimestampMap[e]||(this.lastRequestTimestampMap[e]=Date.UTC(0,0,0,0,0,0,0));const t=this.lastRequestTimestampMap[e],r=Date.now()-t,o=async()=>{this.lastRequestTimestampMap[e]=Date.now(),this.lastRequestTimestampMap[xs]=Date.now();const u=this.currentlyProcessing;if(u){this.currentlyProcessing=u;try{const c=await u.perform(...u.args);u.after&&u.after(c),u.awaitingResolutions.forEach(l=>{l(c)})}catch(c){u.awaitingRejections.forEach(l=>{l(c)})}this.currentlyProcessing=void 0,this.triggerOrWaitProcess()}};r<this.batchMillis?setTimeout(o,this.batchMillis-r):o()}async queueProcess(e){return new Promise((t,r)=>{const o=e.modifyQueue(this.processQueue,this.currentlyProcessing,e.args);if(o){o.awaitingResolutions.push(t),o.awaitingRejections.push(r);return}const u={name:e.name,args:e.args,perform:e.perform,awaitingResolutions:[t],awaitingRejections:[r],after:e.after};this.processQueue.push(u),this.triggerOrWaitProcess()})}}var Jn={exports:{}},Ea;function _h(){return Ea||(Ea=1,function(n,e){var t=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof On<"u"&&On,r=function(){function u(){this.fetch=!1,this.DOMException=t.DOMException}return u.prototype=t,new u}();(function(u){(function(c){var l=typeof u<"u"&&u||typeof self<"u"&&self||typeof On<"u"&&On||{},g={searchParams:"URLSearchParams"in l,iterable:"Symbol"in l&&"iterator"in Symbol,blob:"FileReader"in l&&"Blob"in l&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in l,arrayBuffer:"ArrayBuffer"in l};function h(ne){return ne&&DataView.prototype.isPrototypeOf(ne)}if(g.arrayBuffer)var d=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],p=ArrayBuffer.isView||function(ne){return ne&&d.indexOf(Object.prototype.toString.call(ne))>-1};function x(ne){if(typeof ne!="string"&&(ne=String(ne)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(ne)||ne==="")throw new TypeError('Invalid character in header field name: "'+ne+'"');return ne.toLowerCase()}function T(ne){return typeof ne!="string"&&(ne=String(ne)),ne}function S(ne){var fe={next:function(){var Ne=ne.shift();return{done:Ne===void 0,value:Ne}}};return g.iterable&&(fe[Symbol.iterator]=function(){return fe}),fe}function v(ne){this.map={},ne instanceof v?ne.forEach(function(fe,Ne){this.append(Ne,fe)},this):Array.isArray(ne)?ne.forEach(function(fe){if(fe.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+fe.length);this.append(fe[0],fe[1])},this):ne&&Object.getOwnPropertyNames(ne).forEach(function(fe){this.append(fe,ne[fe])},this)}v.prototype.append=function(ne,fe){ne=x(ne),fe=T(fe);var Ne=this.map[ne];this.map[ne]=Ne?Ne+", "+fe:fe},v.prototype.delete=function(ne){delete this.map[x(ne)]},v.prototype.get=function(ne){return ne=x(ne),this.has(ne)?this.map[ne]:null},v.prototype.has=function(ne){return this.map.hasOwnProperty(x(ne))},v.prototype.set=function(ne,fe){this.map[x(ne)]=T(fe)},v.prototype.forEach=function(ne,fe){for(var Ne in this.map)this.map.hasOwnProperty(Ne)&&ne.call(fe,this.map[Ne],Ne,this)},v.prototype.keys=function(){var ne=[];return this.forEach(function(fe,Ne){ne.push(Ne)}),S(ne)},v.prototype.values=function(){var ne=[];return this.forEach(function(fe){ne.push(fe)}),S(ne)},v.prototype.entries=function(){var ne=[];return this.forEach(function(fe,Ne){ne.push([Ne,fe])}),S(ne)},g.iterable&&(v.prototype[Symbol.iterator]=v.prototype.entries);function R(ne){if(!ne._noBody){if(ne.bodyUsed)return Promise.reject(new TypeError("Already read"));ne.bodyUsed=!0}}function b(ne){return new Promise(function(fe,Ne){ne.onload=function(){fe(ne.result)},ne.onerror=function(){Ne(ne.error)}})}function E(ne){var fe=new FileReader,Ne=b(fe);return fe.readAsArrayBuffer(ne),Ne}function A(ne){var fe=new FileReader,Ne=b(fe),pe=/charset=([A-Za-z0-9_-]+)/.exec(ne.type),Te=pe?pe[1]:"utf-8";return fe.readAsText(ne,Te),Ne}function k(ne){for(var fe=new Uint8Array(ne),Ne=new Array(fe.length),pe=0;pe<fe.length;pe++)Ne[pe]=String.fromCharCode(fe[pe]);return Ne.join("")}function D(ne){if(ne.slice)return ne.slice(0);var fe=new Uint8Array(ne.byteLength);return fe.set(new Uint8Array(ne)),fe.buffer}function B(){return this.bodyUsed=!1,this._initBody=function(ne){this.bodyUsed=this.bodyUsed,this._bodyInit=ne,ne?typeof ne=="string"?this._bodyText=ne:g.blob&&Blob.prototype.isPrototypeOf(ne)?this._bodyBlob=ne:g.formData&&FormData.prototype.isPrototypeOf(ne)?this._bodyFormData=ne:g.searchParams&&URLSearchParams.prototype.isPrototypeOf(ne)?this._bodyText=ne.toString():g.arrayBuffer&&g.blob&&h(ne)?(this._bodyArrayBuffer=D(ne.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):g.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(ne)||p(ne))?this._bodyArrayBuffer=D(ne):this._bodyText=ne=Object.prototype.toString.call(ne):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof ne=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g.searchParams&&URLSearchParams.prototype.isPrototypeOf(ne)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},g.blob&&(this.blob=function(){var ne=R(this);if(ne)return ne;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var ne=R(this);return ne||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(g.blob)return this.blob().then(E);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var ne=R(this);if(ne)return ne;if(this._bodyBlob)return A(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(k(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(L)}),this.json=function(){return this.text().then(JSON.parse)},this}var M=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function ie(ne){var fe=ne.toUpperCase();return M.indexOf(fe)>-1?fe:ne}function he(ne,fe){if(!(this instanceof he))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');fe=fe||{};var Ne=fe.body;if(ne instanceof he){if(ne.bodyUsed)throw new TypeError("Already read");this.url=ne.url,this.credentials=ne.credentials,fe.headers||(this.headers=new v(ne.headers)),this.method=ne.method,this.mode=ne.mode,this.signal=ne.signal,!Ne&&ne._bodyInit!=null&&(Ne=ne._bodyInit,ne.bodyUsed=!0)}else this.url=String(ne);if(this.credentials=fe.credentials||this.credentials||"same-origin",(fe.headers||!this.headers)&&(this.headers=new v(fe.headers)),this.method=ie(fe.method||this.method||"GET"),this.mode=fe.mode||this.mode||null,this.signal=fe.signal||this.signal||function(){if("AbortController"in l){var K=new AbortController;return K.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&Ne)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(Ne),(this.method==="GET"||this.method==="HEAD")&&(fe.cache==="no-store"||fe.cache==="no-cache")){var pe=/([?&])_=[^&]*/;if(pe.test(this.url))this.url=this.url.replace(pe,"$1_="+new Date().getTime());else{var Te=/\?/;this.url+=(Te.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}he.prototype.clone=function(){return new he(this,{body:this._bodyInit})};function L(ne){var fe=new FormData;return ne.trim().split("&").forEach(function(Ne){if(Ne){var pe=Ne.split("="),Te=pe.shift().replace(/\+/g," "),K=pe.join("=").replace(/\+/g," ");fe.append(decodeURIComponent(Te),decodeURIComponent(K))}}),fe}function re(ne){var fe=new v,Ne=ne.replace(/\r?\n[\t ]+/g," ");return Ne.split("\r").map(function(pe){return pe.indexOf(`
`)===0?pe.substr(1,pe.length):pe}).forEach(function(pe){var Te=pe.split(":"),K=Te.shift().trim();if(K){var me=Te.join(":").trim();try{fe.append(K,me)}catch(Ie){console.warn("Response "+Ie.message)}}}),fe}B.call(he.prototype);function be(ne,fe){if(!(this instanceof be))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(fe||(fe={}),this.type="default",this.status=fe.status===void 0?200:fe.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=fe.statusText===void 0?"":""+fe.statusText,this.headers=new v(fe.headers),this.url=fe.url||"",this._initBody(ne)}B.call(be.prototype),be.prototype.clone=function(){return new be(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new v(this.headers),url:this.url})},be.error=function(){var ne=new be(null,{status:200,statusText:""});return ne.ok=!1,ne.status=0,ne.type="error",ne};var ue=[301,302,303,307,308];be.redirect=function(ne,fe){if(ue.indexOf(fe)===-1)throw new RangeError("Invalid status code");return new be(null,{status:fe,headers:{location:ne}})},c.DOMException=l.DOMException;try{new c.DOMException}catch{c.DOMException=function(fe,Ne){this.message=fe,this.name=Ne;var pe=Error(fe);this.stack=pe.stack},c.DOMException.prototype=Object.create(Error.prototype),c.DOMException.prototype.constructor=c.DOMException}function ke(ne,fe){return new Promise(function(Ne,pe){var Te=new he(ne,fe);if(Te.signal&&Te.signal.aborted)return pe(new c.DOMException("Aborted","AbortError"));var K=new XMLHttpRequest;function me(){K.abort()}K.onload=function(){var De={statusText:K.statusText,headers:re(K.getAllResponseHeaders()||"")};Te.url.indexOf("file://")===0&&(K.status<200||K.status>599)?De.status=200:De.status=K.status,De.url="responseURL"in K?K.responseURL:De.headers.get("X-Request-URL");var Oe="response"in K?K.response:K.responseText;setTimeout(function(){Ne(new be(Oe,De))},0)},K.onerror=function(){setTimeout(function(){pe(new TypeError("Network request failed"))},0)},K.ontimeout=function(){setTimeout(function(){pe(new TypeError("Network request timed out"))},0)},K.onabort=function(){setTimeout(function(){pe(new c.DOMException("Aborted","AbortError"))},0)};function Ie(De){try{return De===""&&l.location.href?l.location.href:De}catch{return De}}if(K.open(Te.method,Ie(Te.url),!0),Te.credentials==="include"?K.withCredentials=!0:Te.credentials==="omit"&&(K.withCredentials=!1),"responseType"in K&&(g.blob?K.responseType="blob":g.arrayBuffer&&(K.responseType="arraybuffer")),fe&&typeof fe.headers=="object"&&!(fe.headers instanceof v||l.Headers&&fe.headers instanceof l.Headers)){var Fe=[];Object.getOwnPropertyNames(fe.headers).forEach(function(De){Fe.push(x(De)),K.setRequestHeader(De,T(fe.headers[De]))}),Te.headers.forEach(function(De,Oe){Fe.indexOf(Oe)===-1&&K.setRequestHeader(Oe,De)})}else Te.headers.forEach(function(De,Oe){K.setRequestHeader(Oe,De)});Te.signal&&(Te.signal.addEventListener("abort",me),K.onreadystatechange=function(){K.readyState===4&&Te.signal.removeEventListener("abort",me)}),K.send(typeof Te._bodyInit>"u"?null:Te._bodyInit)})}return ke.polyfill=!0,l.fetch||(l.fetch=ke,l.Headers=v,l.Request=he,l.Response=be),c.Headers=v,c.Request=he,c.Response=be,c.fetch=ke,Object.defineProperty(c,"__esModule",{value:!0}),c})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var o=t.fetch?t:r;e=o.fetch,e.default=o.fetch,e.fetch=o.fetch,e.Headers=o.Headers,e.Request=o.Request,e.Response=o.Response,n.exports=e}(Jn,Jn.exports)),Jn.exports}var bh=_h();const vh=kn(bh);function Xt(n){return n||vh}const xa={"@type":"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"};class Cu{constructor(e){this.context=e,this.iriToKeyMap={},this.iriToKeyMap=this.createIriToKeyMap(e),this.typeNameToIriToKeyMap={},Object.entries(e).forEach(([t,r])=>{typeof r=="object"&&r!==null&&r["@id"]&&r["@context"]&&(this.typeNameToIriToKeyMap[t]=this.createIriToKeyMap(r["@context"]))})}createIriToKeyMap(e){const t={};return Object.entries(e).forEach(([r,o])=>{if(typeof o=="string")t[this.keyIdToIri(o)]=r;else if(typeof o=="object"&&o!==null&&o["@id"]){const u=this.keyIdToIri(o["@id"]);t[u]=r}}),t}getRelevantContext(e,t){for(const r of t){const o=this.iriToKey(r.value,[]);if(typeof this.context[o]=="object"&&this.context[o]?.["@context"]&&this.context[o]?.["@context"][e])return this.context[o]?.["@context"]}return this.context}keyIdToIri(e){return xa[e]?xa[e]:e}keyToIri(e,t){const r=this.getRelevantContext(e,t);if(r[e]){if(typeof r[e]=="string")return this.keyIdToIri(r[e]);if(r[e]&&r[e]["@id"])return this.keyIdToIri(r[e]["@id"])}else return e;return e}iriToKey(e,t){let r=this.iriToKeyMap;for(const o of t){const u=this.iriToKey(o.value,[]);r=this.typeNameToIriToKeyMap[u]?.[e]?this.typeNameToIriToKeyMap[u]:this.iriToKeyMap}return r[e]?r[e]:e}getDataType(e,t){const r=this.getRelevantContext(e,t);return typeof r[e]=="object"&&r[e]["@type"]?r[e]["@type"]:"http://www.w3.org/2001/XMLSchema#string"}isSet(e,t){const r=this.getRelevantContext(e,t);return!!(r[e]&&typeof r[e]=="object"&&(r[e]["@container"]==="@set"||r[e]["@isCollection"]))}isLangString(e,t){const r=this.getRelevantContext(e,t);return!!(r[e]&&typeof r[e]=="object"&&r[e]["@type"]&&r[e]["@type"]==="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString")}}class An{constructor(e){this.proxyContext=e}write(...e){return new An(this.proxyContext.duplicate({writeGraphs:e}))}setLanguagePreferences(...e){return new An(this.proxyContext.duplicate({languageOrdering:e}))}fromSubject(e){return this.proxyContext.createSubjectProxy(e)}matchSubject(e,t,r){return this.proxyContext.createSetProxy([null,e,t,r],!0)}matchObject(e,t,r){return this.proxyContext.createSetProxy([e,t,null,r])}fromJson(e){const t=e["@id"]?st(e["@id"]):ii(),r=this.fromSubject(t);return Object.entries(e).forEach(([o,u])=>{r[o]=u}),r}}const lr=Symbol("_getUnderlyingNode"),Sh=Symbol("_getUnderlyingMatch"),ku=Symbol("_isSubjectOriented"),Ln=Symbol("_getUnderlyingDataset"),Ht=Symbol("_proxyContext"),zs=Symbol("_writeGraphs");function li(n,e){return n[lr]?n[lr]:n["@id"]?typeof n["@id"]=="string"?st(e.keyToIri(n["@id"],[])):n["@id"]:ii()}function Nu(n,e,t){if(n!=null)return typeof n=="string"||typeof n=="boolean"||typeof n=="number"?t?t==="@id"?st(n.toString()):cu(n.toString(),t):void 0:typeof n.termType=="string"&&(n.termType==="NamedNode"||n.termType==="BlankNode")?n:li(n,e.contextUtil)}function Qs(n){if(!n||typeof n!="object")return!1;const e=n;return!(typeof e[zs]!="object"||typeof e[Ln]!="object"||typeof e[lr]!="object"||typeof e[Ht]!="object")}function Eh(n){const e=n;if(!Qs(e))throw new Error(`${n} is not a Jsonld Dataset Proxy Subject`);return e}function Hr(n){if(n==null)return"null";switch(n.termType){case"NamedNode":return`namedNode(${n.value})`;case"BlankNode":return`blankNode(${n.value})`;case"Literal":return`literal(${n.value},${n.datatype.value})`;case"DefaultGraph":return"defaultGraph()"}}class xh{constructor(){this.set=new Set,this.map={}}add(e){const t=Hr(e);this.set.add(t),this.map[t]=e}has(e){return this.set.has(Hr(e))}}function Fh(n,e,t,r){const o=Uu(r);return n.match(e,t).filter(u=>Du(u.object)&&u.object.language===o)}function Rh(n,e,t,r){Fh(n,e,t,r).forEach(u=>{n.delete(u)})}function Du(n){return n.termType==="Literal"&&(n.datatype.value==="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"||n.datatype.value==="http://www.w3.org/2001/XMLSchema#string")}function Th(n){const e={};return n.forEach(t=>{const r=t.object;if(Du(r)){const o=Ah(r.language);e[o]||(e[o]=qr()),e[o].add(t)}}),e}function Lu(n,e){const t=Th(n),r=new Set(e),o=new Set(Object.keys(t));for(const u of e){if(o.has(u))return t[u];if(u==="@other"){for(const c of o)if(!r.has(c))return t[c]}}return qr()}function ju(n){return n.find(e=>e!=="@other")}function Uu(n){return n==="@none"?"":n}function Ah(n){return n===""?"@none":n}class tr{constructor(e){if(this.hashMap=new Map,e)for(const t of e)this.add(t)}hashFn(e){return typeof e!="object"?e.toString():e[lr]?e[lr].value:e["@id"]?typeof e["@id"]=="string"?e["@id"]:e["@id"].value:ii().value}add(e){const t=this.hashFn(e);return this.hashMap.has(t)||this.hashMap.set(t,e),this}clear(){this.hashMap.clear()}delete(e){const t=this.hashFn(e);return this.hashMap.delete(t)}has(e){const t=this.hashFn(e);return this.hashMap.has(t)}get size(){return this.hashMap.size}*entries(){for(const[,e]of this.hashMap.entries())yield[e,e]}keys(){return this.hashMap.values()}values(){return this.hashMap.values()}[Symbol.iterator](){return this.hashMap.values()}get[Symbol.toStringTag](){return"BasicLdSet"}every(e,t){for(const r of this)if(!e.call(t,r,this))return!1;return!0}some(e,t){for(const r of this)if(e.call(t,r,this))return!0;return!1}forEach(e,t){for(const r of this)e.call(t,r,r,this)}map(e,t){const r=[];for(const o of this)r.push(e.call(t,o,this));return r}filter(e,t){const r=new tr;for(const o of this)e.call(t,o,this)&&r.add(o);return r}reduce(e,t){const r=this[Symbol.iterator]();let o;if(t===void 0){const c=r.next();if(c.done)throw new TypeError("Reduce of empty collection with no initial value");o=c.value}else o=t;let u=r.next();for(;!u.done;)o=e(o,u.value,this),u=r.next();return o}toArray(){const e=[];return this.forEach(t=>e.push(t)),e}toJSON(){return this.toArray()}difference(e){return this.filter(t=>!e.has(t))}intersection(e){const t=new tr,r=this.size<e.size?this:e,o=this.size<e.size?e:this;for(const u of r)o.has(u)&&t.add(u);return t}isDisjointFrom(e){const t=this.size<e.size?this:e,r=this.size<e.size?e:this;for(const o of t)if(r.has(o))return!1;return!0}isSubsetOf(e){if(this.size>e.size)return!1;for(const t of this)if(!e.has(t))return!1;return!0}isSupersetOf(e){if(this.size<e.size)return!1;for(const t of e)if(!this.has(t))return!1;return!0}symmetricDifference(e){const t=new tr;return this.forEach(r=>t.add(r)),e.forEach(r=>{t.has(r)?t.delete(r):t.add(r)}),t}union(e){const t=new tr;return this.forEach(r=>t.add(r)),e.forEach(r=>t.add(r)),t}}function Fa(n,e,t,r,o,u){const{dataset:c,contextUtil:l}=u,g=u.getRdfType(n),h=st(l.keyToIri(e,g)),d=Nu(t,u,l.getDataType(e,g));if(d==null)c.deleteMatches(n,h);else if(d.termType==="Literal"){let p=d;if(l.isLangString(e,g)){const x=ju(u.languageOrdering);if(!x)return;p=cu(d.value,Uu(x))}u.writeGraphs.forEach(x=>{u.dataset.add(Pt(n,h,p,x))})}else if(u.writeGraphs.forEach(p=>{c.add(Pt(n,h,d,p))}),!Qs(t)){const p=typeof t=="object"?{...t,"@id":d}:{"@id":d};Ou(p,r,o,u)}}function Ou(n,e,t,r){const{dataset:o}=r,u=li(n,r.contextUtil),c=r.getRdfType(u);return e.has(u)||(e.add(u),Object.entries(n).forEach(([l,g])=>{if(l==="@id")return;const h=st(r.contextUtil.keyToIri(l,c));if(t)if(r.contextUtil.isLangString(l,c)){const d=ju(r.languageOrdering);d&&Rh(o,u,h,d)}else o.deleteMatches(u,h);g instanceof tr?g.forEach(d=>{Fa(u,l,d,e,!0,r)}):Fa(u,l,g,e,!0,r)})),r.createSubjectProxy(u)}function In(n,e,t){return Ou(n,new xh,e,t)}function Ih(n,e,t){if(e==="@context"||e==="toString"||e===Symbol.toStringTag||typeof e=="symbol")return!0;if(e==="@id"){const r=n["@id"];return t.dataset.deleteMatches(r,void 0,void 0),t.dataset.deleteMatches(void 0,void 0,r),!0}return In({"@id":n["@id"],[e]:void 0},!0,t),!0}function Ph(n){switch(n.datatype.value){case"http://www.w3.org/2001/XMLSchema#string":case"http://www.w3.org/2001/XMLSchema#ENTITIES":case"http://www.w3.org/2001/XMLSchema#ENTITY":case"http://www.w3.org/2001/XMLSchema#ID":case"http://www.w3.org/2001/XMLSchema#IDREF":case"http://www.w3.org/2001/XMLSchema#IDREFS":case"http://www.w3.org/2001/XMLSchema#language":case"http://www.w3.org/2001/XMLSchema#Name":case"http://www.w3.org/2001/XMLSchema#NCName":case"http://www.w3.org/2001/XMLSchema#NMTOKEN":case"http://www.w3.org/2001/XMLSchema#NMTOKENS":case"http://www.w3.org/2001/XMLSchema#normalizedString":case"http://www.w3.org/2001/XMLSchema#QName":case"http://www.w3.org/2001/XMLSchema#token":return n.value;case"http://www.w3.org/2001/XMLSchema#date":case"http://www.w3.org/2001/XMLSchema#dateTime":case"http://www.w3.org/2001/XMLSchema#duration":case"http://www.w3.org/2001/XMLSchema#gDay":case"http://www.w3.org/2001/XMLSchema#gMonth":case"http://www.w3.org/2001/XMLSchema#gMonthDay":case"http://www.w3.org/2001/XMLSchema#gYear":case"http://www.w3.org/2001/XMLSchema#gYearMonth":case"http://www.w3.org/2001/XMLSchema#time":return n.value;case"http://www.w3.org/2001/XMLSchema#integer":case"http://www.w3.org/2001/XMLSchema#byte":case"http://www.w3.org/2001/XMLSchema#decimal":case"http://www.w3.org/2001/XMLSchema#double":case"http://www.w3.org/2001/XMLSchema#int":case"http://www.w3.org/2001/XMLSchema#long":case"http://www.w3.org/2001/XMLSchema#negativeInteger":case"http://www.w3.org/2001/XMLSchema#nonNegativeInteger":case"http://www.w3.org/2001/XMLSchema#nonPositiveInteger":case"http://www.w3.org/2001/XMLSchema#positiveInteger":case"http://www.w3.org/2001/XMLSchema#short":case"http://www.w3.org/2001/XMLSchema#unsignedLong":case"http://www.w3.org/2001/XMLSchema#unsignedInt":case"http://www.w3.org/2001/XMLSchema#unsignedShort":case"http://www.w3.org/2001/XMLSchema#unsignedByte":return parseFloat(n.value);case"http://www.w3.org/2001/XMLSchema#boolean":return n.value==="true";case"http://www.w3.org/2001/XMLSchema#hexBinary":return n.value;case"http://www.w3.org/2001/XMLSchema#anyURI":return n.value;case"http://www.w3.org/1999/02/22-rdf-syntax-ns#HTML":case"http://www.w3.org/1999/02/22-rdf-syntax-ns#PlainLiteral":case"http://www.w3.org/1999/02/22-rdf-syntax-ns#XMLLiteral":case"http://www.w3.org/1999/02/22-rdf-syntax-ns#JSON":return n.value;default:return n.value}}function Bu(n,e){if(n.termType==="Literal")return Ph(n);if(n.termType==="NamedNode"||n.termType==="BlankNode")return e.createSubjectProxy(n);throw new Error("Can only convert NamedNodes or Literals or BlankNodes")}function Ra(n,e,t){const{contextUtil:r,dataset:o}=t;if(e==="@id")return n["@id"].termType==="BlankNode"?void 0:r.iriToKey(n["@id"].value,[]);if(e==="toString"||e===Symbol.toStringTag)return Reflect.get(n,"toString");if(typeof e=="symbol")return;const u=n["@id"],c=t.getRdfType(u),l=st(r.keyToIri(e,c));if(r.isSet(e,c))return t.createSetProxy([u,l,null,null],!1,r.isLangString(e,c));let g=o.match(u,l);if(r.isLangString(e,c)&&(g=Lu(g,t.languageOrdering)),g.size!==0)return Bu(g.toArray()[0].object,t)}function Mu(n){let e=n;return{get(t,r){switch(r){case Ln:return e.dataset;case lr:return t["@id"];case Ht:return e;case zs:return e.writeGraphs;case"@context":return e.contextUtil.context}return Ra(t,r,e)},getOwnPropertyDescriptor(t,r){return{value:Ra(t,r,e),writable:!0,enumerable:!0,configurable:!0}},ownKeys(t){const r=t["@id"],o=e.dataset.match(r),u=new Set(["@id"]);return o.toArray().forEach(c=>{u.add(e.contextUtil.iriToKey(c.predicate.value,e.getRdfType(r)))}),Array.from(u)},set:(t,r,o)=>{if(r===Ht)return e=o,!0;if(r==="@id"&&(typeof o=="string"||typeof o>"u")){const u=o?st(o):ii(),c=e.dataset.match(t["@id"]).toArray(),l=c.map(d=>Pt(u,d.predicate,d.object,d.graph));c.forEach(d=>e.dataset.delete(d)),e.dataset.addAll(l);const g=e.dataset.match(void 0,void 0,t["@id"]).toArray(),h=g.map(d=>Pt(d.subject,d.predicate,u,d.graph));g.forEach(d=>e.dataset.delete(d)),e.dataset.addAll(h),t["@id"]=u}return In({"@id":t["@id"],[r]:o},!0,e),!0},deleteProperty(t,r){return Ih(t,r,e)}}}class Ys extends tr{constructor(e,t){super(),this.context=e,this.quadMatch=t}add(e){return console.warn(`You've attempted to call "add" on a wildcard set. You cannot add data to a wildcard set as it is simply a proxy to an underlying dataset`),this}clear(){console.warn(`You've attempted to call "clear" on an abstract set. You cannot clear data from an abstract set as it is simply a proxy to an underlying dataset`)}delete(e){return console.warn(`You've attempted to call "clear" on an abstract set. You cannot delete data from an abstract set as it is simply a proxy to an underlying dataset`),!1}has(e){return this.getQuads(e).size>0}get size(){return this.getQuads().size}entries(){const e=new Set;for(const t of this)e.add([t,t]);return e[Symbol.iterator]()}keys(){return this.values()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){const t=this.getQuads().toArray().map(r=>{const o=this.getNodeOfFocus(r);return Bu(o,this.context)});return new Set(t)[Symbol.iterator]()}get[Symbol.toStringTag](){return"LdSet"}get[Ln](){return this.context.dataset}get[Sh](){return this.quadMatch}get[Ht](){return this.context}set[Ht](e){this.context=e}get[zs](){return this.context.writeGraphs}}class Hu extends Ys{constructor(e,t,r){super(e,t),this.quadMatch=t,this.isLangStringSet=r??!1}getQuads(e){const{dataset:t}=this.context;let r;const o=this.quadMatch[0]??void 0,u=this.quadMatch[1]??void 0,c=this.quadMatch[3]??void 0;if(e){let l;if(this.quadMatch[0]&&u){const h=this.context.getRdfType(this.quadMatch[0]),d=this.context.contextUtil.iriToKey(u.value,h);l=this.context.contextUtil.getDataType(d,h)}const g=Nu(e,this.context,l);r=t.match(o,u,g,c),g||(r=r.filter(h=>h.object.termType==="Literal"&&h.object.value===e))}else r=t.match(o,u,void 0,c);return this.isLangStringSet?Lu(r,this.context.languageOrdering):r}getNodeOfFocus(e){return e.object}get[ku](){return!1}}class Ch extends Hu{constructor(e,t,r){super(e,t,r),this.quadMatch=t}add(e){return In({"@id":this.quadMatch[0],[this.context.contextUtil.iriToKey(this.quadMatch[1].value,this.context.getRdfType(this.quadMatch[0]))]:e},!1,this.context),this}clear(){for(const e of this)this.delete(e)}delete(e){const{dataset:t}=this.context,r=this.getQuads(e);return r.forEach(o=>t.delete(o)),r.size>0}}class Ku extends Ys{constructor(e,t){super(e,t),this.quadMatch=t}getQuads(e){const{dataset:t}=this.context,r=this.quadMatch[1],o=this.quadMatch[2],u=this.quadMatch[3];if(e){const c=li(e,this.context.contextUtil);return t.match(c,r,o,u)}return t.match(void 0,r,o,u)}getNodeOfFocus(e){return e.subject}get[ku](){return!0}}class kh extends Ku{constructor(e,t){super(e,t),this.quadMatch=t}add(e){if(typeof e!="object")throw new Error(`Cannot add a literal "${e}"(${typeof e}) to a subject-oriented collection.`);const t=new Js(this.context.dataset,Ws(),Gs());if(In(e,!1,this.context.duplicate({writeGraphs:[si()]})),!(t.match(li(e,this.context.contextUtil),this.quadMatch[1],this.quadMatch[2]).size!==0))throw new Error(`Cannot add value to collection. This must contain a quad that matches (${Hr(this.quadMatch[0])}, ${Hr(this.quadMatch[1])}, ${Hr(this.quadMatch[2])}, ${Hr(this.quadMatch[3])})`);const u=In(e,!1,this.context)[lr];return this.context.writeGraphs.forEach(c=>{this.context.dataset.add(Pt(u,this.quadMatch[1],this.quadMatch[2],c))}),this}}function qu(n,e,t,r){return e?n[1]&&n[2]?new kh(t,n):new Ku(t,n):n[0]&&n[1]?new Ch(t,n,r):new Hu(t,n,r)}const Nh=st("http://www.w3.org/1999/02/22-rdf-syntax-ns#type");class hi{constructor(e){this.subjectMap=new Map,this.setMap=new Map,this.dataset=e.dataset,this.contextUtil=e.contextUtil,this.writeGraphs=e.writeGraphs,this.languageOrdering=e.languageOrdering,this.state=e.state||{}}createSubjectProxy(e){if(!this.subjectMap.has(e.value)){const t=this.createNewSubjectProxy(e);this.subjectMap.set(e.value,t)}return this.subjectMap.get(e.value)}createNewSubjectProxy(e){return new Proxy({"@id":e},Mu(this))}getSetKey(...e){return`${e[0]?.value||"undefined"}|${e[1]?.value||"undefined"}|${e[2]?.value||"undefined"}|${e[3]?.value||"undefined"}`}createSetProxy(e,t,r){const o=this.getSetKey(...e);if(!this.setMap.has(o)){const u=this.createNewSetProxy(e,t,r);this.setMap.set(o,u)}return this.setMap.get(o)}createNewSetProxy(e,t,r){return qu(e,t??!1,this,r)}duplicate(e){const t={dataset:this.dataset,contextUtil:this.contextUtil,writeGraphs:this.writeGraphs,languageOrdering:this.languageOrdering,...e};return new hi(t)}getRdfType(e){return this.dataset.match(e,Nh).toArray().map(t=>t.object).filter(t=>t.termType==="NamedNode")}}function fi(n,e){const t=new Cu(e),r=new hi({dataset:n,contextUtil:t,writeGraphs:[si()],languageOrdering:["none","en","other"]});return new An(r)}function Dh(n){return!n||typeof n!="object"?!1:n instanceof Ys}function Lh(n){return Qs(n)||Dh(n)}function Xs(n){if(!Lh(n))throw new Error(`${n} is not a Jsonld Dataset Proxy`);return n}function jh(n,e){return{using(...t){const r=[];return t.forEach(o=>{const u=Xs(o),c=u[Ht];u[Ht]=u[Ht].duplicate({[n]:e}),r.push(()=>{u[Ht]=c})}),function(){r.forEach(u=>u())}},usingCopy(...t){return t.map(r=>{const o=Eh(r);return o[Ht].duplicate({[n]:e}).createSubjectProxy(o[lr])})}}}function Uh(...n){return jh("writeGraphs",n)}function ar(n){return typeof n=="string"?st(n):n}function Wu(n){return n.map(e=>ar(e))}function Oh(n){return typeof n.startTransaction=="function"}class Rr{constructor(e,t){this.jsonldDatasetProxyBuilder=e,this.shapeType=t}fromSubject(e){return this.jsonldDatasetProxyBuilder.fromSubject(ar(e))}matchSubject(e,t,r){return this.jsonldDatasetProxyBuilder.matchSubject(e!=null?ar(e):void 0,t!=null?ar(t):void 0,r!=null?ar(r):void 0)}matchObject(e,t,r){return this.jsonldDatasetProxyBuilder.matchObject(e!=null?ar(e):void 0,t!=null?ar(t):void 0,r!=null?ar(r):void 0)}fromJson(e){return this.jsonldDatasetProxyBuilder.fromJson(e)}write(...e){return new Rr(this.jsonldDatasetProxyBuilder.write(...Wu(e)),this.shapeType)}setLanguagePreferences(...e){return new Rr(this.jsonldDatasetProxyBuilder.setLanguagePreferences(...e),this.shapeType)}}class $u extends Js{usingType(e){const t=fi(this,e.context);return new Rr(t,e)}}class Vu extends Vs{usingType(e){const t=fi(this,e.context);return new Rr(t,e)}startTransaction(){return new $u(this,this.datasetFactory,this.transactionDatasetFactory)}}class Bh extends gh{dataset(e){return new Vu(this.datasetFactory,this.transactionDatasetFactory,this.datasetFactory.dataset(e))}}function Ju(){const n={dataset:e=>qr(e)};return new Bh(n,Gs())}function Gu(n){return Ju().dataset(n)}async function Mh(n,e){const t=Ju();return typeof n=="string"?await va(t,n,e):typeof n.add=="function"?Gu(n):await va(t,JSON.stringify(n),{format:"application/ld+json"})}function Hh(...n){return Uh(...Wu(n))}function zu(n){const e=Xs(n),t=e[Ln];if(!Oh(t))throw new Error("Object is not transactable.");e[Ht]=e[Ht].duplicate({dataset:t.startTransaction(),state:{parentDataset:t}})}function Kh(n){return Xs(n)[Ln]}function qh(n,e){const t=Mu(n),r=t.get,o=(u,c,l)=>{const g=u["@id"],h=n.getRdfType(g);if(typeof c!="symbol"){if(c==="@id")n.addListener([g,null,null,null]);else if(!n.contextUtil.isSet(c,h)){const d=st(n.contextUtil.keyToIri(c,h));n.addListener([g,d,null,null])}}return r&&r(u,c,l)};return t.get=o,t.set=()=>(console.warn("You've attempted to set a value on a Linked Data Object from the useSubject, useMatchingSubject, or useMatchingObject hooks. These linked data objects should only be used to render data, not modify it. To modify data, use the `changeData` function."),!0),new Proxy({"@id":e},t)}function Wh(n,e,t,r){const o=qu(e,t??!1,n,r);return new Proxy(o,{get:(u,c,l)=>($h.has(c)?n.addListener(e):Vh.has(c)&&console.warn("You've attempted to modify a value on a Linked Data Object from the useSubject, useMatchingSubject, or useMatchingObject hooks. These linked data objects should only be used to render data, not modify it. To modify data, use the `changeData` function."),Reflect.get(u,c,l))})}const $h=new Set(["has","size","entries","keys","values",Symbol.iterator,"every","every","some","forEach","map","reduce","toArray","toJSON","difference","intersection","isDisjointFrom","isSubsetOf","isSupersetOf","symmetricDifference","union"]),Vh=new Set(["add","clear","delete"]);class Jh extends hi{constructor(e,t){super(e),this.subscribableDataset=e.dataset,this.listener=t}addListener(e){this.subscribableDataset.listeners(e).includes(this.listener)||this.subscribableDataset.on(e,this.listener)}createNewSubjectProxy(e){return qh(this,e)}createNewSetProxy(e,t,r){return Wh(this,e,t,r)}}function Qu(n,e,t){const r=new Cu(e.context),o=new Jh({dataset:n,contextUtil:r,writeGraphs:[si()],languageOrdering:["none","en","other"]},t);return new Rr(new An(o),e)}async function Ta(n,e,t,r,o,u){if((u?.shouldRefreshResources?await t.read():await t.readIfUnfetched()).isError)return;u?.onResourceEncountered&&await u?.onResourceEncountered(t);const g=(u?.onCoveredDataChanged?Qu(n,e,u?.onCoveredDataChanged):n.usingType(e)).fromSubject(r),h=new Set([t.uri]);await Fs(n,g,o,h,u)}async function Fs(n,e,t,r,o){const u=Gh(n,e,t,r),c=n.getResource(e["@id"]);u&&(o?.shouldRefreshResources?await c.read():await c.readIfUnfetched()).isError||(r.has(c.uri)||(r.add(c.uri),o?.onResourceEncountered&&await o.onResourceEncountered(c)),await Promise.all(Object.entries(t).map(async([l,g])=>{g!=null&&g!==!0&&e[l]!=null&&(e[l]instanceof tr?await Promise.all(e[l].map(async h=>{await Fs(n,h,g,r,o)})):await Fs(n,e[l],g,r,o))})))}function Gh(n,e,t,r){const o=e["@id"];if(!o)return!1;const u=n.getResource(o);return r.has(u.uri)?!1:Object.entries(t).some(([c,l])=>l?e[c]instanceof tr||e[c]==null:!1)}class zh{constructor(e,t,r,o,u,c){this.parentDataset=e,this.shapeType=t,this.ldoBuilder=r,this.startingResource=o,this.startingSubject=u,this.linkQueryInput=c,this.previousTransactionId="INIT",this.activeResourceSubscriptions={},this.thisUnsubscribeIds=new Set,this.resourcesWithSubscriptionInProgress={}}async run(e){return await Ta(this.parentDataset,this.shapeType,this.startingResource,this.startingSubject,this.linkQueryInput,{shouldRefreshResources:e?.reload}),this.fromSubject()}async subscribe(){const e=Ar();return this.thisUnsubscribeIds.add(e),this.curOnDataChanged||(this.curOnDataChanged=async(t,r,o)=>{if(r===this.previousTransactionId)return;this.previousTransactionId=r,this.parentDataset.removeListenerFromAllEvents(this.curOnDataChanged);const u=new Set(Object.keys(this.activeResourceSubscriptions)),c=this.curOnDataChanged?{onCoveredDataChanged:this.curOnDataChanged,onResourceEncountered:async l=>{if(this.resourcesWithSubscriptionInProgress[l.uri]){await this.resourcesWithSubscriptionInProgress[l.uri],u.delete(l.uri);return}if(u.has(l.uri)){u.delete(l.uri);return}let g;this.resourcesWithSubscriptionInProgress[l.uri]=new Promise(d=>{g=d});const h=await l.subscribeToNotifications();this.activeResourceSubscriptions[l.uri]=h,this.curOnDataChanged||await this.unsubscribeFromResource(l.uri),g(),this.resourcesWithSubscriptionInProgress[l.uri]=void 0}}:{};await Ta(this.parentDataset,this.shapeType,this.startingResource,this.startingSubject,this.linkQueryInput,c),await Promise.all(Array.from(u).map(async l=>this.unsubscribeFromResource(l)))},await this.curOnDataChanged({},"BEGIN_SUB",[null,null,null,null])),e}async unsubscribeFromResource(e){const t=this.parentDataset.getResource(e),r=this.activeResourceSubscriptions[e];delete this.activeResourceSubscriptions[e],await t.unsubscribeFromNotifications(r)}async fullUnsubscribe(){this.curOnDataChanged&&(this.parentDataset.removeListenerFromAllEvents(this.curOnDataChanged),this.curOnDataChanged=void 0),await Promise.all(Object.keys(this.activeResourceSubscriptions).map(async e=>{this.unsubscribeFromResource(e)}))}async unsubscribe(e){this.thisUnsubscribeIds.delete(e),this.thisUnsubscribeIds.size===0&&await this.fullUnsubscribe()}async unsubscribeAll(){this.thisUnsubscribeIds.clear(),await this.fullUnsubscribe()}fromSubject(){return this.ldoBuilder.fromSubject(this.startingSubject)}getSubscribedResources(){return Object.keys(this.activeResourceSubscriptions).map(e=>this.parentDataset.getResource(e))}}class Yu extends Rr{constructor(e,t,r){super(t,r),this.parentDataset=e}startLinkQuery(e,t,r){return new zh(this.parentDataset,this.shapeType,this,e,t,r)}}class Xu extends Error{constructor(e){super(e||"An unkown error was encountered."),this.isError=!0}}class fr extends Xu{constructor(e,t){super(t||`An unkown error for ${e.uri}`),this.uri=e.uri,this.resource=e}}class Pn extends Xu{constructor(e,t){const r=[];e.forEach(o=>{o instanceof Pn?o.errors.forEach(u=>{r.push(u)}):r.push(o)}),super(t||`Encountered multiple errors:${r.reduce((o,u)=>`${o}
${u}`,"")}`),this.type="aggregateError",this.errors=r}}class Ot extends fr{constructor(e,t){super(e,t.message),this.type="unexpectedResourceError",this.error=t}static fromThrown(e,t){return t instanceof Error?new Ot(e,t):typeof t=="string"?new Ot(e,new Error(t)):new Ot(e,new Error(`Error of type ${typeof t} thrown: ${t}`))}}class Qh extends fr{constructor(e,t){super(e,t||`${e.uri} is an invalid uri.`),this.type="invalidUriError"}}class Yh extends $s{constructor(e){super(),this.type="InvalidIdentifierResouce",this.isError=!1,this.uri=e,this.status=new Qh(this)}isLoading(){return!1}isFetched(){return!1}isUnfetched(){return!0}isDoingInitialFetch(){return!1}isPresent(){return!1}isAbsent(){return!0}isSubscribedToNotifications(){return!1}async read(){return this.status}async readIfUnfetched(){return this.status}async update(){return this.status}async subscribeToNotifications(e){throw new Error("Cannot subscribe to an invalid resource.")}async unsubscribeFromNotifications(e){}async unsubscribeFromAllNotifications(){}}function Aa(n){return n.termType==="DefaultGraph"?"defaultGraph()":n.value}function Xh(n){return n==="defaultGraph()"?si():st(n)}function Zh(n){const e={};n.added?.forEach(r=>{const o=Aa(r.graph);e[o]||(e[o]={}),e[o].added||(e[o].added=qr()),e[o].added?.add(Pt(r.subject,r.predicate,r.object,r.graph))}),n.removed?.forEach(r=>{const o=Aa(r.graph);e[o]||(e[o]={}),e[o].removed||(e[o].removed=qr()),e[o].removed?.add(Pt(r.subject,r.predicate,r.object,r.graph))});const t=new Map;return Object.entries(e).forEach(([r,o])=>{t.set(Xh(r),o)}),t}class di{constructor(){this.isError=!1}}class Jt extends di{constructor(e){super(),this.uri=e.uri,this.resource=e}}class ef extends di{constructor(e){super(),this.type="aggregateSuccess",this.results=e}}class tf extends Jt{constructor(){super(...arguments),this.type="updateSuccess"}}class rf extends di{constructor(){super(...arguments),this.type="updateDefaultGraphSuccess"}}class nf extends Jt{constructor(){super(...arguments),this.type="ignoredInvalidUpdateSuccess"}}class Zs extends $u{constructor(e,t,r,o){super(e,r,o),this.resourceMap=new Map,this.context=t}getResource(e,t){return this.context.dataset.getResource(e,t)}getResources(){return this.context.dataset.getResources()}getFetchedResources(){return this.context.dataset.getFetchedResources()}createResource(e){return this.context.dataset.createResource(e)}setContext(e,t){this.context.dataset.setContext(e,t)}forgetResource(e){return this.context.dataset.forgetResource(e)}forgetAllResources(){this.context.dataset.forgetAllResources()}startTransaction(){return new Zs(this,this.context,this.datasetFactory,this.transactionDatasetFactory)}async commitToRemote(){const e=this.getChanges(),t=Zh(e),r=await Promise.all(Array.from(t.entries()).map(async([u,c])=>{if(u.termType==="DefaultGraph")return Pu(this.parentDataset,c),[u,c,new rf];const g=await this.getResource(u.value).update(c);return[u,c,g]})),o=r.map(u=>u[2]).filter(u=>u.isError);return o.length>0?new Pn(o):{isError:!1,type:"aggregateSuccess",results:r.map(u=>u[2])}}usingType(e){const t=fi(this,e.context);return new Yu(this,t,e)}}class sf extends Vu{constructor(e,t,r,o){super(t,r,o),this.plugins=e,this.resourceMap=new Map,this.context={dataset:this},this.plugins.forEach(u=>this.context[u.name]=u.initialContext)}getValidPlugin(e,t){const r=this.plugins.filter(o=>o.isUriValid(e)).filter(o=>t?t===o.name:!0);if(r.length!==0){if(r.length>1)throw new Error("LDO Connect does not currently support two plugins with overlappng uris");return r[0]}}getResource(e,t){const r=this.getValidPlugin(e,t);if(!r)return new Yh(e);const o=r.normalizeUri?.(e)??e;let u=this.resourceMap.get(o);return u||(u=r.getResource(e,this.context),this.resourceMap.set(o,u)),u}getResources(){return Array.from(this.resourceMap.values())}getFetchedResources(){return this.getResources().filter(e=>e.isFetched())}async createResource(e,t){const o=await this.plugins.find(u=>e===u.name).createResource(this.context,t);return o.isError||this.resourceMap.set(o.uri,o),o}forgetResource(e){const r=this.getValidPlugin(e)?.normalizeUri?.(e)??e;return this.resourceMap.delete(r)}forgetAllResources(){this.resourceMap.clear()}createData(e,t,r,...o){const u=[r,...o],c=this.usingType(e).write(...u.map(l=>l.uri)).fromSubject(t);return zu(c),c}setContext(e,t){this.context[e]={...this.context[e],...t}}usingType(e){const t=fi(this,e.context);return new Yu(this,t,e)}startTransaction(){return new Zs(this,this.context,this.datasetFactory,this.transactionDatasetFactory)}}function of(n,e,...t){const r=[e,...t],[o]=Hh(...r.map(u=>u.uri)).usingCopy(n);return zu(o),o}function af(n){return new sf(n,Ws(),Gs())}class Zu extends Jt{constructor(){super(...arguments),this.type="unfetched"}}class pi extends Jt{constructor(e,t){super(e),this.recalledFromMemory=t}}class ec extends pi{constructor(){super(...arguments),this.type="absentReadSuccess"}}class uf{constructor(e,t,r){this.subscriptions={},this.isOpen=!1,this.resource=e,this.parentSubscription=t,this.context=r}isSubscribedToNotifications(){return this.isOpen}async subscribeToNotifications(e){const t=Ar();return this.subscriptions[t]=e??{},this.isOpen||(await this.open(),this.setIsOpen(!0)),t}async unsubscribeFromNotification(e){this.subscriptions[e]&&Object.keys(this.subscriptions).length===1&&(await this.close(),this.setIsOpen(!1)),delete this.subscriptions[e]}async unsubscribeFromAllNotifications(){await Promise.all(Object.keys(this.subscriptions).map(e=>this.unsubscribeFromNotification(e)))}onNotification(e){this.parentSubscription(e),Object.values(this.subscriptions).forEach(({onNotification:t})=>{t?.(e)})}onNotificationError(e){Object.values(this.subscriptions).forEach(({onNotificationError:t})=>{t?.(e)}),e.type==="disconnectedNotAttemptingReconnectError"&&this.setIsOpen(!1)}setIsOpen(e){const t=e!==this.isOpen;this.isOpen=e,t&&this.resource.emit("update")}}class Tt extends fr{constructor(e,t,r){super(e,r||`Request for ${e.uri} returned ${t.status} (${t.statusText}).`),this.status=t.status,this.headers=t.headers,this.response=t}static isnt(e){return!(e.status>=200&&e.status<300)&&e.status!==404&&e.status!==304}static checkResponse(e,t){if(ka.is(t))return new ka(e,t);if(Ia.is(t))return new Ia(e,t);if(Pa.is(t))return new Pa(e,t);if(Tt.isnt(t))return new tc(e,t)}}class tc extends Tt{constructor(){super(...arguments),this.type="unexpectedHttpError"}}class Ia extends Tt{constructor(){super(...arguments),this.type="unauthenticatedError"}static is(e){return e.status===401}}class Pa extends Tt{constructor(){super(...arguments),this.type="unauthorizedError"}static is(e){return e.status===403}}class Ca extends Tt{constructor(){super(...arguments),this.type="notFoundError"}static is(e){return e.status===404}}class ka extends Tt{constructor(){super(...arguments),this.type="serverError"}static is(e){return e.status>=500&&e.status<600}}class rc extends Jt{constructor(e,t){super(e),this.type="createSuccess",this.didOverwrite=t}}function cf(n){try{const e=new URL(n);return e.protocol==="https:"||e.protocol==="http:"}catch{return!1}}function eo(n){try{return new URL(n).pathname.endsWith("/")}catch{return!1}}const to=st("http://www.w3.org/ns/ldp#contains"),cs=st("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),lf=st("http://www.w3.org/ns/ldp#Resource"),hf=st("http://www.w3.org/ns/ldp#Container"),ff=st("http://www.w3.org/ns/ldp#BasicContainer");function Ir(n){const e=new URL(n),t=e.pathname.split("/");if(!(t.length<2||t.length===2&&t[1].length===0))return t[t.length-1]===""&&t.pop(),t.pop(),e.pathname=`${t.join("/")}/`,e.toString()}function nc(n){const t=new URL(n).pathname.split("/");return t[t.length-1]||t[t.length-2]}function df(n,e){const t=Ir(n);if(t){const r=st(t),o=st(n);e.delete(Pt(r,to,o,r)),e.deleteMatches(o,void 0,void 0,r)}}function gi(n,e){const t=Ir(n);if(t){const r=st(t),o=st(n);e.add(Pt(r,to,o,r)),e.add(Pt(o,cs,lf,r)),eo(n)&&(e.add(Pt(o,cs,ff,r)),e.add(Pt(o,cs,hf,r))),gi(t,e)}}async function pf(n,e,t){const r=await ic(n,t);if(r instanceof Error)return r;const o=r,u=st(t);e.deleteMatches(void 0,void 0,void 0,u),e.addAll(o.map(c=>Pt(c.subject,c.predicate,c.object,u)))}async function ic(n,e){try{return await Mh(n,{baseIRI:e})}catch(t){const r=t instanceof Error?t.message:"";return new Error(`Request returned noncompliant turtle: ${r}
${n}`)}}class sc extends Jt{constructor(e,t){super(e),this.type="deleteSuccess",this.resourceExisted=t}}async function ro(n,e){try{const r=await Xt(e?.fetch)(n.uri,{method:"delete"}),o=Tt.checkResponse(n,r);return o||(r.status===205||r.status===404?(e?.dataset&&oc(n.uri,e.dataset),new sc(n,r.status===205)):new tc(n,r))}catch(t){return Ot.fromThrown(n,t)}}function oc(n,e){e.deleteMatches(void 0,void 0,void 0,st(n)),df(n,e)}class ac extends pi{constructor(e,t,r,o){super(e,t),this.type="binaryReadSuccess",this.blob=r,this.mimeType=o}}class uc extends pi{constructor(){super(...arguments),this.type="dataReadSuccess"}}class gf extends pi{constructor(e,t,r){super(e,t),this.type="containerReadSuccess",this.isRootContainer=r}}function yf(n){return n.type==="binaryReadSuccess"||n.type==="dataReadSuccess"||n.type==="absentReadSuccess"||n.type==="containerReadSuccess"}class Wr extends fr{constructor(e,t){super(e,`Response from ${e.uri} is not compliant with the Solid Specification: ${t}`),this.type="noncompliantPodError"}}var ls,Na;function mf(){if(Na)return ls;Na=1;var n=/^utf-?8|ascii|utf-?16-?le|ucs-?2|base-?64|latin-?1$/i,e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,t=/\s|\uFEFF|\xA0/,r=/\r?\n[\x20\x09]+/g,o=/[;,"]/,u=/[;,"]|\s/,c=/^[!#$%&'*+\-\.^_`|~\da-zA-Z]+$/,l={IDLE:1,URI:2,ATTR:4};function g(S){return S.replace(e,"")}function h(S){return t.test(S)}function d(S,v){for(;h(S[v]);)v++;return v}function p(S){return u.test(S)||!c.test(S)}function x(S,v){return Object.keys(S).length===Object.keys(v).length&&Object.keys(S).every(R=>R in v&&S[R]===v[R])}class T{constructor(v){this.refs=[],v&&this.parse(v)}rel(v){for(var R=[],b=v.toLowerCase(),E=0;E<this.refs.length;E++)typeof this.refs[E].rel=="string"&&this.refs[E].rel.toLowerCase()===b&&R.push(this.refs[E]);return R}get(v,R){v=v.toLowerCase(),R=R.toLowerCase();for(var b=[],E=0;E<this.refs.length;E++)typeof this.refs[E][v]=="string"&&this.refs[E][v].toLowerCase()===R&&b.push(this.refs[E]);return b}set(v){return this.refs.push(v),this}setUnique(v){return this.refs.some(R=>x(R,v))||this.refs.push(v),this}has(v,R){v=v.toLowerCase(),R=R.toLowerCase();for(var b=0;b<this.refs.length;b++)if(typeof this.refs[b][v]=="string"&&this.refs[b][v].toLowerCase()===R)return!0;return!1}parse(v,A){A=A||0,v=A?v.slice(A):v,v=g(v).replace(r,"");for(var b=l.IDLE,E=v.length,A=0,k=null;A<E;)if(b===l.IDLE){if(h(v[A])){A++;continue}else if(v[A]==="<"){k!=null&&(k.rel!=null?this.refs.push(...T.expandRelations(k)):this.refs.push(k));var D=v.indexOf(">",A);if(D===-1)throw new Error("Expected end of URI delimiter at offset "+A);k={uri:v.slice(A+1,D)},A=D,b=l.URI}else throw new Error('Unexpected character "'+v[A]+'" at offset '+A);A++}else if(b===l.URI)if(h(v[A])){A++;continue}else if(v[A]===";")b=l.ATTR,A++;else if(v[A]===",")b=l.IDLE,A++;else throw new Error('Unexpected character "'+v[A]+'" at offset '+A);else if(b===l.ATTR){if(v[A]===";"||h(v[A])){A++;continue}var D=v.indexOf("=",A);D===-1&&(D=v.indexOf(";",A)),D===-1&&(D=v.length);var B=g(v.slice(A,D)).toLowerCase(),M="";if(A=D+1,A=d(v,A),v[A]==='"')for(A++;A<E;){if(v[A]==='"'){A++;break}v[A]==="\\"&&A++,M+=v[A],A++}else{for(var D=A+1;!o.test(v[D])&&D<E;)D++;M=v.slice(A,D),A=D}switch(k[B]&&T.isSingleOccurenceAttr(B)||(B[B.length-1]==="*"?k[B]=T.parseExtendedValue(M):(M=B==="type"?M.toLowerCase():M,k[B]!=null?Array.isArray(k[B])?k[B].push(M):k[B]=[k[B],M]:k[B]=M)),v[A]){case",":b=l.IDLE;break;case";":b=l.ATTR;break}A++}else throw new Error('Unknown parser state "'+b+'"');return k!=null&&(k.rel!=null?this.refs.push(...T.expandRelations(k)):this.refs.push(k)),k=null,this}toString(){for(var v=[],R="",b=null,E=0;E<this.refs.length;E++)b=this.refs[E],R=Object.keys(this.refs[E]).reduce(function(A,k){return k==="uri"?A:A+"; "+T.formatAttribute(k,b[k])},"<"+b.uri+">"),v.push(R);return v.join(", ")}}return T.isCompatibleEncoding=function(S){return n.test(S)},T.parse=function(S,v){return new T().parse(S,v)},T.isSingleOccurenceAttr=function(S){return S==="rel"||S==="type"||S==="media"||S==="title"||S==="title*"},T.isTokenAttr=function(S){return S==="rel"||S==="type"||S==="anchor"},T.escapeQuotes=function(S){return S.replace(/"/g,'\\"')},T.expandRelations=function(S){var v=S.rel.split(" ");return v.map(function(R){var b=Object.assign({},S);return b.rel=R,b})},T.parseExtendedValue=function(S){var v=/([^']+)?(?:'([^']*)')?(.+)/.exec(S);return{language:v[2].toLowerCase(),encoding:T.isCompatibleEncoding(v[1])?null:v[1].toLowerCase(),value:T.isCompatibleEncoding(v[1])?decodeURIComponent(v[3]):v[3]}},T.formatExtendedAttribute=function(S,v){var R=(v.encoding||"utf-8").toUpperCase(),b=v.language||"en",E="";return Buffer.isBuffer(v.value)&&T.isCompatibleEncoding(R)?E=v.value.toString(R):Buffer.isBuffer(v.value)?E=v.value.toString("hex").replace(/[0-9a-f]{2}/gi,"%$1"):E=encodeURIComponent(v.value),S+"="+R+"'"+b+"'"+E},T.formatAttribute=function(S,v){return Array.isArray(v)?v.map(R=>T.formatAttribute(S,R)).join("; "):S[S.length-1]==="*"||typeof v!="string"?T.formatExtendedAttribute(S,v):(T.isTokenAttr(S)?v=p(v)?'"'+T.escapeQuotes(v)+'"':T.escapeQuotes(v):p(v)&&(v=encodeURIComponent(v),v=v.replace(/%20/g," ").replace(/%2C/g,",").replace(/%3B/g,";"),v='"'+v+'"'),S+"="+v)},ls=T,ls}var wf=mf();const yi=kn(wf);class Da extends Jt{constructor(e,t){super(e),this.type="checkRootContainerSuccess",this.isRootContainer=t}}class vg extends di{constructor(e){super(),this.type="getStorageContainerFromWebIdSuccess",this.storageContainers=e}}const _f=yi.parse;function cc(n,e){const t=e.get("link");if(!t)return new Da(n,!1);const u=_f(t).get("rel","type").some(c=>c.uri==="http://www.w3.org/ns/pim/space#Storage");return new Da(n,u)}async function bf(n,e){try{const r=await Xt(e?.fetch)(n.uri,{method:"HEAD",cache:"no-store"}),o=Tt.checkResponse(n,r);return o||cc(n,r.headers)}catch(t){return Ot.fromThrown(n,t)}}async function no(n,e){try{const r=await Xt(e?.fetch)(n.uri,{headers:{accept:"text/turtle, */*"}});if(r.status===404)return e?.dataset&&e.dataset.deleteMatches(void 0,void 0,void 0,st(n.uri)),new ec(n,!1);const o=Tt.checkResponse(n,r);if(o)return o;e?.dataset&&gi(n.uri,e.dataset);const u=r.headers.get("content-type");if(!u)return new Wr(n,"Resource requests must return a content-type header.");if(u.startsWith("text/turtle")){const c=await r.text();if(e?.dataset){const l=await pf(c,e.dataset,n.uri);if(l)return new Wr(n,l.message)}if(n.type==="SolidContainer"){const l=cc(n,r.headers);return new gf(n,!1,l.isRootContainer)}return new uc(n,!1)}else{const c=await r.blob();return new ac(n,!1,c,u)}}catch(t){return Ot.fromThrown(n,t)}}async function vf(n,e,t){try{const r=Xt(t?.fetch);let o=!1;if(e){const h=await ro(n,t);if(h.isError)return h;o=h.resourceExisted}else{const h=await no(n,t);if(h.type!=="absentReadSuccess")return h}const u=Ir(n.uri),c={"content-type":"text/turtle",slug:nc(n.uri)};n.type==="SolidContainer"&&(c.link='<http://www.w3.org/ns/ldp#Container>; rel="type"');const l=await r(u,{method:"post",headers:c}),g=Tt.checkResponse(n,l);return g||(t?.dataset&&gi(n.uri,t.dataset),new rc(n,o))}catch(r){return Ot.fromThrown(n,r)}}function Rs(n){return(e,t)=>{if(e.length===0&&t?.name===n)return t;if(e[e.length-1]?.name===n)return e[e.length-1]}}const hs="read",Gn="createDataResource",fs="delete";class lc{constructor(e){this.requestBatcher=new wh,this.context=e}isLoading(){return this.requestBatcher.isLoading(xs)}isCreating(){return this.requestBatcher.isLoading(Gn)}isReading(){return this.requestBatcher.isLoading(hs)}isDeletinng(){return this.requestBatcher.isLoading(fs)}async read(){const e=this.context.dataset.startTransaction();return await this.requestBatcher.queueProcess({name:hs,args:[this.resource,{dataset:e,fetch:this.context.solid.fetch}],perform:no,modifyQueue:Rs(hs),after:r=>{r.isError||e.commit()}})}async delete(){const e=this.context.dataset.startTransaction();return await this.requestBatcher.queueProcess({name:fs,args:[this.resource,{dataset:e,fetch:this.context.solid.fetch}],perform:ro,modifyQueue:Rs(fs),after:r=>{r.isError||e.commit()}})}async createDataResource(e){const t=this.context.dataset.startTransaction();return await this.requestBatcher.queueProcess({name:Gn,args:[this.resource,e??!1,{dataset:t,fetch:this.context.solid.fetch}],perform:vf,modifyQueue:(o,u,c)=>{const l=o[o.length-1];if(l&&l.name===Gn&&!!l.args[1]==!!c[1])return l;if(u&&u.name===Gn&&!!u.args[1]==!!c[1])return u},after:o=>{o.isError||t.commit()}})}}async function Sf(n,e,t){try{t?.dataset?.bulk(e);const r=Xt(t?.fetch),o=await ih(e),u=await r(n.uri,{method:"PATCH",body:o,headers:{"Content-Type":"application/sparql-update"}}),c=Tt.checkResponse(n,u);return c?(t?.dataset&&t.dataset.bulk({added:e.removed,removed:e.added}),c):new tf(n)}catch(r){return Ot.fromThrown(n,r)}}async function Ef(n,e,t,r,o){try{const u=Xt(o?.fetch);let c=!1;if(r){const d=await ro(n,o);if(d.isError)return d;c=d.resourceExisted}else{const d=await no(n,o);if(d.type!=="absentReadSuccess")return d}const l=Ir(n.uri),g=await u(l,{method:"post",headers:{"content-type":t,slug:nc(n.uri)},body:e}),h=Tt.checkResponse(n,g);return h||(o?.dataset&&gi(n.uri,o.dataset),new rc(n,c))}catch(u){return Ot.fromThrown(n,u)}}const ds="update",zn="upload";class xf extends lc{constructor(e,t){super(t),this.resource=e}isUpdating(){return this.requestBatcher.isLoading(ds)}isUploading(){return this.requestBatcher.isLoading(zn)}async read(){return super.read()}createDataResource(e){return super.createDataResource(e)}async updateDataResource(e){return await this.requestBatcher.queueProcess({name:ds,args:[this.resource,e,{fetch:this.context.solid.fetch,dataset:this.context.dataset}],perform:Sf,modifyQueue:(r,o,[,u])=>{if(r[r.length-1]?.name===ds){const c=r[r.length-1].args[1];return Iu(c,u),r[r.length-1]}}})}async upload(e,t,r){const o=this.context.dataset.startTransaction();return await this.requestBatcher.queueProcess({name:zn,args:[this.resource,e,t,r,{dataset:o,fetch:this.context.solid.fetch}],perform:Ef,modifyQueue:(c,l,g)=>{const h=c[c.length-1];if(h&&h.name===zn&&!!h.args[3]==!!g[3])return h;if(l&&l.name===zn&&!!l.args[3]==!!g[3])return l},after:c=>{c.isError||o.commit()}})}}const hc=async(n,e="")=>{const t=new Rt;return new Promise((r,o)=>{const u={};e&&(u.baseIRI=e),new Os(u).parse(n,(l,g)=>{l&&o(l),g?t.add(mt.quad(g.subject,g.predicate,g.object,mt.defaultGraph())):r(t)})})},Ff=n=>{const e=new Rt;for(const t of n)e.add(mt.quad(t.subject,t.predicate,t.object,mt.defaultGraph()));return e},Rf=async(n,e=!1)=>{const t=new oi({format:"text/turtle"});for(const r of e?Ff(n):n)t.addQuad(r);return new Promise((r,o)=>{t.end((u,c)=>{u?o(u):r(c)})})},Or=(n,e,t,r,o)=>[...n.match(e,t,r,o)].shift(),Tf=(n,e,t,r,o)=>[...n.match(e,t,r,o)];function Af(n){return yi.parse(n).refs.find(t=>t.rel==="describedby")?.uri}function If(n){return yi.parse(n).refs.find(t=>t.rel==="http://www.w3.org/ns/solid/terms#storageDescription")?.uri}function Ut(n){const e={get:(t,r)=>mt.namedNode(t.base+r)};return new Proxy({base:n},e)}Ut("http://www.w3.org/ns/solid/interop#");const Er=Ut("http://www.w3.org/ns/solid/notifications#"),Ts=Ut("http://www.w3.org/1999/02/22-rdf-syntax-ns#");Ut("http://www.w3.org/2000/01/rdf-schema#");Ut("http://www.w3.org/ns/ldp#");Ut("http://www.w3.org/ns/auth/acl#");Ut("http://www.w3.org/ns/shapetrees#");Ut("http://www.w3.org/2001/XMLSchema#");Ut("http://www.w3.org/2004/02/skos/core#");Ut("http://www.w3.org/ns/solid/acp#");Ut("http://www.w3.org/ns/solid/terms#");Ut("http://www.w3.org/ns/solid/oidc#");Ut("http://purl.org/dc/terms/");Ut("http://www.w3.org/ns/pim/space#");class Pf{constructor(e){this.authnFetch=e,this.rdf={contentType:"text/turtle",parse:hc}}async findService(e,t){const r=await this.fetchStorageDescription(e),o=Or(r,null,Er.channelType,mt.namedNode(t))?.subject;if(!o)return null;const u=Tf(r,o,Er.feature).map(c=>c.object.value);return{id:o.value,channelType:t,feature:u}}async fetchResource(e){const t=await this.authnFetch(e,{headers:{Accept:this.rdf.contentType}});if(t.status<200||t.status>300)throw Error(`Failed fetching resource: ${e}`);return this.rdf.parse(await t.text(),t.url)}async discoverStorageDescription(e){const t=await this.authnFetch(e,{method:"head"});if(t.status<200||t.status>300)throw Error(`Failed fetching resource: ${e}`);return If(t.headers.get("Link"))}async fetchStorageDescription(e){const t=await this.discoverStorageDescription(e);return this.fetchResource(t)}async discoverDescriptionResource(e){const t=await this.authnFetch(e,{method:"head"});return Af(t.headers.get("Link"))}async fetchDescriptionResource(e){const t=await this.discoverDescriptionResource(e);return this.fetchResource(t)}}function Cf(n,e,t){const r=new Rt,o=mt.blankNode();return r.add(mt.quad(o,Ts.type,mt.namedNode(e))),r.add(mt.quad(o,Er.topic,mt.namedNode(n))),t&&r.add(mt.quad(o,Er.sendTo,mt.namedNode(t))),r}function kf(n){const e=Or(n,null,Ts.type).subject,t={id:e.value,type:Or(n,e,Ts.type).object.value,topic:Or(n,e,Er.topic).object.value},r=Or(n,e,Er.receiveFrom)?.object.value;r&&(t.receiveFrom=r);const o=Or(n,e,Er.sendTo)?.object.value;return o&&(t.sendTo=o),t}class Nf{constructor(e){this.authnFetch=e,this.discovery=new Pf(this.authnFetch),this.rdf={contentType:"text/turtle",parse:hc,serialize:Rf}}async subscribe(e,t,r){const o=await this.discovery.findService(e,t);if(!o)throw Error(`Discovery did not succeed: channel type ${t} is not supported by the Solid Server.`);const u=Cf(e,t,r),c=await this.authnFetch(o.id,{method:"POST",body:await this.rdf.serialize(u),headers:{Accept:this.rdf.contentType,"Content-Type":this.rdf.contentType}});if(!c.headers.get("Content-Type").startsWith(this.rdf.contentType))throw new Error("unexpected Content Type");const l=await this.rdf.parse(await c.text(),c.url);return kf(l)}}var ps,La;function Df(){return La||(La=1,ps=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}),ps}var Lf=Df();class jf extends fr{constructor(){super(...arguments),this.type="unsupportedNotificationError"}}class Uf extends fr{constructor(){super(...arguments),this.type="disconnectedAttemptingReconnectError"}}class Of extends fr{constructor(){super(...arguments),this.type="disconnectedNotAttemptingReconnectError"}}const Bf="http://www.w3.org/ns/solid/notifications#WebSocketChannel2023";class Mf extends uf{constructor(e,t,r,o){super(e,t,r),this.reconnectInterval=5e3,this.reconnectAttempts=0,this.isManualClose=!1,this.maxReconnectAttempts=6,this.createWebsocket=o??Hf}async open(){try{const e=await this.discoverNotificationChannel();await this.subscribeToWebsocket(e)}catch(e){e instanceof Error&&e.message.startsWith("Discovery did not succeed")?this.onNotificationError(new jf(this.resource,e.message)):this.onNotificationError(Ot.fromThrown(this.resource,e)),this.onClose()}}async discoverNotificationChannel(){return await new Nf(Xt(this.context.solid.fetch)).subscribe(this.resource.uri,Bf)}async subscribeToWebsocket(e){this.socket=this.createWebsocket(e.receiveFrom),this.socket.onopen=()=>{this.reconnectAttempts=0,this.isManualClose=!1},this.socket.onmessage=t=>{const r=t.data.toString();this.onNotification(JSON.parse(r))},this.socket.onclose=()=>{this.onClose()},this.socket.onerror=t=>{this.onNotificationError(new Ot(this.resource,t.error))}}onClose(){this.isManualClose||(this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,setTimeout(()=>{this.open()},this.reconnectInterval),this.onNotificationError(new Uf(this.resource,`Attempting to reconnect to Websocket for ${this.resource.uri}.`))):this.onNotificationError(new Of(this.resource,`Lost connection to websocket for ${this.resource.uri}.`)))}async close(){this.socket?.close()}}function Hf(n){const e=typeof window<"u"?window.WebSocket:Lf.WebSocket;return new e(n)}class fc extends Jt{constructor(e,t){super(e),this.type="getWacUriSuccess",this.wacUri=t}}const Kf=yi.parse;async function qf(n,e){try{const r=await Xt(e?.fetch)(n.uri,{method:"head"}),o=Tt.checkResponse(n,r);if(o)return o;if(Ca.is(r))return new Ca(n,r,"Could not get access control rules because the resource does not exist.");const u=r.headers.get("link");if(!u)return new Wr(n,"No link header present in request.");const l=Kf(u).get("rel","acl");return l.length!==1?new Wr(n,'There must be one link with a rel="acl"'):new fc(n,l[0].uri)}catch(t){return Ot.fromThrown(n,t)}}class dc extends Jt{constructor(e,t){super(e),this.type="getWacRuleSuccess",this.wacRule=t}}const Wf={type:"Schema",shapes:[{id:"http://www.w3.org/ns/auth/acls#Authorization",type:"ShapeDecl",shapeExpr:{type:"Shape",expression:{id:"http://www.w3.org/ns/auth/acls#AuthorizationShape",type:"EachOf",expressions:[{type:"TripleConstraint",predicate:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",valueExpr:{type:"NodeConstraint",values:["http://www.w3.org/ns/auth/acl#Authorization"]},annotations:[{type:"Annotation",predicate:"http://www.w3.org/2000/01/rdf-schema#comment",object:{value:"Denotes this as an acl:Authorization"}}]},{type:"TripleConstraint",predicate:"http://www.w3.org/ns/auth/acl#accessTo",valueExpr:{type:"NodeConstraint",nodeKind:"iri"},min:0,max:1,annotations:[{type:"Annotation",predicate:"http://www.w3.org/2000/01/rdf-schema#comment",object:{value:"The subject of this authorization"}}]},{type:"TripleConstraint",predicate:"http://www.w3.org/ns/auth/acl#default",valueExpr:{type:"NodeConstraint",nodeKind:"iri"},min:0,max:1,annotations:[{type:"Annotation",predicate:"http://www.w3.org/2000/01/rdf-schema#comment",object:{value:"The container subject of this authorization"}}]},{type:"TripleConstraint",predicate:"http://www.w3.org/ns/auth/acl#agent",valueExpr:{type:"NodeConstraint",nodeKind:"iri"},min:0,max:-1,annotations:[{type:"Annotation",predicate:"http://www.w3.org/2000/01/rdf-schema#comment",object:{value:"An agent is a person, social entity or software identified by a URI, e.g., a WebID denotes an agent"}}]},{type:"TripleConstraint",predicate:"http://www.w3.org/ns/auth/acl#agentGroup",valueExpr:{type:"NodeConstraint",nodeKind:"iri"},min:0,max:-1,annotations:[{type:"Annotation",predicate:"http://www.w3.org/2000/01/rdf-schema#comment",object:{value:"Denotes a group of agents being given the access permission"}}]},{type:"TripleConstraint",predicate:"http://www.w3.org/ns/auth/acl#agentClass",valueExpr:{type:"NodeConstraint",values:["http://www.w3.org/ns/auth/acl#AuthenticatedAgent","http://xmlns.com/foaf/0.1/Agent"]},min:0,max:-1,annotations:[{type:"Annotation",predicate:"http://www.w3.org/2000/01/rdf-schema#comment",object:{value:"An agent class is a class of persons or entities identified by a URI."}}]},{type:"TripleConstraint",predicate:"http://www.w3.org/ns/auth/acl#mode",valueExpr:{type:"NodeConstraint",values:["http://www.w3.org/ns/auth/acl#Read","http://www.w3.org/ns/auth/acl#Write","http://www.w3.org/ns/auth/acl#Append","http://www.w3.org/ns/auth/acl#Control"]},min:0,max:-1,annotations:[{type:"Annotation",predicate:"http://www.w3.org/2000/01/rdf-schema#comment",object:{value:"Denotes a class of operations that the agents can perform on a resource."}}]}]},extra:["http://www.w3.org/1999/02/22-rdf-syntax-ns#type"]}}]},$f={type:{"@id":"@type"},Authorization:{"@id":"http://www.w3.org/ns/auth/acl#Authorization","@context":{type:{"@id":"@type"},accessTo:{"@id":"http://www.w3.org/ns/auth/acl#accessTo","@type":"@id"},default:{"@id":"http://www.w3.org/ns/auth/acl#default","@type":"@id"},agent:{"@id":"http://www.w3.org/ns/auth/acl#agent","@type":"@id","@isCollection":!0},agentGroup:{"@id":"http://www.w3.org/ns/auth/acl#agentGroup","@type":"@id","@isCollection":!0},agentClass:{"@id":"http://www.w3.org/ns/auth/acl#agentClass","@isCollection":!0},mode:{"@id":"http://www.w3.org/ns/auth/acl#mode","@isCollection":!0}}},accessTo:{"@id":"http://www.w3.org/ns/auth/acl#accessTo","@type":"@id"},default:{"@id":"http://www.w3.org/ns/auth/acl#default","@type":"@id"},agent:{"@id":"http://www.w3.org/ns/auth/acl#agent","@type":"@id","@isCollection":!0},agentGroup:{"@id":"http://www.w3.org/ns/auth/acl#agentGroup","@type":"@id","@isCollection":!0},agentClass:{"@id":"http://www.w3.org/ns/auth/acl#agentClass","@isCollection":!0},AuthenticatedAgent:"http://www.w3.org/ns/auth/acl#AuthenticatedAgent",Agent:"http://xmlns.com/foaf/0.1/Agent",mode:{"@id":"http://www.w3.org/ns/auth/acl#mode","@isCollection":!0},Read:"http://www.w3.org/ns/auth/acl#Read",Write:"http://www.w3.org/ns/auth/acl#Write",Append:"http://www.w3.org/ns/auth/acl#Append",Control:"http://www.w3.org/ns/auth/acl#Control"},pc={schema:Wf,shape:"http://www.w3.org/ns/auth/acls#Authorization",context:$f};class Vf extends Jt{constructor(){super(...arguments),this.type="wacRuleAbsent"}}async function Jf(n,e,t){const o=await Xt(t?.fetch)(n),u=Tt.checkResponse(e,o);if(u)return u;if(o.status===404)return new Vf(e);const c=await o.text(),l=await ic(c,n);if(l instanceof Error)return new Wr(e,l.message);const h=l.usingType(pc).matchSubject("http://www.w3.org/1999/02/22-rdf-syntax-ns#type","http://www.w3.org/ns/auth/acl#Authorization"),d={public:{read:!1,write:!1,append:!1,control:!1},authenticated:{read:!1,write:!1,append:!1,control:!1},agent:{}};function p(x,T){T.mode?.forEach(S=>{x[S["@id"].toLowerCase()]=!0})}return h.forEach(x=>{x.agentClass?.some(T=>T["@id"]==="Agent")&&(p(d.public,x),p(d.authenticated,x)),x.agentClass?.some(T=>T["@id"]==="AuthenticatedAgent")&&p(d.authenticated,x),x.agent?.forEach(T=>{d.agent[T["@id"]]||(d.agent[T["@id"]]={read:!1,write:!1,append:!1,control:!1}),p(d.agent[T["@id"]],x)})}),new dc(e,d)}class Gf extends Jt{constructor(e,t){super(e),this.type="setWacRuleSuccess",this.wacRule=t}}async function zf(n,e,t,r){const o=Xt(r?.fetch),u={},c=Gu();function l(d,p,x){const T=Qf(p);if(T==="")return;if(!u[T]){const v=c.usingType(pc).fromSubject(`${n}#${Ar()}`);v.type={"@id":"Authorization"},p.read&&v.mode?.add({"@id":"Read"}),p.write&&v.mode?.add({"@id":"Write"}),p.append&&v.mode?.add({"@id":"Append"}),p.control&&v.mode?.add({"@id":"Control"}),v.accessTo={"@id":t.uri},eo(t.uri)&&(v.default={"@id":t.uri}),u[T]=v}const S=u[T];d==="public"?S.agentClass?.add({"@id":"Agent"}):d==="authenticated"?S.agentClass?.add({"@id":"AuthenticatedAgent"}):d==="agent"&&x&&S.agent?.add({"@id":x})}l("public",e.public),l("authenticated",e.authenticated),Object.entries(e.agent).forEach(([d,p])=>{l("agent",p,d)});const g=await o(n,{method:"PUT",headers:{"content-type":"text/turtle"},body:c.toString()}),h=Tt.checkResponse(t,g);return h||new Gf(t,e)}function Qf(n){return Object.entries(n).reduce((e,[t,r])=>r?e+t:e,"")}class gc extends $s{constructor(e){super(),this.didInitialFetch=!1,this.isError=!1,this.context=e,this.notificationSubscription=new Mf(this,this.onNotification.bind(this),this.context)}isLoading(){return this.requester.isLoading()}isCreating(){return this.requester.isCreating()}isReading(){return this.requester.isReading()}isDeleting(){return this.requester.isDeletinng()}isDoingInitialFetch(){return this.isReading()&&!this.isFetched()}isReloading(){return this.isReading()&&this.isFetched()}isFetched(){return this.didInitialFetch}isUnfetched(){return!this.didInitialFetch}isAbsent(){return this.absent}isPresent(){return this.absent===void 0?void 0:!this.absent}isSubscribedToNotifications(){return this.notificationSubscription.isSubscribedToNotifications()}emitThisAndParent(){this.emit("update");const e=Ir(this.uri);e&&this.context.dataset.getResource(e).emit("update")}updateWithReadSuccess(e){this.absent=e.type==="absentReadSuccess",this.didInitialFetch=!0}async handleRead(){const e=await this.requester.read();return this.status=e,e.isError?(this.emit("update"),e):(this.updateWithReadSuccess(e),this.emitThisAndParent(),e)}async readIfUnfetched(){if(this.didInitialFetch){const e=this.toReadResult();return this.status=e,e}return this.read()}updateWithDeleteSuccess(e){this.absent=!0,this.didInitialFetch=!0}async handleDelete(){const e=await this.requester.delete();return this.status=e,e.isError?(this.emit("update"),e):(this.updateWithDeleteSuccess(e),this.emitThisAndParent(),e)}updateWithCreateSuccess(e){this.absent=!1,this.didInitialFetch=!0,yf(e)&&this.updateWithReadSuccess(e)}async handleCreateAndOverwrite(){const e=await this.requester.createDataResource(!0);return this.status=e,e.isError?(this.emit("update"),e):(this.updateWithCreateSuccess(e),this.emitThisAndParent(),e)}async handleCreateIfAbsent(){const e=await this.requester.createDataResource();return this.status=e,e.isError?(this.emit("update"),e):(this.updateWithCreateSuccess(e),this.emitThisAndParent(),e)}async getWacUri(e){const t=this;if(!e?.ignoreCache&&this.wacUri)return new fc(t,this.wacUri);const r=await qf(t,{fetch:this.context.solid.fetch});return r.isError||(this.wacUri=r.wacUri),r}async getWac(e){const t=this;if(!e?.ignoreCache&&this.wacRule)return new dc(t,this.wacRule);const r=await this.getWacUri(e);if(r.isError)return r;const o=await Jf(r.wacUri,t,{fetch:this.context.solid.fetch});if(o.isError)return o;if(o.type==="getWacRuleSuccess")return this.wacRule=o.wacRule,o;const u=await this.getParentContainer();return u?.isError?u:u?u.getWac():new Wr(t,`Resource "${this.uri}" has no Effective ACL resource`)}async setWac(e){const t=this,r=await this.getWacUri();if(r.isError)return r;const o=await zf(r.wacUri,e,t,{fetch:this.context.solid.fetch});return o.isError?(this.emit("update"),o):(this.wacRule=o.wacRule,o)}async subscribeToNotifications(e){return await this.notificationSubscription.subscribeToNotifications(e)}async onNotification(e){const t=this.context.dataset.getResource(e.object);if(t.type!=="InvalidIdentifierResouce"&&t.type==="SolidLeaf")switch(e.type){case"Update":case"Add":await t.read();return;case"Delete":case"Remove":oc(e.object,this.context.dataset),t.updateWithDeleteSuccess(new sc(t,!0));return}}async unsubscribeFromNotifications(e){return this.notificationSubscription.unsubscribeFromNotification(e)}async unsubscribeFromAllNotifications(){return this.notificationSubscription.unsubscribeFromAllNotifications()}}class Yf extends gc{constructor(e,t){super(t),this.type="SolidLeaf",this.isError=!1;const r=new URL(e);r.hash="",this.uri=r.toString(),this.requester=new xf(this,t),this.status=new Zu(this)}isUploading(){return this.requester.isUploading()}isUpdating(){return this.requester.isUpdating()}getMimeType(){return this.binaryData?.mimeType}getBlob(){return this.binaryData?.blob}isBinary(){if(this.didInitialFetch)return!!this.binaryData}isDataResource(){if(this.didInitialFetch)return!this.binaryData}updateWithReadSuccess(e){super.updateWithReadSuccess(e),e.type==="binaryReadSuccess"?this.binaryData={blob:e.blob,mimeType:e.mimeType}:this.binaryData=void 0}async read(){const e=await this.handleRead();return e.isError?e:{...e,resource:this}}toReadResult(){return this.isAbsent()?new ec(this,!0):this.isBinary()?new ac(this,!0,this.binaryData.blob,this.binaryData.mimeType):new uc(this,!0)}async readIfUnfetched(){return super.readIfUnfetched()}async getParentContainer(){const e=Ir(this.uri);return this.context.dataset.getResource(e)}async getRootContainer(){return(await this.getParentContainer()).getRootContainer()}updateWithDeleteSuccess(e){super.updateWithDeleteSuccess(e),this.binaryData=void 0}async delete(){return this.handleDelete()}async handleDelete(){return super.handleDelete()}updateWithCreateSuccess(e){this.binaryData=void 0}async createAndOverwrite(){const e=await this.handleCreateAndOverwrite();return e.isError?e:{...e,resource:this}}async createIfAbsent(){const e=await this.handleCreateIfAbsent();return e.isError?e:{...e,resource:this}}async uploadAndOverwrite(e,t){const r=await this.requester.upload(e,t,!0);return this.status=r,r.isError?(this.emit("update"),r):(super.updateWithCreateSuccess(r),this.binaryData={blob:e,mimeType:t},this.emitThisAndParent(),{...r,resource:this})}async uploadIfAbsent(e,t){const r=await this.requester.upload(e,t);return this.status=r,r.isError?(this.emit("update"),r):(super.updateWithCreateSuccess(r),this.binaryData={blob:e,mimeType:t},this.emitThisAndParent(),{...r,resource:this})}async update(e){const t=await this.requester.updateDataResource(e);return this.status=t,t.isError?(this.emit("update"),t):(this.binaryData=void 0,this.absent=!1,this.emitThisAndParent(),{...t,resource:this})}}const ja="isRootContainer";class Xf extends lc{constructor(e,t){super(t),this.resource=e}read(){return super.read()}createDataResource(e){return super.createDataResource(e)}async isRootContainer(){return this.requestBatcher.queueProcess({name:ja,args:[this.resource,{fetch:this.context.solid.fetch}],perform:bf,modifyQueue:Rs(ja)})}}class Zf extends fr{constructor(e){super(e,`${e.uri} has not root container.`),this.type="noRootContainerError"}}class ed extends gc{constructor(e,t){super(t),this.type="SolidContainer",this.isError=!1,this.uri=e,this.requester=new Xf(this,t),this.status=new Zu(this)}isRootContainer(){return this.rootContainer}updateWithReadSuccess(e){super.updateWithReadSuccess(e),e.type==="containerReadSuccess"&&(this.rootContainer=e.isRootContainer)}async read(){return{...await this.handleRead(),resource:this}}toReadResult(){return this.isAbsent()?{isError:!1,type:"absentReadSuccess",uri:this.uri,recalledFromMemory:!0,resource:this}:{isError:!1,type:"containerReadSuccess",uri:this.uri,recalledFromMemory:!0,isRootContainer:this.isRootContainer(),resource:this}}async readIfUnfetched(){return super.readIfUnfetched()}async checkIfIsRootContainer(){const e=await this.requester.isRootContainer();return this.status=e,e.isError?e:(this.rootContainer=e.isRootContainer,this.emit("update"),{...e,resource:this})}async getRootContainer(){const e=await this.getParentContainer();return e?.isError?e:e?e.getRootContainer():this.isRootContainer()?this:new Zf(this)}async getParentContainer(){if(this.rootContainer===void 0){const t=await this.checkIfIsRootContainer();if(t.isError)return t}if(this.rootContainer)return;const e=Ir(this.uri);if(e)return this.context.dataset.getResource(e)}children(){return this.context.dataset.match(st(this.uri),to,null,st(this.uri)).toArray().map(t=>this.context.dataset.getResource(t.object.value))}child(e){return this.context.dataset.getResource(`${this.uri}${e}`)}createChildAndOverwrite(e){return this.child(e).createAndOverwrite()}createChildIfAbsent(e){return this.child(e).createIfAbsent()}async uploadChildAndOverwrite(e,t,r){return this.child(e).uploadAndOverwrite(t,r)}async uploadChildIfAbsent(e,t,r){return this.child(e).uploadIfAbsent(t,r)}async clear(){const e=await this.read();if(e.isError)return new Pn([e]);const t=(await Promise.all(this.children().map(async o=>o.delete()))).flat(),r=t.filter(o=>o.isError);return r.length>0?new Pn(r):new ef(t)}async delete(){const e=await this.clear();if(e.isError)return e;const t=await this.handleDelete();return t.isError?t:{...t,resource:this}}async handleDelete(){return super.handleDelete()}async createAndOverwrite(){const e=await this.handleCreateAndOverwrite();return e.isError?e:{...e,resource:this}}async createIfAbsent(){const e=await this.handleCreateIfAbsent();return e.isError?e:{...e,resource:this}}async update(e){return new nf(this)}}function td(n,e){return eo(n)?new ed(n,e):new Yf(n,e)}const rd={name:"solid",getResource:td,createResource:function(){throw new Error("Function not implemented.")},isUriValid:function(n){return cf(n)},initialContext:{fetch:void 0},types:{},normalizeUri(n){const e=new URL(n);return e.hash="",e.search="",e.toString()}};function nd(n){const e={dataset:n,getResource:n.getResource.bind(n),setContext:n.setContext.bind(n),getSubject(t,r){return n.usingType(t).fromSubject(r)},createData(t,r,o,...u){return n.createData(t,r,o,...u)},changeData:of,commitData(t){return Kh(t).commitToRemote()}};return function(){return e}}function mi(n,e,t){const r={},o=()=>{t.removeListenerFromAllEvents(o);const c=Qu(t,n,o),l=e(c);r.ldo=l,r.set&&r.ldo&&r.set(r.ldo)};o();const u=Xa(r.ldo,c=>(r.set=c,()=>{t.removeListenerFromAllEvents(o)}));return Ya(()=>{t.removeListenerFromAllEvents(o)}),{subscribe:u.subscribe}}function id(n){return function(t,r,o,u){return mi(t,l=>l.matchObject(r,o,u),n)}}function sd(n){return function(t,r,o,u){return mi(t,l=>l.matchSubject(r,o,u),n)}}function od(n){return function(t,r){let o;return t?(o=n.getResource(t),r?.suppressInitialRead||(r?.reloadOnMount?o.read():o.readIfUnfetched())):o=void 0,{subscribe:Xa(o,c=>{const l=()=>{c(o)};if(o)return o.on("update",l),()=>{o.off("update",l)}}).subscribe}}}function ad(n){return function(t,r){return mi(t,u=>{if(r)return u.fromSubject(r)},n)}}function ud(n){return function(...t){throw new Error("Subscribe to Resource is Not Implemented for Svelte")}}function cd(n){return function(t,r,o,u){const c=n.getResource(r);console.log(c);const l=n.usingType(t).startLinkQuery(c,o,u);return console.log("Calling subscribe"),l.subscribe(),console.log("After call subscribe"),Ya(()=>{l.unsubscribeAll()}),mi(t,h=>{if(o)return h.fromSubject(o)},n)}}function ld(n){const e=af(n);return e.setMaxListeners(1e3),{dataset:e,useLdo:nd(e),useMatchObject:id(e),useMatchSubject:sd(e),useResource:od(e),useSubject:ad(e),useSubscribeToResource:ud(),useLinkQuery:cd(e)}}const{dataset:hd,useLdo:Sg,useMatchSubject:Eg,useResource:xg,useSubject:Fg}=ld([rd]),Gr=crypto,io=n=>n instanceof CryptoKey,Yt=new TextEncoder,$r=new TextDecoder;function yc(...n){const e=n.reduce((o,{length:u})=>o+u,0),t=new Uint8Array(e);let r=0;for(const o of n)t.set(o,r),r+=o.length;return t}const fd=n=>{let e=n;typeof e=="string"&&(e=Yt.encode(e));const t=32768,r=[];for(let o=0;o<e.length;o+=t)r.push(String.fromCharCode.apply(null,e.subarray(o,o+t)));return btoa(r.join(""))},Xn=n=>fd(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),dd=n=>{const e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},xr=n=>{let e=n;e instanceof Uint8Array&&(e=$r.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return dd(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class xt extends Error{constructor(e,t){super(e,t),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}xt.code="ERR_JOSE_GENERIC";class $t extends xt{constructor(e,t,r="unspecified",o="unspecified"){super(e,{cause:{claim:r,reason:o,payload:t}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=r,this.reason=o,this.payload=t}}$t.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class As extends xt{constructor(e,t,r="unspecified",o="unspecified"){super(e,{cause:{claim:r,reason:o,payload:t}}),this.code="ERR_JWT_EXPIRED",this.claim=r,this.reason=o,this.payload=t}}As.code="ERR_JWT_EXPIRED";class mc extends xt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}mc.code="ERR_JOSE_ALG_NOT_ALLOWED";class Lt extends xt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}Lt.code="ERR_JOSE_NOT_SUPPORTED";class pd extends xt{constructor(e="decryption operation failed",t){super(e,t),this.code="ERR_JWE_DECRYPTION_FAILED"}}pd.code="ERR_JWE_DECRYPTION_FAILED";class gd extends xt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}gd.code="ERR_JWE_INVALID";class ut extends xt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}ut.code="ERR_JWS_INVALID";class wi extends xt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}wi.code="ERR_JWT_INVALID";class yd extends xt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}yd.code="ERR_JWK_INVALID";class so extends xt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}so.code="ERR_JWKS_INVALID";class oo extends xt{constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_NO_MATCHING_KEY"}}oo.code="ERR_JWKS_NO_MATCHING_KEY";class wc extends xt{constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}wc.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class _c extends xt{constructor(e="request timed out",t){super(e,t),this.code="ERR_JWKS_TIMEOUT"}}_c.code="ERR_JWKS_TIMEOUT";class bc extends xt{constructor(e="signature verification failed",t){super(e,t),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}bc.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";function zt(n,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${n}`)}function bn(n,e){return n.name===e}function gs(n){return parseInt(n.name.slice(4),10)}function md(n){switch(n){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function wd(n,e){if(e.length&&!e.some(t=>n.usages.includes(t))){let t="CryptoKey does not support this operation, its usages must include ";if(e.length>2){const r=e.pop();t+=`one of ${e.join(", ")}, or ${r}.`}else e.length===2?t+=`one of ${e[0]} or ${e[1]}.`:t+=`${e[0]}.`;throw new TypeError(t)}}function _d(n,e,...t){switch(e){case"HS256":case"HS384":case"HS512":{if(!bn(n.algorithm,"HMAC"))throw zt("HMAC");const r=parseInt(e.slice(2),10);if(gs(n.algorithm.hash)!==r)throw zt(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!bn(n.algorithm,"RSASSA-PKCS1-v1_5"))throw zt("RSASSA-PKCS1-v1_5");const r=parseInt(e.slice(2),10);if(gs(n.algorithm.hash)!==r)throw zt(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!bn(n.algorithm,"RSA-PSS"))throw zt("RSA-PSS");const r=parseInt(e.slice(2),10);if(gs(n.algorithm.hash)!==r)throw zt(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":{if(n.algorithm.name!=="Ed25519"&&n.algorithm.name!=="Ed448")throw zt("Ed25519 or Ed448");break}case"Ed25519":{if(!bn(n.algorithm,"Ed25519"))throw zt("Ed25519");break}case"ES256":case"ES384":case"ES512":{if(!bn(n.algorithm,"ECDSA"))throw zt("ECDSA");const r=md(e);if(n.algorithm.namedCurve!==r)throw zt(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}wd(n,t)}function vc(n,e,...t){if(t=t.filter(Boolean),t.length>2){const r=t.pop();n+=`one of type ${t.join(", ")}, or ${r}.`}else t.length===2?n+=`one of type ${t[0]} or ${t[1]}.`:n+=`of type ${t[0]}.`;return e==null?n+=` Received ${e}`:typeof e=="function"&&e.name?n+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&e.constructor?.name&&(n+=` Received an instance of ${e.constructor.name}`),n}const Is=(n,...e)=>vc("Key must be ",n,...e);function Sc(n,e,...t){return vc(`Key for the ${n} algorithm must be `,e,...t)}const Ec=n=>io(n)?!0:n?.[Symbol.toStringTag]==="KeyObject",Cn=["CryptoKey"],xc=(...n)=>{const e=n.filter(Boolean);if(e.length===0||e.length===1)return!0;let t;for(const r of e){const o=Object.keys(r);if(!t||t.size===0){t=new Set(o);continue}for(const u of o){if(t.has(u))return!1;t.add(u)}}return!0};function bd(n){return typeof n=="object"&&n!==null}function nr(n){if(!bd(n)||Object.prototype.toString.call(n)!=="[object Object]")return!1;if(Object.getPrototypeOf(n)===null)return!0;let e=n;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}const Fc=(n,e)=>{if(n.startsWith("RS")||n.startsWith("PS")){const{modulusLength:t}=e.algorithm;if(typeof t!="number"||t<2048)throw new TypeError(`${n} requires key modulusLength to be 2048 bits or larger`)}};function zr(n){return nr(n)&&typeof n.kty=="string"}function vd(n){return n.kty!=="oct"&&typeof n.d=="string"}function Sd(n){return n.kty!=="oct"&&typeof n.d>"u"}function Ed(n){return zr(n)&&n.kty==="oct"&&typeof n.k=="string"}function xd(n){let e,t;switch(n.kty){case"RSA":{switch(n.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(n.alg.slice(-3),10)||1}`},t=n.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Lt('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(n.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},t=n.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},t=n.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new Lt('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(n.alg){case"Ed25519":e={name:"Ed25519"},t=n.d?["sign"]:["verify"];break;case"EdDSA":e={name:n.crv},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new Lt('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new Lt('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:t}}const Rc=async n=>{if(!n.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:t}=xd(n),r=[e,n.ext??!1,n.key_ops??t],o={...n};return delete o.alg,delete o.use,Gr.subtle.importKey("jwk",o,...r)},Tc=n=>xr(n);let jr,Ur;const Ac=n=>n?.[Symbol.toStringTag]==="KeyObject",ei=async(n,e,t,r,o=!1)=>{let u=n.get(e);if(u?.[r])return u[r];const c=await Rc({...t,alg:r});return o&&Object.freeze(e),u?u[r]=c:n.set(e,{[r]:c}),c},Fd=(n,e)=>{if(Ac(n)){let t=n.export({format:"jwk"});return delete t.d,delete t.dp,delete t.dq,delete t.p,delete t.q,delete t.qi,t.k?Tc(t.k):(Ur||(Ur=new WeakMap),ei(Ur,n,t,e))}return zr(n)?n.k?xr(n.k):(Ur||(Ur=new WeakMap),ei(Ur,n,n,e,!0)):n},Rd=(n,e)=>{if(Ac(n)){let t=n.export({format:"jwk"});return t.k?Tc(t.k):(jr||(jr=new WeakMap),ei(jr,n,t,e))}return zr(n)?n.k?xr(n.k):(jr||(jr=new WeakMap),ei(jr,n,n,e,!0)):n},Ua={normalizePublicKey:Fd,normalizePrivateKey:Rd};async function Ic(n,e){if(!nr(n))throw new TypeError("JWK must be an object");switch(e||(e=n.alg),n.kty){case"oct":if(typeof n.k!="string"||!n.k)throw new TypeError('missing "k" (Key Value) Parameter value');return xr(n.k);case"RSA":if("oth"in n&&n.oth!==void 0)throw new Lt('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return Rc({...n,alg:e});default:throw new Lt('Unsupported "kty" (Key Type) Parameter value')}}const Br=n=>n?.[Symbol.toStringTag],Ps=(n,e,t)=>{if(e.use!==void 0&&e.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(e.key_ops!==void 0&&e.key_ops.includes?.(t)!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${t}`);if(e.alg!==void 0&&e.alg!==n)throw new TypeError(`Invalid key for this operation, when present its alg must be ${n}`);return!0},Td=(n,e,t,r)=>{if(!(e instanceof Uint8Array)){if(r&&zr(e)){if(Ed(e)&&Ps(n,e,t))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Ec(e))throw new TypeError(Sc(n,e,...Cn,"Uint8Array",r?"JSON Web Key":null));if(e.type!=="secret")throw new TypeError(`${Br(e)} instances for symmetric algorithms must be of type "secret"`)}},Ad=(n,e,t,r)=>{if(r&&zr(e))switch(t){case"sign":if(vd(e)&&Ps(n,e,t))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(Sd(e)&&Ps(n,e,t))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Ec(e))throw new TypeError(Sc(n,e,...Cn,r?"JSON Web Key":null));if(e.type==="secret")throw new TypeError(`${Br(e)} instances for asymmetric algorithms must not be of type "secret"`);if(t==="sign"&&e.type==="public")throw new TypeError(`${Br(e)} instances for asymmetric algorithm signing must be of type "private"`);if(t==="decrypt"&&e.type==="public")throw new TypeError(`${Br(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&t==="verify"&&e.type==="private")throw new TypeError(`${Br(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&t==="encrypt"&&e.type==="private")throw new TypeError(`${Br(e)} instances for asymmetric algorithm encryption must be of type "public"`)};function Pc(n,e,t,r){e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?Td(e,t,r,n):Ad(e,t,r,n)}Pc.bind(void 0,!1);const Cs=Pc.bind(void 0,!0);function Cc(n,e,t,r,o){if(o.crit!==void 0&&r?.crit===void 0)throw new n('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||r.crit===void 0)return new Set;if(!Array.isArray(r.crit)||r.crit.length===0||r.crit.some(c=>typeof c!="string"||c.length===0))throw new n('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let u;t!==void 0?u=new Map([...Object.entries(t),...e.entries()]):u=e;for(const c of r.crit){if(!u.has(c))throw new Lt(`Extension Header Parameter "${c}" is not recognized`);if(o[c]===void 0)throw new n(`Extension Header Parameter "${c}" is missing`);if(u.get(c)&&r[c]===void 0)throw new n(`Extension Header Parameter "${c}" MUST be integrity protected`)}return new Set(r.crit)}const Id=(n,e)=>{if(e!==void 0&&(!Array.isArray(e)||e.some(t=>typeof t!="string")))throw new TypeError(`"${n}" option must be an array of strings`);if(e)return new Set(e)},Pd=async n=>{if(n instanceof Uint8Array)return{kty:"oct",k:Xn(n)};if(!io(n))throw new TypeError(Is(n,...Cn,"Uint8Array"));if(!n.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:e,key_ops:t,alg:r,use:o,...u}=await Gr.subtle.exportKey("jwk",n);return u};async function Cd(n){return Pd(n)}function kc(n,e){const t=`SHA-${n.slice(-3)}`;switch(n){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:n.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:e.namedCurve};case"Ed25519":return{name:"Ed25519"};case"EdDSA":return{name:e.name};default:throw new Lt(`alg ${n} is not supported either by JOSE or your javascript runtime`)}}async function Nc(n,e,t){if(t==="sign"&&(e=await Ua.normalizePrivateKey(e,n)),t==="verify"&&(e=await Ua.normalizePublicKey(e,n)),io(e))return _d(e,n,t),e;if(e instanceof Uint8Array){if(!n.startsWith("HS"))throw new TypeError(Is(e,...Cn));return Gr.subtle.importKey("raw",e,{hash:`SHA-${n.slice(-3)}`,name:"HMAC"},!1,[t])}throw new TypeError(Is(e,...Cn,"Uint8Array","JSON Web Key"))}const kd=async(n,e,t,r)=>{const o=await Nc(n,e,"verify");Fc(n,o);const u=kc(n,o.algorithm);try{return await Gr.subtle.verify(u,o,t,r)}catch{return!1}};async function Nd(n,e,t){if(!nr(n))throw new ut("Flattened JWS must be an object");if(n.protected===void 0&&n.header===void 0)throw new ut('Flattened JWS must have either of the "protected" or "header" members');if(n.protected!==void 0&&typeof n.protected!="string")throw new ut("JWS Protected Header incorrect type");if(n.payload===void 0)throw new ut("JWS Payload missing");if(typeof n.signature!="string")throw new ut("JWS Signature missing or incorrect type");if(n.header!==void 0&&!nr(n.header))throw new ut("JWS Unprotected Header incorrect type");let r={};if(n.protected)try{const v=xr(n.protected);r=JSON.parse($r.decode(v))}catch{throw new ut("JWS Protected Header is invalid")}if(!xc(r,n.header))throw new ut("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o={...r,...n.header},u=Cc(ut,new Map([["b64",!0]]),t?.crit,r,o);let c=!0;if(u.has("b64")&&(c=r.b64,typeof c!="boolean"))throw new ut('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:l}=o;if(typeof l!="string"||!l)throw new ut('JWS "alg" (Algorithm) Header Parameter missing or invalid');const g=t&&Id("algorithms",t.algorithms);if(g&&!g.has(l))throw new mc('"alg" (Algorithm) Header Parameter value not allowed');if(c){if(typeof n.payload!="string")throw new ut("JWS Payload must be a string")}else if(typeof n.payload!="string"&&!(n.payload instanceof Uint8Array))throw new ut("JWS Payload must be a string or an Uint8Array instance");let h=!1;typeof e=="function"?(e=await e(r,n),h=!0,Cs(l,e,"verify"),zr(e)&&(e=await Ic(e,l))):Cs(l,e,"verify");const d=yc(Yt.encode(n.protected??""),Yt.encode("."),typeof n.payload=="string"?Yt.encode(n.payload):n.payload);let p;try{p=xr(n.signature)}catch{throw new ut("Failed to base64url decode the signature")}if(!await kd(l,e,p,d))throw new bc;let T;if(c)try{T=xr(n.payload)}catch{throw new ut("Failed to base64url decode the payload")}else typeof n.payload=="string"?T=Yt.encode(n.payload):T=n.payload;const S={payload:T};return n.protected!==void 0&&(S.protectedHeader=r),n.header!==void 0&&(S.unprotectedHeader=n.header),h?{...S,key:e}:S}async function Dd(n,e,t){if(n instanceof Uint8Array&&(n=$r.decode(n)),typeof n!="string")throw new ut("Compact JWS must be a string or Uint8Array");const{0:r,1:o,2:u,length:c}=n.split(".");if(c!==3)throw new ut("Invalid Compact JWS");const l=await Nd({payload:o,protected:r,signature:u},e,t),g={payload:l.payload,protectedHeader:l.protectedHeader};return typeof e=="function"?{...g,key:l.key}:g}const ur=n=>Math.floor(n.getTime()/1e3),Dc=60,Lc=Dc*60,ao=Lc*24,Ld=ao*7,jd=ao*365.25,Ud=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Fn=n=>{const e=Ud.exec(n);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const t=parseFloat(e[2]),r=e[3].toLowerCase();let o;switch(r){case"sec":case"secs":case"second":case"seconds":case"s":o=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":o=Math.round(t*Dc);break;case"hour":case"hours":case"hr":case"hrs":case"h":o=Math.round(t*Lc);break;case"day":case"days":case"d":o=Math.round(t*ao);break;case"week":case"weeks":case"w":o=Math.round(t*Ld);break;default:o=Math.round(t*jd);break}return e[1]==="-"||e[4]==="ago"?-o:o},Oa=n=>n.toLowerCase().replace(/^application\//,""),Od=(n,e)=>typeof n=="string"?e.includes(n):Array.isArray(n)?e.some(Set.prototype.has.bind(new Set(n))):!1,Bd=(n,e,t={})=>{let r;try{r=JSON.parse($r.decode(e))}catch{}if(!nr(r))throw new wi("JWT Claims Set must be a top-level JSON object");const{typ:o}=t;if(o&&(typeof n.typ!="string"||Oa(n.typ)!==Oa(o)))throw new $t('unexpected "typ" JWT header value',r,"typ","check_failed");const{requiredClaims:u=[],issuer:c,subject:l,audience:g,maxTokenAge:h}=t,d=[...u];h!==void 0&&d.push("iat"),g!==void 0&&d.push("aud"),l!==void 0&&d.push("sub"),c!==void 0&&d.push("iss");for(const S of new Set(d.reverse()))if(!(S in r))throw new $t(`missing required "${S}" claim`,r,S,"missing");if(c&&!(Array.isArray(c)?c:[c]).includes(r.iss))throw new $t('unexpected "iss" claim value',r,"iss","check_failed");if(l&&r.sub!==l)throw new $t('unexpected "sub" claim value',r,"sub","check_failed");if(g&&!Od(r.aud,typeof g=="string"?[g]:g))throw new $t('unexpected "aud" claim value',r,"aud","check_failed");let p;switch(typeof t.clockTolerance){case"string":p=Fn(t.clockTolerance);break;case"number":p=t.clockTolerance;break;case"undefined":p=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:x}=t,T=ur(x||new Date);if((r.iat!==void 0||h)&&typeof r.iat!="number")throw new $t('"iat" claim must be a number',r,"iat","invalid");if(r.nbf!==void 0){if(typeof r.nbf!="number")throw new $t('"nbf" claim must be a number',r,"nbf","invalid");if(r.nbf>T+p)throw new $t('"nbf" claim timestamp check failed',r,"nbf","check_failed")}if(r.exp!==void 0){if(typeof r.exp!="number")throw new $t('"exp" claim must be a number',r,"exp","invalid");if(r.exp<=T-p)throw new As('"exp" claim timestamp check failed',r,"exp","check_failed")}if(h){const S=T-r.iat,v=typeof h=="number"?h:Fn(h);if(S-p>v)throw new As('"iat" claim timestamp check failed (too far in the past)',r,"iat","check_failed");if(S<0-p)throw new $t('"iat" claim timestamp check failed (it should be in the past)',r,"iat","check_failed")}return r};async function Md(n,e,t){const r=await Dd(n,e,t);if(r.protectedHeader.crit?.includes("b64")&&r.protectedHeader.b64===!1)throw new wi("JWTs MUST NOT use unencoded payload");const u={payload:Bd(r.protectedHeader,r.payload,t),protectedHeader:r.protectedHeader};return typeof e=="function"?{...u,key:r.key}:u}const Hd=async(n,e,t)=>{const r=await Nc(n,e,"sign");Fc(n,r);const o=await Gr.subtle.sign(kc(n,r.algorithm),r,t);return new Uint8Array(o)};class Kd{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){if(!this._protectedHeader&&!this._unprotectedHeader)throw new ut("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!xc(this._protectedHeader,this._unprotectedHeader))throw new ut("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const r={...this._protectedHeader,...this._unprotectedHeader},o=Cc(ut,new Map([["b64",!0]]),t?.crit,this._protectedHeader,r);let u=!0;if(o.has("b64")&&(u=this._protectedHeader.b64,typeof u!="boolean"))throw new ut('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:c}=r;if(typeof c!="string"||!c)throw new ut('JWS "alg" (Algorithm) Header Parameter missing or invalid');Cs(c,e,"sign");let l=this._payload;u&&(l=Yt.encode(Xn(l)));let g;this._protectedHeader?g=Yt.encode(Xn(JSON.stringify(this._protectedHeader))):g=Yt.encode("");const h=yc(g,Yt.encode("."),l),d=await Hd(c,e,h),p={signature:Xn(d),payload:""};return u&&(p.payload=$r.decode(l)),this._unprotectedHeader&&(p.header=this._unprotectedHeader),this._protectedHeader&&(p.protected=$r.decode(g)),p}}class qd{constructor(e){this._flattened=new Kd(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){const r=await this._flattened.sign(e,t);if(r.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}function vr(n,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${n} input`);return e}class Wd{constructor(e={}){if(!nr(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:vr("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:vr("setNotBefore",ur(e))}:this._payload={...this._payload,nbf:ur(new Date)+Fn(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:vr("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:vr("setExpirationTime",ur(e))}:this._payload={...this._payload,exp:ur(new Date)+Fn(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:ur(new Date)}:e instanceof Date?this._payload={...this._payload,iat:vr("setIssuedAt",ur(e))}:typeof e=="string"?this._payload={...this._payload,iat:vr("setIssuedAt",ur(new Date)+Fn(e))}:this._payload={...this._payload,iat:vr("setIssuedAt",e)},this}}class $d extends Wd{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){const r=new qd(Yt.encode(JSON.stringify(this._payload)));if(r.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new wi("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}function Vd(n){switch(typeof n=="string"&&n.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new Lt('Unsupported "alg" value for a JSON Web Key Set')}}function Jd(n){return n&&typeof n=="object"&&Array.isArray(n.keys)&&n.keys.every(Gd)}function Gd(n){return nr(n)}function jc(n){return typeof structuredClone=="function"?structuredClone(n):JSON.parse(JSON.stringify(n))}class zd{constructor(e){if(this._cached=new WeakMap,!Jd(e))throw new so("JSON Web Key Set malformed");this._jwks=jc(e)}async getKey(e,t){const{alg:r,kid:o}={...e,...t?.header},u=Vd(r),c=this._jwks.keys.filter(h=>{let d=u===h.kty;if(d&&typeof o=="string"&&(d=o===h.kid),d&&typeof h.alg=="string"&&(d=r===h.alg),d&&typeof h.use=="string"&&(d=h.use==="sig"),d&&Array.isArray(h.key_ops)&&(d=h.key_ops.includes("verify")),d)switch(r){case"ES256":d=h.crv==="P-256";break;case"ES256K":d=h.crv==="secp256k1";break;case"ES384":d=h.crv==="P-384";break;case"ES512":d=h.crv==="P-521";break;case"Ed25519":d=h.crv==="Ed25519";break;case"EdDSA":d=h.crv==="Ed25519"||h.crv==="Ed448";break}return d}),{0:l,length:g}=c;if(g===0)throw new oo;if(g!==1){const h=new wc,{_cached:d}=this;throw h[Symbol.asyncIterator]=async function*(){for(const p of c)try{yield await Ba(d,p,r)}catch{}},h}return Ba(this._cached,l,r)}}async function Ba(n,e,t){const r=n.get(e)||n.set(e,{}).get(e);if(r[t]===void 0){const o=await Ic({...e,ext:!0},t);if(o instanceof Uint8Array||o.type!=="public")throw new so("JSON Web Key Set members must be public keys");r[t]=o}return r[t]}function Ma(n){const e=new zd(n),t=async(r,o)=>e.getKey(r,o);return Object.defineProperties(t,{jwks:{value:()=>jc(e._jwks),enumerable:!0,configurable:!1,writable:!1}}),t}const Qd=async(n,e,t)=>{let r,o,u=!1;typeof AbortController=="function"&&(r=new AbortController,o=setTimeout(()=>{u=!0,r.abort()},e));const c=await fetch(n.href,{signal:r?r.signal:void 0,redirect:"manual",headers:t.headers}).catch(l=>{throw u?new _c:l});if(o!==void 0&&clearTimeout(o),c.status!==200)throw new xt("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await c.json()}catch{throw new xt("Failed to parse the JSON Web Key Set HTTP response as JSON")}};function Yd(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}let ks;(typeof navigator>"u"||!navigator.userAgent?.startsWith?.("Mozilla/5.0 "))&&(ks="jose/v5.10.0");const ys=Symbol();function Xd(n,e){return!(typeof n!="object"||n===null||!("uat"in n)||typeof n.uat!="number"||Date.now()-n.uat>=e||!("jwks"in n)||!nr(n.jwks)||!Array.isArray(n.jwks.keys)||!Array.prototype.every.call(n.jwks.keys,nr))}class Zd{constructor(e,t){if(!(e instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:t?.agent,headers:t?.headers},this._timeoutDuration=typeof t?.timeoutDuration=="number"?t?.timeoutDuration:5e3,this._cooldownDuration=typeof t?.cooldownDuration=="number"?t?.cooldownDuration:3e4,this._cacheMaxAge=typeof t?.cacheMaxAge=="number"?t?.cacheMaxAge:6e5,t?.[ys]!==void 0&&(this._cache=t?.[ys],Xd(t?.[ys],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=Ma(this._cache.jwks)))}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(e,t){(!this._local||!this.fresh())&&await this.reload();try{return await this._local(e,t)}catch(r){if(r instanceof oo&&this.coolingDown()===!1)return await this.reload(),this._local(e,t);throw r}}async reload(){this._pendingFetch&&Yd()&&(this._pendingFetch=void 0);const e=new Headers(this._options.headers);ks&&!e.has("User-Agent")&&(e.set("User-Agent",ks),this._options.headers=Object.fromEntries(e.entries())),this._pendingFetch||(this._pendingFetch=Qd(this._url,this._timeoutDuration,this._options).then(t=>{this._local=Ma(t),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=t),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(t=>{throw this._pendingFetch=void 0,t})),await this._pendingFetch}}function ep(n,e){const t=new Zd(n,e),r=async(o,u)=>t.getKey(o,u);return Object.defineProperties(r,{coolingDown:{get:()=>t.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>t.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>t.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!t._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>t._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),r}function ms(n){const e=n?.modulusLength??2048;if(typeof e!="number"||e<2048)throw new Lt("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return e}async function tp(n,e){let t,r;switch(n){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${n.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:ms(e)},r=["sign","verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:ms(e)},r=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(n.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:ms(e)},r=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=["sign","verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=["sign","verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=["sign","verify"];break;case"Ed25519":t={name:"Ed25519"},r=["sign","verify"];break;case"EdDSA":{r=["sign","verify"];const o="Ed25519";switch(o){case"Ed25519":case"Ed448":t={name:o};break;default:throw new Lt("Invalid or unsupported crv option provided")}break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{r=["deriveKey","deriveBits"];const o="P-256";switch(o){case"P-256":case"P-384":case"P-521":{t={name:"ECDH",namedCurve:o};break}case"X25519":case"X448":t={name:o};break;default:throw new Lt("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new Lt('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return Gr.subtle.generateKey(t,!1,r)}async function rp(n,e){return tp(n,e)}const Uc="solidClientAuthn:",ti=["ES256","RS256"],wt={ERROR:"error",LOGIN:"login",LOGOUT:"logout",NEW_REFRESH_TOKEN:"newRefreshToken",NEW_TOKENS:"newTokens",AUTHORIZATION_REQUEST:"authorizationRequest",SESSION_EXPIRED:"sessionExpired",SESSION_EXTENDED:"sessionExtended",SESSION_RESTORED:"sessionRestore",TIMEOUT_SET:"timeoutSet"},Ha=5,np="openid",ip="offline_access",sp="webid",Ka=[np,ip,sp];class op{handleables;constructor(e){this.handleables=e,this.handleables=e}async getProperHandler(e){const t=await Promise.all(this.handleables.map(r=>r.canHandle(...e)));for(let r=0;r<t.length;r+=1)if(t[r])return this.handleables[r];return null}async canHandle(...e){return await this.getProperHandler(e)!==null}async handle(...e){const t=await this.getProperHandler(e);if(t)return t.handle(...e);throw new Error(`[${this.constructor.name}] cannot find a suitable handler for: ${e.map(r=>{try{return JSON.stringify(r)}catch{return r.toString()}}).join(", ")}`)}}async function Oc(n,e,t,r){let o,u;try{const{payload:c}=await Md(n,ep(new URL(e)),{issuer:t,audience:r});o=c}catch(c){throw new Error(`Token verification failed: ${c.stack}`)}if(typeof o.azp=="string"&&(u=o.azp),typeof o.webid=="string")return{webId:o.webid,clientId:u};if(typeof o.sub!="string")throw new Error(`The token ${JSON.stringify(o)} is invalid: it has no 'webid' claim and no 'sub' claim.`);try{return new URL(o.sub),{webId:o.sub,clientId:u}}catch(c){throw new Error(`The token has no 'webid' claim, and its 'sub' claim of [${o.sub}] is invalid as a URL - error [${c}].`)}}function ap(n){return Array.isArray(n)?Array.from(new Set([...Ka,...n.filter(e=>typeof e=="string"&&!e.includes(" "))])):Ka}function Bc(n){try{const e=new URL(n),t=!e.searchParams.has("code")&&!e.searchParams.has("state"),r=e.hash==="";return t&&r}catch{return!1}}function Mc(n){const e=new URL(n);return e.searchParams.delete("state"),e.searchParams.delete("code"),e.searchParams.delete("error"),e.searchParams.delete("error_description"),e.searchParams.delete("iss"),e}function up(n,e){return typeof n=="boolean"?!!n:!!e}class cp{storageUtility;redirector;constructor(e,t){this.storageUtility=e,this.redirector=t,this.storageUtility=e,this.redirector=t}parametersGuard=e=>e.issuerConfiguration.grantTypesSupported!==void 0&&e.issuerConfiguration.grantTypesSupported.indexOf("authorization_code")>-1&&e.redirectUrl!==void 0;async canHandle(e){return this.parametersGuard(e)}async setupRedirectHandler({oidcLoginOptions:e,state:t,codeVerifier:r,targetUrl:o}){if(!this.parametersGuard(e))throw new Error("The authorization code grant requires a redirectUrl.");await Promise.all([this.storageUtility.setForUser(t,{sessionId:e.sessionId}),this.storageUtility.setForUser(e.sessionId,{codeVerifier:r,issuer:e.issuer.toString(),redirectUrl:e.redirectUrl,dpop:(!!e.dpop).toString(),keepAlive:up(e.keepAlive,!0).toString()})]),this.redirector.redirect(o,{handleRedirect:e.handleRedirect})}}class lp{sessionInfoManager;constructor(e){this.sessionInfoManager=e,this.sessionInfoManager=e}async canHandle(){return!0}async handle(e){await this.sessionInfoManager.clear(e)}}class hp{redirector;constructor(e){this.redirector=e,this.redirector=e}async canHandle(e,t){return t?.logoutType==="idp"}async handle(e,t){if(t?.logoutType!=="idp")throw new Error("Attempting to call idp logout handler to perform app logout");if(t.toLogoutUrl===void 0)throw new Error("Cannot perform IDP logout. Did you log in using the OIDC authentication flow?");this.redirector.redirect(t.toLogoutUrl(t),{handleRedirect:t.handleRedirect})}}class fp{handlers;constructor(e,t){this.handlers=[new lp(e),new hp(t)]}async canHandle(){return!0}async handle(e,t){for(const r of this.handlers)await r.canHandle(e,t)&&await r.handle(e,t)}}function Hc(){return{isLoggedIn:!1,sessionId:Ar(),fetch:(...n)=>fetch(...n)}}async function Kc(n,e){await Promise.all([e.deleteAllUserData(n,{secure:!1}),e.deleteAllUserData(n,{secure:!0})])}class dp{storageUtility;constructor(e){this.storageUtility=e,this.storageUtility=e}update(e,t){throw new Error("Not Implemented")}set(e,t){throw new Error("Not Implemented")}get(e){throw new Error("Not implemented")}async getAll(){throw new Error("Not implemented")}async clear(e){return Kc(e,this.storageUtility)}async register(e){throw new Error("Not implemented")}async getRegisteredSessionIdAll(){throw new Error("Not implemented")}async clearAll(){throw new Error("Not implemented")}async setOidcContext(e,t){throw new Error("Not implemented")}}function pp({endSessionEndpoint:n,idTokenHint:e,postLogoutRedirectUri:t,state:r}){const o=new URL(n);return e!==void 0&&o.searchParams.append("id_token_hint",e),t!==void 0&&(o.searchParams.append("post_logout_redirect_uri",t),r!==void 0&&o.searchParams.append("state",r)),o.toString()}function gp({endSessionEndpoint:n,idTokenHint:e}){if(n!==void 0)return function({state:r,postLogoutUrl:o}){return pp({endSessionEndpoint:n,idTokenHint:e,state:r,postLogoutRedirectUri:o})}}function yp(n){return typeof n=="string"&&["DPoP","Bearer"].includes(n)}function qc(n){try{return new URL(n),!0}catch{return!1}}function mp(n,e){return e.find(t=>n.includes(t))??null}function wp(n){return n.clientId!==void 0&&!qc(n.clientId)}function _p(n,e){return e.scopesSupported.includes("webid")&&n.clientId!==void 0&&qc(n.clientId)}function bp(n){return typeof n=="string"&&["dynamic","static","solid-oidc"].includes(n)}async function vp(n,e,t,r){let o;if(_p(n,e))o={clientId:n.clientId,clientName:n.clientName,clientType:"solid-oidc"};else if(wp(n))o={clientId:n.clientId,clientSecret:n.clientSecret,clientName:n.clientName,clientType:"static"};else return r.getClient({sessionId:n.sessionId,clientName:n.clientName,redirectUrl:n.redirectUrl},e);const u={clientId:o.clientId,clientType:o.clientType};return o.clientType==="static"&&(u.clientSecret=o.clientSecret),o.clientName&&(u.clientName=o.clientName),await t.setForUser(n.sessionId,u),o}const qa=(n,e)=>fetch(n,e);let Sp=class{loginHandler;redirectHandler;logoutHandler;sessionInfoManager;issuerConfigFetcher;boundLogout;constructor(e,t,r,o,u){this.loginHandler=e,this.redirectHandler=t,this.logoutHandler=r,this.sessionInfoManager=o,this.issuerConfigFetcher=u,this.loginHandler=e,this.redirectHandler=t,this.logoutHandler=r,this.sessionInfoManager=o,this.issuerConfigFetcher=u}fetch=qa;logout=async(e,t)=>{await this.logoutHandler.handle(e,t?.logoutType==="idp"?{...t,toLogoutUrl:this.boundLogout}:t),this.fetch=qa,delete this.boundLogout};getSessionInfo=async e=>this.sessionInfoManager.get(e);getAllSessionInfo=async()=>this.sessionInfoManager.getAll()};async function Wc(n,e,t){try{const[r,o,u,c,l]=await Promise.all([e.getForUser(n,"issuer",{errorIfNull:!0}),e.getForUser(n,"codeVerifier"),e.getForUser(n,"redirectUrl"),e.getForUser(n,"dpop",{errorIfNull:!0}),e.getForUser(n,"keepAlive")]);await e.deleteForUser(n,"codeVerifier");const g=await t.fetchConfig(r);return{codeVerifier:o,redirectUrl:u,issuerConfig:g,dpop:c==="true",keepAlive:typeof l=="string"?l==="true":!0}}catch(r){throw new Error(`Failed to retrieve OIDC context from storage associated with session [${n}]: ${r}`)}}async function Ep(n,e,t,r,o,u,c,l){t!==void 0&&await n.setForUser(e,{webId:t},{secure:c}),r!==void 0&&await n.setForUser(e,{clientId:r},{secure:c}),await n.setForUser(e,{isLoggedIn:o},{secure:c})}class xp{secureStorage;insecureStorage;constructor(e,t){this.secureStorage=e,this.insecureStorage=t,this.secureStorage=e,this.insecureStorage=t}getKey(e){return`solidClientAuthenticationUser:${e}`}async getUserData(e,t){const r=await(t?this.secureStorage:this.insecureStorage).get(this.getKey(e));if(r===void 0)return{};try{return JSON.parse(r)}catch{throw new Error(`Data for user [${e}] in [${t?"secure":"unsecure"}] storage is corrupted - expected valid JSON, but got: ${r}`)}}async setUserData(e,t,r){await(r?this.secureStorage:this.insecureStorage).set(this.getKey(e),JSON.stringify(t))}async get(e,t){const r=await(t?.secure?this.secureStorage:this.insecureStorage).get(e);if(r===void 0&&t?.errorIfNull)throw new Error(`[${e}] is not stored`);return r}async set(e,t,r){return(r?.secure?this.secureStorage:this.insecureStorage).set(e,t)}async delete(e,t){return(t?.secure?this.secureStorage:this.insecureStorage).delete(e)}async getForUser(e,t,r){const o=await this.getUserData(e,r?.secure);let u;if((!o||!o[t])&&(u=void 0),u=o[t],u===void 0&&r?.errorIfNull)throw new Error(`Field [${t}] for user [${e}] is not stored`);return u||void 0}async setForUser(e,t,r){let o;try{o=await this.getUserData(e,r?.secure)}catch{o={}}await this.setUserData(e,{...o,...t},r?.secure)}async deleteForUser(e,t,r){const o=await this.getUserData(e,r?.secure);delete o[t],await this.setUserData(e,o,r?.secure)}async deleteAllUserData(e,t){await(t?.secure?this.secureStorage:this.insecureStorage).delete(this.getKey(e))}}class Fp{map={};async get(e){return this.map[e]||void 0}async set(e,t){this.map[e]=t}async delete(e){delete this.map[e]}}class Ns extends Error{constructor(e){super(e)}}class En extends Error{missingFields;constructor(e){super(`Invalid response from OIDC provider: missing fields ${e}`),this.missingFields=e}}class $c extends Error{error;errorDescription;constructor(e,t,r){super(e),this.error=t,this.errorDescription=r}}function Rp(n){const e=new URL(n);return new URL(e.pathname,e.origin).toString()}async function uo(n,e,t){return new $d({htu:Rp(n),htm:e.toUpperCase(),jti:Ar()}).setProtectedHeader({alg:ti[0],jwk:t.publicKey,typ:"dpop+jwt"}).setIssuedAt().sign(t.privateKey,{})}async function Tp(){const{privateKey:n,publicKey:e}=await rp(ti[0]),t={privateKey:n,publicKey:await Cd(e)};return[t.publicKey.alg]=ti,t}const Vc=600;function Ap(n){return[401,403].includes(n)}async function Ip(n,e,t,r){const o=new Headers(r?.headers);return o.set("Authorization",`DPoP ${e}`),o.set("DPoP",await uo(n,r?.method??"get",t)),{...r,headers:o}}async function Pp(n,e,t,r){if(t!==void 0)return Ip(n,e,t,r);const o=new Headers(r?.headers);return o.set("Authorization",`Bearer ${e}`),{...r,headers:o}}async function Wa(n,e,t,r,o=fetch){return o(e,await Pp(e.toString(),n,r,t))}async function Cp(n,e,t){const r=await n.tokenRefresher.refresh(n.sessionId,n.refreshToken,e);return t?.emit(wt.SESSION_EXTENDED,r.expiresIn??Vc),{accessToken:r.accessToken,refreshToken:r.refreshToken,expiresIn:r.expiresIn}}const ws=n=>n!==void 0?n-Ha>0?n-Ha:n:Vc;function kp(n,e){let t=n,r;const o=e?.refreshOptions;if(o!==void 0){const u=async()=>{try{const{accessToken:c,refreshToken:l,expiresIn:g}=await Cp(o,e.dpopKey,e.eventEmitter);t=c,l!==void 0&&(o.refreshToken=l),clearTimeout(r),r=setTimeout(u,ws(g)*1e3),e.eventEmitter?.emit(wt.TIMEOUT_SET,r)}catch(c){c instanceof $c&&(e?.eventEmitter?.emit(wt.ERROR,c.error,c.errorDescription),e?.eventEmitter?.emit(wt.SESSION_EXPIRED)),c instanceof En&&c.missingFields.includes("access_token")&&e?.eventEmitter?.emit(wt.SESSION_EXPIRED)}};r=setTimeout(u,ws(e.expiresIn)*1e3),e.eventEmitter?.emit(wt.TIMEOUT_SET,r)}else if(e!==void 0&&e.eventEmitter!==void 0){const u=setTimeout(()=>{e.eventEmitter.emit(wt.SESSION_EXPIRED)},ws(e.expiresIn)*1e3);e.eventEmitter.emit(wt.TIMEOUT_SET,u)}return async(u,c)=>{let l=await Wa(t,u,c,e?.dpopKey,e?.fetch);const g=!l.ok&&!Ap(l.status);return l.ok||g||l.url!==u&&e?.dpopKey!==void 0&&(l=await Wa(t,l.url,c,e.dpopKey,e.fetch)),l}}var Zn={exports:{}},Np=Zn.exports,$a;function Dp(){return $a||($a=1,function(n,e){(function(r,o){n.exports=o()})(Np,function(){return function(t){var r={};function o(u){if(r[u])return r[u].exports;var c=r[u]={i:u,l:!1,exports:{}};return t[u].call(c.exports,c,c.exports,o),c.l=!0,c.exports}return o.m=t,o.c=r,o.d=function(u,c,l){o.o(u,c)||Object.defineProperty(u,c,{enumerable:!0,get:l})},o.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},o.t=function(u,c){if(1&c&&(u=o(u)),8&c||4&c&&typeof u=="object"&&u&&u.__esModule)return u;var l=Object.create(null);if(o.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:u}),2&c&&typeof u!="string")for(var g in u)o.d(l,g,(function(h){return u[h]}).bind(null,g));return l},o.n=function(u){var c=u&&u.__esModule?function(){return u.default}:function(){return u};return o.d(c,"a",c),c},o.o=function(u,c){return Object.prototype.hasOwnProperty.call(u,c)},o.p="",o(o.s=22)}([function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function h(d,p){for(var x=0;x<p.length;x++){var T=p[x];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(d,T.key,T)}}return function(d,p,x){return p&&h(d.prototype,p),x&&h(d,x),d}}(),c={debug:function(){},info:function(){},warn:function(){},error:function(){}},l=void 0,g=void 0;(r.Log=function(){function h(){(function(p,x){if(!(p instanceof x))throw new TypeError("Cannot call a class as a function")})(this,h)}return h.reset=function(){g=3,l=c},h.debug=function(){if(g>=4){for(var p=arguments.length,x=Array(p),T=0;T<p;T++)x[T]=arguments[T];l.debug.apply(l,Array.from(x))}},h.info=function(){if(g>=3){for(var p=arguments.length,x=Array(p),T=0;T<p;T++)x[T]=arguments[T];l.info.apply(l,Array.from(x))}},h.warn=function(){if(g>=2){for(var p=arguments.length,x=Array(p),T=0;T<p;T++)x[T]=arguments[T];l.warn.apply(l,Array.from(x))}},h.error=function(){if(g>=1){for(var p=arguments.length,x=Array(p),T=0;T<p;T++)x[T]=arguments[T];l.error.apply(l,Array.from(x))}},u(h,null,[{key:"NONE",get:function(){return 0}},{key:"ERROR",get:function(){return 1}},{key:"WARN",get:function(){return 2}},{key:"INFO",get:function(){return 3}},{key:"DEBUG",get:function(){return 4}},{key:"level",get:function(){return g},set:function(p){if(!(0<=p&&p<=4))throw new Error("Invalid log level");g=p}},{key:"logger",get:function(){return l},set:function(p){if(!p.debug&&p.info&&(p.debug=p.info),!(p.debug&&p.info&&p.warn&&p.error))throw new Error("Invalid logger");l=p}}]),h}()).reset()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function h(d,p){for(var x=0;x<p.length;x++){var T=p[x];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(d,T.key,T)}}return function(d,p,x){return p&&h(d.prototype,p),x&&h(d,x),d}}(),c={setInterval:function(h){function d(p,x){return h.apply(this,arguments)}return d.toString=function(){return h.toString()},d}(function(h,d){return setInterval(h,d)}),clearInterval:function(h){function d(p){return h.apply(this,arguments)}return d.toString=function(){return h.toString()},d}(function(h){return clearInterval(h)})},l=!1,g=null;r.Global=function(){function h(){(function(p,x){if(!(p instanceof x))throw new TypeError("Cannot call a class as a function")})(this,h)}return h._testing=function(){l=!0},h.setXMLHttpRequest=function(p){g=p},u(h,null,[{key:"location",get:function(){if(!l)return location}},{key:"localStorage",get:function(){if(!l&&typeof window<"u")return localStorage}},{key:"sessionStorage",get:function(){if(!l&&typeof window<"u")return sessionStorage}},{key:"XMLHttpRequest",get:function(){if(!l&&typeof window<"u")return g||XMLHttpRequest}},{key:"timer",get:function(){if(!l)return c}}]),h}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.MetadataService=void 0;var u=function(){function d(p,x){for(var T=0;T<x.length;T++){var S=x[T];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(p,S.key,S)}}return function(p,x,T){return x&&d(p.prototype,x),T&&d(p,T),p}}(),c=o(0),l=o(7);function g(d,p){if(!(d instanceof p))throw new TypeError("Cannot call a class as a function")}var h=".well-known/openid-configuration";r.MetadataService=function(){function d(p){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.JsonService;if(g(this,d),!p)throw c.Log.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=p,this._jsonService=new x(["application/jwk-set+json"])}return d.prototype.resetSigningKeys=function(){this._settings=this._settings||{},this._settings.signingKeys=void 0},d.prototype.getMetadata=function(){var x=this;return this._settings.metadata?(c.Log.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(c.Log.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(function(T){c.Log.debug("MetadataService.getMetadata: json received");var S=x._settings.metadataSeed||{};return x._settings.metadata=Object.assign({},S,T),x._settings.metadata})):(c.Log.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))},d.prototype.getIssuer=function(){return this._getMetadataProperty("issuer")},d.prototype.getAuthorizationEndpoint=function(){return this._getMetadataProperty("authorization_endpoint")},d.prototype.getUserInfoEndpoint=function(){return this._getMetadataProperty("userinfo_endpoint")},d.prototype.getTokenEndpoint=function(){var x=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return this._getMetadataProperty("token_endpoint",x)},d.prototype.getCheckSessionIframe=function(){return this._getMetadataProperty("check_session_iframe",!0)},d.prototype.getEndSessionEndpoint=function(){return this._getMetadataProperty("end_session_endpoint",!0)},d.prototype.getRevocationEndpoint=function(){return this._getMetadataProperty("revocation_endpoint",!0)},d.prototype.getKeysEndpoint=function(){return this._getMetadataProperty("jwks_uri",!0)},d.prototype._getMetadataProperty=function(x){var T=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return c.Log.debug("MetadataService.getMetadataProperty for: "+x),this.getMetadata().then(function(S){if(c.Log.debug("MetadataService.getMetadataProperty: metadata recieved"),S[x]===void 0){if(T===!0)return void c.Log.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+x);throw c.Log.error("MetadataService.getMetadataProperty: Metadata does not contain property "+x),new Error("Metadata does not contain property "+x)}return S[x]})},d.prototype.getSigningKeys=function(){var x=this;return this._settings.signingKeys?(c.Log.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(function(T){return c.Log.debug("MetadataService.getSigningKeys: jwks_uri received",T),x._jsonService.getJson(T).then(function(S){if(c.Log.debug("MetadataService.getSigningKeys: key set received",S),!S.keys)throw c.Log.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return x._settings.signingKeys=S.keys,x._settings.signingKeys})})},u(d,[{key:"metadataUrl",get:function(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(h)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=h))),this._metadataUrl}}]),d}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.UrlUtility=void 0;var u=o(0),c=o(1);r.UrlUtility=function(){function l(){(function(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.addQueryParam=function(h,d,p){return h.indexOf("?")<0&&(h+="?"),h[h.length-1]!=="?"&&(h+="&"),h+=encodeURIComponent(d),h+="=",h+=encodeURIComponent(p)},l.parseUrlFragment=function(h){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#",p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c.Global;typeof h!="string"&&(h=p.location.href);var x=h.lastIndexOf(d);x>=0&&(h=h.substr(x+1)),d==="?"&&(x=h.indexOf("#"))>=0&&(h=h.substr(0,x));for(var T,S={},v=/([^&=]+)=([^&]*)/g,R=0;T=v.exec(h);)if(S[decodeURIComponent(T[1])]=decodeURIComponent(T[2].replace(/\+/g," ")),R++>50)return u.Log.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",h),{error:"Response exceeded expected number of parameters"};for(var b in S)return S;return{}},l}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.JoseUtil=void 0;var u=o(26),c=function(g){return g&&g.__esModule?g:{default:g}}(o(33));r.JoseUtil=(0,c.default)({jws:u.jws,KeyUtil:u.KeyUtil,X509:u.X509,crypto:u.crypto,hextob64u:u.hextob64u,b64tohex:u.b64tohex,AllowedSigningAlgs:u.AllowedSigningAlgs})},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.OidcClientSettings=void 0;var u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},c=function(){function b(E,A){for(var k=0;k<A.length;k++){var D=A[k];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(E,D.key,D)}}return function(E,A,k){return A&&b(E.prototype,A),k&&b(E,k),E}}(),l=o(0),g=o(23),h=o(6),d=o(24),p=o(2);function x(b,E){if(!(b instanceof E))throw new TypeError("Cannot call a class as a function")}var T=".well-known/openid-configuration",S="id_token",v="openid",R="client_secret_post";r.OidcClientSettings=function(){function b(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},A=E.authority,k=E.metadataUrl,D=E.metadata,B=E.signingKeys,M=E.metadataSeed,ie=E.client_id,he=E.client_secret,L=E.response_type,re=L===void 0?S:L,be=E.scope,ue=be===void 0?v:be,ke=E.redirect_uri,ne=E.post_logout_redirect_uri,fe=E.client_authentication,Ne=fe===void 0?R:fe,pe=E.prompt,Te=E.display,K=E.max_age,me=E.ui_locales,Ie=E.acr_values,Fe=E.resource,De=E.response_mode,Oe=E.filterProtocolClaims,$e=Oe===void 0||Oe,He=E.loadUserInfo,Se=He===void 0||He,Re=E.staleStateAge,Ce=Re===void 0?900:Re,V=E.clockSkew,I=V===void 0?300:V,y=E.clockService,C=y===void 0?new g.ClockService:y,O=E.userInfoJwtIssuer,X=O===void 0?"OP":O,se=E.mergeClaims,_e=se!==void 0&&se,te=E.stateStore,Ee=te===void 0?new h.WebStorageStateStore:te,Ae=E.ResponseValidatorCtor,ye=Ae===void 0?d.ResponseValidator:Ae,We=E.MetadataServiceCtor,Xe=We===void 0?p.MetadataService:We,je=E.extraQueryParams,Je=je===void 0?{}:je,N=E.extraTokenParams,w=N===void 0?{}:N;x(this,b),this._authority=A,this._metadataUrl=k,this._metadata=D,this._metadataSeed=M,this._signingKeys=B,this._client_id=ie,this._client_secret=he,this._response_type=re,this._scope=ue,this._redirect_uri=ke,this._post_logout_redirect_uri=ne,this._client_authentication=Ne,this._prompt=pe,this._display=Te,this._max_age=K,this._ui_locales=me,this._acr_values=Ie,this._resource=Fe,this._response_mode=De,this._filterProtocolClaims=!!$e,this._loadUserInfo=!!Se,this._staleStateAge=Ce,this._clockSkew=I,this._clockService=C,this._userInfoJwtIssuer=X,this._mergeClaims=!!_e,this._stateStore=Ee,this._validator=new ye(this),this._metadataService=new Xe(this),this._extraQueryParams=(Je===void 0?"undefined":u(Je))==="object"?Je:{},this._extraTokenParams=(w===void 0?"undefined":u(w))==="object"?w:{}}return b.prototype.getEpochTime=function(){return this._clockService.getEpochTime()},c(b,[{key:"client_id",get:function(){return this._client_id},set:function(A){if(this._client_id)throw l.Log.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=A}},{key:"client_secret",get:function(){return this._client_secret}},{key:"response_type",get:function(){return this._response_type}},{key:"scope",get:function(){return this._scope}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function(){return this._post_logout_redirect_uri}},{key:"client_authentication",get:function(){return this._client_authentication}},{key:"prompt",get:function(){return this._prompt}},{key:"display",get:function(){return this._display}},{key:"max_age",get:function(){return this._max_age}},{key:"ui_locales",get:function(){return this._ui_locales}},{key:"acr_values",get:function(){return this._acr_values}},{key:"resource",get:function(){return this._resource}},{key:"response_mode",get:function(){return this._response_mode}},{key:"authority",get:function(){return this._authority},set:function(A){if(this._authority)throw l.Log.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=A}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(T)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=T)),this._metadataUrl}},{key:"metadata",get:function(){return this._metadata},set:function(A){this._metadata=A}},{key:"metadataSeed",get:function(){return this._metadataSeed},set:function(A){this._metadataSeed=A}},{key:"signingKeys",get:function(){return this._signingKeys},set:function(A){this._signingKeys=A}},{key:"filterProtocolClaims",get:function(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function(){return this._loadUserInfo}},{key:"staleStateAge",get:function(){return this._staleStateAge}},{key:"clockSkew",get:function(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function(){return this._userInfoJwtIssuer}},{key:"mergeClaims",get:function(){return this._mergeClaims}},{key:"stateStore",get:function(){return this._stateStore}},{key:"validator",get:function(){return this._validator}},{key:"metadataService",get:function(){return this._metadataService}},{key:"extraQueryParams",get:function(){return this._extraQueryParams},set:function(A){(A===void 0?"undefined":u(A))==="object"?this._extraQueryParams=A:this._extraQueryParams={}}},{key:"extraTokenParams",get:function(){return this._extraTokenParams},set:function(A){(A===void 0?"undefined":u(A))==="object"?this._extraTokenParams=A:this._extraTokenParams={}}}]),b}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.WebStorageStateStore=void 0;var u=o(0),c=o(1);function l(g,h){if(!(g instanceof h))throw new TypeError("Cannot call a class as a function")}r.WebStorageStateStore=function(){function g(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=h.prefix,p=d===void 0?"oidc.":d,x=h.store,T=x===void 0?c.Global.localStorage:x;l(this,g),this._store=T,this._prefix=p}return g.prototype.set=function(d,p){return u.Log.debug("WebStorageStateStore.set",d),d=this._prefix+d,this._store.setItem(d,p),Promise.resolve()},g.prototype.get=function(d){u.Log.debug("WebStorageStateStore.get",d),d=this._prefix+d;var p=this._store.getItem(d);return Promise.resolve(p)},g.prototype.remove=function(d){u.Log.debug("WebStorageStateStore.remove",d),d=this._prefix+d;var p=this._store.getItem(d);return this._store.removeItem(d),Promise.resolve(p)},g.prototype.getAllKeys=function(){u.Log.debug("WebStorageStateStore.getAllKeys");for(var d=[],p=0;p<this._store.length;p++){var x=this._store.key(p);x.indexOf(this._prefix)===0&&d.push(x.substr(this._prefix.length))}return Promise.resolve(d)},g}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.JsonService=void 0;var u=o(0),c=o(1);function l(g,h){if(!(g instanceof h))throw new TypeError("Cannot call a class as a function")}r.JsonService=function(){function g(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:c.Global.XMLHttpRequest,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;l(this,g),h&&Array.isArray(h)?this._contentTypes=h.slice():this._contentTypes=[],this._contentTypes.push("application/json"),p&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=d,this._jwtHandler=p}return g.prototype.getJson=function(d,p){var x=this;if(!d)throw u.Log.error("JsonService.getJson: No url passed"),new Error("url");return u.Log.debug("JsonService.getJson, url: ",d),new Promise(function(T,S){var v=new x._XMLHttpRequest;v.open("GET",d);var R=x._contentTypes,b=x._jwtHandler;v.onload=function(){if(u.Log.debug("JsonService.getJson: HTTP response received, status",v.status),v.status===200){var E=v.getResponseHeader("Content-Type");if(E){var A=R.find(function(k){if(E.startsWith(k))return!0});if(A=="application/jwt")return void b(v).then(T,S);if(A)try{return void T(JSON.parse(v.responseText))}catch(k){return u.Log.error("JsonService.getJson: Error parsing JSON response",k.message),void S(k)}}S(Error("Invalid response Content-Type: "+E+", from URL: "+d))}else S(Error(v.statusText+" ("+v.status+")"))},v.onerror=function(){u.Log.error("JsonService.getJson: network error"),S(Error("Network Error"))},p&&(u.Log.debug("JsonService.getJson: token passed, setting Authorization header"),v.setRequestHeader("Authorization","Bearer "+p)),v.send()})},g.prototype.postForm=function(d,p,x){var T=this;if(!d)throw u.Log.error("JsonService.postForm: No url passed"),new Error("url");return u.Log.debug("JsonService.postForm, url: ",d),new Promise(function(S,v){var R=new T._XMLHttpRequest;R.open("POST",d);var b=T._contentTypes;R.onload=function(){if(u.Log.debug("JsonService.postForm: HTTP response received, status",R.status),R.status!==200){if(R.status===400&&(B=R.getResponseHeader("Content-Type"))&&b.find(function(M){if(B.startsWith(M))return!0}))try{var D=JSON.parse(R.responseText);if(D&&D.error)return u.Log.error("JsonService.postForm: Error from server: ",D.error),void v(new Error(D.error))}catch(M){return u.Log.error("JsonService.postForm: Error parsing JSON response",M.message),void v(M)}v(Error(R.statusText+" ("+R.status+")"))}else{var B;if((B=R.getResponseHeader("Content-Type"))&&b.find(function(M){if(B.startsWith(M))return!0}))try{return void S(JSON.parse(R.responseText))}catch(M){return u.Log.error("JsonService.postForm: Error parsing JSON response",M.message),void v(M)}v(Error("Invalid response Content-Type: "+B+", from URL: "+d))}},R.onerror=function(){u.Log.error("JsonService.postForm: network error"),v(Error("Network Error"))};var E="";for(var A in p){var k=p[A];k&&(E.length>0&&(E+="&"),E+=encodeURIComponent(A),E+="=",E+=encodeURIComponent(k))}R.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),x!==void 0&&R.setRequestHeader("Authorization","Basic "+btoa(x)),R.send(E)})},g}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.SigninRequest=void 0;var u=o(0),c=o(3),l=o(13);r.SigninRequest=function(){function g(h){var d=h.url,p=h.client_id,x=h.redirect_uri,T=h.response_type,S=h.scope,v=h.authority,R=h.data,b=h.prompt,E=h.display,A=h.max_age,k=h.ui_locales,D=h.id_token_hint,B=h.login_hint,M=h.acr_values,ie=h.resource,he=h.response_mode,L=h.request,re=h.request_uri,be=h.extraQueryParams,ue=h.request_type,ke=h.client_secret,ne=h.extraTokenParams,fe=h.skipUserInfo;if(function(Fe,De){if(!(Fe instanceof De))throw new TypeError("Cannot call a class as a function")}(this,g),!d)throw u.Log.error("SigninRequest.ctor: No url passed"),new Error("url");if(!p)throw u.Log.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!x)throw u.Log.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!T)throw u.Log.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!S)throw u.Log.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!v)throw u.Log.error("SigninRequest.ctor: No authority passed"),new Error("authority");var Ne=g.isOidc(T),pe=g.isCode(T);he||(he=g.isCode(T)?"query":null),this.state=new l.SigninState({nonce:Ne,data:R,client_id:p,authority:v,redirect_uri:x,code_verifier:pe,request_type:ue,response_mode:he,client_secret:ke,scope:S,extraTokenParams:ne,skipUserInfo:fe}),d=c.UrlUtility.addQueryParam(d,"client_id",p),d=c.UrlUtility.addQueryParam(d,"redirect_uri",x),d=c.UrlUtility.addQueryParam(d,"response_type",T),d=c.UrlUtility.addQueryParam(d,"scope",S),d=c.UrlUtility.addQueryParam(d,"state",this.state.id),Ne&&(d=c.UrlUtility.addQueryParam(d,"nonce",this.state.nonce)),pe&&(d=c.UrlUtility.addQueryParam(d,"code_challenge",this.state.code_challenge),d=c.UrlUtility.addQueryParam(d,"code_challenge_method","S256"));var Te={prompt:b,display:E,max_age:A,ui_locales:k,id_token_hint:D,login_hint:B,acr_values:M,resource:ie,request:L,request_uri:re,response_mode:he};for(var K in Te)Te[K]&&(d=c.UrlUtility.addQueryParam(d,K,Te[K]));for(var me in be)d=c.UrlUtility.addQueryParam(d,me,be[me]);this.url=d}return g.isOidc=function(d){return!!d.split(/\s+/g).filter(function(p){return p==="id_token"})[0]},g.isOAuth=function(d){return!!d.split(/\s+/g).filter(function(p){return p==="token"})[0]},g.isCode=function(d){return!!d.split(/\s+/g).filter(function(p){return p==="code"})[0]},g}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.State=void 0;var u=function(){function h(d,p){for(var x=0;x<p.length;x++){var T=p[x];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(d,T.key,T)}}return function(d,p,x){return p&&h(d.prototype,p),x&&h(d,x),d}}(),c=o(0),l=function(d){return d&&d.__esModule?d:{default:d}}(o(14));function g(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")}r.State=function(){function h(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=d.id,x=d.data,T=d.created,S=d.request_type;g(this,h),this._id=p||(0,l.default)(),this._data=x,this._created=typeof T=="number"&&T>0?T:parseInt(Date.now()/1e3),this._request_type=S}return h.prototype.toStorageString=function(){return c.Log.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})},h.fromStorageString=function(p){return c.Log.debug("State.fromStorageString"),new h(JSON.parse(p))},h.clearStaleState=function(p,x){var T=Date.now()/1e3-x;return p.getAllKeys().then(function(S){c.Log.debug("State.clearStaleState: got keys",S);for(var v=[],R=function(k){var D=S[k];E=p.get(D).then(function(B){var M=!1;if(B)try{var ie=h.fromStorageString(B);c.Log.debug("State.clearStaleState: got item from key: ",D,ie.created),ie.created<=T&&(M=!0)}catch(he){c.Log.error("State.clearStaleState: Error parsing state for key",D,he.message),M=!0}else c.Log.debug("State.clearStaleState: no item in storage for key: ",D),M=!0;if(M)return c.Log.debug("State.clearStaleState: removed item for key: ",D),p.remove(D)}),v.push(E)},b=0;b<S.length;b++){var E;R(b)}return c.Log.debug("State.clearStaleState: waiting on promise count:",v.length),Promise.all(v)})},u(h,[{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"created",get:function(){return this._created}},{key:"request_type",get:function(){return this._request_type}}]),h}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.OidcClient=void 0;var u=function(){function R(b,E){for(var A=0;A<E.length;A++){var k=E[A];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(b,k.key,k)}}return function(b,E,A){return E&&R(b.prototype,E),A&&R(b,A),b}}(),c=o(0),l=o(5),g=o(12),h=o(8),d=o(34),p=o(35),x=o(36),T=o(13),S=o(9);function v(R,b){if(!(R instanceof b))throw new TypeError("Cannot call a class as a function")}r.OidcClient=function(){function R(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v(this,R),b instanceof l.OidcClientSettings?this._settings=b:this._settings=new l.OidcClientSettings(b)}return R.prototype.createSigninRequest=function(){var E=this,A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},k=A.response_type,D=A.scope,B=A.redirect_uri,M=A.data,ie=A.state,he=A.prompt,L=A.display,re=A.max_age,be=A.ui_locales,ue=A.id_token_hint,ke=A.login_hint,ne=A.acr_values,fe=A.resource,Ne=A.request,pe=A.request_uri,Te=A.response_mode,K=A.extraQueryParams,me=A.extraTokenParams,Ie=A.request_type,Fe=A.skipUserInfo,De=arguments[1];c.Log.debug("OidcClient.createSigninRequest");var Oe=this._settings.client_id;k=k||this._settings.response_type,D=D||this._settings.scope,B=B||this._settings.redirect_uri,he=he||this._settings.prompt,L=L||this._settings.display,re=re||this._settings.max_age,be=be||this._settings.ui_locales,ne=ne||this._settings.acr_values,fe=fe||this._settings.resource,Te=Te||this._settings.response_mode,K=K||this._settings.extraQueryParams,me=me||this._settings.extraTokenParams;var $e=this._settings.authority;return h.SigninRequest.isCode(k)&&k!=="code"?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then(function(He){c.Log.debug("OidcClient.createSigninRequest: Received authorization endpoint",He);var Se=new h.SigninRequest({url:He,client_id:Oe,redirect_uri:B,response_type:k,scope:D,data:M||ie,authority:$e,prompt:he,display:L,max_age:re,ui_locales:be,id_token_hint:ue,login_hint:ke,acr_values:ne,resource:fe,request:Ne,request_uri:pe,extraQueryParams:K,extraTokenParams:me,request_type:Ie,response_mode:Te,client_secret:E._settings.client_secret,skipUserInfo:Fe}),Re=Se.state;return(De=De||E._stateStore).set(Re.id,Re.toStorageString()).then(function(){return Se})})},R.prototype.readSigninResponseState=function(E,A){var k=arguments.length>2&&arguments[2]!==void 0&&arguments[2];c.Log.debug("OidcClient.readSigninResponseState");var D=this._settings.response_mode==="query"||!this._settings.response_mode&&h.SigninRequest.isCode(this._settings.response_type),B=D?"?":"#",M=new d.SigninResponse(E,B);if(!M.state)return c.Log.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response"));A=A||this._stateStore;var ie=k?A.remove.bind(A):A.get.bind(A);return ie(M.state).then(function(he){if(!he)throw c.Log.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:T.SigninState.fromStorageString(he),response:M}})},R.prototype.processSigninResponse=function(E,A){var k=this;return c.Log.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(E,A,!0).then(function(D){var B=D.state,M=D.response;return c.Log.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),k._validator.validateSigninResponse(B,M)})},R.prototype.createSignoutRequest=function(){var E=this,A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},k=A.id_token_hint,D=A.data,B=A.state,M=A.post_logout_redirect_uri,ie=A.extraQueryParams,he=A.request_type,L=arguments[1];return c.Log.debug("OidcClient.createSignoutRequest"),M=M||this._settings.post_logout_redirect_uri,ie=ie||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then(function(re){if(!re)throw c.Log.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");c.Log.debug("OidcClient.createSignoutRequest: Received end session endpoint",re);var be=new p.SignoutRequest({url:re,id_token_hint:k,post_logout_redirect_uri:M,data:D||B,extraQueryParams:ie,request_type:he}),ue=be.state;return ue&&(c.Log.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(L=L||E._stateStore).set(ue.id,ue.toStorageString())),be})},R.prototype.readSignoutResponseState=function(E,A){var k=arguments.length>2&&arguments[2]!==void 0&&arguments[2];c.Log.debug("OidcClient.readSignoutResponseState");var D=new x.SignoutResponse(E);if(!D.state)return c.Log.debug("OidcClient.readSignoutResponseState: No state in response"),D.error?(c.Log.warn("OidcClient.readSignoutResponseState: Response was error: ",D.error),Promise.reject(new g.ErrorResponse(D))):Promise.resolve({state:void 0,response:D});var B=D.state;A=A||this._stateStore;var M=k?A.remove.bind(A):A.get.bind(A);return M(B).then(function(ie){if(!ie)throw c.Log.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:S.State.fromStorageString(ie),response:D}})},R.prototype.processSignoutResponse=function(E,A){var k=this;return c.Log.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(E,A,!0).then(function(D){var B=D.state,M=D.response;return B?(c.Log.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),k._validator.validateSignoutResponse(B,M)):(c.Log.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),M)})},R.prototype.clearStaleState=function(E){return c.Log.debug("OidcClient.clearStaleState"),E=E||this._stateStore,S.State.clearStaleState(E,this.settings.staleStateAge)},u(R,[{key:"_stateStore",get:function(){return this.settings.stateStore}},{key:"_validator",get:function(){return this.settings.validator}},{key:"_metadataService",get:function(){return this.settings.metadataService}},{key:"settings",get:function(){return this._settings}},{key:"metadataService",get:function(){return this._metadataService}}]),R}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.TokenClient=void 0;var u=o(7),c=o(2),l=o(0);function g(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")}r.TokenClient=function(){function h(d){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:u.JsonService,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c.MetadataService;if(g(this,h),!d)throw l.Log.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=d,this._jsonService=new p,this._metadataService=new x(this._settings)}return h.prototype.exchangeCode=function(){var p=this,x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(x=Object.assign({},x)).grant_type=x.grant_type||"authorization_code",x.client_id=x.client_id||this._settings.client_id,x.client_secret=x.client_secret||this._settings.client_secret,x.redirect_uri=x.redirect_uri||this._settings.redirect_uri;var T=void 0,S=x._client_authentication||this._settings._client_authentication;return delete x._client_authentication,x.code?x.redirect_uri?x.code_verifier?x.client_id?x.client_secret||S!="client_secret_basic"?(S=="client_secret_basic"&&(T=x.client_id+":"+x.client_secret,delete x.client_id,delete x.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(v){return l.Log.debug("TokenClient.exchangeCode: Received token endpoint"),p._jsonService.postForm(v,x,T).then(function(R){return l.Log.debug("TokenClient.exchangeCode: response received"),R})})):(l.Log.error("TokenClient.exchangeCode: No client_secret passed"),Promise.reject(new Error("A client_secret is required"))):(l.Log.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(l.Log.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(l.Log.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(l.Log.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))},h.prototype.exchangeRefreshToken=function(){var p=this,x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(x=Object.assign({},x)).grant_type=x.grant_type||"refresh_token",x.client_id=x.client_id||this._settings.client_id,x.client_secret=x.client_secret||this._settings.client_secret;var T=void 0,S=x._client_authentication||this._settings._client_authentication;return delete x._client_authentication,x.refresh_token?x.client_id?(S=="client_secret_basic"&&(T=x.client_id+":"+x.client_secret,delete x.client_id,delete x.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(v){return l.Log.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),p._jsonService.postForm(v,x,T).then(function(R){return l.Log.debug("TokenClient.exchangeRefreshToken: response received"),R})})):(l.Log.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(l.Log.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))},h}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.ErrorResponse=void 0;var u=o(0);function c(g,h){if(!(g instanceof h))throw new TypeError("Cannot call a class as a function")}function l(g,h){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!h||typeof h!="object"&&typeof h!="function"?g:h}r.ErrorResponse=function(g){function h(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=d.error,x=d.error_description,T=d.error_uri,S=d.state,v=d.session_state;if(c(this,h),!p)throw u.Log.error("No error passed to ErrorResponse"),new Error("error");var R=l(this,g.call(this,x||p));return R.name="ErrorResponse",R.error=p,R.error_description=x,R.error_uri=T,R.state=S,R.session_state=v,R}return function(p,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof x);p.prototype=Object.create(x&&x.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),x&&(Object.setPrototypeOf?Object.setPrototypeOf(p,x):p.__proto__=x)}(h,g),h}(Error)},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.SigninState=void 0;var u=function(){function x(T,S){for(var v=0;v<S.length;v++){var R=S[v];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(T,R.key,R)}}return function(T,S,v){return S&&x(T.prototype,S),v&&x(T,v),T}}(),c=o(0),l=o(9),g=o(4),h=function(T){return T&&T.__esModule?T:{default:T}}(o(14));function d(x,T){if(!(x instanceof T))throw new TypeError("Cannot call a class as a function")}function p(x,T){if(!x)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!T||typeof T!="object"&&typeof T!="function"?x:T}r.SigninState=function(x){function T(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},v=S.nonce,R=S.authority,b=S.client_id,E=S.redirect_uri,A=S.code_verifier,k=S.response_mode,D=S.client_secret,B=S.scope,M=S.extraTokenParams,ie=S.skipUserInfo;d(this,T);var he=p(this,x.call(this,arguments[0]));if(v===!0?he._nonce=(0,h.default)():v&&(he._nonce=v),A===!0?he._code_verifier=(0,h.default)()+(0,h.default)()+(0,h.default)():A&&(he._code_verifier=A),he.code_verifier){var L=g.JoseUtil.hashString(he.code_verifier,"SHA256");he._code_challenge=g.JoseUtil.hexToBase64Url(L)}return he._redirect_uri=E,he._authority=R,he._client_id=b,he._response_mode=k,he._client_secret=D,he._scope=B,he._extraTokenParams=M,he._skipUserInfo=ie,he}return function(v,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);v.prototype=Object.create(R&&R.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(v,R):v.__proto__=R)}(T,x),T.prototype.toStorageString=function(){return c.Log.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})},T.fromStorageString=function(v){return c.Log.debug("SigninState.fromStorageString"),new T(JSON.parse(v))},u(T,[{key:"nonce",get:function(){return this._nonce}},{key:"authority",get:function(){return this._authority}},{key:"client_id",get:function(){return this._client_id}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"code_verifier",get:function(){return this._code_verifier}},{key:"code_challenge",get:function(){return this._code_challenge}},{key:"response_mode",get:function(){return this._response_mode}},{key:"client_secret",get:function(){return this._client_secret}},{key:"scope",get:function(){return this._scope}},{key:"extraTokenParams",get:function(){return this._extraTokenParams}},{key:"skipUserInfo",get:function(){return this._skipUserInfo}}]),T}(l.State)},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(){return(u!="undefined"&&u!==null&&u.getRandomValues!==void 0?c:l)().replace(/-/g,"")};var u=typeof window<"u"?window.crypto||window.msCrypto:null;function c(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,function(g){return(g^u.getRandomValues(new Uint8Array(1))[0]&15>>g/4).toString(16)})}function l(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,function(g){return(g^16*Math.random()>>g/4).toString(16)})}t.exports=r.default},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.User=void 0;var u=function(){function l(g,h){for(var d=0;d<h.length;d++){var p=h[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(g,p.key,p)}}return function(g,h,d){return h&&l(g.prototype,h),d&&l(g,d),g}}(),c=o(0);r.User=function(){function l(g){var h=g.id_token,d=g.session_state,p=g.access_token,x=g.refresh_token,T=g.token_type,S=g.scope,v=g.profile,R=g.expires_at,b=g.state;(function(A,k){if(!(A instanceof k))throw new TypeError("Cannot call a class as a function")})(this,l),this.id_token=h,this.session_state=d,this.access_token=p,this.refresh_token=x,this.token_type=T,this.scope=S,this.profile=v,this.expires_at=R,this.state=b}return l.prototype.toStorageString=function(){return c.Log.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})},l.fromStorageString=function(h){return c.Log.debug("User.fromStorageString"),new l(JSON.parse(h))},u(l,[{key:"expires_in",get:function(){if(this.expires_at){var h=parseInt(Date.now()/1e3);return this.expires_at-h}},set:function(h){var d=parseInt(h);if(typeof d=="number"&&d>0){var p=parseInt(Date.now()/1e3);this.expires_at=p+d}}},{key:"expired",get:function(){var h=this.expires_in;if(h!==void 0)return h<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}}]),l}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.AccessTokenEvents=void 0;var u=o(0),c=o(46);function l(g,h){if(!(g instanceof h))throw new TypeError("Cannot call a class as a function")}r.AccessTokenEvents=function(){function g(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=h.accessTokenExpiringNotificationTime,p=d===void 0?60:d,x=h.accessTokenExpiringTimer,T=x===void 0?new c.Timer("Access token expiring"):x,S=h.accessTokenExpiredTimer,v=S===void 0?new c.Timer("Access token expired"):S;l(this,g),this._accessTokenExpiringNotificationTime=p,this._accessTokenExpiring=T,this._accessTokenExpired=v}return g.prototype.load=function(d){if(d.access_token&&d.expires_in!==void 0){var p=d.expires_in;if(u.Log.debug("AccessTokenEvents.load: access token present, remaining duration:",p),p>0){var x=p-this._accessTokenExpiringNotificationTime;x<=0&&(x=1),u.Log.debug("AccessTokenEvents.load: registering expiring timer in:",x),this._accessTokenExpiring.init(x)}else u.Log.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var T=p+1;u.Log.debug("AccessTokenEvents.load: registering expired timer in:",T),this._accessTokenExpired.init(T)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},g.prototype.unload=function(){u.Log.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},g.prototype.addAccessTokenExpiring=function(d){this._accessTokenExpiring.addHandler(d)},g.prototype.removeAccessTokenExpiring=function(d){this._accessTokenExpiring.removeHandler(d)},g.prototype.addAccessTokenExpired=function(d){this._accessTokenExpired.addHandler(d)},g.prototype.removeAccessTokenExpired=function(d){this._accessTokenExpired.removeHandler(d)},g}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.Event=void 0;var u=o(0);r.Event=function(){function c(l){(function(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")})(this,c),this._name=l,this._callbacks=[]}return c.prototype.addHandler=function(g){this._callbacks.push(g)},c.prototype.removeHandler=function(g){var h=this._callbacks.findIndex(function(d){return d===g});h>=0&&this._callbacks.splice(h,1)},c.prototype.raise=function(){u.Log.debug("Event: Raising event: "+this._name);for(var g=0;g<this._callbacks.length;g++){var h;(h=this._callbacks)[g].apply(h,arguments)}},c}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.SessionMonitor=void 0;var u=function(){function d(p,x){for(var T=0;T<x.length;T++){var S=x[T];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(p,S.key,S)}}return function(p,x,T){return x&&d(p.prototype,x),T&&d(p,T),p}}(),c=o(0),l=o(19),g=o(1);function h(d,p){if(!(d instanceof p))throw new TypeError("Cannot call a class as a function")}r.SessionMonitor=function(){function d(p){var x=this,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.CheckSessionIFrame,S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:g.Global.timer;if(h(this,d),!p)throw c.Log.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=p,this._CheckSessionIFrameCtor=T,this._timer=S,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),Promise.resolve(this._userManager.getUser().then(function(v){v?x._start(v):x._settings.monitorAnonymousSession&&x._userManager.querySessionStatus().then(function(R){var b={session_state:R.session_state};R.sub&&R.sid&&(b.profile={sub:R.sub,sid:R.sid}),x._start(b)}).catch(function(R){c.Log.error("SessionMonitor ctor: error from querySessionStatus:",R.message)})}).catch(function(v){c.Log.error("SessionMonitor ctor: error from getUser:",v.message)}))}return d.prototype._start=function(x){var T=this,S=x.session_state;S&&(x.profile?(this._sub=x.profile.sub,this._sid=x.profile.sid,c.Log.debug("SessionMonitor._start: session_state:",S,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,c.Log.debug("SessionMonitor._start: session_state:",S,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(S):this._metadataService.getCheckSessionIframe().then(function(v){if(v){c.Log.debug("SessionMonitor._start: Initializing check session iframe");var R=T._client_id,b=T._checkSessionInterval,E=T._stopCheckSessionOnError;T._checkSessionIFrame=new T._CheckSessionIFrameCtor(T._callback.bind(T),R,v,b,E),T._checkSessionIFrame.load().then(function(){T._checkSessionIFrame.start(S)})}else c.Log.warn("SessionMonitor._start: No check session iframe found in the metadata")}).catch(function(v){c.Log.error("SessionMonitor._start: Error from getCheckSessionIframe:",v.message)}))},d.prototype._stop=function(){var x=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(c.Log.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var T=this._timer.setInterval(function(){x._timer.clearInterval(T),x._userManager.querySessionStatus().then(function(S){var v={session_state:S.session_state};S.sub&&S.sid&&(v.profile={sub:S.sub,sid:S.sid}),x._start(v)}).catch(function(S){c.Log.error("SessionMonitor: error from querySessionStatus:",S.message)})},1e3)},d.prototype._callback=function(){var x=this;this._userManager.querySessionStatus().then(function(T){var S=!0;T?T.sub===x._sub?(S=!1,x._checkSessionIFrame.start(T.session_state),T.sid===x._sid?c.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",T.session_state):(c.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",T.session_state),x._userManager.events._raiseUserSessionChanged())):c.Log.debug("SessionMonitor._callback: Different subject signed into OP:",T.sub):c.Log.debug("SessionMonitor._callback: Subject no longer signed into OP"),S&&(x._sub?(c.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),x._userManager.events._raiseUserSignedOut()):(c.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),x._userManager.events._raiseUserSignedIn()))}).catch(function(T){x._sub&&(c.Log.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",T.message),x._userManager.events._raiseUserSignedOut())})},u(d,[{key:"_settings",get:function(){return this._userManager.settings}},{key:"_metadataService",get:function(){return this._userManager.metadataService}},{key:"_client_id",get:function(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function(){return this._settings.stopCheckSessionOnError}}]),d}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.CheckSessionIFrame=void 0;var u=o(0);function c(l,g){if(!(l instanceof g))throw new TypeError("Cannot call a class as a function")}r.CheckSessionIFrame=function(){function l(g,h,d,p){var x=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];c(this,l),this._callback=g,this._client_id=h,this._url=d,this._interval=p||2e3,this._stopOnError=x;var T=d.indexOf("/",d.indexOf("//")+2);this._frame_origin=d.substr(0,T),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.width=0,this._frame.height=0,this._frame.src=d}return l.prototype.load=function(){var h=this;return new Promise(function(d){h._frame.onload=function(){d()},window.document.body.appendChild(h._frame),h._boundMessageEvent=h._message.bind(h),window.addEventListener("message",h._boundMessageEvent,!1)})},l.prototype._message=function(h){h.origin===this._frame_origin&&h.source===this._frame.contentWindow&&(h.data==="error"?(u.Log.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):h.data==="changed"?(u.Log.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):u.Log.debug("CheckSessionIFrame: "+h.data+" message from check session op iframe"))},l.prototype.start=function(h){var d=this;if(this._session_state!==h){u.Log.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=h;var p=function(){d._frame.contentWindow.postMessage(d._client_id+" "+d._session_state,d._frame_origin)};p(),this._timer=window.setInterval(p,this._interval)}},l.prototype.stop=function(){this._session_state=null,this._timer&&(u.Log.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)},l}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.TokenRevocationClient=void 0;var u=o(0),c=o(2),l=o(1);function g(p,x){if(!(p instanceof x))throw new TypeError("Cannot call a class as a function")}var h="access_token",d="refresh_token";r.TokenRevocationClient=function(){function p(x){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.Global.XMLHttpRequest,S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c.MetadataService;if(g(this,p),!x)throw u.Log.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=x,this._XMLHttpRequestCtor=T,this._metadataService=new S(this._settings)}return p.prototype.revoke=function(T,S){var v=this,R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"access_token";if(!T)throw u.Log.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if(R!==h&&R!=d)throw u.Log.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then(function(b){if(b){u.Log.debug("TokenRevocationClient.revoke: Revoking "+R);var E=v._settings.client_id,A=v._settings.client_secret;return v._revoke(b,E,A,T,R)}if(S)throw u.Log.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")})},p.prototype._revoke=function(T,S,v,R,b){var E=this;return new Promise(function(A,k){var D=new E._XMLHttpRequestCtor;D.open("POST",T),D.onload=function(){u.Log.debug("TokenRevocationClient.revoke: HTTP response received, status",D.status),D.status===200?A():k(Error(D.statusText+" ("+D.status+")"))},D.onerror=function(){u.Log.debug("TokenRevocationClient.revoke: Network Error."),k("Network Error")};var B="client_id="+encodeURIComponent(S);v&&(B+="&client_secret="+encodeURIComponent(v)),B+="&token_type_hint="+encodeURIComponent(b),B+="&token="+encodeURIComponent(R),D.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),D.send(B)})},p}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.CordovaPopupWindow=void 0;var u=function(){function l(g,h){for(var d=0;d<h.length;d++){var p=h[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(g,p.key,p)}}return function(g,h,d){return h&&l(g.prototype,h),d&&l(g,d),g}}(),c=o(0);r.CordovaPopupWindow=function(){function l(g){var h=this;(function(p,x){if(!(p instanceof x))throw new TypeError("Cannot call a class as a function")})(this,l),this._promise=new Promise(function(d,p){h._resolve=d,h._reject=p}),this.features=g.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=g.popupWindowTarget||"_blank",this.redirect_uri=g.startUrl,c.Log.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}return l.prototype._isInAppBrowserInstalled=function(h){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(d){return h.hasOwnProperty(d)})},l.prototype.navigate=function(h){if(h&&h.url){if(!window.cordova)return this._error("cordova is undefined");var d=window.cordova.require("cordova/plugin_list").metadata;if(this._isInAppBrowserInstalled(d)===!1)return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(h.url,this.target,this.features),this._popup?(c.Log.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise},l.prototype._loadStartCallback=function(h){h.url.indexOf(this.redirect_uri)===0&&this._success({url:h.url})},l.prototype._exitCallback=function(h){this._error(h)},l.prototype._success=function(h){this._cleanup(),c.Log.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(h)},l.prototype._error=function(h){this._cleanup(),c.Log.error(h),this._reject(new Error(h))},l.prototype.close=function(){this._cleanup()},l.prototype._cleanup=function(){this._popup&&(c.Log.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null},u(l,[{key:"promise",get:function(){return this._promise}}]),l}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0});var u=o(0),c=o(10),l=o(5),g=o(6),h=o(37),d=o(38),p=o(16),x=o(2),T=o(48),S=o(49),v=o(19),R=o(20),b=o(18),E=o(1),A=o(15),k=o(50);r.default={Version:k.Version,Log:u.Log,OidcClient:c.OidcClient,OidcClientSettings:l.OidcClientSettings,WebStorageStateStore:g.WebStorageStateStore,InMemoryWebStorage:h.InMemoryWebStorage,UserManager:d.UserManager,AccessTokenEvents:p.AccessTokenEvents,MetadataService:x.MetadataService,CordovaPopupNavigator:T.CordovaPopupNavigator,CordovaIFrameNavigator:S.CordovaIFrameNavigator,CheckSessionIFrame:v.CheckSessionIFrame,TokenRevocationClient:R.TokenRevocationClient,SessionMonitor:b.SessionMonitor,Global:E.Global,User:A.User},t.exports=r.default},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.ClockService=function(){function u(){(function(l,g){if(!(l instanceof g))throw new TypeError("Cannot call a class as a function")})(this,u)}return u.prototype.getEpochTime=function(){return Promise.resolve(Date.now()/1e3|0)},u}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.ResponseValidator=void 0;var u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},c=o(0),l=o(2),g=o(25),h=o(11),d=o(12),p=o(4);function x(S,v){if(!(S instanceof v))throw new TypeError("Cannot call a class as a function")}var T=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"];r.ResponseValidator=function(){function S(v){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.MetadataService,b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:g.UserInfoService,E=arguments.length>3&&arguments[3]!==void 0?arguments[3]:p.JoseUtil,A=arguments.length>4&&arguments[4]!==void 0?arguments[4]:h.TokenClient;if(x(this,S),!v)throw c.Log.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=v,this._metadataService=new R(this._settings),this._userInfoService=new b(this._settings),this._joseUtil=E,this._tokenClient=new A(this._settings)}return S.prototype.validateSigninResponse=function(R,b){var E=this;return c.Log.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(R,b).then(function(A){return c.Log.debug("ResponseValidator.validateSigninResponse: state processed"),E._validateTokens(R,A).then(function(k){return c.Log.debug("ResponseValidator.validateSigninResponse: tokens validated"),E._processClaims(R,k).then(function(D){return c.Log.debug("ResponseValidator.validateSigninResponse: claims processed"),D})})})},S.prototype.validateSignoutResponse=function(R,b){return R.id!==b.state?(c.Log.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(c.Log.debug("ResponseValidator.validateSignoutResponse: state validated"),b.state=R.data,b.error?(c.Log.warn("ResponseValidator.validateSignoutResponse: Response was error",b.error),Promise.reject(new d.ErrorResponse(b))):Promise.resolve(b))},S.prototype._processSigninParams=function(R,b){if(R.id!==b.state)return c.Log.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!R.client_id)return c.Log.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!R.authority)return c.Log.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==R.authority)return c.Log.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=R.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==R.client_id)return c.Log.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=R.client_id;return c.Log.debug("ResponseValidator._processSigninParams: state validated"),b.state=R.data,b.error?(c.Log.warn("ResponseValidator._processSigninParams: Response was error",b.error),Promise.reject(new d.ErrorResponse(b))):R.nonce&&!b.id_token?(c.Log.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!R.nonce&&b.id_token?(c.Log.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):R.code_verifier&&!b.code?(c.Log.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!R.code_verifier&&b.code?(c.Log.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(b.scope||(b.scope=R.scope),Promise.resolve(b))},S.prototype._processClaims=function(R,b){var E=this;if(b.isOpenIdConnect){if(c.Log.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),b.profile=this._filterProtocolClaims(b.profile),R.skipUserInfo!==!0&&this._settings.loadUserInfo&&b.access_token)return c.Log.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(b.access_token).then(function(A){return c.Log.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),A.sub!==b.profile.sub?(c.Log.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in id_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in id_token"))):(b.profile=E._mergeClaims(b.profile,A),c.Log.debug("ResponseValidator._processClaims: user info claims received, updated profile:",b.profile),b)});c.Log.debug("ResponseValidator._processClaims: not loading user info")}else c.Log.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(b)},S.prototype._mergeClaims=function(R,b){var E=Object.assign({},R);for(var A in b){var k=b[A];Array.isArray(k)||(k=[k]);for(var D=0;D<k.length;D++){var B=k[D];E[A]?Array.isArray(E[A])?E[A].indexOf(B)<0&&E[A].push(B):E[A]!==B&&((B===void 0?"undefined":u(B))==="object"&&this._settings.mergeClaims?E[A]=this._mergeClaims(E[A],B):E[A]=[E[A],B]):E[A]=B}}return E},S.prototype._filterProtocolClaims=function(R){c.Log.debug("ResponseValidator._filterProtocolClaims, incoming claims:",R);var b=Object.assign({},R);return this._settings._filterProtocolClaims?(T.forEach(function(E){delete b[E]}),c.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",b)):c.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),b},S.prototype._validateTokens=function(R,b){return b.code?(c.Log.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(R,b)):b.id_token?b.access_token?(c.Log.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(R,b)):(c.Log.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(R,b)):(c.Log.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(b))},S.prototype._processCode=function(R,b){var E=this,A={client_id:R.client_id,client_secret:R.client_secret,code:b.code,redirect_uri:R.redirect_uri,code_verifier:R.code_verifier};return R.extraTokenParams&&u(R.extraTokenParams)==="object"&&Object.assign(A,R.extraTokenParams),this._tokenClient.exchangeCode(A).then(function(k){for(var D in k)b[D]=k[D];return b.id_token?(c.Log.debug("ResponseValidator._processCode: token response successful, processing id_token"),E._validateIdTokenAttributes(R,b)):(c.Log.debug("ResponseValidator._processCode: token response successful, returning response"),b)})},S.prototype._validateIdTokenAttributes=function(R,b){var E=this;return this._metadataService.getIssuer().then(function(A){var k=R.client_id,D=E._settings.clockSkew;return c.Log.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",D),E._settings.getEpochTime().then(function(B){return E._joseUtil.validateJwtAttributes(b.id_token,A,k,D,B).then(function(M){return R.nonce&&R.nonce!==M.nonce?(c.Log.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):M.sub?(b.profile=M,b):(c.Log.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})})},S.prototype._validateIdTokenAndAccessToken=function(R,b){var E=this;return this._validateIdToken(R,b).then(function(A){return E._validateAccessToken(A)})},S.prototype._getSigningKeyForJwt=function(R){var b=this;return this._metadataService.getSigningKeys().then(function(E){var A=R.header.kid;if(!E)return c.Log.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));c.Log.debug("ResponseValidator._validateIdToken: Received signing keys");var k=void 0;if(A)k=E.filter(function(D){return D.kid===A})[0];else{if((E=b._filterByAlg(E,R.header.alg)).length>1)return c.Log.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));k=E[0]}return Promise.resolve(k)})},S.prototype._getSigningKeyForJwtWithSingleRetry=function(R){var b=this;return this._getSigningKeyForJwt(R).then(function(E){return E?Promise.resolve(E):(b._metadataService.resetSigningKeys(),b._getSigningKeyForJwt(R))})},S.prototype._validateIdToken=function(R,b){var E=this;if(!R.nonce)return c.Log.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));var A=this._joseUtil.parseJwt(b.id_token);return A&&A.header&&A.payload?R.nonce!==A.payload.nonce?(c.Log.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):this._metadataService.getIssuer().then(function(k){return c.Log.debug("ResponseValidator._validateIdToken: Received issuer"),E._getSigningKeyForJwtWithSingleRetry(A).then(function(D){if(!D)return c.Log.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var B=R.client_id,M=E._settings.clockSkew;return c.Log.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",M),E._joseUtil.validateJwt(b.id_token,D,k,B,M).then(function(){return c.Log.debug("ResponseValidator._validateIdToken: JWT validation successful"),A.payload.sub?(b.profile=A.payload,b):(c.Log.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})}):(c.Log.error("ResponseValidator._validateIdToken: Failed to parse id_token",A),Promise.reject(new Error("Failed to parse id_token")))},S.prototype._filterByAlg=function(R,b){var E=null;if(b.startsWith("RS"))E="RSA";else if(b.startsWith("PS"))E="PS";else{if(!b.startsWith("ES"))return c.Log.debug("ResponseValidator._filterByAlg: alg not supported: ",b),[];E="EC"}return c.Log.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",E),R=R.filter(function(A){return A.kty===E}),c.Log.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",E,R.length),R},S.prototype._validateAccessToken=function(R){if(!R.profile)return c.Log.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!R.profile.at_hash)return c.Log.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!R.id_token)return c.Log.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));var b=this._joseUtil.parseJwt(R.id_token);if(!b||!b.header)return c.Log.error("ResponseValidator._validateAccessToken: Failed to parse id_token",b),Promise.reject(new Error("Failed to parse id_token"));var E=b.header.alg;if(!E||E.length!==5)return c.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",E),Promise.reject(new Error("Unsupported alg: "+E));var A=E.substr(2,3);if(!A)return c.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",E,A),Promise.reject(new Error("Unsupported alg: "+E));if((A=parseInt(A))!==256&&A!==384&&A!==512)return c.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",E,A),Promise.reject(new Error("Unsupported alg: "+E));var k="sha"+A,D=this._joseUtil.hashString(R.access_token,k);if(!D)return c.Log.error("ResponseValidator._validateAccessToken: access_token hash failed:",k),Promise.reject(new Error("Failed to validate at_hash"));var B=D.substr(0,D.length/2),M=this._joseUtil.hexToBase64Url(B);return M!==R.profile.at_hash?(c.Log.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",M,R.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(c.Log.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(R))},S}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.UserInfoService=void 0;var u=o(7),c=o(2),l=o(0),g=o(4);function h(d,p){if(!(d instanceof p))throw new TypeError("Cannot call a class as a function")}r.UserInfoService=function(){function d(p){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:u.JsonService,T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c.MetadataService,S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:g.JoseUtil;if(h(this,d),!p)throw l.Log.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=p,this._jsonService=new x(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new T(this._settings),this._joseUtil=S}return d.prototype.getClaims=function(x){var T=this;return x?this._metadataService.getUserInfoEndpoint().then(function(S){return l.Log.debug("UserInfoService.getClaims: received userinfo url",S),T._jsonService.getJson(S,x).then(function(v){return l.Log.debug("UserInfoService.getClaims: claims received",v),v})}):(l.Log.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))},d.prototype._getClaimsFromJwt=function(x){var T=this;try{var S=this._joseUtil.parseJwt(x.responseText);if(!S||!S.header||!S.payload)return l.Log.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",S),Promise.reject(new Error("Failed to parse id_token"));var v=S.header.kid,R=void 0;switch(this._settings.userInfoJwtIssuer){case"OP":R=this._metadataService.getIssuer();break;case"ANY":R=Promise.resolve(S.payload.iss);break;default:R=Promise.resolve(this._settings.userInfoJwtIssuer)}return R.then(function(b){return l.Log.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+b),T._metadataService.getSigningKeys().then(function(E){if(!E)return l.Log.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));l.Log.debug("UserInfoService._getClaimsFromJwt: Received signing keys");var A=void 0;if(v)A=E.filter(function(B){return B.kid===v})[0];else{if((E=T._filterByAlg(E,S.header.alg)).length>1)return l.Log.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));A=E[0]}if(!A)return l.Log.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var k=T._settings.client_id,D=T._settings.clockSkew;return l.Log.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",D),T._joseUtil.validateJwt(x.responseText,A,b,k,D,void 0,!0).then(function(){return l.Log.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),S.payload})})})}catch(b){return l.Log.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",b.message),void reject(b)}},d.prototype._filterByAlg=function(x,T){var S=null;if(T.startsWith("RS"))S="RSA";else if(T.startsWith("PS"))S="PS";else{if(!T.startsWith("ES"))return l.Log.debug("UserInfoService._filterByAlg: alg not supported: ",T),[];S="EC"}return l.Log.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",S),x=x.filter(function(v){return v.kty===S}),l.Log.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",S,x.length),x},d}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.AllowedSigningAlgs=r.b64tohex=r.hextob64u=r.crypto=r.X509=r.KeyUtil=r.jws=void 0;var u=o(27);r.jws=u.jws,r.KeyUtil=u.KEYUTIL,r.X509=u.X509,r.crypto=u.crypto,r.hextob64u=u.hextob64u,r.b64tohex=u.b64tohex,r.AllowedSigningAlgs=["RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"]},function(t,r,o){(function(u){Object.defineProperty(r,"__esModule",{value:!0});var c,l,g,h,d,p,x,T,S,v,R,b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},E={},A={},k=k||(c=Math,g=(l={}).lib={},h=g.Base=function(){function s(){}return{extend:function(a){s.prototype=this;var f=new s;return a&&f.mixIn(a),f.hasOwnProperty("init")||(f.init=function(){f.$super.init.apply(this,arguments)}),f.init.prototype=f,f.$super=this,f},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var f in a)a.hasOwnProperty(f)&&(this[f]=a[f]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=g.WordArray=h.extend({init:function(i,a){i=this.words=i||[],this.sigBytes=a??4*i.length},toString:function(i){return(i||x).stringify(this)},concat:function(i){var a=this.words,f=i.words,m=this.sigBytes,P=i.sigBytes;if(this.clamp(),m%4)for(var U=0;U<P;U++){var $=f[U>>>2]>>>24-U%4*8&255;a[m+U>>>2]|=$<<24-(m+U)%4*8}else for(U=0;U<P;U+=4)a[m+U>>>2]=f[U>>>2];return this.sigBytes+=P,this},clamp:function(){var i=this.words,a=this.sigBytes;i[a>>>2]&=4294967295<<32-a%4*8,i.length=c.ceil(a/4)},clone:function(){var i=h.clone.call(this);return i.words=this.words.slice(0),i},random:function(i){for(var a=[],f=0;f<i;f+=4)a.push(4294967296*c.random()|0);return new d.init(a,i)}}),p=l.enc={},x=p.Hex={stringify:function(i){for(var a=i.words,f=i.sigBytes,m=[],P=0;P<f;P++){var U=a[P>>>2]>>>24-P%4*8&255;m.push((U>>>4).toString(16)),m.push((15&U).toString(16))}return m.join("")},parse:function(i){for(var a=i.length,f=[],m=0;m<a;m+=2)f[m>>>3]|=parseInt(i.substr(m,2),16)<<24-m%8*4;return new d.init(f,a/2)}},T=p.Latin1={stringify:function(i){for(var a=i.words,f=i.sigBytes,m=[],P=0;P<f;P++){var U=a[P>>>2]>>>24-P%4*8&255;m.push(String.fromCharCode(U))}return m.join("")},parse:function(i){for(var a=i.length,f=[],m=0;m<a;m++)f[m>>>2]|=(255&i.charCodeAt(m))<<24-m%4*8;return new d.init(f,a)}},S=p.Utf8={stringify:function(i){try{return decodeURIComponent(escape(T.stringify(i)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(i){return T.parse(unescape(encodeURIComponent(i)))}},v=g.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(i){typeof i=="string"&&(i=S.parse(i)),this._data.concat(i),this._nDataBytes+=i.sigBytes},_process:function(i){var a=this._data,f=a.words,m=a.sigBytes,P=this.blockSize,U=m/(4*P),$=(U=i?c.ceil(U):c.max((0|U)-this._minBufferSize,0))*P,H=c.min(4*$,m);if($){for(var q=0;q<$;q+=P)this._doProcessBlock(f,q);var J=f.splice(0,$);a.sigBytes-=H}return new d.init(J,H)},clone:function(){var i=h.clone.call(this);return i._data=this._data.clone(),i},_minBufferSize:0}),g.Hasher=v.extend({cfg:h.extend(),init:function(i){this.cfg=this.cfg.extend(i),this.reset()},reset:function(){v.reset.call(this),this._doReset()},update:function(i){return this._append(i),this._process(),this},finalize:function(i){return i&&this._append(i),this._doFinalize()},blockSize:16,_createHelper:function(i){return function(a,f){return new i.init(f).finalize(a)}},_createHmacHelper:function(i){return function(a,f){return new R.HMAC.init(i,f).finalize(a)}}}),R=l.algo={},l);(function(s){var i,a=(i=k).lib,f=a.Base,m=a.WordArray;(i=i.x64={}).Word=f.extend({init:function(U,$){this.high=U,this.low=$}}),i.WordArray=f.extend({init:function(U,$){U=this.words=U||[],this.sigBytes=$??8*U.length},toX32:function(){for(var U=this.words,$=U.length,H=[],q=0;q<$;q++){var J=U[q];H.push(J.high),H.push(J.low)}return m.create(H,this.sigBytes)},clone:function(){for(var U=f.clone.call(this),$=U.words=this.words.slice(0),H=$.length,q=0;q<H;q++)$[q]=$[q].clone();return U}})})(),function(){var s=k,i=s.lib.WordArray;s.enc.Base64={stringify:function(f){var m=f.words,P=f.sigBytes,U=this._map;f.clamp(),f=[];for(var $=0;$<P;$+=3)for(var H=(m[$>>>2]>>>24-$%4*8&255)<<16|(m[$+1>>>2]>>>24-($+1)%4*8&255)<<8|m[$+2>>>2]>>>24-($+2)%4*8&255,q=0;4>q&&$+.75*q<P;q++)f.push(U.charAt(H>>>6*(3-q)&63));if(m=U.charAt(64))for(;f.length%4;)f.push(m);return f.join("")},parse:function(f){var m=f.length,P=this._map;(U=P.charAt(64))&&(U=f.indexOf(U))!=-1&&(m=U);for(var U=[],$=0,H=0;H<m;H++)if(H%4){var q=P.indexOf(f.charAt(H-1))<<H%4*2,J=P.indexOf(f.charAt(H))>>>6-H%4*2;U[$>>>2]|=(q|J)<<24-$%4*8,$++}return i.create(U,$)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(s){for(var i=k,a=(m=i.lib).WordArray,f=m.Hasher,m=i.algo,P=[],U=[],$=function(we){return 4294967296*(we-(0|we))|0},H=2,q=0;64>q;){var J;e:{J=H;for(var z=s.sqrt(J),ee=2;ee<=z;ee++)if(!(J%ee)){J=!1;break e}J=!0}J&&(8>q&&(P[q]=$(s.pow(H,.5))),U[q]=$(s.pow(H,1/3)),q++),H++}var oe=[];m=m.SHA256=f.extend({_doReset:function(){this._hash=new a.init(P.slice(0))},_doProcessBlock:function(we,ve){for(var j=this._hash.words,G=j[0],Q=j[1],Z=j[2],de=j[3],xe=j[4],Me=j[5],Pe=j[6],Ge=j[7],Be=0;64>Be;Be++){if(16>Be)oe[Be]=0|we[ve+Be];else{var qe=oe[Be-15],nt=oe[Be-2];oe[Be]=((qe<<25|qe>>>7)^(qe<<14|qe>>>18)^qe>>>3)+oe[Be-7]+((nt<<15|nt>>>17)^(nt<<13|nt>>>19)^nt>>>10)+oe[Be-16]}qe=Ge+((xe<<26|xe>>>6)^(xe<<21|xe>>>11)^(xe<<7|xe>>>25))+(xe&Me^~xe&Pe)+U[Be]+oe[Be],nt=((G<<30|G>>>2)^(G<<19|G>>>13)^(G<<10|G>>>22))+(G&Q^G&Z^Q&Z),Ge=Pe,Pe=Me,Me=xe,xe=de+qe|0,de=Z,Z=Q,Q=G,G=qe+nt|0}j[0]=j[0]+G|0,j[1]=j[1]+Q|0,j[2]=j[2]+Z|0,j[3]=j[3]+de|0,j[4]=j[4]+xe|0,j[5]=j[5]+Me|0,j[6]=j[6]+Pe|0,j[7]=j[7]+Ge|0},_doFinalize:function(){var we=this._data,ve=we.words,j=8*this._nDataBytes,G=8*we.sigBytes;return ve[G>>>5]|=128<<24-G%32,ve[14+(G+64>>>9<<4)]=s.floor(j/4294967296),ve[15+(G+64>>>9<<4)]=j,we.sigBytes=4*ve.length,this._process(),this._hash},clone:function(){var we=f.clone.call(this);return we._hash=this._hash.clone(),we}}),i.SHA256=f._createHelper(m),i.HmacSHA256=f._createHmacHelper(m)}(Math),function(){function s(){return f.create.apply(f,arguments)}for(var i=k,a=i.lib.Hasher,f=(P=i.x64).Word,m=P.WordArray,P=i.algo,U=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],$=[],H=0;80>H;H++)$[H]=s();P=P.SHA512=a.extend({_doReset:function(){this._hash=new m.init([new f.init(1779033703,4089235720),new f.init(3144134277,2227873595),new f.init(1013904242,4271175723),new f.init(2773480762,1595750129),new f.init(1359893119,2917565137),new f.init(2600822924,725511199),new f.init(528734635,4215389547),new f.init(1541459225,327033209)])},_doProcessBlock:function(J,z){for(var ee=(Q=this._hash.words)[0],oe=Q[1],le=Q[2],we=Q[3],ve=Q[4],j=Q[5],G=Q[6],Q=Q[7],Z=ee.high,de=ee.low,xe=oe.high,Me=oe.low,Pe=le.high,Ge=le.low,Be=we.high,qe=we.low,nt=ve.high,ot=ve.low,it=j.high,Dt=j.low,Ft=G.high,At=G.low,ft=Q.high,gt=Q.low,bt=Z,It=de,en=xe,kr=Me,tn=Pe,Nr=Ge,_i=Be,rn=qe,Kt=nt,Mt=ot,jn=it,nn=Dt,Un=Ft,sn=At,bi=ft,on=gt,qt=0;80>qt;qt++){var mr=$[qt];if(16>qt)var Zt=mr.high=0|J[z+2*qt],at=mr.low=0|J[z+2*qt+1];else{Zt=((at=(Zt=$[qt-15]).high)>>>1|(er=Zt.low)<<31)^(at>>>8|er<<24)^at>>>7;var er=(er>>>1|at<<31)^(er>>>8|at<<24)^(er>>>7|at<<25),Dr=((at=(Dr=$[qt-2]).high)>>>19|(yt=Dr.low)<<13)^(at<<3|yt>>>29)^at>>>6,yt=(yt>>>19|at<<13)^(yt<<3|at>>>29)^(yt>>>6|at<<26),vi=(at=$[qt-7]).high,wr=(_r=$[qt-16]).high,_r=_r.low;Zt=(Zt=(Zt=Zt+vi+((at=er+at.low)>>>0<er>>>0?1:0))+Dr+((at=at+yt)>>>0<yt>>>0?1:0))+wr+((at=at+_r)>>>0<_r>>>0?1:0),mr.high=Zt,mr.low=at}vi=Kt&jn^~Kt&Un,_r=Mt&nn^~Mt&sn,mr=bt&en^bt&tn^en&tn;var il=It&kr^It&Nr^kr&Nr,sl=(er=(bt>>>28|It<<4)^(bt<<30|It>>>2)^(bt<<25|It>>>7),Dr=(It>>>28|bt<<4)^(It<<30|bt>>>2)^(It<<25|bt>>>7),(yt=U[qt]).high),fo=yt.low;wr=bi+((Kt>>>14|Mt<<18)^(Kt>>>18|Mt<<14)^(Kt<<23|Mt>>>9))+((yt=on+((Mt>>>14|Kt<<18)^(Mt>>>18|Kt<<14)^(Mt<<23|Kt>>>9)))>>>0<on>>>0?1:0),bi=Un,on=sn,Un=jn,sn=nn,jn=Kt,nn=Mt,Kt=_i+(wr=(wr=(wr=wr+vi+((yt=yt+_r)>>>0<_r>>>0?1:0))+sl+((yt=yt+fo)>>>0<fo>>>0?1:0))+Zt+((yt=yt+at)>>>0<at>>>0?1:0))+((Mt=rn+yt|0)>>>0<rn>>>0?1:0)|0,_i=tn,rn=Nr,tn=en,Nr=kr,en=bt,kr=It,bt=wr+(mr=er+mr+((at=Dr+il)>>>0<Dr>>>0?1:0))+((It=yt+at|0)>>>0<yt>>>0?1:0)|0}de=ee.low=de+It,ee.high=Z+bt+(de>>>0<It>>>0?1:0),Me=oe.low=Me+kr,oe.high=xe+en+(Me>>>0<kr>>>0?1:0),Ge=le.low=Ge+Nr,le.high=Pe+tn+(Ge>>>0<Nr>>>0?1:0),qe=we.low=qe+rn,we.high=Be+_i+(qe>>>0<rn>>>0?1:0),ot=ve.low=ot+Mt,ve.high=nt+Kt+(ot>>>0<Mt>>>0?1:0),Dt=j.low=Dt+nn,j.high=it+jn+(Dt>>>0<nn>>>0?1:0),At=G.low=At+sn,G.high=Ft+Un+(At>>>0<sn>>>0?1:0),gt=Q.low=gt+on,Q.high=ft+bi+(gt>>>0<on>>>0?1:0)},_doFinalize:function(){var J=this._data,z=J.words,ee=8*this._nDataBytes,oe=8*J.sigBytes;return z[oe>>>5]|=128<<24-oe%32,z[30+(oe+128>>>10<<5)]=Math.floor(ee/4294967296),z[31+(oe+128>>>10<<5)]=ee,J.sigBytes=4*z.length,this._process(),this._hash.toX32()},clone:function(){var J=a.clone.call(this);return J._hash=this._hash.clone(),J},blockSize:32}),i.SHA512=a._createHelper(P),i.HmacSHA512=a._createHmacHelper(P)}(),function(){var s=k,i=(m=s.x64).Word,a=m.WordArray,f=(m=s.algo).SHA512,m=m.SHA384=f.extend({_doReset:function(){this._hash=new a.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var U=f._doFinalize.call(this);return U.sigBytes-=16,U}});s.SHA384=f._createHelper(m),s.HmacSHA384=f._createHmacHelper(m)}();/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */var D,B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function M(s){var i,a,f="";for(i=0;i+3<=s.length;i+=3)a=parseInt(s.substring(i,i+3),16),f+=B.charAt(a>>6)+B.charAt(63&a);for(i+1==s.length?(a=parseInt(s.substring(i,i+1),16),f+=B.charAt(a<<2)):i+2==s.length&&(a=parseInt(s.substring(i,i+2),16),f+=B.charAt(a>>2)+B.charAt((3&a)<<4)),"=";(3&f.length)>0;)f+="=";return f}function ie(s){var i,a,f,m="",P=0;for(i=0;i<s.length&&s.charAt(i)!="=";++i)(f=B.indexOf(s.charAt(i)))<0||(P==0?(m+=ne(f>>2),a=3&f,P=1):P==1?(m+=ne(a<<2|f>>4),a=15&f,P=2):P==2?(m+=ne(a),m+=ne(f>>2),a=3&f,P=3):(m+=ne(a<<2|f>>4),m+=ne(15&f),P=0));return P==1&&(m+=ne(a<<2)),m}function he(s){var i,a=ie(s),f=new Array;for(i=0;2*i<a.length;++i)f[i]=parseInt(a.substring(2*i,2*i+2),16);return f}function L(s,i,a){s!=null&&(typeof s=="number"?this.fromNumber(s,i,a):i==null&&typeof s!="string"?this.fromString(s,256):this.fromString(s,i))}function re(){return new L(null)}E.appName=="Microsoft Internet Explorer"?(L.prototype.am=function(i,a,f,m,P,U){for(var $=32767&a,H=a>>15;--U>=0;){var q=32767&this[i],J=this[i++]>>15,z=H*q+J*$;P=((q=$*q+((32767&z)<<15)+f[m]+(1073741823&P))>>>30)+(z>>>15)+H*J+(P>>>30),f[m++]=1073741823&q}return P},D=30):E.appName!="Netscape"?(L.prototype.am=function(i,a,f,m,P,U){for(;--U>=0;){var $=a*this[i++]+f[m]+P;P=Math.floor($/67108864),f[m++]=67108863&$}return P},D=26):(L.prototype.am=function(i,a,f,m,P,U){for(var $=16383&a,H=a>>14;--U>=0;){var q=16383&this[i],J=this[i++]>>14,z=H*q+J*$;P=((q=$*q+((16383&z)<<14)+f[m]+P)>>28)+(z>>14)+H*J,f[m++]=268435455&q}return P},D=28),L.prototype.DB=D,L.prototype.DM=(1<<D)-1,L.prototype.DV=1<<D,L.prototype.FV=Math.pow(2,52),L.prototype.F1=52-D,L.prototype.F2=2*D-52;var be,ue,ke=new Array;for(be=48,ue=0;ue<=9;++ue)ke[be++]=ue;for(be=97,ue=10;ue<36;++ue)ke[be++]=ue;for(be=65,ue=10;ue<36;++ue)ke[be++]=ue;function ne(s){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(s)}function fe(s,i){var a=ke[s.charCodeAt(i)];return a??-1}function Ne(s){var i=re();return i.fromInt(s),i}function pe(s){var i,a=1;return(i=s>>>16)!=0&&(s=i,a+=16),(i=s>>8)!=0&&(s=i,a+=8),(i=s>>4)!=0&&(s=i,a+=4),(i=s>>2)!=0&&(s=i,a+=2),(i=s>>1)!=0&&(s=i,a+=1),a}function Te(s){this.m=s}function K(s){this.m=s,this.mp=s.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<s.DB-15)-1,this.mt2=2*s.t}function me(s,i){return s&i}function Ie(s,i){return s|i}function Fe(s,i){return s^i}function De(s,i){return s&~i}function Oe(s){if(s==0)return-1;var i=0;return(65535&s)==0&&(s>>=16,i+=16),(255&s)==0&&(s>>=8,i+=8),(15&s)==0&&(s>>=4,i+=4),(3&s)==0&&(s>>=2,i+=2),(1&s)==0&&++i,i}function $e(s){for(var i=0;s!=0;)s&=s-1,++i;return i}function He(){}function Se(s){return s}function Re(s){this.r2=re(),this.q3=re(),L.ONE.dlShiftTo(2*s.t,this.r2),this.mu=this.r2.divide(s),this.m=s}Te.prototype.convert=function(i){return i.s<0||i.compareTo(this.m)>=0?i.mod(this.m):i},Te.prototype.revert=function(i){return i},Te.prototype.reduce=function(i){i.divRemTo(this.m,null,i)},Te.prototype.mulTo=function(i,a,f){i.multiplyTo(a,f),this.reduce(f)},Te.prototype.sqrTo=function(i,a){i.squareTo(a),this.reduce(a)},K.prototype.convert=function(i){var a=re();return i.abs().dlShiftTo(this.m.t,a),a.divRemTo(this.m,null,a),i.s<0&&a.compareTo(L.ZERO)>0&&this.m.subTo(a,a),a},K.prototype.revert=function(i){var a=re();return i.copyTo(a),this.reduce(a),a},K.prototype.reduce=function(i){for(;i.t<=this.mt2;)i[i.t++]=0;for(var a=0;a<this.m.t;++a){var f=32767&i[a],m=f*this.mpl+((f*this.mph+(i[a]>>15)*this.mpl&this.um)<<15)&i.DM;for(i[f=a+this.m.t]+=this.m.am(0,m,i,a,0,this.m.t);i[f]>=i.DV;)i[f]-=i.DV,i[++f]++}i.clamp(),i.drShiftTo(this.m.t,i),i.compareTo(this.m)>=0&&i.subTo(this.m,i)},K.prototype.mulTo=function(i,a,f){i.multiplyTo(a,f),this.reduce(f)},K.prototype.sqrTo=function(i,a){i.squareTo(a),this.reduce(a)},L.prototype.copyTo=function(i){for(var a=this.t-1;a>=0;--a)i[a]=this[a];i.t=this.t,i.s=this.s},L.prototype.fromInt=function(i){this.t=1,this.s=i<0?-1:0,i>0?this[0]=i:i<-1?this[0]=i+this.DV:this.t=0},L.prototype.fromString=function(i,a){var f;if(a==16)f=4;else if(a==8)f=3;else if(a==256)f=8;else if(a==2)f=1;else if(a==32)f=5;else{if(a!=4)return void this.fromRadix(i,a);f=2}this.t=0,this.s=0;for(var m=i.length,P=!1,U=0;--m>=0;){var $=f==8?255&i[m]:fe(i,m);$<0?i.charAt(m)=="-"&&(P=!0):(P=!1,U==0?this[this.t++]=$:U+f>this.DB?(this[this.t-1]|=($&(1<<this.DB-U)-1)<<U,this[this.t++]=$>>this.DB-U):this[this.t-1]|=$<<U,(U+=f)>=this.DB&&(U-=this.DB))}f==8&&(128&i[0])!=0&&(this.s=-1,U>0&&(this[this.t-1]|=(1<<this.DB-U)-1<<U)),this.clamp(),P&&L.ZERO.subTo(this,this)},L.prototype.clamp=function(){for(var i=this.s&this.DM;this.t>0&&this[this.t-1]==i;)--this.t},L.prototype.dlShiftTo=function(i,a){var f;for(f=this.t-1;f>=0;--f)a[f+i]=this[f];for(f=i-1;f>=0;--f)a[f]=0;a.t=this.t+i,a.s=this.s},L.prototype.drShiftTo=function(i,a){for(var f=i;f<this.t;++f)a[f-i]=this[f];a.t=Math.max(this.t-i,0),a.s=this.s},L.prototype.lShiftTo=function(i,a){var f,m=i%this.DB,P=this.DB-m,U=(1<<P)-1,$=Math.floor(i/this.DB),H=this.s<<m&this.DM;for(f=this.t-1;f>=0;--f)a[f+$+1]=this[f]>>P|H,H=(this[f]&U)<<m;for(f=$-1;f>=0;--f)a[f]=0;a[$]=H,a.t=this.t+$+1,a.s=this.s,a.clamp()},L.prototype.rShiftTo=function(i,a){a.s=this.s;var f=Math.floor(i/this.DB);if(f>=this.t)a.t=0;else{var m=i%this.DB,P=this.DB-m,U=(1<<m)-1;a[0]=this[f]>>m;for(var $=f+1;$<this.t;++$)a[$-f-1]|=(this[$]&U)<<P,a[$-f]=this[$]>>m;m>0&&(a[this.t-f-1]|=(this.s&U)<<P),a.t=this.t-f,a.clamp()}},L.prototype.subTo=function(i,a){for(var f=0,m=0,P=Math.min(i.t,this.t);f<P;)m+=this[f]-i[f],a[f++]=m&this.DM,m>>=this.DB;if(i.t<this.t){for(m-=i.s;f<this.t;)m+=this[f],a[f++]=m&this.DM,m>>=this.DB;m+=this.s}else{for(m+=this.s;f<i.t;)m-=i[f],a[f++]=m&this.DM,m>>=this.DB;m-=i.s}a.s=m<0?-1:0,m<-1?a[f++]=this.DV+m:m>0&&(a[f++]=m),a.t=f,a.clamp()},L.prototype.multiplyTo=function(i,a){var f=this.abs(),m=i.abs(),P=f.t;for(a.t=P+m.t;--P>=0;)a[P]=0;for(P=0;P<m.t;++P)a[P+f.t]=f.am(0,m[P],a,P,0,f.t);a.s=0,a.clamp(),this.s!=i.s&&L.ZERO.subTo(a,a)},L.prototype.squareTo=function(i){for(var a=this.abs(),f=i.t=2*a.t;--f>=0;)i[f]=0;for(f=0;f<a.t-1;++f){var m=a.am(f,a[f],i,2*f,0,1);(i[f+a.t]+=a.am(f+1,2*a[f],i,2*f+1,m,a.t-f-1))>=a.DV&&(i[f+a.t]-=a.DV,i[f+a.t+1]=1)}i.t>0&&(i[i.t-1]+=a.am(f,a[f],i,2*f,0,1)),i.s=0,i.clamp()},L.prototype.divRemTo=function(i,a,f){var m=i.abs();if(!(m.t<=0)){var P=this.abs();if(P.t<m.t)return a?.fromInt(0),void(f!=null&&this.copyTo(f));f==null&&(f=re());var U=re(),$=this.s,H=i.s,q=this.DB-pe(m[m.t-1]);q>0?(m.lShiftTo(q,U),P.lShiftTo(q,f)):(m.copyTo(U),P.copyTo(f));var J=U.t,z=U[J-1];if(z!=0){var ee=z*(1<<this.F1)+(J>1?U[J-2]>>this.F2:0),oe=this.FV/ee,le=(1<<this.F1)/ee,we=1<<this.F2,ve=f.t,j=ve-J,G=a??re();for(U.dlShiftTo(j,G),f.compareTo(G)>=0&&(f[f.t++]=1,f.subTo(G,f)),L.ONE.dlShiftTo(J,G),G.subTo(U,U);U.t<J;)U[U.t++]=0;for(;--j>=0;){var Q=f[--ve]==z?this.DM:Math.floor(f[ve]*oe+(f[ve-1]+we)*le);if((f[ve]+=U.am(0,Q,f,j,0,J))<Q)for(U.dlShiftTo(j,G),f.subTo(G,f);f[ve]<--Q;)f.subTo(G,f)}a!=null&&(f.drShiftTo(J,a),$!=H&&L.ZERO.subTo(a,a)),f.t=J,f.clamp(),q>0&&f.rShiftTo(q,f),$<0&&L.ZERO.subTo(f,f)}}},L.prototype.invDigit=function(){if(this.t<1)return 0;var i=this[0];if((1&i)==0)return 0;var a=3&i;return(a=(a=(a=(a=a*(2-(15&i)*a)&15)*(2-(255&i)*a)&255)*(2-((65535&i)*a&65535))&65535)*(2-i*a%this.DV)%this.DV)>0?this.DV-a:-a},L.prototype.isEven=function(){return(this.t>0?1&this[0]:this.s)==0},L.prototype.exp=function(i,a){if(i>4294967295||i<1)return L.ONE;var f=re(),m=re(),P=a.convert(this),U=pe(i)-1;for(P.copyTo(f);--U>=0;)if(a.sqrTo(f,m),(i&1<<U)>0)a.mulTo(m,P,f);else{var $=f;f=m,m=$}return a.revert(f)},L.prototype.toString=function(i){if(this.s<0)return"-"+this.negate().toString(i);var a;if(i==16)a=4;else if(i==8)a=3;else if(i==2)a=1;else if(i==32)a=5;else{if(i!=4)return this.toRadix(i);a=2}var f,m=(1<<a)-1,P=!1,U="",$=this.t,H=this.DB-$*this.DB%a;if($-- >0)for(H<this.DB&&(f=this[$]>>H)>0&&(P=!0,U=ne(f));$>=0;)H<a?(f=(this[$]&(1<<H)-1)<<a-H,f|=this[--$]>>(H+=this.DB-a)):(f=this[$]>>(H-=a)&m,H<=0&&(H+=this.DB,--$)),f>0&&(P=!0),P&&(U+=ne(f));return P?U:"0"},L.prototype.negate=function(){var i=re();return L.ZERO.subTo(this,i),i},L.prototype.abs=function(){return this.s<0?this.negate():this},L.prototype.compareTo=function(i){var a=this.s-i.s;if(a!=0)return a;var f=this.t;if((a=f-i.t)!=0)return this.s<0?-a:a;for(;--f>=0;)if((a=this[f]-i[f])!=0)return a;return 0},L.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+pe(this[this.t-1]^this.s&this.DM)},L.prototype.mod=function(i){var a=re();return this.abs().divRemTo(i,null,a),this.s<0&&a.compareTo(L.ZERO)>0&&i.subTo(a,a),a},L.prototype.modPowInt=function(i,a){var f;return f=i<256||a.isEven()?new Te(a):new K(a),this.exp(i,f)},L.ZERO=Ne(0),L.ONE=Ne(1),He.prototype.convert=Se,He.prototype.revert=Se,He.prototype.mulTo=function(i,a,f){i.multiplyTo(a,f)},He.prototype.sqrTo=function(i,a){i.squareTo(a)},Re.prototype.convert=function(i){if(i.s<0||i.t>2*this.m.t)return i.mod(this.m);if(i.compareTo(this.m)<0)return i;var a=re();return i.copyTo(a),this.reduce(a),a},Re.prototype.revert=function(i){return i},Re.prototype.reduce=function(i){for(i.drShiftTo(this.m.t-1,this.r2),i.t>this.m.t+1&&(i.t=this.m.t+1,i.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);i.compareTo(this.r2)<0;)i.dAddOffset(1,this.m.t+1);for(i.subTo(this.r2,i);i.compareTo(this.m)>=0;)i.subTo(this.m,i)},Re.prototype.mulTo=function(i,a,f){i.multiplyTo(a,f),this.reduce(f)},Re.prototype.sqrTo=function(i,a){i.squareTo(a),this.reduce(a)};var Ce=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],V=(1<<26)/Ce[Ce.length-1];/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function I(){this.i=0,this.j=0,this.S=new Array}L.prototype.chunkSize=function(i){return Math.floor(Math.LN2*this.DB/Math.log(i))},L.prototype.toRadix=function(i){if(i==null&&(i=10),this.signum()==0||i<2||i>36)return"0";var a=this.chunkSize(i),f=Math.pow(i,a),m=Ne(f),P=re(),U=re(),$="";for(this.divRemTo(m,P,U);P.signum()>0;)$=(f+U.intValue()).toString(i).substr(1)+$,P.divRemTo(m,P,U);return U.intValue().toString(i)+$},L.prototype.fromRadix=function(i,a){this.fromInt(0),a==null&&(a=10);for(var f=this.chunkSize(a),m=Math.pow(a,f),P=!1,U=0,$=0,H=0;H<i.length;++H){var q=fe(i,H);q<0?i.charAt(H)=="-"&&this.signum()==0&&(P=!0):($=a*$+q,++U>=f&&(this.dMultiply(m),this.dAddOffset($,0),U=0,$=0))}U>0&&(this.dMultiply(Math.pow(a,U)),this.dAddOffset($,0)),P&&L.ZERO.subTo(this,this)},L.prototype.fromNumber=function(i,a,f){if(typeof a=="number")if(i<2)this.fromInt(1);else for(this.fromNumber(i,f),this.testBit(i-1)||this.bitwiseTo(L.ONE.shiftLeft(i-1),Ie,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(a);)this.dAddOffset(2,0),this.bitLength()>i&&this.subTo(L.ONE.shiftLeft(i-1),this);else{var m=new Array,P=7&i;m.length=1+(i>>3),a.nextBytes(m),P>0?m[0]&=(1<<P)-1:m[0]=0,this.fromString(m,256)}},L.prototype.bitwiseTo=function(i,a,f){var m,P,U=Math.min(i.t,this.t);for(m=0;m<U;++m)f[m]=a(this[m],i[m]);if(i.t<this.t){for(P=i.s&this.DM,m=U;m<this.t;++m)f[m]=a(this[m],P);f.t=this.t}else{for(P=this.s&this.DM,m=U;m<i.t;++m)f[m]=a(P,i[m]);f.t=i.t}f.s=a(this.s,i.s),f.clamp()},L.prototype.changeBit=function(i,a){var f=L.ONE.shiftLeft(i);return this.bitwiseTo(f,a,f),f},L.prototype.addTo=function(i,a){for(var f=0,m=0,P=Math.min(i.t,this.t);f<P;)m+=this[f]+i[f],a[f++]=m&this.DM,m>>=this.DB;if(i.t<this.t){for(m+=i.s;f<this.t;)m+=this[f],a[f++]=m&this.DM,m>>=this.DB;m+=this.s}else{for(m+=this.s;f<i.t;)m+=i[f],a[f++]=m&this.DM,m>>=this.DB;m+=i.s}a.s=m<0?-1:0,m>0?a[f++]=m:m<-1&&(a[f++]=this.DV+m),a.t=f,a.clamp()},L.prototype.dMultiply=function(i){this[this.t]=this.am(0,i-1,this,0,0,this.t),++this.t,this.clamp()},L.prototype.dAddOffset=function(i,a){if(i!=0){for(;this.t<=a;)this[this.t++]=0;for(this[a]+=i;this[a]>=this.DV;)this[a]-=this.DV,++a>=this.t&&(this[this.t++]=0),++this[a]}},L.prototype.multiplyLowerTo=function(i,a,f){var m,P=Math.min(this.t+i.t,a);for(f.s=0,f.t=P;P>0;)f[--P]=0;for(m=f.t-this.t;P<m;++P)f[P+this.t]=this.am(0,i[P],f,P,0,this.t);for(m=Math.min(i.t,a);P<m;++P)this.am(0,i[P],f,P,0,a-P);f.clamp()},L.prototype.multiplyUpperTo=function(i,a,f){--a;var m=f.t=this.t+i.t-a;for(f.s=0;--m>=0;)f[m]=0;for(m=Math.max(a-this.t,0);m<i.t;++m)f[this.t+m-a]=this.am(a-m,i[m],f,0,0,this.t+m-a);f.clamp(),f.drShiftTo(1,f)},L.prototype.modInt=function(i){if(i<=0)return 0;var a=this.DV%i,f=this.s<0?i-1:0;if(this.t>0)if(a==0)f=this[0]%i;else for(var m=this.t-1;m>=0;--m)f=(a*f+this[m])%i;return f},L.prototype.millerRabin=function(i){var a=this.subtract(L.ONE),f=a.getLowestSetBit();if(f<=0)return!1;var m=a.shiftRight(f);(i=i+1>>1)>Ce.length&&(i=Ce.length);for(var P=re(),U=0;U<i;++U){P.fromInt(Ce[Math.floor(Math.random()*Ce.length)]);var $=P.modPow(m,this);if($.compareTo(L.ONE)!=0&&$.compareTo(a)!=0){for(var H=1;H++<f&&$.compareTo(a)!=0;)if(($=$.modPowInt(2,this)).compareTo(L.ONE)==0)return!1;if($.compareTo(a)!=0)return!1}}return!0},L.prototype.clone=function(){var i=re();return this.copyTo(i),i},L.prototype.intValue=function(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},L.prototype.byteValue=function(){return this.t==0?this.s:this[0]<<24>>24},L.prototype.shortValue=function(){return this.t==0?this.s:this[0]<<16>>16},L.prototype.signum=function(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1},L.prototype.toByteArray=function(){var i=this.t,a=new Array;a[0]=this.s;var f,m=this.DB-i*this.DB%8,P=0;if(i-- >0)for(m<this.DB&&(f=this[i]>>m)!=(this.s&this.DM)>>m&&(a[P++]=f|this.s<<this.DB-m);i>=0;)m<8?(f=(this[i]&(1<<m)-1)<<8-m,f|=this[--i]>>(m+=this.DB-8)):(f=this[i]>>(m-=8)&255,m<=0&&(m+=this.DB,--i)),(128&f)!=0&&(f|=-256),P==0&&(128&this.s)!=(128&f)&&++P,(P>0||f!=this.s)&&(a[P++]=f);return a},L.prototype.equals=function(i){return this.compareTo(i)==0},L.prototype.min=function(i){return this.compareTo(i)<0?this:i},L.prototype.max=function(i){return this.compareTo(i)>0?this:i},L.prototype.and=function(i){var a=re();return this.bitwiseTo(i,me,a),a},L.prototype.or=function(i){var a=re();return this.bitwiseTo(i,Ie,a),a},L.prototype.xor=function(i){var a=re();return this.bitwiseTo(i,Fe,a),a},L.prototype.andNot=function(i){var a=re();return this.bitwiseTo(i,De,a),a},L.prototype.not=function(){for(var i=re(),a=0;a<this.t;++a)i[a]=this.DM&~this[a];return i.t=this.t,i.s=~this.s,i},L.prototype.shiftLeft=function(i){var a=re();return i<0?this.rShiftTo(-i,a):this.lShiftTo(i,a),a},L.prototype.shiftRight=function(i){var a=re();return i<0?this.lShiftTo(-i,a):this.rShiftTo(i,a),a},L.prototype.getLowestSetBit=function(){for(var i=0;i<this.t;++i)if(this[i]!=0)return i*this.DB+Oe(this[i]);return this.s<0?this.t*this.DB:-1},L.prototype.bitCount=function(){for(var i=0,a=this.s&this.DM,f=0;f<this.t;++f)i+=$e(this[f]^a);return i},L.prototype.testBit=function(i){var a=Math.floor(i/this.DB);return a>=this.t?this.s!=0:(this[a]&1<<i%this.DB)!=0},L.prototype.setBit=function(i){return this.changeBit(i,Ie)},L.prototype.clearBit=function(i){return this.changeBit(i,De)},L.prototype.flipBit=function(i){return this.changeBit(i,Fe)},L.prototype.add=function(i){var a=re();return this.addTo(i,a),a},L.prototype.subtract=function(i){var a=re();return this.subTo(i,a),a},L.prototype.multiply=function(i){var a=re();return this.multiplyTo(i,a),a},L.prototype.divide=function(i){var a=re();return this.divRemTo(i,a,null),a},L.prototype.remainder=function(i){var a=re();return this.divRemTo(i,null,a),a},L.prototype.divideAndRemainder=function(i){var a=re(),f=re();return this.divRemTo(i,a,f),new Array(a,f)},L.prototype.modPow=function(i,a){var f,m,P=i.bitLength(),U=Ne(1);if(P<=0)return U;f=P<18?1:P<48?3:P<144?4:P<768?5:6,m=P<8?new Te(a):a.isEven()?new Re(a):new K(a);var $=new Array,H=3,q=f-1,J=(1<<f)-1;if($[1]=m.convert(this),f>1){var z=re();for(m.sqrTo($[1],z);H<=J;)$[H]=re(),m.mulTo(z,$[H-2],$[H]),H+=2}var ee,oe,le=i.t-1,we=!0,ve=re();for(P=pe(i[le])-1;le>=0;){for(P>=q?ee=i[le]>>P-q&J:(ee=(i[le]&(1<<P+1)-1)<<q-P,le>0&&(ee|=i[le-1]>>this.DB+P-q)),H=f;(1&ee)==0;)ee>>=1,--H;if((P-=H)<0&&(P+=this.DB,--le),we)$[ee].copyTo(U),we=!1;else{for(;H>1;)m.sqrTo(U,ve),m.sqrTo(ve,U),H-=2;H>0?m.sqrTo(U,ve):(oe=U,U=ve,ve=oe),m.mulTo(ve,$[ee],U)}for(;le>=0&&(i[le]&1<<P)==0;)m.sqrTo(U,ve),oe=U,U=ve,ve=oe,--P<0&&(P=this.DB-1,--le)}return m.revert(U)},L.prototype.modInverse=function(i){var a=i.isEven();if(this.isEven()&&a||i.signum()==0)return L.ZERO;for(var f=i.clone(),m=this.clone(),P=Ne(1),U=Ne(0),$=Ne(0),H=Ne(1);f.signum()!=0;){for(;f.isEven();)f.rShiftTo(1,f),a?(P.isEven()&&U.isEven()||(P.addTo(this,P),U.subTo(i,U)),P.rShiftTo(1,P)):U.isEven()||U.subTo(i,U),U.rShiftTo(1,U);for(;m.isEven();)m.rShiftTo(1,m),a?($.isEven()&&H.isEven()||($.addTo(this,$),H.subTo(i,H)),$.rShiftTo(1,$)):H.isEven()||H.subTo(i,H),H.rShiftTo(1,H);f.compareTo(m)>=0?(f.subTo(m,f),a&&P.subTo($,P),U.subTo(H,U)):(m.subTo(f,m),a&&$.subTo(P,$),H.subTo(U,H))}return m.compareTo(L.ONE)!=0?L.ZERO:H.compareTo(i)>=0?H.subtract(i):H.signum()<0?(H.addTo(i,H),H.signum()<0?H.add(i):H):H},L.prototype.pow=function(i){return this.exp(i,new He)},L.prototype.gcd=function(i){var a=this.s<0?this.negate():this.clone(),f=i.s<0?i.negate():i.clone();if(a.compareTo(f)<0){var m=a;a=f,f=m}var P=a.getLowestSetBit(),U=f.getLowestSetBit();if(U<0)return a;for(P<U&&(U=P),U>0&&(a.rShiftTo(U,a),f.rShiftTo(U,f));a.signum()>0;)(P=a.getLowestSetBit())>0&&a.rShiftTo(P,a),(P=f.getLowestSetBit())>0&&f.rShiftTo(P,f),a.compareTo(f)>=0?(a.subTo(f,a),a.rShiftTo(1,a)):(f.subTo(a,f),f.rShiftTo(1,f));return U>0&&f.lShiftTo(U,f),f},L.prototype.isProbablePrime=function(i){var a,f=this.abs();if(f.t==1&&f[0]<=Ce[Ce.length-1]){for(a=0;a<Ce.length;++a)if(f[0]==Ce[a])return!0;return!1}if(f.isEven())return!1;for(a=1;a<Ce.length;){for(var m=Ce[a],P=a+1;P<Ce.length&&m<V;)m*=Ce[P++];for(m=f.modInt(m);a<P;)if(m%Ce[a++]==0)return!1}return f.millerRabin(i)},L.prototype.square=function(){var i=re();return this.squareTo(i),i},I.prototype.init=function(i){var a,f,m;for(a=0;a<256;++a)this.S[a]=a;for(f=0,a=0;a<256;++a)f=f+this.S[a]+i[a%i.length]&255,m=this.S[a],this.S[a]=this.S[f],this.S[f]=m;this.i=0,this.j=0},I.prototype.next=function(){var i;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,i=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=i,this.S[i+this.S[this.i]&255]};var y,C,O;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function X(){(function(i){C[O++]^=255&i,C[O++]^=i>>8&255,C[O++]^=i>>16&255,C[O++]^=i>>24&255,O>=256&&(O-=256)})(new Date().getTime())}if(C==null){var se;if(C=new Array,O=0,A!==void 0&&(A.crypto!==void 0||A.msCrypto!==void 0)){var _e=A.crypto||A.msCrypto;if(_e.getRandomValues){var te=new Uint8Array(32);for(_e.getRandomValues(te),se=0;se<32;++se)C[O++]=te[se]}else if(E.appName=="Netscape"&&E.appVersion<"5"){var Ee=A.crypto.random(32);for(se=0;se<Ee.length;++se)C[O++]=255&Ee.charCodeAt(se)}}for(;O<256;)se=Math.floor(65536*Math.random()),C[O++]=se>>>8,C[O++]=255&se;O=0,X()}function Ae(){if(y==null){for(X(),(y=function(){return new I}()).init(C),O=0;O<C.length;++O)C[O]=0;O=0}return y.next()}function ye(){}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function We(s,i){return new L(s,i)}function Xe(s,i,a){for(var f="",m=0;f.length<i;)f+=a(String.fromCharCode.apply(String,s.concat([(4278190080&m)>>24,(16711680&m)>>16,(65280&m)>>8,255&m]))),m+=1;return f}function je(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Je(s,i){this.x=i,this.q=s}function N(s,i,a,f){this.curve=s,this.x=i,this.y=a,this.z=f??L.ONE,this.zinv=null}function w(s,i,a){this.q=s,this.a=this.fromBigInteger(i),this.b=this.fromBigInteger(a),this.infinity=new N(this,null,null)}ye.prototype.nextBytes=function(i){var a;for(a=0;a<i.length;++a)i[a]=Ae()},je.prototype.doPublic=function(i){return i.modPowInt(this.e,this.n)},je.prototype.setPublic=function(i,a){if(this.isPublic=!0,this.isPrivate=!1,typeof i!="string")this.n=i,this.e=a;else{if(!(i!=null&&a!=null&&i.length>0&&a.length>0))throw"Invalid RSA public key";this.n=We(i,16),this.e=parseInt(a,16)}},je.prototype.encrypt=function(i){var a=function(U,$){if($<U.length+11)throw"Message too long for RSA";for(var H=new Array,q=U.length-1;q>=0&&$>0;){var J=U.charCodeAt(q--);J<128?H[--$]=J:J>127&&J<2048?(H[--$]=63&J|128,H[--$]=J>>6|192):(H[--$]=63&J|128,H[--$]=J>>6&63|128,H[--$]=J>>12|224)}H[--$]=0;for(var z=new ye,ee=new Array;$>2;){for(ee[0]=0;ee[0]==0;)z.nextBytes(ee);H[--$]=ee[0]}return H[--$]=2,H[--$]=0,new L(H)}(i,this.n.bitLength()+7>>3);if(a==null)return null;var f=this.doPublic(a);if(f==null)return null;var m=f.toString(16);return(1&m.length)==0?m:"0"+m},je.prototype.encryptOAEP=function(i,a,f){var m=function(H,q,J,z){var ee=_.crypto.MessageDigest,oe=_.crypto.Util,le=null;if(J||(J="sha1"),typeof J=="string"&&(le=ee.getCanonicalAlgName(J),z=ee.getHashLength(le),J=function(Pe){return kt(oe.hashHex(Nt(Pe),le))}),H.length+2*z+2>q)throw"Message too long for RSA";var we,ve="";for(we=0;we<q-H.length-2*z-2;we+=1)ve+="\0";var j=J("")+ve+""+H,G=new Array(z);new ye().nextBytes(G);var Q=Xe(G,j.length,J),Z=[];for(we=0;we<j.length;we+=1)Z[we]=j.charCodeAt(we)^Q.charCodeAt(we);var de=Xe(Z,G.length,J),xe=[0];for(we=0;we<G.length;we+=1)xe[we+1]=G[we]^de.charCodeAt(we);return new L(xe.concat(Z))}(i,this.n.bitLength()+7>>3,a,f);if(m==null)return null;var P=this.doPublic(m);if(P==null)return null;var U=P.toString(16);return(1&U.length)==0?U:"0"+U},je.prototype.type="RSA",Je.prototype.equals=function(i){return i==this||this.q.equals(i.q)&&this.x.equals(i.x)},Je.prototype.toBigInteger=function(){return this.x},Je.prototype.negate=function(){return new Je(this.q,this.x.negate().mod(this.q))},Je.prototype.add=function(i){return new Je(this.q,this.x.add(i.toBigInteger()).mod(this.q))},Je.prototype.subtract=function(i){return new Je(this.q,this.x.subtract(i.toBigInteger()).mod(this.q))},Je.prototype.multiply=function(i){return new Je(this.q,this.x.multiply(i.toBigInteger()).mod(this.q))},Je.prototype.square=function(){return new Je(this.q,this.x.square().mod(this.q))},Je.prototype.divide=function(i){return new Je(this.q,this.x.multiply(i.toBigInteger().modInverse(this.q)).mod(this.q))},N.prototype.getX=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},N.prototype.getY=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},N.prototype.equals=function(i){return i==this||(this.isInfinity()?i.isInfinity():i.isInfinity()?this.isInfinity():!!i.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(i.z)).mod(this.curve.q).equals(L.ZERO)&&i.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(i.z)).mod(this.curve.q).equals(L.ZERO))},N.prototype.isInfinity=function(){return this.x==null&&this.y==null||this.z.equals(L.ZERO)&&!this.y.toBigInteger().equals(L.ZERO)},N.prototype.negate=function(){return new N(this.curve,this.x,this.y.negate(),this.z)},N.prototype.add=function(i){if(this.isInfinity())return i;if(i.isInfinity())return this;var a=i.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(i.z)).mod(this.curve.q),f=i.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(i.z)).mod(this.curve.q);if(L.ZERO.equals(f))return L.ZERO.equals(a)?this.twice():this.curve.getInfinity();var m=new L("3"),P=this.x.toBigInteger(),U=this.y.toBigInteger(),$=(i.x.toBigInteger(),i.y.toBigInteger(),f.square()),H=$.multiply(f),q=P.multiply($),J=a.square().multiply(this.z),z=J.subtract(q.shiftLeft(1)).multiply(i.z).subtract(H).multiply(f).mod(this.curve.q),ee=q.multiply(m).multiply(a).subtract(U.multiply(H)).subtract(J.multiply(a)).multiply(i.z).add(a.multiply(H)).mod(this.curve.q),oe=H.multiply(this.z).multiply(i.z).mod(this.curve.q);return new N(this.curve,this.curve.fromBigInteger(z),this.curve.fromBigInteger(ee),oe)},N.prototype.twice=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var i=new L("3"),a=this.x.toBigInteger(),f=this.y.toBigInteger(),m=f.multiply(this.z),P=m.multiply(f).mod(this.curve.q),U=this.curve.a.toBigInteger(),$=a.square().multiply(i);L.ZERO.equals(U)||($=$.add(this.z.square().multiply(U)));var H=($=$.mod(this.curve.q)).square().subtract(a.shiftLeft(3).multiply(P)).shiftLeft(1).multiply(m).mod(this.curve.q),q=$.multiply(i).multiply(a).subtract(P.shiftLeft(1)).shiftLeft(2).multiply(P).subtract($.square().multiply($)).mod(this.curve.q),J=m.square().multiply(m).shiftLeft(3).mod(this.curve.q);return new N(this.curve,this.curve.fromBigInteger(H),this.curve.fromBigInteger(q),J)},N.prototype.multiply=function(i){if(this.isInfinity())return this;if(i.signum()==0)return this.curve.getInfinity();var a,f=i,m=f.multiply(new L("3")),P=this.negate(),U=this,$=this.curve.q.subtract(i),H=$.multiply(new L("3")),q=new N(this.curve,this.x,this.y),J=q.negate();for(a=m.bitLength()-2;a>0;--a){U=U.twice();var z=m.testBit(a);z!=f.testBit(a)&&(U=U.add(z?this:P))}for(a=H.bitLength()-2;a>0;--a){q=q.twice();var ee=H.testBit(a);ee!=$.testBit(a)&&(q=q.add(ee?q:J))}return U},N.prototype.multiplyTwo=function(i,a,f){var m;m=i.bitLength()>f.bitLength()?i.bitLength()-1:f.bitLength()-1;for(var P=this.curve.getInfinity(),U=this.add(a);m>=0;)P=P.twice(),i.testBit(m)?P=f.testBit(m)?P.add(U):P.add(this):f.testBit(m)&&(P=P.add(a)),--m;return P},w.prototype.getQ=function(){return this.q},w.prototype.getA=function(){return this.a},w.prototype.getB=function(){return this.b},w.prototype.equals=function(i){return i==this||this.q.equals(i.q)&&this.a.equals(i.a)&&this.b.equals(i.b)},w.prototype.getInfinity=function(){return this.infinity},w.prototype.fromBigInteger=function(i){return new Je(this.q,i)},w.prototype.decodePointHex=function(i){switch(parseInt(i.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var a=(i.length-2)/2,f=i.substr(2,a),m=i.substr(a+2,a);return new N(this,this.fromBigInteger(new L(f,16)),this.fromBigInteger(new L(m,16)));default:return null}},Je.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},N.prototype.getEncoded=function(s){var i=function(U,$){var H=U.toByteArrayUnsigned();if($<H.length)H=H.slice(H.length-$);else for(;$>H.length;)H.unshift(0);return H},a=this.getX().toBigInteger(),f=this.getY().toBigInteger(),m=i(a,32);return s?f.isEven()?m.unshift(2):m.unshift(3):(m.unshift(4),m=m.concat(i(f,32))),m},N.decodeFrom=function(s,i){i[0];var a=i.length-1,f=i.slice(1,1+a/2),m=i.slice(1+a/2,1+a);f.unshift(0),m.unshift(0);var P=new L(f),U=new L(m);return new N(s,s.fromBigInteger(P),s.fromBigInteger(U))},N.decodeFromHex=function(s,i){i.substr(0,2);var a=i.length-2,f=i.substr(2,a/2),m=i.substr(2+a/2,a/2),P=new L(f,16),U=new L(m,16);return new N(s,s.fromBigInteger(P),s.fromBigInteger(U))},N.prototype.add2D=function(s){if(this.isInfinity())return s;if(s.isInfinity())return this;if(this.x.equals(s.x))return this.y.equals(s.y)?this.twice():this.curve.getInfinity();var i=s.x.subtract(this.x),a=s.y.subtract(this.y).divide(i),f=a.square().subtract(this.x).subtract(s.x),m=a.multiply(this.x.subtract(f)).subtract(this.y);return new N(this.curve,f,m)},N.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var s=this.curve.fromBigInteger(L.valueOf(2)),i=this.curve.fromBigInteger(L.valueOf(3)),a=this.x.square().multiply(i).add(this.curve.a).divide(this.y.multiply(s)),f=a.square().subtract(this.x.multiply(s)),m=a.multiply(this.x.subtract(f)).subtract(this.y);return new N(this.curve,f,m)},N.prototype.multiply2D=function(s){if(this.isInfinity())return this;if(s.signum()==0)return this.curve.getInfinity();var i,a=s,f=a.multiply(new L("3")),m=this.negate(),P=this;for(i=f.bitLength()-2;i>0;--i){P=P.twice();var U=f.testBit(i);U!=a.testBit(i)&&(P=P.add2D(U?this:m))}return P},N.prototype.isOnCurve=function(){var s=this.getX().toBigInteger(),i=this.getY().toBigInteger(),a=this.curve.getA().toBigInteger(),f=this.curve.getB().toBigInteger(),m=this.curve.getQ(),P=i.multiply(i).mod(m),U=s.multiply(s).multiply(s).add(a.multiply(s)).add(f).mod(m);return P.equals(U)},N.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},N.prototype.validate=function(){var s=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var i=this.getX().toBigInteger(),a=this.getY().toBigInteger();if(i.compareTo(L.ONE)<0||i.compareTo(s.subtract(L.ONE))>0)throw new Error("x coordinate out of bounds");if(a.compareTo(L.ONE)<0||a.compareTo(s.subtract(L.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(s).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
 */var F=function(){var s=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),i=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),a={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function f(U,$,H){return $?a[$]:String.fromCharCode(parseInt(H,16))}var m=new String(""),P=Object.hasOwnProperty;return function(U,$){var H,q,J=U.match(s),z=J[0],ee=!1;z==="{"?H={}:z==="["?H=[]:(H=[],ee=!0);for(var oe=[H],le=1-ee,we=J.length;le<we;++le){var ve;switch((z=J[le]).charCodeAt(0)){default:(ve=oe[0])[q||ve.length]=+z,q=void 0;break;case 34:if((z=z.substring(1,z.length-1)).indexOf("\\")!==-1&&(z=z.replace(i,f)),ve=oe[0],!q){if(!(ve instanceof Array)){q=z||m;break}q=ve.length}ve[q]=z,q=void 0;break;case 91:ve=oe[0],oe.unshift(ve[q||ve.length]=[]),q=void 0;break;case 93:oe.shift();break;case 102:(ve=oe[0])[q||ve.length]=!1,q=void 0;break;case 110:(ve=oe[0])[q||ve.length]=null,q=void 0;break;case 116:(ve=oe[0])[q||ve.length]=!0,q=void 0;break;case 123:ve=oe[0],oe.unshift(ve[q||ve.length]={}),q=void 0;break;case 125:oe.shift()}}if(ee){if(oe.length!==1)throw new Error;H=H[0]}else if(oe.length)throw new Error;return $&&(H=function j(G,Q){var Z=G[Q];if(Z&&(Z===void 0?"undefined":b(Z))==="object"){var de=null;for(var xe in Z)if(P.call(Z,xe)&&Z!==G){var Me=j(Z,xe);Me!==void 0?Z[xe]=Me:(de||(de=[]),de.push(xe))}if(de)for(var Pe=de.length;--Pe>=0;)delete Z[de[Pe]]}return $.call(G,Q,Z)}({"":H},"")),H}}();_!==void 0&&_||(r.KJUR=_={}),_.asn1!==void 0&&_.asn1||(_.asn1={}),_.asn1.ASN1Util=new function(){this.integerToByteHex=function(s){var i=s.toString(16);return i.length%2==1&&(i="0"+i),i},this.bigIntToMinTwosComplementsHex=function(s){var i=s.toString(16);if(i.substr(0,1)!="-")i.length%2==1?i="0"+i:i.match(/^[0-7]/)||(i="00"+i);else{var a=i.substr(1).length;a%2==1?a+=1:i.match(/^[0-7]/)||(a+=2);for(var f="",m=0;m<a;m++)f+="f";i=new L(f,16).xor(s).add(L.ONE).toString(16).replace(/^-/,"")}return i},this.getPEMStringFromHex=function(s,i){return Le(s,i)},this.newObject=function(s){var i=_.asn1,a=i.ASN1Object,f=i.DERBoolean,m=i.DERInteger,P=i.DERBitString,U=i.DEROctetString,$=i.DERNull,H=i.DERObjectIdentifier,q=i.DEREnumerated,J=i.DERUTF8String,z=i.DERNumericString,ee=i.DERPrintableString,oe=i.DERTeletexString,le=i.DERIA5String,we=i.DERUTCTime,ve=i.DERGeneralizedTime,j=i.DERVisibleString,G=i.DERBMPString,Q=i.DERSequence,Z=i.DERSet,de=i.DERTaggedObject,xe=i.ASN1Util.newObject;if(s instanceof i.ASN1Object)return s;var Me=Object.keys(s);if(Me.length!=1)throw new Error("key of param shall be only one.");var Pe=Me[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+Pe+":")==-1)throw new Error("undefined key: "+Pe);if(Pe=="bool")return new f(s[Pe]);if(Pe=="int")return new m(s[Pe]);if(Pe=="bitstr")return new P(s[Pe]);if(Pe=="octstr")return new U(s[Pe]);if(Pe=="null")return new $(s[Pe]);if(Pe=="oid")return new H(s[Pe]);if(Pe=="enum")return new q(s[Pe]);if(Pe=="utf8str")return new J(s[Pe]);if(Pe=="numstr")return new z(s[Pe]);if(Pe=="prnstr")return new ee(s[Pe]);if(Pe=="telstr")return new oe(s[Pe]);if(Pe=="ia5str")return new le(s[Pe]);if(Pe=="utctime")return new we(s[Pe]);if(Pe=="gentime")return new ve(s[Pe]);if(Pe=="visstr")return new j(s[Pe]);if(Pe=="bmpstr")return new G(s[Pe]);if(Pe=="asn1")return new a(s[Pe]);if(Pe=="seq"){for(var Ge=s[Pe],Be=[],qe=0;qe<Ge.length;qe++){var nt=xe(Ge[qe]);Be.push(nt)}return new Q({array:Be})}if(Pe=="set"){for(Ge=s[Pe],Be=[],qe=0;qe<Ge.length;qe++)nt=xe(Ge[qe]),Be.push(nt);return new Z({array:Be})}if(Pe=="tag"){var ot=s[Pe];if(Object.prototype.toString.call(ot)==="[object Array]"&&ot.length==3){var it=xe(ot[2]);return new de({tag:ot[0],explicit:ot[1],obj:it})}return new de(ot)}},this.jsonToASN1HEX=function(s){return this.newObject(s).getEncodedHex()}},_.asn1.ASN1Util.oidHexToInt=function(s){for(var i="",a=parseInt(s.substr(0,2),16),f=(i=Math.floor(a/40)+"."+a%40,""),m=2;m<s.length;m+=2){var P=("00000000"+parseInt(s.substr(m,2),16).toString(2)).slice(-8);f+=P.substr(1,7),P.substr(0,1)=="0"&&(i=i+"."+new L(f,2).toString(10),f="")}return i},_.asn1.ASN1Util.oidIntToHex=function(s){var i=function(H){var q=H.toString(16);return q.length==1&&(q="0"+q),q},a=function(H){var q="",J=new L(H,10).toString(2),z=7-J.length%7;z==7&&(z=0);for(var ee="",oe=0;oe<z;oe++)ee+="0";for(J=ee+J,oe=0;oe<J.length-1;oe+=7){var le=J.substr(oe,7);oe!=J.length-7&&(le="1"+le),q+=i(parseInt(le,2))}return q};if(!s.match(/^[0-9.]+$/))throw"malformed oid string: "+s;var f="",m=s.split("."),P=40*parseInt(m[0])+parseInt(m[1]);f+=i(P),m.splice(0,2);for(var U=0;U<m.length;U++)f+=a(m[U]);return f},_.asn1.ASN1Object=function(s){this.params=null,this.getLengthHexFromValue=function(){if(this.hV===void 0||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n=0,v="+this.hV);var i=this.hV.length/2,a=i.toString(16);if(a.length%2==1&&(a="0"+a),i<128)return a;var f=a.length/2;if(f>15)throw"ASN.1 length too long to represent by 8x: n = "+i.toString(16);return(128+f).toString(16)+a},this.getEncodedHex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(i){this.params=i},s!=null&&s.tlv!=null&&(this.hTLV=s.tlv,this.isModified=!1)},_.asn1.DERAbstractString=function(s){_.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(i){this.hTLV=null,this.isModified=!0,this.s=i,this.hV=dr(this.s).toLowerCase()},this.setStringHex=function(i){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=i},this.getFreshValueHex=function(){return this.hV},s!==void 0&&(typeof s=="string"?this.setString(s):s.str!==void 0?this.setString(s.str):s.hex!==void 0&&this.setStringHex(s.hex))},et(_.asn1.DERAbstractString,_.asn1.ASN1Object),_.asn1.DERAbstractTime=function(s){_.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(i){var a=i.getTime()+6e4*i.getTimezoneOffset();return new Date(a)},this.formatDate=function(i,a,f){var m=this.zeroPadding,P=this.localDateToUTC(i),U=String(P.getFullYear());a=="utc"&&(U=U.substr(2,2));var $=U+m(String(P.getMonth()+1),2)+m(String(P.getDate()),2)+m(String(P.getHours()),2)+m(String(P.getMinutes()),2)+m(String(P.getSeconds()),2);if(f===!0){var H=P.getMilliseconds();if(H!=0){var q=m(String(H),3);$=$+"."+(q=q.replace(/[0]+$/,""))}}return $+"Z"},this.zeroPadding=function(i,a){return i.length>=a?i:new Array(a-i.length+1).join("0")+i},this.getString=function(){return this.s},this.setString=function(i){this.hTLV=null,this.isModified=!0,this.s=i,this.hV=Qe(i)},this.setByDateValue=function(i,a,f,m,P,U){var $=new Date(Date.UTC(i,a-1,f,m,P,U,0));this.setByDate($)},this.getFreshValueHex=function(){return this.hV}},et(_.asn1.DERAbstractTime,_.asn1.ASN1Object),_.asn1.DERAbstractStructured=function(s){_.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(i){this.hTLV=null,this.isModified=!0,this.asn1Array=i},this.appendASN1Object=function(i){this.hTLV=null,this.isModified=!0,this.asn1Array.push(i)},this.asn1Array=new Array,s!==void 0&&s.array!==void 0&&(this.asn1Array=s.array)},et(_.asn1.DERAbstractStructured,_.asn1.ASN1Object),_.asn1.DERBoolean=function(s){_.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=s==0?"010100":"0101ff"},et(_.asn1.DERBoolean,_.asn1.ASN1Object),_.asn1.DERInteger=function(s){_.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(i){this.hTLV=null,this.isModified=!0,this.hV=_.asn1.ASN1Util.bigIntToMinTwosComplementsHex(i)},this.setByInteger=function(i){var a=new L(String(i),10);this.setByBigInteger(a)},this.setValueHex=function(i){this.hV=i},this.getFreshValueHex=function(){return this.hV},s!==void 0&&(s.bigint!==void 0?this.setByBigInteger(s.bigint):s.int!==void 0?this.setByInteger(s.int):typeof s=="number"?this.setByInteger(s):s.hex!==void 0&&this.setValueHex(s.hex))},et(_.asn1.DERInteger,_.asn1.ASN1Object),_.asn1.DERBitString=function(s){if(s!==void 0&&s.obj!==void 0){var i=_.asn1.ASN1Util.newObject(s.obj);s.hex="00"+i.getEncodedHex()}_.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(a){this.hTLV=null,this.isModified=!0,this.hV=a},this.setUnusedBitsAndHexValue=function(a,f){if(a<0||7<a)throw"unused bits shall be from 0 to 7: u = "+a;var m="0"+a;this.hTLV=null,this.isModified=!0,this.hV=m+f},this.setByBinaryString=function(a){var f=8-(a=a.replace(/0+$/,"")).length%8;f==8&&(f=0);for(var m=0;m<=f;m++)a+="0";var P="";for(m=0;m<a.length-1;m+=8){var U=a.substr(m,8),$=parseInt(U,2).toString(16);$.length==1&&($="0"+$),P+=$}this.hTLV=null,this.isModified=!0,this.hV="0"+f+P},this.setByBooleanArray=function(a){for(var f="",m=0;m<a.length;m++)a[m]==1?f+="1":f+="0";this.setByBinaryString(f)},this.newFalseArray=function(a){for(var f=new Array(a),m=0;m<a;m++)f[m]=!1;return f},this.getFreshValueHex=function(){return this.hV},s!==void 0&&(typeof s=="string"&&s.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(s):s.hex!==void 0?this.setHexValueIncludingUnusedBits(s.hex):s.bin!==void 0?this.setByBinaryString(s.bin):s.array!==void 0&&this.setByBooleanArray(s.array))},et(_.asn1.DERBitString,_.asn1.ASN1Object),_.asn1.DEROctetString=function(s){if(s!==void 0&&s.obj!==void 0){var i=_.asn1.ASN1Util.newObject(s.obj);s.hex=i.getEncodedHex()}_.asn1.DEROctetString.superclass.constructor.call(this,s),this.hT="04"},et(_.asn1.DEROctetString,_.asn1.DERAbstractString),_.asn1.DERNull=function(){_.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},et(_.asn1.DERNull,_.asn1.ASN1Object),_.asn1.DERObjectIdentifier=function(s){_.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(i){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=i},this.setValueOidString=function(i){var a=function(m){var P=function(ee){var oe=ee.toString(16);return oe.length==1&&(oe="0"+oe),oe},U=function(ee){var oe="",le=parseInt(ee,10).toString(2),we=7-le.length%7;we==7&&(we=0);for(var ve="",j=0;j<we;j++)ve+="0";for(le=ve+le,j=0;j<le.length-1;j+=7){var G=le.substr(j,7);j!=le.length-7&&(G="1"+G),oe+=P(parseInt(G,2))}return oe};try{if(!m.match(/^[0-9.]+$/))return null;var $="",H=m.split("."),q=40*parseInt(H[0],10)+parseInt(H[1],10);$+=P(q),H.splice(0,2);for(var J=0;J<H.length;J++)$+=U(H[J]);return $}catch{return null}}(i);if(a==null)throw new Error("malformed oid string: "+i);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=a},this.setValueName=function(i){var a=_.asn1.x509.OID.name2oid(i);if(a==="")throw new Error("DERObjectIdentifier oidName undefined: "+i);this.setValueOidString(a)},this.setValueNameOrOid=function(i){i.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(i):this.setValueName(i)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(i){typeof i=="string"?this.setValueNameOrOid(i):i.oid!==void 0?this.setValueNameOrOid(i.oid):i.name!==void 0?this.setValueNameOrOid(i.name):i.hex!==void 0&&this.setValueHex(i.hex)},s!==void 0&&this.setByParam(s)},et(_.asn1.DERObjectIdentifier,_.asn1.ASN1Object),_.asn1.DEREnumerated=function(s){_.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(i){this.hTLV=null,this.isModified=!0,this.hV=_.asn1.ASN1Util.bigIntToMinTwosComplementsHex(i)},this.setByInteger=function(i){var a=new L(String(i),10);this.setByBigInteger(a)},this.setValueHex=function(i){this.hV=i},this.getFreshValueHex=function(){return this.hV},s!==void 0&&(s.int!==void 0?this.setByInteger(s.int):typeof s=="number"?this.setByInteger(s):s.hex!==void 0&&this.setValueHex(s.hex))},et(_.asn1.DEREnumerated,_.asn1.ASN1Object),_.asn1.DERUTF8String=function(s){_.asn1.DERUTF8String.superclass.constructor.call(this,s),this.hT="0c"},et(_.asn1.DERUTF8String,_.asn1.DERAbstractString),_.asn1.DERNumericString=function(s){_.asn1.DERNumericString.superclass.constructor.call(this,s),this.hT="12"},et(_.asn1.DERNumericString,_.asn1.DERAbstractString),_.asn1.DERPrintableString=function(s){_.asn1.DERPrintableString.superclass.constructor.call(this,s),this.hT="13"},et(_.asn1.DERPrintableString,_.asn1.DERAbstractString),_.asn1.DERTeletexString=function(s){_.asn1.DERTeletexString.superclass.constructor.call(this,s),this.hT="14"},et(_.asn1.DERTeletexString,_.asn1.DERAbstractString),_.asn1.DERIA5String=function(s){_.asn1.DERIA5String.superclass.constructor.call(this,s),this.hT="16"},et(_.asn1.DERIA5String,_.asn1.DERAbstractString),_.asn1.DERVisibleString=function(s){_.asn1.DERIA5String.superclass.constructor.call(this,s),this.hT="1a"},et(_.asn1.DERVisibleString,_.asn1.DERAbstractString),_.asn1.DERBMPString=function(s){_.asn1.DERBMPString.superclass.constructor.call(this,s),this.hT="1e"},et(_.asn1.DERBMPString,_.asn1.DERAbstractString),_.asn1.DERUTCTime=function(s){_.asn1.DERUTCTime.superclass.constructor.call(this,s),this.hT="17",this.setByDate=function(i){this.hTLV=null,this.isModified=!0,this.date=i,this.s=this.formatDate(this.date,"utc"),this.hV=Qe(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=Qe(this.s)),this.hV},s!==void 0&&(s.str!==void 0?this.setString(s.str):typeof s=="string"&&s.match(/^[0-9]{12}Z$/)?this.setString(s):s.hex!==void 0?this.setStringHex(s.hex):s.date!==void 0&&this.setByDate(s.date))},et(_.asn1.DERUTCTime,_.asn1.DERAbstractTime),_.asn1.DERGeneralizedTime=function(s){_.asn1.DERGeneralizedTime.superclass.constructor.call(this,s),this.hT="18",this.withMillis=!1,this.setByDate=function(i){this.hTLV=null,this.isModified=!0,this.date=i,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=Qe(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=Qe(this.s)),this.hV},s!==void 0&&(s.str!==void 0?this.setString(s.str):typeof s=="string"&&s.match(/^[0-9]{14}Z$/)?this.setString(s):s.hex!==void 0?this.setStringHex(s.hex):s.date!==void 0&&this.setByDate(s.date),s.millis===!0&&(this.withMillis=!0))},et(_.asn1.DERGeneralizedTime,_.asn1.DERAbstractTime),_.asn1.DERSequence=function(s){_.asn1.DERSequence.superclass.constructor.call(this,s),this.hT="30",this.getFreshValueHex=function(){for(var i="",a=0;a<this.asn1Array.length;a++)i+=this.asn1Array[a].getEncodedHex();return this.hV=i,this.hV}},et(_.asn1.DERSequence,_.asn1.DERAbstractStructured),_.asn1.DERSet=function(s){_.asn1.DERSet.superclass.constructor.call(this,s),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var i=new Array,a=0;a<this.asn1Array.length;a++){var f=this.asn1Array[a];i.push(f.getEncodedHex())}return this.sortFlag==1&&i.sort(),this.hV=i.join(""),this.hV},s!==void 0&&s.sortflag!==void 0&&s.sortflag==0&&(this.sortFlag=!1)},et(_.asn1.DERSet,_.asn1.DERAbstractStructured),_.asn1.DERTaggedObject=function(s){_.asn1.DERTaggedObject.superclass.constructor.call(this);var i=_.asn1;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(a,f,m){this.hT=f,this.isExplicit=a,this.asn1Object=m,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=m.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,f),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(a){a.tag!=null&&(this.hT=a.tag),a.explicit!=null&&(this.isExplicit=a.explicit),a.tage!=null&&(this.hT=a.tage,this.isExplicit=!0),a.tagi!=null&&(this.hT=a.tagi,this.isExplicit=!1),a.obj!=null&&(a.obj instanceof i.ASN1Object?(this.asn1Object=a.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)):b(a.obj)=="object"&&(this.asn1Object=i.ASN1Util.newObject(a.obj),this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},s!=null&&this.setByParam(s)},et(_.asn1.DERTaggedObject,_.asn1.ASN1Object);var _,ae,ge,ce=new function(){};function Ve(s){for(var i=new Array,a=0;a<s.length;a++)i[a]=s.charCodeAt(a);return i}function rt(s){for(var i="",a=0;a<s.length;a++)i+=String.fromCharCode(s[a]);return i}function Ye(s){for(var i="",a=0;a<s.length;a++){var f=s[a].toString(16);f.length==1&&(f="0"+f),i+=f}return i}function Qe(s){return Ye(Ve(s))}function ze(s){return s=(s=(s=s.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function or(s){return s.length%4==2?s+="==":s.length%4==3&&(s+="="),s=(s=s.replace(/-/g,"+")).replace(/_/g,"/")}function lt(s){return s.length%2==1&&(s="0"+s),ze(M(s))}function Ze(s){return ie(or(s))}function dr(s){return _t(gr(s))}function ht(s){return decodeURIComponent(pr(s))}function kt(s){for(var i="",a=0;a<s.length-1;a+=2)i+=String.fromCharCode(parseInt(s.substr(a,2),16));return i}function Nt(s){for(var i="",a=0;a<s.length;a++)i+=("0"+s.charCodeAt(a).toString(16)).slice(-2);return i}function Qr(s){return M(s)}function W(s){var i=Qr(s).replace(/(.{64})/g,`$1\r
`);return i=i.replace(/\r\n$/,"")}function Y(s){return ie(s.replace(/[^0-9A-Za-z\/+=]*/g,""))}function Le(s,i){return"-----BEGIN "+i+`-----\r
`+W(s)+`\r
-----END `+i+`-----\r
`}function Ue(s,i){if(s.indexOf("-----BEGIN ")==-1)throw"can't find PEM header: "+i;return Y(s=i!==void 0?(s=s.replace(new RegExp("^[^]*-----BEGIN "+i+"-----"),"")).replace(new RegExp("-----END "+i+"-----[^]*$"),""):(s=s.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function Ke(s){var i,a,f,m,P,U,$,H,q,J,z;if(z=s.match(/^(\d{2}|\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return H=z[1],i=parseInt(H),H.length===2&&(50<=i&&i<100?i=1900+i:0<=i&&i<50&&(i=2e3+i)),a=parseInt(z[2])-1,f=parseInt(z[3]),m=parseInt(z[4]),P=parseInt(z[5]),U=parseInt(z[6]),$=0,(q=z[7])!==""&&(J=(q.substr(1)+"00").substr(0,3),$=parseInt(J)),Date.UTC(i,a,f,m,P,U,$);throw"unsupported zulu format: "+s}function dt(s){return~~(Ke(s)/1e3)}function _t(s){return s.replace(/%/g,"")}function pr(s){return s.replace(/(..)/g,"%$1")}function Gt(s){var i="malformed IPv6 address";if(!s.match(/^[0-9A-Fa-f:]+$/))throw i;var a=(s=s.toLowerCase()).split(":").length-1;if(a<2)throw i;var f=":".repeat(7-a+2),m=(s=s.replace("::",f)).split(":");if(m.length!=8)throw i;for(var P=0;P<8;P++)m[P]=("0000"+m[P]).slice(-4);return m.join("")}function Yr(s){if(!s.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";for(var i=(s=s.toLowerCase()).match(/.{1,4}/g),a=0;a<8;a++)i[a]=i[a].replace(/^0+/,""),i[a]==""&&(i[a]="0");var f=(s=":"+i.join(":")+":").match(/:(0:){2,}/g);if(f===null)return s.slice(1,-1);var m="";for(a=0;a<f.length;a++)f[a].length>m.length&&(m=f[a]);return(s=s.replace(m,"::")).slice(1,-1)}function Xr(s){var i="malformed hex value";if(!s.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw i;if(s.length!=8)return s.length==32?Yr(s):s;try{return parseInt(s.substr(0,2),16)+"."+parseInt(s.substr(2,2),16)+"."+parseInt(s.substr(4,2),16)+"."+parseInt(s.substr(6,2),16)}catch{throw i}}function Zr(s){return s.match(/.{4}/g).map(function(a){var f=parseInt(a.substr(0,2),16),m=parseInt(a.substr(2),16);if(f==0&m<128)return String.fromCharCode(m);if(f<8){var P=128|63&m;return ht((192|(7&f)<<3|(192&m)>>6).toString(16)+P.toString(16))}P=128|(15&f)<<2|(192&m)>>6;var U=128|63&m;return ht((224|(240&f)>>4).toString(16)+P.toString(16)+U.toString(16))}).join("")}function gr(s){for(var i=encodeURIComponent(s),a="",f=0;f<i.length;f++)i[f]=="%"?(a+=i.substr(f,3),f+=2):a=a+"%"+Qe(i[f]);return a}function Pr(s){return!(s.length%2!=0||!s.match(/^[0-9a-f]+$/)&&!s.match(/^[0-9A-F]+$/))}function yr(s){return s.length%2==1?"0"+s:s.substr(0,1)>"7"?"00"+s:s}ce.getLblen=function(s,i){if(s.substr(i+2,1)!="8")return 1;var a=parseInt(s.substr(i+3,1));return a==0?-1:0<a&&a<10?a+1:-2},ce.getL=function(s,i){var a=ce.getLblen(s,i);return a<1?"":s.substr(i+2,2*a)},ce.getVblen=function(s,i){var a;return(a=ce.getL(s,i))==""?-1:(a.substr(0,1)==="8"?new L(a.substr(2),16):new L(a,16)).intValue()},ce.getVidx=function(s,i){var a=ce.getLblen(s,i);return a<0?a:i+2*(a+1)},ce.getV=function(s,i){var a=ce.getVidx(s,i),f=ce.getVblen(s,i);return s.substr(a,2*f)},ce.getTLV=function(s,i){return s.substr(i,2)+ce.getL(s,i)+ce.getV(s,i)},ce.getTLVblen=function(s,i){return 2+2*ce.getLblen(s,i)+2*ce.getVblen(s,i)},ce.getNextSiblingIdx=function(s,i){return ce.getVidx(s,i)+2*ce.getVblen(s,i)},ce.getChildIdx=function(s,i){var a,f,m,P=ce,U=[];a=P.getVidx(s,i),f=2*P.getVblen(s,i),s.substr(i,2)=="03"&&(a+=2,f-=2),m=0;for(var $=a;m<=f;){var H=P.getTLVblen(s,$);if((m+=H)<=f&&U.push($),$+=H,m>=f)break}return U},ce.getNthChildIdx=function(s,i,a){return ce.getChildIdx(s,i)[a]},ce.getIdxbyList=function(s,i,a,f){var m,P,U=ce;return a.length==0?f!==void 0&&s.substr(i,2)!==f?-1:i:(m=a.shift())>=(P=U.getChildIdx(s,i)).length?-1:U.getIdxbyList(s,P[m],a,f)},ce.getIdxbyListEx=function(s,i,a,f){var m,P,U=ce;if(a.length==0)return f!==void 0&&s.substr(i,2)!==f?-1:i;m=a.shift(),P=U.getChildIdx(s,i);for(var $=0,H=0;H<P.length;H++){var q=s.substr(P[H],2);if(typeof m=="number"&&!U.isContextTag(q)&&$==m||typeof m=="string"&&U.isContextTag(q,m))return U.getIdxbyListEx(s,P[H],a,f);U.isContextTag(q)||$++}return-1},ce.getTLVbyList=function(s,i,a,f){var m=ce,P=m.getIdxbyList(s,i,a,f);return P==-1||P>=s.length?null:m.getTLV(s,P)},ce.getTLVbyListEx=function(s,i,a,f){var m=ce,P=m.getIdxbyListEx(s,i,a,f);return P==-1?null:m.getTLV(s,P)},ce.getVbyList=function(s,i,a,f,m){var P,U,$=ce;return(P=$.getIdxbyList(s,i,a,f))==-1||P>=s.length?null:(U=$.getV(s,P),m===!0&&(U=U.substr(2)),U)},ce.getVbyListEx=function(s,i,a,f,m){var P,U,$=ce;return(P=$.getIdxbyListEx(s,i,a,f))==-1?null:(U=$.getV(s,P),s.substr(P,2)=="03"&&m!==!1&&(U=U.substr(2)),U)},ce.getInt=function(s,i,a){a==null&&(a=-1);try{var f=s.substr(i,2);if(f!="02"&&f!="03")return a;var m=ce.getV(s,i);return f=="02"?parseInt(m,16):function(U){try{var $=U.substr(0,2);if($=="00")return parseInt(U.substr(2),16);var H=parseInt($,16),q=U.substr(2),J=parseInt(q,16).toString(2);return J=="0"&&(J="00000000"),J=J.slice(0,0-H),parseInt(J,2)}catch{return-1}}(m)}catch{return a}},ce.getOID=function(s,i,a){a==null&&(a=null);try{return s.substr(i,2)!="06"?a:function(m){if(!Pr(m))return null;try{var P=[],U=m.substr(0,2),$=parseInt(U,16);P[0]=new String(Math.floor($/40)),P[1]=new String($%40);for(var H=m.substr(2),q=[],J=0;J<H.length/2;J++)q.push(parseInt(H.substr(2*J,2),16));var z=[],ee="";for(J=0;J<q.length;J++)128&q[J]?ee+=Cr((127&q[J]).toString(2),7):(ee+=Cr((127&q[J]).toString(2),7),z.push(new String(parseInt(ee,2))),ee="");var oe=P.join(".");return z.length>0&&(oe=oe+"."+z.join(".")),oe}catch{return null}}(ce.getV(s,i))}catch{return a}},ce.getOIDName=function(s,i,a){a==null&&(a=null);try{var f=ce.getOID(s,i,a);if(f==a)return a;var m=_.asn1.x509.OID.oid2name(f);return m==""?f:m}catch{return a}},ce.getString=function(s,i,a){a==null&&(a=null);try{return kt(ce.getV(s,i))}catch{return a}},ce.hextooidstr=function(s){var i=function(ee,oe){return ee.length>=oe?ee:new Array(oe-ee.length+1).join("0")+ee},a=[],f=s.substr(0,2),m=parseInt(f,16);a[0]=new String(Math.floor(m/40)),a[1]=new String(m%40);for(var P=s.substr(2),U=[],$=0;$<P.length/2;$++)U.push(parseInt(P.substr(2*$,2),16));var H=[],q="";for($=0;$<U.length;$++)128&U[$]?q+=i((127&U[$]).toString(2),7):(q+=i((127&U[$]).toString(2),7),H.push(new String(parseInt(q,2))),q="");var J=a.join(".");return H.length>0&&(J=J+"."+H.join(".")),J},ce.dump=function(s,i,a,f){var m=ce,P=m.getV,U=m.dump,$=m.getChildIdx,H=s;s instanceof _.asn1.ASN1Object&&(H=s.getEncodedHex());var q=function(Pe,Ge){return Pe.length<=2*Ge?Pe:Pe.substr(0,Ge)+"..(total "+Pe.length/2+"bytes).."+Pe.substr(Pe.length-Ge,Ge)};i===void 0&&(i={ommit_long_octet:32}),a===void 0&&(a=0),f===void 0&&(f="");var J,z=i.ommit_long_octet;if((J=H.substr(a,2))=="01")return(ee=P(H,a))=="00"?f+`BOOLEAN FALSE
`:f+`BOOLEAN TRUE
`;if(J=="02")return f+"INTEGER "+q(ee=P(H,a),z)+`
`;if(J=="03"){var ee=P(H,a);if(m.isASN1HEX(ee.substr(2))){var oe=f+`BITSTRING, encapsulates
`;return oe+=U(ee.substr(2),i,0,f+"  ")}return f+"BITSTRING "+q(ee,z)+`
`}if(J=="04")return ee=P(H,a),m.isASN1HEX(ee)?(oe=f+`OCTETSTRING, encapsulates
`,oe+=U(ee,i,0,f+"  ")):f+"OCTETSTRING "+q(ee,z)+`
`;if(J=="05")return f+`NULL
`;if(J=="06"){var le=P(H,a),we=_.asn1.ASN1Util.oidHexToInt(le),ve=_.asn1.x509.OID.oid2name(we),j=we.replace(/\./g," ");return ve!=""?f+"ObjectIdentifier "+ve+" ("+j+`)
`:f+"ObjectIdentifier ("+j+`)
`}if(J=="0a")return f+"ENUMERATED "+parseInt(P(H,a))+`
`;if(J=="0c")return f+"UTF8String '"+ht(P(H,a))+`'
`;if(J=="13")return f+"PrintableString '"+ht(P(H,a))+`'
`;if(J=="14")return f+"TeletexString '"+ht(P(H,a))+`'
`;if(J=="16")return f+"IA5String '"+ht(P(H,a))+`'
`;if(J=="17")return f+"UTCTime "+ht(P(H,a))+`
`;if(J=="18")return f+"GeneralizedTime "+ht(P(H,a))+`
`;if(J=="1a")return f+"VisualString '"+ht(P(H,a))+`'
`;if(J=="1e")return f+"BMPString '"+Zr(P(H,a))+`'
`;if(J=="30"){if(H.substr(a,4)=="3000")return f+`SEQUENCE {}
`;oe=f+`SEQUENCE
`;var G=i;if(((de=$(H,a)).length==2||de.length==3)&&H.substr(de[0],2)=="06"&&H.substr(de[de.length-1],2)=="04"){ve=m.oidname(P(H,de[0]));var Q=JSON.parse(JSON.stringify(i));Q.x509ExtName=ve,G=Q}for(var Z=0;Z<de.length;Z++)oe+=U(H,G,de[Z],f+"  ");return oe}if(J=="31"){oe=f+`SET
`;var de=$(H,a);for(Z=0;Z<de.length;Z++)oe+=U(H,i,de[Z],f+"  ");return oe}if((128&(J=parseInt(J,16)))!=0){var xe=31&J;if((32&J)!=0){for(oe=f+"["+xe+`]
`,de=$(H,a),Z=0;Z<de.length;Z++)oe+=U(H,i,de[Z],f+"  ");return oe}if(ee=P(H,a),ce.isASN1HEX(ee)){var oe=f+"["+xe+`]
`;return oe+=U(ee,i,0,f+"  ")}return(ee.substr(0,8)=="68747470"||i.x509ExtName==="subjectAltName"&&xe==2)&&(ee=ht(ee)),oe=f+"["+xe+"] "+ee+`
`}return f+"UNKNOWN("+J+") "+P(H,a)+`
`},ce.isContextTag=function(s,i){var a,f;s=s.toLowerCase();try{a=parseInt(s,16)}catch{return-1}if(i===void 0)return(192&a)==128;try{return i.match(/^\[[0-9]+\]$/)!=null&&!((f=parseInt(i.substr(1,i.length-1),10))>31)&&(192&a)==128&&(31&a)==f}catch{return!1}},ce.isASN1HEX=function(s){var i=ce;if(s.length%2==1)return!1;var a=i.getVblen(s,0),f=s.substr(0,2),m=i.getL(s,0);return s.length-f.length-m.length==2*a},ce.checkStrictDER=function(s,i,a,f,m){var P=ce;if(a===void 0){if(typeof s!="string")throw new Error("not hex string");if(s=s.toLowerCase(),!_.lang.String.isHex(s))throw new Error("not hex string");a=s.length,m=(f=s.length/2)<128?1:Math.ceil(f.toString(16))+1}if(P.getL(s,i).length>2*m)throw new Error("L of TLV too long: idx="+i);var U=P.getVblen(s,i);if(U>f)throw new Error("value of L too long than hex: idx="+i);var $=P.getTLV(s,i),H=$.length-2-P.getL(s,i).length;if(H!==2*U)throw new Error("V string length and L's value not the same:"+H+"/"+2*U);if(i===0&&s.length!=$.length)throw new Error("total length and TLV length unmatch:"+s.length+"!="+$.length);var q=s.substr(i,2);if(q==="02"){var J=P.getVidx(s,i);if(s.substr(J,2)=="00"&&s.charCodeAt(J+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(q,16)){for(var z=P.getVblen(s,i),ee=0,oe=P.getChildIdx(s,i),le=0;le<oe.length;le++)ee+=P.getTLV(s,oe[le]).length,P.checkStrictDER(s,oe[le],a,f,m);if(2*z!=ee)throw new Error("sum of children's TLV length and L unmatch: "+2*z+"!="+ee)}},ce.oidname=function(s){var i=_.asn1;_.lang.String.isHex(s)&&(s=i.ASN1Util.oidHexToInt(s));var a=i.x509.OID.oid2name(s);return a===""&&(a=s),a},_!==void 0&&_||(r.KJUR=_={}),_.lang!==void 0&&_.lang||(_.lang={}),_.lang.String=function(){},typeof u=="function"?(r.utf8tob64u=ae=function(i){return ze(u.from(i,"utf8").toString("base64"))},r.b64utoutf8=ge=function(i){return u.from(or(i),"base64").toString("utf8")}):(r.utf8tob64u=ae=function(i){return lt(_t(gr(i)))},r.b64utoutf8=ge=function(i){return decodeURIComponent(pr(Ze(i)))}),_.lang.String.isInteger=function(s){return!!s.match(/^[0-9]+$/)||!!s.match(/^-[0-9]+$/)},_.lang.String.isHex=function(s){return Pr(s)},_.lang.String.isBase64=function(s){return!(!(s=s.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||s.length%4!=0)},_.lang.String.isBase64URL=function(s){return!s.match(/[+/=]/)&&(s=or(s),_.lang.String.isBase64(s))},_.lang.String.isIntegerArray=function(s){return!!(s=s.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},_.lang.String.isPrintable=function(s){return s.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},_.lang.String.isIA5=function(s){return s.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},_.lang.String.isMail=function(s){return s.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};var Cr=function(i,a,f){return f==null&&(f="0"),i.length>=a?i:new Array(a-i.length+1).join(f)+i};function et(s,i){var a=function(){};a.prototype=i.prototype,s.prototype=new a,s.prototype.constructor=s,s.superclass=i.prototype,i.prototype.constructor==Object.prototype.constructor&&(i.prototype.constructor=i)}_!==void 0&&_||(r.KJUR=_={}),_.crypto!==void 0&&_.crypto||(_.crypto={}),_.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:k.algo.MD5,sha1:k.algo.SHA1,sha224:k.algo.SHA224,sha256:k.algo.SHA256,sha384:k.algo.SHA384,sha512:k.algo.SHA512,ripemd160:k.algo.RIPEMD160},this.getDigestInfoHex=function(s,i){if(this.DIGESTINFOHEAD[i]===void 0)throw"alg not supported in Util.DIGESTINFOHEAD: "+i;return this.DIGESTINFOHEAD[i]+s},this.getPaddedDigestInfoHex=function(s,i,a){var f=this.getDigestInfoHex(s,i),m=a/4;if(f.length+22>m)throw"key is too short for SigAlg: keylen="+a+","+i;for(var P="0001",U="00"+f,$="",H=m-P.length-U.length,q=0;q<H;q+=2)$+="ff";return P+$+U},this.hashString=function(s,i){return new _.crypto.MessageDigest({alg:i}).digestString(s)},this.hashHex=function(s,i){return new _.crypto.MessageDigest({alg:i}).digestHex(s)},this.sha1=function(s){return this.hashString(s,"sha1")},this.sha256=function(s){return this.hashString(s,"sha256")},this.sha256Hex=function(s){return this.hashHex(s,"sha256")},this.sha512=function(s){return this.hashString(s,"sha512")},this.sha512Hex=function(s){return this.hashHex(s,"sha512")},this.isKey=function(s){return s instanceof je||s instanceof _.crypto.DSA||s instanceof _.crypto.ECDSA}},_.crypto.Util.md5=function(s){return new _.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(s)},_.crypto.Util.ripemd160=function(s){return new _.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(s)},_.crypto.Util.SECURERANDOMGEN=new ye,_.crypto.Util.getRandomHexOfNbytes=function(s){var i=new Array(s);return _.crypto.Util.SECURERANDOMGEN.nextBytes(i),Ye(i)},_.crypto.Util.getRandomBigIntegerOfNbytes=function(s){return new L(_.crypto.Util.getRandomHexOfNbytes(s),16)},_.crypto.Util.getRandomHexOfNbits=function(s){var i=s%8,a=new Array((s-i)/8+1);return _.crypto.Util.SECURERANDOMGEN.nextBytes(a),a[0]=(255<<i&255^255)&a[0],Ye(a)},_.crypto.Util.getRandomBigIntegerOfNbits=function(s){return new L(_.crypto.Util.getRandomHexOfNbits(s),16)},_.crypto.Util.getRandomBigIntegerZeroToMax=function(s){for(var i=s.bitLength();;){var a=_.crypto.Util.getRandomBigIntegerOfNbits(i);if(s.compareTo(a)!=-1)return a}},_.crypto.Util.getRandomBigIntegerMinToMax=function(s,i){var a=s.compareTo(i);if(a==1)throw"biMin is greater than biMax";if(a==0)return s;var f=i.subtract(s);return _.crypto.Util.getRandomBigIntegerZeroToMax(f).add(s)},_.crypto.MessageDigest=function(s){this.setAlgAndProvider=function(i,a){if((i=_.crypto.MessageDigest.getCanonicalAlgName(i))!==null&&a===void 0&&(a=_.crypto.Util.DEFAULTPROVIDER[i]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(i)!=-1&&a=="cryptojs"){try{this.md=_.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[i].create()}catch(f){throw"setAlgAndProvider hash alg set fail alg="+i+"/"+f}this.updateString=function(f){this.md.update(f)},this.updateHex=function(f){var m=k.enc.Hex.parse(f);this.md.update(m)},this.digest=function(){return this.md.finalize().toString(k.enc.Hex)},this.digestString=function(f){return this.updateString(f),this.digest()},this.digestHex=function(f){return this.updateHex(f),this.digest()}}if(":sha256:".indexOf(i)!=-1&&a=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(f){throw"setAlgAndProvider hash alg set fail alg="+i+"/"+f}this.updateString=function(f){this.md.update(f)},this.updateHex=function(f){var m=sjcl.codec.hex.toBits(f);this.md.update(m)},this.digest=function(){var f=this.md.finalize();return sjcl.codec.hex.fromBits(f)},this.digestString=function(f){return this.updateString(f),this.digest()},this.digestHex=function(f){return this.updateHex(f),this.digest()}}},this.updateString=function(i){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(i){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(i){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(i){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},s!==void 0&&s.alg!==void 0&&(this.algName=s.alg,s.prov===void 0&&(this.provName=_.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},_.crypto.MessageDigest.getCanonicalAlgName=function(s){return typeof s=="string"&&(s=(s=s.toLowerCase()).replace(/-/,"")),s},_.crypto.MessageDigest.getHashLength=function(s){var i=_.crypto.MessageDigest,a=i.getCanonicalAlgName(s);if(i.HASHLENGTH[a]===void 0)throw"not supported algorithm: "+s;return i.HASHLENGTH[a]},_.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},_.crypto.Mac=function(s){this.setAlgAndProvider=function(i,a){if((i=i.toLowerCase())==null&&(i="hmacsha1"),(i=i.toLowerCase()).substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+i;a===void 0&&(a=_.crypto.Util.DEFAULTPROVIDER[i]),this.algProv=i+"/"+a;var f=i.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(f)!=-1&&a=="cryptojs"){try{var m=_.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[f];this.mac=k.algo.HMAC.create(m,this.pass)}catch(P){throw"setAlgAndProvider hash alg set fail hashAlg="+f+"/"+P}this.updateString=function(P){this.mac.update(P)},this.updateHex=function(P){var U=k.enc.Hex.parse(P);this.mac.update(U)},this.doFinal=function(){return this.mac.finalize().toString(k.enc.Hex)},this.doFinalString=function(P){return this.updateString(P),this.doFinal()},this.doFinalHex=function(P){return this.updateHex(P),this.doFinal()}}},this.updateString=function(i){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(i){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(i){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(i){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(i){if(typeof i=="string"){var a=i;return i.length%2!=1&&i.match(/^[0-9A-Fa-f]+$/)||(a=Nt(i)),void(this.pass=k.enc.Hex.parse(a))}if((i===void 0?"undefined":b(i))!="object")throw"KJUR.crypto.Mac unsupported password type: "+i;if(a=null,i.hex!==void 0){if(i.hex.length%2!=0||!i.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+i.hex;a=i.hex}if(i.utf8!==void 0&&(a=dr(i.utf8)),i.rstr!==void 0&&(a=Nt(i.rstr)),i.b64!==void 0&&(a=ie(i.b64)),i.b64u!==void 0&&(a=Ze(i.b64u)),a==null)throw"KJUR.crypto.Mac unsupported password type: "+i;this.pass=k.enc.Hex.parse(a)},s!==void 0&&(s.pass!==void 0&&this.setPassword(s.pass),s.alg!==void 0&&(this.algName=s.alg,s.prov===void 0&&(this.provName=_.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},_.crypto.Signature=function(s){var i=null;if(this._setAlgNames=function(){var a=this.algName.match(/^(.+)with(.+)$/);a&&(this.mdAlgName=a[1].toLowerCase(),this.pubkeyAlgName=a[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(a,f){for(var m="",P=f/4-a.length,U=0;U<P;U++)m+="0";return m+a},this.setAlgAndProvider=function(a,f){if(this._setAlgNames(),f!="cryptojs/jsrsa")throw new Error("provider not supported: "+f);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new _.crypto.MessageDigest({alg:this.mdAlgName})}catch(m){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+m)}this.init=function(m,P){var U=null;try{U=P===void 0?tt.getKey(m):tt.getKey(m,P)}catch($){throw"init failed:"+$}if(U.isPrivate===!0)this.prvKey=U,this.state="SIGN";else{if(U.isPublic!==!0)throw"init failed.:"+U;this.pubKey=U,this.state="VERIFY"}},this.updateString=function(m){this.md.updateString(m)},this.updateHex=function(m){this.md.updateHex(m)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&_.crypto.ECDSA!==void 0&&(this.prvKey=new _.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof je&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof je&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof _.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof _.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(m){return this.updateString(m),this.sign()},this.signHex=function(m){return this.updateHex(m),this.sign()},this.verify=function(m){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&_.crypto.ECDSA!==void 0&&(this.pubKey=new _.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof je&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,m,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof je&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,m);if(_.crypto.ECDSA!==void 0&&this.pubKey instanceof _.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,m);if(_.crypto.DSA!==void 0&&this.pubKey instanceof _.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,m);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(a,f){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(a){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(a){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(a){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(a){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(a){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=s,s!==void 0&&(s.alg!==void 0&&(this.algName=s.alg,s.prov===void 0?this.provName=_.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=s.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),s.psssaltlen!==void 0&&(this.pssSaltLen=s.psssaltlen),s.prvkeypem!==void 0)){if(s.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{i=tt.getKey(s.prvkeypem),this.init(i)}catch(a){throw"fatal error to load pem private key: "+a}}},_.crypto.Cipher=function(s){},_.crypto.Cipher.encrypt=function(s,i,a){if(i instanceof je&&i.isPublic){var f=_.crypto.Cipher.getAlgByKeyAndName(i,a);if(f==="RSA")return i.encrypt(s);if(f==="RSAOAEP")return i.encryptOAEP(s,"sha1");var m=f.match(/^RSAOAEP(\d+)$/);if(m!==null)return i.encryptOAEP(s,"sha"+m[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+a}throw"Cipher.encrypt: unsupported key or algorithm"},_.crypto.Cipher.decrypt=function(s,i,a){if(i instanceof je&&i.isPrivate){var f=_.crypto.Cipher.getAlgByKeyAndName(i,a);if(f==="RSA")return i.decrypt(s);if(f==="RSAOAEP")return i.decryptOAEP(s,"sha1");var m=f.match(/^RSAOAEP(\d+)$/);if(m!==null)return i.decryptOAEP(s,"sha"+m[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+a}throw"Cipher.decrypt: unsupported key or algorithm"},_.crypto.Cipher.getAlgByKeyAndName=function(s,i){if(s instanceof je){if(":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(i)!=-1)return i;if(i==null)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+i}throw"getAlgByKeyAndName: not supported algorithm name: "+i},_.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},_!==void 0&&_||(r.KJUR=_={}),_.crypto!==void 0&&_.crypto||(_.crypto={}),_.crypto.ECDSA=function(s){var i=Error,a=L,f=N,m=_.crypto.ECDSA,P=_.crypto.ECParameterDB,U=m.getName,$=ce,H=$.getVbyListEx,q=$.isASN1HEX,J=new ye;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(z){return new a(z.bitLength(),J).mod(z.subtract(a.ONE)).add(a.ONE)},this.setNamedCurve=function(z){this.ecparams=P.getByName(z),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=z},this.setPrivateKeyHex=function(z){this.isPrivate=!0,this.prvKeyHex=z},this.setPublicKeyHex=function(z){this.isPublic=!0,this.pubKeyHex=z},this.getPublicKeyXYHex=function(){var z=this.pubKeyHex;if(z.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var ee=this.ecparams.keylen/4;if(z.length!==2+2*ee)throw"malformed public key hex length";var oe={};return oe.x=z.substr(2,ee),oe.y=z.substr(2+ee),oe},this.getShortNISTPCurveName=function(){var z=this.curveName;return z==="secp256r1"||z==="NIST P-256"||z==="P-256"||z==="prime256v1"?"P-256":z==="secp384r1"||z==="NIST P-384"||z==="P-384"?"P-384":null},this.generateKeyPairHex=function(){var z=this.ecparams.n,ee=this.getBigRandom(z),oe=this.ecparams.G.multiply(ee),le=oe.getX().toBigInteger(),we=oe.getY().toBigInteger(),ve=this.ecparams.keylen/4,j=("0000000000"+ee.toString(16)).slice(-ve),G="04"+("0000000000"+le.toString(16)).slice(-ve)+("0000000000"+we.toString(16)).slice(-ve);return this.setPrivateKeyHex(j),this.setPublicKeyHex(G),{ecprvhex:j,ecpubhex:G}},this.signWithMessageHash=function(z){return this.signHex(z,this.prvKeyHex)},this.signHex=function(z,ee){var oe=new a(ee,16),le=this.ecparams.n,we=new a(z.substring(0,this.ecparams.keylen/4),16);do var ve=this.getBigRandom(le),j=this.ecparams.G.multiply(ve).getX().toBigInteger().mod(le);while(j.compareTo(a.ZERO)<=0);var G=ve.modInverse(le).multiply(we.add(oe.multiply(j))).mod(le);return m.biRSSigToASN1Sig(j,G)},this.sign=function(z,ee){var oe=ee,le=this.ecparams.n,we=a.fromByteArrayUnsigned(z);do var ve=this.getBigRandom(le),j=this.ecparams.G.multiply(ve).getX().toBigInteger().mod(le);while(j.compareTo(L.ZERO)<=0);var G=ve.modInverse(le).multiply(we.add(oe.multiply(j))).mod(le);return this.serializeSig(j,G)},this.verifyWithMessageHash=function(z,ee){return this.verifyHex(z,ee,this.pubKeyHex)},this.verifyHex=function(z,ee,oe){try{var le,we,ve=m.parseSigHex(ee);le=ve.r,we=ve.s;var j=f.decodeFromHex(this.ecparams.curve,oe),G=new a(z.substring(0,this.ecparams.keylen/4),16);return this.verifyRaw(G,le,we,j)}catch{return!1}},this.verify=function(z,ee,oe){var le,we,ve;if(Bitcoin.Util.isArray(ee)){var j=this.parseSig(ee);le=j.r,we=j.s}else{if((ee===void 0?"undefined":b(ee))!=="object"||!ee.r||!ee.s)throw"Invalid value for signature";le=ee.r,we=ee.s}if(oe instanceof N)ve=oe;else{if(!Bitcoin.Util.isArray(oe))throw"Invalid format for pubkey value, must be byte array or ECPointFp";ve=f.decodeFrom(this.ecparams.curve,oe)}var G=a.fromByteArrayUnsigned(z);return this.verifyRaw(G,le,we,ve)},this.verifyRaw=function(z,ee,oe,le){var we=this.ecparams.n,ve=this.ecparams.G;if(ee.compareTo(a.ONE)<0||ee.compareTo(we)>=0||oe.compareTo(a.ONE)<0||oe.compareTo(we)>=0)return!1;var j=oe.modInverse(we),G=z.multiply(j).mod(we),Q=ee.multiply(j).mod(we);return ve.multiply(G).add(le.multiply(Q)).getX().toBigInteger().mod(we).equals(ee)},this.serializeSig=function(z,ee){var oe=z.toByteArraySigned(),le=ee.toByteArraySigned(),we=[];return we.push(2),we.push(oe.length),(we=we.concat(oe)).push(2),we.push(le.length),(we=we.concat(le)).unshift(we.length),we.unshift(48),we},this.parseSig=function(z){var ee;if(z[0]!=48)throw new Error("Signature not a valid DERSequence");if(z[ee=2]!=2)throw new Error("First element in signature must be a DERInteger");var oe=z.slice(ee+2,ee+2+z[ee+1]);if(z[ee+=2+z[ee+1]]!=2)throw new Error("Second element in signature must be a DERInteger");var le=z.slice(ee+2,ee+2+z[ee+1]);return ee+=2+z[ee+1],{r:a.fromByteArrayUnsigned(oe),s:a.fromByteArrayUnsigned(le)}},this.parseSigCompact=function(z){if(z.length!==65)throw"Signature has the wrong length";var ee=z[0]-27;if(ee<0||ee>7)throw"Invalid signature type";var oe=this.ecparams.n;return{r:a.fromByteArrayUnsigned(z.slice(1,33)).mod(oe),s:a.fromByteArrayUnsigned(z.slice(33,65)).mod(oe),i:ee}},this.readPKCS5PrvKeyHex=function(z){if(q(z)===!1)throw new Error("not ASN.1 hex string");var ee,oe,le;try{ee=H(z,0,["[0]",0],"06"),oe=H(z,0,[1],"04");try{le=H(z,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=U(ee),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(le),this.setPrivateKeyHex(oe),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(z){if(q(z)===!1)throw new i("not ASN.1 hex string");var ee,oe,le;try{H(z,0,[1,0],"06"),ee=H(z,0,[1,1],"06"),oe=H(z,0,[2,0,1],"04");try{le=H(z,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new i("malformed PKCS#8 plain ECC private key")}if(this.curveName=U(ee),this.curveName===void 0)throw new i("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(le),this.setPrivateKeyHex(oe),this.isPublic=!1},this.readPKCS8PubKeyHex=function(z){if(q(z)===!1)throw new i("not ASN.1 hex string");var ee,oe;try{H(z,0,[0,0],"06"),ee=H(z,0,[0,1],"06"),oe=H(z,0,[1],"03")}catch{throw new i("malformed PKCS#8 ECC public key")}if(this.curveName=U(ee),this.curveName===null)throw new i("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(oe)},this.readCertPubKeyHex=function(z,ee){if(q(z)===!1)throw new i("not ASN.1 hex string");var oe,le;try{oe=H(z,0,[0,5,0,1],"06"),le=H(z,0,[0,5,1],"03")}catch{throw new i("malformed X.509 certificate ECC public key")}if(this.curveName=U(oe),this.curveName===null)throw new i("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(le)},s!==void 0&&s.curve!==void 0&&(this.curveName=s.curve),this.curveName===void 0&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),s!==void 0&&(s.prv!==void 0&&this.setPrivateKeyHex(s.prv),s.pub!==void 0&&this.setPublicKeyHex(s.pub))},_.crypto.ECDSA.parseSigHex=function(s){var i=_.crypto.ECDSA.parseSigHexInHexRS(s);return{r:new L(i.r,16),s:new L(i.s,16)}},_.crypto.ECDSA.parseSigHexInHexRS=function(s){var i=ce,a=i.getChildIdx,f=i.getV;if(i.checkStrictDER(s,0),s.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var m=a(s,0);if(m.length!=2)throw new Error("signature shall have two elements");var P=m[0],U=m[1];if(s.substr(P,2)!="02")throw new Error("1st item not ASN.1 integer");if(s.substr(U,2)!="02")throw new Error("2nd item not ASN.1 integer");return{r:f(s,P),s:f(s,U)}},_.crypto.ECDSA.asn1SigToConcatSig=function(s){var i=_.crypto.ECDSA.parseSigHexInHexRS(s),a=i.r,f=i.s;if(a.substr(0,2)=="00"&&a.length%32==2&&(a=a.substr(2)),f.substr(0,2)=="00"&&f.length%32==2&&(f=f.substr(2)),a.length%32==30&&(a="00"+a),f.length%32==30&&(f="00"+f),a.length%32!=0)throw"unknown ECDSA sig r length error";if(f.length%32!=0)throw"unknown ECDSA sig s length error";return a+f},_.crypto.ECDSA.concatSigToASN1Sig=function(s){if(s.length/2*8%128!=0)throw"unknown ECDSA concatinated r-s sig  length error";var i=s.substr(0,s.length/2),a=s.substr(s.length/2);return _.crypto.ECDSA.hexRSSigToASN1Sig(i,a)},_.crypto.ECDSA.hexRSSigToASN1Sig=function(s,i){var a=new L(s,16),f=new L(i,16);return _.crypto.ECDSA.biRSSigToASN1Sig(a,f)},_.crypto.ECDSA.biRSSigToASN1Sig=function(s,i){var a=_.asn1,f=new a.DERInteger({bigint:s}),m=new a.DERInteger({bigint:i});return new a.DERSequence({array:[f,m]}).getEncodedHex()},_.crypto.ECDSA.getName=function(s){return s==="2b8104001f"?"secp192k1":s==="2a8648ce3d030107"?"secp256r1":s==="2b8104000a"?"secp256k1":s==="2b81040021"?"secp224r1":s==="2b81040022"?"secp384r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(s)!==-1?"secp256r1":"|secp256k1|".indexOf(s)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(s)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(s)!==-1?"secp384r1":null},_!==void 0&&_||(r.KJUR=_={}),_.crypto!==void 0&&_.crypto||(_.crypto={}),_.crypto.ECParameterDB=new function(){var s={},i={};function a(f){return new L(f,16)}this.getByName=function(f){var m=f;if(i[m]!==void 0&&(m=i[f]),s[m]!==void 0)return s[m];throw"unregistered EC curve name: "+m},this.regist=function(f,m,P,U,$,H,q,J,z,ee,oe,le){s[f]={};var we=a(P),ve=a(U),j=a($),G=a(H),Q=a(q),Z=new w(we,ve,j),de=Z.decodePointHex("04"+J+z);s[f].name=f,s[f].keylen=m,s[f].curve=Z,s[f].G=de,s[f].n=G,s[f].h=Q,s[f].oid=oe,s[f].info=le;for(var xe=0;xe<ee.length;xe++)i[ee[xe]]=f}},_.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),_.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),_.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),_.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),_.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),_.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),_.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),_.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),_.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),_.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);var tt=function(){var s=function(q,J,z){return i(k.AES,q,J,z)},i=function(q,J,z,ee){var oe=k.enc.Hex.parse(J),le=k.enc.Hex.parse(z),we=k.enc.Hex.parse(ee),ve={};ve.key=le,ve.iv=we,ve.ciphertext=oe;var j=q.decrypt(ve,le,{iv:we});return k.enc.Hex.stringify(j)},a=function(q,J,z){return f(k.AES,q,J,z)},f=function(q,J,z,ee){var oe=k.enc.Hex.parse(J),le=k.enc.Hex.parse(z),we=k.enc.Hex.parse(ee),ve=q.encrypt(oe,le,{iv:we}),j=k.enc.Hex.parse(ve.toString());return k.enc.Base64.stringify(j)},m={"AES-256-CBC":{proc:s,eproc:a,keylen:32,ivlen:16},"AES-192-CBC":{proc:s,eproc:a,keylen:24,ivlen:16},"AES-128-CBC":{proc:s,eproc:a,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(q,J,z){return i(k.TripleDES,q,J,z)},eproc:function(q,J,z){return f(k.TripleDES,q,J,z)},keylen:24,ivlen:8},"DES-CBC":{proc:function(q,J,z){return i(k.DES,q,J,z)},eproc:function(q,J,z){return f(k.DES,q,J,z)},keylen:8,ivlen:8}},P=function(q){var J={},z=q.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));z&&(J.cipher=z[1],J.ivsalt=z[2]);var ee=q.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));ee&&(J.type=ee[1]);var oe=-1,le=0;q.indexOf(`\r
\r
`)!=-1&&(oe=q.indexOf(`\r
\r
`),le=2),q.indexOf(`

`)!=-1&&(oe=q.indexOf(`

`),le=1);var we=q.indexOf("-----END");if(oe!=-1&&we!=-1){var ve=q.substring(oe+2*le,we-le);ve=ve.replace(/\s+/g,""),J.data=ve}return J},U=function(q,J,z){for(var ee=z.substring(0,16),oe=k.enc.Hex.parse(ee),le=k.enc.Utf8.parse(J),we=m[q].keylen+m[q].ivlen,ve="",j=null;;){var G=k.algo.MD5.create();if(j!=null&&G.update(j),G.update(le),G.update(oe),j=G.finalize(),(ve+=k.enc.Hex.stringify(j)).length>=2*we)break}var Q={};return Q.keyhex=ve.substr(0,2*m[q].keylen),Q.ivhex=ve.substr(2*m[q].keylen,2*m[q].ivlen),Q},$=function(q,J,z,ee){var oe=k.enc.Base64.parse(q),le=k.enc.Hex.stringify(oe);return(0,m[J].proc)(le,z,ee)};return{version:"1.0.0",parsePKCS5PEM:function(q){return P(q)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(q,J,z){return U(q,J,z)},decryptKeyB64:function(q,J,z,ee){return $(q,J,z,ee)},getDecryptedKeyHex:function(q,J){var z=P(q),ee=(z.type,z.cipher),oe=z.ivsalt,le=z.data,we=U(ee,J,oe).keyhex;return $(le,ee,we,oe)},getEncryptedPKCS5PEMFromPrvKeyHex:function(q,J,z,ee,oe){var le="";if(ee!==void 0&&ee!=null||(ee="AES-256-CBC"),m[ee]===void 0)throw new Error("KEYUTIL unsupported algorithm: "+ee);oe!==void 0&&oe!=null||(oe=function(j){var G=k.lib.WordArray.random(j);return k.enc.Hex.stringify(G)}(m[ee].ivlen).toUpperCase());var we=function(j,G,Q,Z){return(0,m[G].eproc)(j,Q,Z)}(J,ee,U(ee,z,oe).keyhex,oe);return le="-----BEGIN "+q+` PRIVATE KEY-----\r
`,le+=`Proc-Type: 4,ENCRYPTED\r
`,le+="DEK-Info: "+ee+","+oe+`\r
`,le+=`\r
`,le+=we.replace(/(.{64})/g,`$1\r
`),le+=`\r
-----END `+q+` PRIVATE KEY-----\r
`},parseHexOfEncryptedPKCS8:function(q){var J=ce,z=J.getChildIdx,ee=J.getV,oe={},le=z(q,0);if(le.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+le.length);oe.ciphertext=ee(q,le[1]);var we=z(q,le[0]);if(we.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+we.length);if(ee(q,we[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var ve=z(q,we[1]);if(we.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+ve.length);var j=z(q,ve[1]);if(j.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+j.length);if(ee(q,j[0])!="2a864886f70d0307")throw"this only supports TripleDES";oe.encryptionSchemeAlg="TripleDES",oe.encryptionSchemeIV=ee(q,j[1]);var G=z(q,ve[0]);if(G.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+G.length);if(ee(q,G[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var Q=z(q,G[1]);if(Q.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+Q.length);oe.pbkdf2Salt=ee(q,Q[0]);var Z=ee(q,Q[1]);try{oe.pbkdf2Iter=parseInt(Z,16)}catch{throw new Error("malformed format pbkdf2Iter: "+Z)}return oe},getPBKDF2KeyHexFromParam:function(q,J){var z=k.enc.Hex.parse(q.pbkdf2Salt),ee=q.pbkdf2Iter,oe=k.PBKDF2(J,z,{keySize:6,iterations:ee});return k.enc.Hex.stringify(oe)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(q,J){var z=Ue(q,"ENCRYPTED PRIVATE KEY"),ee=this.parseHexOfEncryptedPKCS8(z),oe=tt.getPBKDF2KeyHexFromParam(ee,J),le={};le.ciphertext=k.enc.Hex.parse(ee.ciphertext);var we=k.enc.Hex.parse(oe),ve=k.enc.Hex.parse(ee.encryptionSchemeIV),j=k.TripleDES.decrypt(le,we,{iv:ve});return k.enc.Hex.stringify(j)},getKeyFromEncryptedPKCS8PEM:function(q,J){var z=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(q,J);return this.getKeyFromPlainPrivatePKCS8Hex(z)},parsePlainPrivatePKCS8Hex:function(q){var J=ce,z=J.getChildIdx,ee=J.getV,oe={algparam:null};if(q.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var le=z(q,0);if(le.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(q.substr(le[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var we=z(q,le[1]);if(we.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(q.substr(we[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if(oe.algoid=ee(q,we[0]),q.substr(we[1],2)=="06"&&(oe.algparam=ee(q,we[1])),q.substr(le[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return oe.keyidx=J.getVidx(q,le[2]),oe},getKeyFromPlainPrivatePKCS8PEM:function(q){var J=Ue(q,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(J)},getKeyFromPlainPrivatePKCS8Hex:function(q){var J,z=this.parsePlainPrivatePKCS8Hex(q);if(z.algoid=="2a864886f70d010101")J=new je;else if(z.algoid=="2a8648ce380401")J=new _.crypto.DSA;else{if(z.algoid!="2a8648ce3d0201")throw new Error("unsupported private key algorithm");J=new _.crypto.ECDSA}return J.readPKCS8PrvKeyHex(q),J},_getKeyFromPublicPKCS8Hex:function(q){var J,z=ce.getVbyList(q,0,[0,0],"06");if(z==="2a864886f70d010101")J=new je;else if(z==="2a8648ce380401")J=new _.crypto.DSA;else{if(z!=="2a8648ce3d0201")throw new Error("unsupported PKCS#8 public key hex");J=new _.crypto.ECDSA}return J.readPKCS8PubKeyHex(q),J},parsePublicRawRSAKeyHex:function(q){var J=ce,z=J.getChildIdx,ee=J.getV,oe={};if(q.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var le=z(q,0);if(le.length!=2)throw new Error("malformed RSA key(code:002)");if(q.substr(le[0],2)!="02")throw new Error("malformed RSA key(code:003)");if(oe.n=ee(q,le[0]),q.substr(le[1],2)!="02")throw new Error("malformed RSA key(code:004)");return oe.e=ee(q,le[1]),oe},parsePublicPKCS8Hex:function(q){var J=ce,z=J.getChildIdx,ee=J.getV,oe={algparam:null},le=z(q,0);if(le.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+le.length);var we=le[0];if(q.substr(we,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var ve=z(q,we);if(ve.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(q.substr(ve[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if(oe.algoid=ee(q,ve[0]),q.substr(ve[1],2)=="06"?oe.algparam=ee(q,ve[1]):q.substr(ve[1],2)=="30"&&(oe.algparam={},oe.algparam.p=J.getVbyList(q,ve[1],[0],"02"),oe.algparam.q=J.getVbyList(q,ve[1],[1],"02"),oe.algparam.g=J.getVbyList(q,ve[1],[2],"02")),q.substr(le[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return oe.key=ee(q,le[1]).substr(2),oe}}}();tt.getKey=function(s,i,a){var f=(ve=ce).getChildIdx,m=(ve.getV,ve.getVbyList),P=_.crypto,U=P.ECDSA,$=P.DSA,H=je,q=Ue,J=tt;if(H!==void 0&&s instanceof H||U!==void 0&&s instanceof U||$!==void 0&&s instanceof $)return s;if(s.curve!==void 0&&s.xy!==void 0&&s.d===void 0)return new U({pub:s.xy,curve:s.curve});if(s.curve!==void 0&&s.d!==void 0)return new U({prv:s.d,curve:s.curve});if(s.kty===void 0&&s.n!==void 0&&s.e!==void 0&&s.d===void 0)return(qe=new H).setPublic(s.n,s.e),qe;if(s.kty===void 0&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0&&s.p!==void 0&&s.q!==void 0&&s.dp!==void 0&&s.dq!==void 0&&s.co!==void 0&&s.qi===void 0)return(qe=new H).setPrivateEx(s.n,s.e,s.d,s.p,s.q,s.dp,s.dq,s.co),qe;if(s.kty===void 0&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0&&s.p===void 0)return(qe=new H).setPrivate(s.n,s.e,s.d),qe;if(s.p!==void 0&&s.q!==void 0&&s.g!==void 0&&s.y!==void 0&&s.x===void 0)return(qe=new $).setPublic(s.p,s.q,s.g,s.y),qe;if(s.p!==void 0&&s.q!==void 0&&s.g!==void 0&&s.y!==void 0&&s.x!==void 0)return(qe=new $).setPrivate(s.p,s.q,s.g,s.y,s.x),qe;if(s.kty==="RSA"&&s.n!==void 0&&s.e!==void 0&&s.d===void 0)return(qe=new H).setPublic(Ze(s.n),Ze(s.e)),qe;if(s.kty==="RSA"&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0&&s.p!==void 0&&s.q!==void 0&&s.dp!==void 0&&s.dq!==void 0&&s.qi!==void 0)return(qe=new H).setPrivateEx(Ze(s.n),Ze(s.e),Ze(s.d),Ze(s.p),Ze(s.q),Ze(s.dp),Ze(s.dq),Ze(s.qi)),qe;if(s.kty==="RSA"&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0)return(qe=new H).setPrivate(Ze(s.n),Ze(s.e),Ze(s.d)),qe;if(s.kty==="EC"&&s.crv!==void 0&&s.x!==void 0&&s.y!==void 0&&s.d===void 0){var z=(Be=new U({curve:s.crv})).ecparams.keylen/4,ee="04"+("0000000000"+Ze(s.x)).slice(-z)+("0000000000"+Ze(s.y)).slice(-z);return Be.setPublicKeyHex(ee),Be}if(s.kty==="EC"&&s.crv!==void 0&&s.x!==void 0&&s.y!==void 0&&s.d!==void 0){z=(Be=new U({curve:s.crv})).ecparams.keylen/4,ee="04"+("0000000000"+Ze(s.x)).slice(-z)+("0000000000"+Ze(s.y)).slice(-z);var oe=("0000000000"+Ze(s.d)).slice(-z);return Be.setPublicKeyHex(ee),Be.setPrivateKeyHex(oe),Be}if(a==="pkcs5prv"){var le,we=s,ve=ce;if((le=f(we,0)).length===9)(qe=new H).readPKCS5PrvKeyHex(we);else if(le.length===6)(qe=new $).readPKCS5PrvKeyHex(we);else{if(!(le.length>2&&we.substr(le[1],2)==="04"))throw new Error("unsupported PKCS#1/5 hexadecimal key");(qe=new U).readPKCS5PrvKeyHex(we)}return qe}if(a==="pkcs8prv")return qe=J.getKeyFromPlainPrivatePKCS8Hex(s);if(a==="pkcs8pub")return J._getKeyFromPublicPKCS8Hex(s);if(a==="x509pub")return pt.getPublicKeyFromCertHex(s);if(s.indexOf("-END CERTIFICATE-",0)!=-1||s.indexOf("-END X509 CERTIFICATE-",0)!=-1||s.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return pt.getPublicKeyFromCertPEM(s);if(s.indexOf("-END PUBLIC KEY-")!=-1){var j=Ue(s,"PUBLIC KEY");return J._getKeyFromPublicPKCS8Hex(j)}if(s.indexOf("-END RSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")==-1){var G=q(s,"RSA PRIVATE KEY");return J.getKey(G,null,"pkcs5prv")}if(s.indexOf("-END DSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")==-1){var Q=m(it=q(s,"DSA PRIVATE KEY"),0,[1],"02"),Z=m(it,0,[2],"02"),de=m(it,0,[3],"02"),xe=m(it,0,[4],"02"),Me=m(it,0,[5],"02");return(qe=new $).setPrivate(new L(Q,16),new L(Z,16),new L(de,16),new L(xe,16),new L(Me,16)),qe}if(s.indexOf("-END EC PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")==-1)return G=q(s,"EC PRIVATE KEY"),J.getKey(G,null,"pkcs5prv");if(s.indexOf("-END PRIVATE KEY-")!=-1)return J.getKeyFromPlainPrivatePKCS8PEM(s);if(s.indexOf("-END RSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")!=-1){var Pe=J.getDecryptedKeyHex(s,i),Ge=new je;return Ge.readPKCS5PrvKeyHex(Pe),Ge}if(s.indexOf("-END EC PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")!=-1){var Be,qe=m(it=J.getDecryptedKeyHex(s,i),0,[1],"04"),nt=m(it,0,[2,0],"06"),ot=m(it,0,[3,0],"03").substr(2);if(_.crypto.OID.oidhex2name[nt]===void 0)throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+nt);return(Be=new U({curve:_.crypto.OID.oidhex2name[nt]})).setPublicKeyHex(ot),Be.setPrivateKeyHex(qe),Be.isPublic=!1,Be}if(s.indexOf("-END DSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")!=-1){var it;return Q=m(it=J.getDecryptedKeyHex(s,i),0,[1],"02"),Z=m(it,0,[2],"02"),de=m(it,0,[3],"02"),xe=m(it,0,[4],"02"),Me=m(it,0,[5],"02"),(qe=new $).setPrivate(new L(Q,16),new L(Z,16),new L(de,16),new L(xe,16),new L(Me,16)),qe}if(s.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return J.getKeyFromEncryptedPKCS8PEM(s,i);throw new Error("not supported argument")},tt.generateKeypair=function(s,i){if(s=="RSA"){var a=i;(U=new je).generate(a,"10001"),U.isPrivate=!0,U.isPublic=!0;var f=new je,m=U.n.toString(16),P=U.e.toString(16);return f.setPublic(m,P),f.isPrivate=!1,f.isPublic=!0,($={}).prvKeyObj=U,$.pubKeyObj=f,$}if(s=="EC"){var U,$,H=i,q=new _.crypto.ECDSA({curve:H}).generateKeyPairHex();return(U=new _.crypto.ECDSA({curve:H})).setPublicKeyHex(q.ecpubhex),U.setPrivateKeyHex(q.ecprvhex),U.isPrivate=!0,U.isPublic=!1,(f=new _.crypto.ECDSA({curve:H})).setPublicKeyHex(q.ecpubhex),f.isPrivate=!1,f.isPublic=!0,($={}).prvKeyObj=U,$.pubKeyObj=f,$}throw new Error("unknown algorithm: "+s)},tt.getPEM=function(s,i,a,f,m,P){var U=_,$=U.asn1,H=$.DERObjectIdentifier,q=$.DERInteger,J=$.ASN1Util.newObject,z=$.x509.SubjectPublicKeyInfo,ee=U.crypto,oe=ee.DSA,le=ee.ECDSA,we=je;function ve(Be){return J({seq:[{int:0},{int:{bigint:Be.n}},{int:Be.e},{int:{bigint:Be.d}},{int:{bigint:Be.p}},{int:{bigint:Be.q}},{int:{bigint:Be.dmp1}},{int:{bigint:Be.dmq1}},{int:{bigint:Be.coeff}}]})}function j(Be){return J({seq:[{int:1},{octstr:{hex:Be.prvKeyHex}},{tag:["a0",!0,{oid:{name:Be.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+Be.pubKeyHex}}]}]})}function G(Be){return J({seq:[{int:0},{int:{bigint:Be.p}},{int:{bigint:Be.q}},{int:{bigint:Be.g}},{int:{bigint:Be.y}},{int:{bigint:Be.x}}]})}if((we!==void 0&&s instanceof we||oe!==void 0&&s instanceof oe||le!==void 0&&s instanceof le)&&s.isPublic==1&&(i===void 0||i=="PKCS8PUB"))return Le(xe=new z(s).getEncodedHex(),"PUBLIC KEY");if(i=="PKCS1PRV"&&we!==void 0&&s instanceof we&&(a===void 0||a==null)&&s.isPrivate==1)return Le(xe=ve(s).getEncodedHex(),"RSA PRIVATE KEY");if(i=="PKCS1PRV"&&le!==void 0&&s instanceof le&&(a===void 0||a==null)&&s.isPrivate==1){var Q=new H({name:s.curveName}).getEncodedHex(),Z=j(s).getEncodedHex(),de="";return de+=Le(Q,"EC PARAMETERS"),de+=Le(Z,"EC PRIVATE KEY")}if(i=="PKCS1PRV"&&oe!==void 0&&s instanceof oe&&(a===void 0||a==null)&&s.isPrivate==1)return Le(xe=G(s).getEncodedHex(),"DSA PRIVATE KEY");if(i=="PKCS5PRV"&&we!==void 0&&s instanceof we&&a!==void 0&&a!=null&&s.isPrivate==1){var xe=ve(s).getEncodedHex();return f===void 0&&(f="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",xe,a,f,P)}if(i=="PKCS5PRV"&&le!==void 0&&s instanceof le&&a!==void 0&&a!=null&&s.isPrivate==1)return xe=j(s).getEncodedHex(),f===void 0&&(f="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",xe,a,f,P);if(i=="PKCS5PRV"&&oe!==void 0&&s instanceof oe&&a!==void 0&&a!=null&&s.isPrivate==1)return xe=G(s).getEncodedHex(),f===void 0&&(f="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",xe,a,f,P);var Me=function(qe,nt){var ot=Pe(qe,nt);return new J({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:ot.pbkdf2Salt}},{int:ot.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:ot.encryptionSchemeIV}}]}]}]},{octstr:{hex:ot.ciphertext}}]}).getEncodedHex()},Pe=function(qe,nt){var ot=k.lib.WordArray.random(8),it=k.lib.WordArray.random(8),Dt=k.PBKDF2(nt,ot,{keySize:6,iterations:100}),Ft=k.enc.Hex.parse(qe),At=k.TripleDES.encrypt(Ft,Dt,{iv:it})+"",ft={};return ft.ciphertext=At,ft.pbkdf2Salt=k.enc.Hex.stringify(ot),ft.pbkdf2Iter=100,ft.encryptionSchemeAlg="DES-EDE3-CBC",ft.encryptionSchemeIV=k.enc.Hex.stringify(it),ft};if(i=="PKCS8PRV"&&we!=null&&s instanceof we&&s.isPrivate==1){var Ge=ve(s).getEncodedHex();return xe=J({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:Ge}}]}).getEncodedHex(),a===void 0||a==null?Le(xe,"PRIVATE KEY"):Le(Z=Me(xe,a),"ENCRYPTED PRIVATE KEY")}if(i=="PKCS8PRV"&&le!==void 0&&s instanceof le&&s.isPrivate==1)return Ge=new J({seq:[{int:1},{octstr:{hex:s.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+s.pubKeyHex}}]}]}).getEncodedHex(),xe=J({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:s.curveName}}]},{octstr:{hex:Ge}}]}).getEncodedHex(),a===void 0||a==null?Le(xe,"PRIVATE KEY"):Le(Z=Me(xe,a),"ENCRYPTED PRIVATE KEY");if(i=="PKCS8PRV"&&oe!==void 0&&s instanceof oe&&s.isPrivate==1)return Ge=new q({bigint:s.x}).getEncodedHex(),xe=J({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:s.p}},{int:{bigint:s.q}},{int:{bigint:s.g}}]}]},{octstr:{hex:Ge}}]}).getEncodedHex(),a===void 0||a==null?Le(xe,"PRIVATE KEY"):Le(Z=Me(xe,a),"ENCRYPTED PRIVATE KEY");throw new Error("unsupported object nor format")},tt.getKeyFromCSRPEM=function(s){var i=Ue(s,"CERTIFICATE REQUEST");return tt.getKeyFromCSRHex(i)},tt.getKeyFromCSRHex=function(s){var i=tt.parseCSRHex(s);return tt.getKey(i.p8pubkeyhex,null,"pkcs8pub")},tt.parseCSRHex=function(s){var i=ce,a=i.getChildIdx,f=i.getTLV,m={},P=s;if(P.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var U=a(P,0);if(U.length<1)throw new Error("malformed CSR(code:002)");if(P.substr(U[0],2)!="30")throw new Error("malformed CSR(code:003)");var $=a(P,U[0]);if($.length<3)throw new Error("malformed CSR(code:004)");return m.p8pubkeyhex=f(P,$[2]),m},tt.getKeyID=function(s){var i=tt,a=ce;typeof s=="string"&&s.indexOf("BEGIN ")!=-1&&(s=i.getKey(s));var f=Ue(i.getPEM(s)),m=a.getIdxbyList(f,0,[1]),P=a.getV(f,m).substring(2);return _.crypto.Util.hashHex(P,"sha1")},tt.getJWKFromKey=function(s){var i={};if(s instanceof je&&s.isPrivate)return i.kty="RSA",i.n=lt(s.n.toString(16)),i.e=lt(s.e.toString(16)),i.d=lt(s.d.toString(16)),i.p=lt(s.p.toString(16)),i.q=lt(s.q.toString(16)),i.dp=lt(s.dmp1.toString(16)),i.dq=lt(s.dmq1.toString(16)),i.qi=lt(s.coeff.toString(16)),i;if(s instanceof je&&s.isPublic)return i.kty="RSA",i.n=lt(s.n.toString(16)),i.e=lt(s.e.toString(16)),i;if(s instanceof _.crypto.ECDSA&&s.isPrivate){if((f=s.getShortNISTPCurveName())!=="P-256"&&f!=="P-384")throw new Error("unsupported curve name for JWT: "+f);var a=s.getPublicKeyXYHex();return i.kty="EC",i.crv=f,i.x=lt(a.x),i.y=lt(a.y),i.d=lt(s.prvKeyHex),i}if(s instanceof _.crypto.ECDSA&&s.isPublic){var f;if((f=s.getShortNISTPCurveName())!=="P-256"&&f!=="P-384")throw new Error("unsupported curve name for JWT: "+f);return a=s.getPublicKeyXYHex(),i.kty="EC",i.crv=f,i.x=lt(a.x),i.y=lt(a.y),i}throw new Error("not supported key object")},je.getPosArrayOfChildrenFromHex=function(s){return ce.getChildIdx(s,0)},je.getHexValueArrayOfChildrenFromHex=function(s){var i,a=ce.getV,f=a(s,(i=je.getPosArrayOfChildrenFromHex(s))[0]),m=a(s,i[1]),P=a(s,i[2]),U=a(s,i[3]),$=a(s,i[4]),H=a(s,i[5]),q=a(s,i[6]),J=a(s,i[7]),z=a(s,i[8]);return(i=new Array).push(f,m,P,U,$,H,q,J,z),i},je.prototype.readPrivateKeyFromPEMString=function(s){var i=Ue(s),a=je.getHexValueArrayOfChildrenFromHex(i);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},je.prototype.readPKCS5PrvKeyHex=function(s){var i=je.getHexValueArrayOfChildrenFromHex(s);this.setPrivateEx(i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},je.prototype.readPKCS8PrvKeyHex=function(s){var i,a,f,m,P,U,$,H,q=ce,J=q.getVbyListEx;if(q.isASN1HEX(s)===!1)throw new Error("not ASN.1 hex string");try{i=J(s,0,[2,0,1],"02"),a=J(s,0,[2,0,2],"02"),f=J(s,0,[2,0,3],"02"),m=J(s,0,[2,0,4],"02"),P=J(s,0,[2,0,5],"02"),U=J(s,0,[2,0,6],"02"),$=J(s,0,[2,0,7],"02"),H=J(s,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(i,a,f,m,P,U,$,H)},je.prototype.readPKCS5PubKeyHex=function(s){var i=ce,a=i.getV;if(i.isASN1HEX(s)===!1)throw new Error("keyHex is not ASN.1 hex string");var f=i.getChildIdx(s,0);if(f.length!==2||s.substr(f[0],2)!=="02"||s.substr(f[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var m=a(s,f[0]),P=a(s,f[1]);this.setPublic(m,P)},je.prototype.readPKCS8PubKeyHex=function(s){var i=ce;if(i.isASN1HEX(s)===!1)throw new Error("not ASN.1 hex string");if(i.getTLVbyListEx(s,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var a=i.getTLVbyListEx(s,0,[1,0]);this.readPKCS5PubKeyHex(a)},je.prototype.readCertPubKeyHex=function(s,i){var a,f;(a=new pt).readCertHex(s),f=a.getPublicKeyHex(),this.readPKCS8PubKeyHex(f)};function Bt(s,i){for(var a="",f=i/4-s.length,m=0;m<f;m++)a+="0";return a+s}function lo(s,i,a){for(var f="",m=0;f.length<i;)f+=kt(a(Nt(s+String.fromCharCode.apply(String,[(4278190080&m)>>24,(16711680&m)>>16,(65280&m)>>8,255&m])))),m+=1;return f}function ho(s){for(var i in _.crypto.Util.DIGESTINFOHEAD){var a=_.crypto.Util.DIGESTINFOHEAD[i],f=a.length;if(s.substring(0,f)==a)return[i,s.substring(f)]}return[]}function pt(s){var i,a=ce,f=a.getChildIdx,m=a.getV,P=a.getTLV,U=a.getVbyList,$=a.getVbyListEx,H=a.getTLVbyList,q=a.getTLVbyListEx,J=a.getIdxbyList,z=a.getIdxbyListEx,ee=a.getVidx,oe=a.getInt,le=a.oidname,we=a.hextooidstr,ve=Ue;try{i=_.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var j=H(this.hex,0,[0,0]);if(j.substr(0,2)=="a0"){var G=H(j,0,[0]),Q=oe(G,0);if(Q<0||2<Q)throw new Error("malformed version field");return this.version=Q+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return $(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var j=q(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(j)},this.getAlgorithmIdentifierName=function(j){for(var G in i)if(j===i[G])return G;return le($(j,0,[0],"06"))},this.getIssuer=function(){return this.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return H(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(){return this.getX500Name(this.getSubjectHex())},this.getSubjectHex=function(){return H(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var j=U(this.hex,0,[0,4+this.foffset,0]);return j=j.replace(/(..)/g,"%$1"),j=decodeURIComponent(j)},this.getNotAfter=function(){var j=U(this.hex,0,[0,4+this.foffset,1]);return j=j.replace(/(..)/g,"%$1"),j=decodeURIComponent(j)},this.getPublicKeyHex=function(){return a.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return J(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var j=this.getPublicKeyIdx();return J(this.hex,j,[1,0],"30")},this.getPublicKey=function(){return tt.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var j=H(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(j)},this.getSignatureValueHex=function(){return U(this.hex,0,[2],"03",!0)},this.verifySignature=function(j){var G=this.getSignatureAlgorithmField(),Q=this.getSignatureValueHex(),Z=H(this.hex,0,[0],"30"),de=new _.crypto.Signature({alg:G});return de.init(j),de.updateHex(Z),de.verify(Q)},this.parseExt=function(j){var G,Q,Z;if(j===void 0){if(Z=this.hex,this.version!==3)return-1;G=J(Z,0,[0,7,0],"30"),Q=f(Z,G)}else{Z=Ue(j);var de=J(Z,0,[0,3,0,0],"06");if(m(Z,de)!="2a864886f70d01090e")return void(this.aExtInfo=new Array);G=J(Z,0,[0,3,0,1,0],"30"),Q=f(Z,G),this.hex=Z}this.aExtInfo=new Array;for(var xe=0;xe<Q.length;xe++){var Me={critical:!1},Pe=0;f(Z,Q[xe]).length===3&&(Me.critical=!0,Pe=1),Me.oid=a.hextooidstr(U(Z,Q[xe],[0],"06"));var Ge=J(Z,Q[xe],[1+Pe]);Me.vidx=ee(Z,Ge),this.aExtInfo.push(Me)}},this.getExtInfo=function(j){var G=this.aExtInfo,Q=j;if(j.match(/^[0-9.]+$/)||(Q=_.asn1.x509.OID.name2oid(j)),Q!==""){for(var Z=0;Z<G.length;Z++)if(G[Z].oid===Q)return G[Z]}},this.getExtBasicConstraints=function(j,G){if(j===void 0&&G===void 0){var Q=this.getExtInfo("basicConstraints");if(Q===void 0)return;j=P(this.hex,Q.vidx),G=Q.critical}var Z={extname:"basicConstraints"};if(G&&(Z.critical=!0),j==="3000")return Z;if(j==="30030101ff")return Z.cA=!0,Z;if(j.substr(0,12)==="30060101ff02"){var de=m(j,10),xe=parseInt(de,16);return Z.cA=!0,Z.pathLen=xe,Z}throw new Error("hExtV parse error: "+j)},this.getExtKeyUsage=function(j,G){if(j===void 0&&G===void 0){var Q=this.getExtInfo("keyUsage");if(Q===void 0)return;j=P(this.hex,Q.vidx),G=Q.critical}var Z={extname:"keyUsage"};return G&&(Z.critical=!0),Z.names=this.getExtKeyUsageString(j).split(","),Z},this.getExtKeyUsageBin=function(j){if(j===void 0){var G=this.getExtInfo("keyUsage");if(G===void 0)return"";j=P(this.hex,G.vidx)}if(j.length!=8&&j.length!=10)throw new Error("malformed key usage value: "+j);var Q="000000000000000"+parseInt(j.substr(6),16).toString(2);return j.length==8&&(Q=Q.slice(-8)),j.length==10&&(Q=Q.slice(-16)),(Q=Q.replace(/0+$/,""))==""&&(Q="0"),Q},this.getExtKeyUsageString=function(j){for(var G=this.getExtKeyUsageBin(j),Q=new Array,Z=0;Z<G.length;Z++)G.substr(Z,1)=="1"&&Q.push(pt.KEYUSAGE_NAME[Z]);return Q.join(",")},this.getExtSubjectKeyIdentifier=function(j,G){if(j===void 0&&G===void 0){var Q=this.getExtInfo("subjectKeyIdentifier");if(Q===void 0)return;j=P(this.hex,Q.vidx),G=Q.critical}var Z={extname:"subjectKeyIdentifier"};G&&(Z.critical=!0);var de=m(j,0);return Z.kid={hex:de},Z},this.getExtAuthorityKeyIdentifier=function(j,G){if(j===void 0&&G===void 0){var Q=this.getExtInfo("authorityKeyIdentifier");if(Q===void 0)return;j=P(this.hex,Q.vidx),G=Q.critical}var Z={extname:"authorityKeyIdentifier"};G&&(Z.critical=!0);for(var de=f(j,0),xe=0;xe<de.length;xe++){var Me=j.substr(de[xe],2);if(Me==="80"&&(Z.kid={hex:m(j,de[xe])}),Me==="a1"){var Pe=P(j,de[xe]),Ge=this.getGeneralNames(Pe);Z.issuer=Ge[0].dn}Me==="82"&&(Z.sn={hex:m(j,de[xe])})}return Z},this.getExtExtKeyUsage=function(j,G){if(j===void 0&&G===void 0){var Q=this.getExtInfo("extKeyUsage");if(Q===void 0)return;j=P(this.hex,Q.vidx),G=Q.critical}var Z={extname:"extKeyUsage",array:[]};G&&(Z.critical=!0);for(var de=f(j,0),xe=0;xe<de.length;xe++)Z.array.push(le(m(j,de[xe])));return Z},this.getExtExtKeyUsageName=function(){var j=this.getExtInfo("extKeyUsage");if(j===void 0)return j;var G=new Array,Q=P(this.hex,j.vidx);if(Q==="")return G;for(var Z=f(Q,0),de=0;de<Z.length;de++)G.push(le(m(Q,Z[de])));return G},this.getExtSubjectAltName=function(j,G){if(j===void 0&&G===void 0){var Q=this.getExtInfo("subjectAltName");if(Q===void 0)return;j=P(this.hex,Q.vidx),G=Q.critical}var Z={extname:"subjectAltName",array:[]};return G&&(Z.critical=!0),Z.array=this.getGeneralNames(j),Z},this.getExtIssuerAltName=function(j,G){if(j===void 0&&G===void 0){var Q=this.getExtInfo("issuerAltName");if(Q===void 0)return;j=P(this.hex,Q.vidx),G=Q.critical}var Z={extname:"issuerAltName",array:[]};return G&&(Z.critical=!0),Z.array=this.getGeneralNames(j),Z},this.getGeneralNames=function(j){for(var G=f(j,0),Q=[],Z=0;Z<G.length;Z++){var de=this.getGeneralName(P(j,G[Z]));de!==void 0&&Q.push(de)}return Q},this.getGeneralName=function(j){var G=j.substr(0,2),Q=m(j,0),Z=kt(Q);return G=="81"?{rfc822:Z}:G=="82"?{dns:Z}:G=="86"?{uri:Z}:G=="87"?{ip:Xr(Q)}:G=="a4"?{dn:this.getX500Name(Q)}:void 0},this.getExtSubjectAltName2=function(){var j,G,Q,Z=this.getExtInfo("subjectAltName");if(Z===void 0)return Z;for(var de=new Array,xe=P(this.hex,Z.vidx),Me=f(xe,0),Pe=0;Pe<Me.length;Pe++)Q=xe.substr(Me[Pe],2),j=m(xe,Me[Pe]),Q==="81"&&(G=ht(j),de.push(["MAIL",G])),Q==="82"&&(G=ht(j),de.push(["DNS",G])),Q==="84"&&(G=pt.hex2dn(j,0),de.push(["DN",G])),Q==="86"&&(G=ht(j),de.push(["URI",G])),Q==="87"&&(G=Xr(j),de.push(["IP",G]));return de},this.getExtCRLDistributionPoints=function(j,G){if(j===void 0&&G===void 0){var Q=this.getExtInfo("cRLDistributionPoints");if(Q===void 0)return;j=P(this.hex,Q.vidx),G=Q.critical}var Z={extname:"cRLDistributionPoints",array:[]};G&&(Z.critical=!0);for(var de=f(j,0),xe=0;xe<de.length;xe++){var Me=P(j,de[xe]);Z.array.push(this.getDistributionPoint(Me))}return Z},this.getDistributionPoint=function(j){for(var G={},Q=f(j,0),Z=0;Z<Q.length;Z++){var de=j.substr(Q[Z],2),xe=P(j,Q[Z]);de=="a0"&&(G.dpname=this.getDistributionPointName(xe))}return G},this.getDistributionPointName=function(j){for(var G={},Q=f(j,0),Z=0;Z<Q.length;Z++){var de=j.substr(Q[Z],2),xe=P(j,Q[Z]);de=="a0"&&(G.full=this.getGeneralNames(xe))}return G},this.getExtCRLDistributionPointsURI=function(){var j=this.getExtInfo("cRLDistributionPoints");if(j===void 0)return j;for(var G=new Array,Q=f(this.hex,j.vidx),Z=0;Z<Q.length;Z++)try{var de=ht(U(this.hex,Q[Z],[0,0,0],"86"));G.push(de)}catch{}return G},this.getExtAIAInfo=function(){var j=this.getExtInfo("authorityInfoAccess");if(j===void 0)return j;for(var G={ocsp:[],caissuer:[]},Q=f(this.hex,j.vidx),Z=0;Z<Q.length;Z++){var de=U(this.hex,Q[Z],[0],"06"),xe=U(this.hex,Q[Z],[1],"86");de==="2b06010505073001"&&G.ocsp.push(ht(xe)),de==="2b06010505073002"&&G.caissuer.push(ht(xe))}return G},this.getExtAuthorityInfoAccess=function(j,G){if(j===void 0&&G===void 0){var Q=this.getExtInfo("authorityInfoAccess");if(Q===void 0)return;j=P(this.hex,Q.vidx),G=Q.critical}var Z={extname:"authorityInfoAccess",array:[]};G&&(Z.critical=!0);for(var de=f(j,0),xe=0;xe<de.length;xe++){var Me=$(j,de[xe],[0],"06"),Pe=ht(U(j,de[xe],[1],"86"));if(Me=="2b06010505073001")Z.array.push({ocsp:Pe});else{if(Me!="2b06010505073002")throw new Error("unknown method: "+Me);Z.array.push({caissuer:Pe})}}return Z},this.getExtCertificatePolicies=function(j,G){if(j===void 0&&G===void 0){var Q=this.getExtInfo("certificatePolicies");if(Q===void 0)return;j=P(this.hex,Q.vidx),G=Q.critical}var Z={extname:"certificatePolicies",array:[]};G&&(Z.critical=!0);for(var de=f(j,0),xe=0;xe<de.length;xe++){var Me=P(j,de[xe]),Pe=this.getPolicyInformation(Me);Z.array.push(Pe)}return Z},this.getPolicyInformation=function(j){var G={},Q=U(j,0,[0],"06");G.policyoid=le(Q);var Z=z(j,0,[1],"30");if(Z!=-1){G.array=[];for(var de=f(j,Z),xe=0;xe<de.length;xe++){var Me=P(j,de[xe]),Pe=this.getPolicyQualifierInfo(Me);G.array.push(Pe)}}return G},this.getPolicyQualifierInfo=function(j){var G={},Q=U(j,0,[0],"06");if(Q==="2b06010505070201"){var Z=$(j,0,[1],"16");G.cps=kt(Z)}else if(Q==="2b06010505070202"){var de=H(j,0,[1],"30");G.unotice=this.getUserNotice(de)}return G},this.getUserNotice=function(j){for(var G={},Q=f(j,0),Z=0;Z<Q.length;Z++){var de=P(j,Q[Z]);de.substr(0,2)!="30"&&(G.exptext=this.getDisplayText(de))}return G},this.getDisplayText=function(j){var G={};return G.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[j.substr(0,2)],G.str=kt(m(j,0)),G},this.getExtCRLNumber=function(j,G){var Q={extname:"cRLNumber"};if(G&&(Q.critical=!0),j.substr(0,2)=="02")return Q.num={hex:m(j,0)},Q;throw new Error("hExtV parse error: "+j)},this.getExtCRLReason=function(j,G){var Q={extname:"cRLReason"};if(G&&(Q.critical=!0),j.substr(0,2)=="0a")return Q.code=parseInt(m(j,0),16),Q;throw new Error("hExtV parse error: "+j)},this.getExtOcspNonce=function(j,G){var Q={extname:"ocspNonce"};G&&(Q.critical=!0);var Z=m(j,0);return Q.hex=Z,Q},this.getExtOcspNoCheck=function(j,G){var Q={extname:"ocspNoCheck"};return G&&(Q.critical=!0),Q},this.getExtAdobeTimeStamp=function(j,G){if(j===void 0&&G===void 0){var Q=this.getExtInfo("adobeTimeStamp");if(Q===void 0)return;j=P(this.hex,Q.vidx),G=Q.critical}var Z={extname:"adobeTimeStamp"};G&&(Z.critical=!0);var de=f(j,0);if(de.length>1){var xe=P(j,de[1]),Me=this.getGeneralName(xe);Me.uri!=null&&(Z.uri=Me.uri)}if(de.length>2){var Pe=P(j,de[2]);Pe=="0101ff"&&(Z.reqauth=!0),Pe=="010100"&&(Z.reqauth=!1)}return Z},this.getX500NameRule=function(j){for(var G=null,Q=[],Z=0;Z<j.length;Z++)for(var de=j[Z],xe=0;xe<de.length;xe++)Q.push(de[xe]);for(Z=0;Z<Q.length;Z++){var Me=Q[Z],Pe=Me.ds,Ge=Me.value,Be=Me.type;if(Pe!="prn"&&Pe!="utf8"&&Pe!="ia5")return"mixed";if(Pe=="ia5"){if(Be!="CN")return"mixed";if(_.lang.String.isMail(Ge))continue;return"mixed"}if(Be=="C"){if(Pe=="prn")continue;return"mixed"}if(G==null)G=Pe;else if(G!==Pe)return"mixed"}return G??"prn"},this.getX500Name=function(j){var G=this.getX500NameArray(j);return{array:G,str:this.dnarraytostr(G)}},this.getX500NameArray=function(j){for(var G=[],Q=f(j,0),Z=0;Z<Q.length;Z++)G.push(this.getRDN(P(j,Q[Z])));return G},this.getRDN=function(j){for(var G=[],Q=f(j,0),Z=0;Z<Q.length;Z++)G.push(this.getAttrTypeAndValue(P(j,Q[Z])));return G},this.getAttrTypeAndValue=function(j){var G={type:null,value:null,ds:null},Q=f(j,0),Z=U(j,Q[0],[],"06"),de=U(j,Q[1],[]),xe=_.asn1.ASN1Util.oidHexToInt(Z);return G.type=_.asn1.x509.OID.oid2atype(xe),G.ds=this.HEX2STAG[j.substr(Q[1],2)],G.ds!="bmp"?G.value=ht(de):G.value=Zr(de),G},this.readCertPEM=function(j){this.readCertHex(ve(j))},this.readCertHex=function(j){this.hex=j,this.getVersion();try{J(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(){var j={};return j.version=this.getVersion(),j.serial={hex:this.getSerialNumberHex()},j.sigalg=this.getSignatureAlgorithmField(),j.issuer=this.getIssuer(),j.notbefore=this.getNotBefore(),j.notafter=this.getNotAfter(),j.subject=this.getSubject(),j.sbjpubkey=Le(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo.length>0&&(j.ext=this.getExtParamArray()),j.sighex=this.getSignatureValueHex(),j},this.getExtParamArray=function(j){j==null&&z(this.hex,0,[0,"[3]"])!=-1&&(j=q(this.hex,0,[0,"[3]",0],"30"));for(var G=[],Q=f(j,0),Z=0;Z<Q.length;Z++){var de=P(j,Q[Z]),xe=this.getExtParam(de);xe!=null&&G.push(xe)}return G},this.getExtParam=function(j){var G=f(j,0).length;if(G!=2&&G!=3)throw new Error("wrong number elements in Extension: "+G+" "+j);var Q=we(U(j,0,[0],"06")),Z=!1;G==3&&H(j,0,[1])=="0101ff"&&(Z=!0);var de=H(j,0,[G-1,0]),xe=void 0;if(Q=="2.5.29.14"?xe=this.getExtSubjectKeyIdentifier(de,Z):Q=="2.5.29.15"?xe=this.getExtKeyUsage(de,Z):Q=="2.5.29.17"?xe=this.getExtSubjectAltName(de,Z):Q=="2.5.29.18"?xe=this.getExtIssuerAltName(de,Z):Q=="2.5.29.19"?xe=this.getExtBasicConstraints(de,Z):Q=="2.5.29.31"?xe=this.getExtCRLDistributionPoints(de,Z):Q=="2.5.29.32"?xe=this.getExtCertificatePolicies(de,Z):Q=="2.5.29.35"?xe=this.getExtAuthorityKeyIdentifier(de,Z):Q=="2.5.29.37"?xe=this.getExtExtKeyUsage(de,Z):Q=="1.3.6.1.5.5.7.1.1"?xe=this.getExtAuthorityInfoAccess(de,Z):Q=="2.5.29.20"?xe=this.getExtCRLNumber(de,Z):Q=="2.5.29.21"?xe=this.getExtCRLReason(de,Z):Q=="1.3.6.1.5.5.7.48.1.2"?xe=this.getExtOcspNonce(de,Z):Q=="1.3.6.1.5.5.7.48.1.5"?xe=this.getExtOcspNoCheck(de,Z):Q=="1.2.840.113583.1.1.9.1"&&(xe=this.getExtAdobeTimeStamp(de,Z)),xe!=null)return xe;var Me={extname:Q,extn:de};return Z&&(Me.critical=!0),Me},this.findExt=function(j,G){for(var Q=0;Q<j.length;Q++)if(j[Q].extname==G)return j[Q];return null},this.updateExtCDPFullURI=function(j,G){var Q=this.findExt(j,"cRLDistributionPoints");if(Q!=null&&Q.array!=null){for(var Z=Q.array,de=0;de<Z.length;de++)if(Z[de].dpname!=null&&Z[de].dpname.full!=null)for(var xe=Z[de].dpname.full,Me=0;Me<xe.length;Me++){var Pe=xe[de];Pe.uri!=null&&(Pe.uri=G)}}},this.updateExtAIAOCSP=function(j,G){var Q=this.findExt(j,"authorityInfoAccess");if(Q!=null&&Q.array!=null)for(var Z=Q.array,de=0;de<Z.length;de++)Z[de].ocsp!=null&&(Z[de].ocsp=G)},this.updateExtAIACAIssuer=function(j,G){var Q=this.findExt(j,"authorityInfoAccess");if(Q!=null&&Q.array!=null)for(var Z=Q.array,de=0;de<Z.length;de++)Z[de].caissuer!=null&&(Z[de].caissuer=G)},this.dnarraytostr=function(j){return"/"+j.map(function(G){return function(Z){return Z.map(function(de){return function(Me){return Me.type+"="+Me.value}(de).replace(/\+/,"\\+")}).join("+")}(G).replace(/\//,"\\/")}).join("/")},this.getInfo=function(){var j,G,Q,Z=function(Dt){return JSON.stringify(Dt.array).replace(/[\[\]\{\}\"]/g,"")},de=function(Dt){for(var Ft="",At=Dt.array,ft=0;ft<At.length;ft++){var gt=At[ft];if(Ft+="    policy oid: "+gt.policyoid+`
`,gt.array!==void 0)for(var bt=0;bt<gt.array.length;bt++){var It=gt.array[bt];It.cps!==void 0&&(Ft+="    cps: "+It.cps+`
`)}}return Ft},xe=function(Dt){for(var Ft="",At=Dt.array,ft=0;ft<At.length;ft++){var gt=At[ft];try{gt.dpname.full[0].uri!==void 0&&(Ft+="    "+gt.dpname.full[0].uri+`
`)}catch{}try{gt.dname.full[0].dn.hex!==void 0&&(Ft+="    "+pt.hex2dn(gt.dpname.full[0].dn.hex)+`
`)}catch{}}return Ft},Me=function(Dt){for(var Ft="",At=Dt.array,ft=0;ft<At.length;ft++){var gt=At[ft];gt.caissuer!==void 0&&(Ft+="    caissuer: "+gt.caissuer+`
`),gt.ocsp!==void 0&&(Ft+="    ocsp: "+gt.ocsp+`
`)}return Ft};if(j=`Basic Fields
`,j+="  serial number: "+this.getSerialNumberHex()+`
`,j+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,j+="  issuer: "+this.getIssuerString()+`
`,j+="  notBefore: "+this.getNotBefore()+`
`,j+="  notAfter: "+this.getNotAfter()+`
`,j+="  subject: "+this.getSubjectString()+`
`,j+=`  subject public key info: 
`,j+="    key algorithm: "+(G=this.getPublicKey()).type+`
`,G.type==="RSA"&&(j+="    n="+yr(G.n.toString(16)).substr(0,16)+`...
`,j+="    e="+yr(G.e.toString(16))+`
`),(Q=this.aExtInfo)!=null){j+=`X509v3 Extensions:
`;for(var Pe=0;Pe<Q.length;Pe++){var Ge=Q[Pe],Be=_.asn1.x509.OID.oid2name(Ge.oid);Be===""&&(Be=Ge.oid);var qe="";if(Ge.critical===!0&&(qe="CRITICAL"),j+="  "+Be+" "+qe+`:
`,Be==="basicConstraints"){var nt=this.getExtBasicConstraints();nt.cA===void 0?j+=`    {}
`:(j+="    cA=true",nt.pathLen!==void 0&&(j+=", pathLen="+nt.pathLen),j+=`
`)}else if(Be==="keyUsage")j+="    "+this.getExtKeyUsageString()+`
`;else if(Be==="subjectKeyIdentifier")j+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(Be==="authorityKeyIdentifier"){var ot=this.getExtAuthorityKeyIdentifier();ot.kid!==void 0&&(j+="    kid="+ot.kid.hex+`
`)}else Be==="extKeyUsage"?j+="    "+this.getExtExtKeyUsage().array.join(", ")+`
`:Be==="subjectAltName"?j+="    "+Z(this.getExtSubjectAltName())+`
`:Be==="cRLDistributionPoints"?j+=xe(this.getExtCRLDistributionPoints()):Be==="authorityInfoAccess"?j+=Me(this.getExtAuthorityInfoAccess()):Be==="certificatePolicies"&&(j+=de(this.getExtCertificatePolicies()))}}return j+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,j+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`},typeof s=="string"&&(s.indexOf("-----BEGIN")!=-1?this.readCertPEM(s):_.lang.String.isHex(s)&&this.readCertHex(s))}je.prototype.sign=function(s,i){var a=function(m){return _.crypto.Util.hashString(m,i)}(s);return this.signWithMessageHash(a,i)},je.prototype.signWithMessageHash=function(s,i){var a=We(_.crypto.Util.getPaddedDigestInfoHex(s,i,this.n.bitLength()),16);return Bt(this.doPrivate(a).toString(16),this.n.bitLength())},je.prototype.signPSS=function(s,i,a){var f=function(P){return _.crypto.Util.hashHex(P,i)}(Nt(s));return a===void 0&&(a=-1),this.signWithMessageHashPSS(f,i,a)},je.prototype.signWithMessageHashPSS=function(s,i,a){var f,m=kt(s),P=m.length,U=this.n.bitLength()-1,$=Math.ceil(U/8),H=function(j){return _.crypto.Util.hashHex(j,i)};if(a===-1||a===void 0)a=P;else if(a===-2)a=$-P-2;else if(a<-2)throw new Error("invalid salt length");if($<P+a+2)throw new Error("data too long");var q="";a>0&&(q=new Array(a),new ye().nextBytes(q),q=String.fromCharCode.apply(String,q));var J=kt(H(Nt("\0\0\0\0\0\0\0\0"+m+q))),z=[];for(f=0;f<$-a-P-2;f+=1)z[f]=0;var ee=String.fromCharCode.apply(String,z)+""+q,oe=lo(J,ee.length,H),le=[];for(f=0;f<ee.length;f+=1)le[f]=ee.charCodeAt(f)^oe.charCodeAt(f);var we=65280>>8*$-U&255;for(le[0]&=~we,f=0;f<P;f++)le.push(J.charCodeAt(f));return le.push(188),Bt(this.doPrivate(new L(le)).toString(16),this.n.bitLength())},je.prototype.verify=function(s,i){if((i=i.toLowerCase()).match(/^[0-9a-f]+$/)==null)return!1;var a=We(i,16),f=this.n.bitLength();if(a.bitLength()>f)return!1;var m=this.doPublic(a).toString(16);if(m.length+3!=f/4)return!1;var P=ho(m.replace(/^1f+00/,""));if(P.length==0)return!1;var U=P[0];return P[1]==function(H){return _.crypto.Util.hashString(H,U)}(s)},je.prototype.verifyWithMessageHash=function(s,i){if(i.length!=Math.ceil(this.n.bitLength()/4))return!1;var a=We(i,16);if(a.bitLength()>this.n.bitLength())return 0;var f=ho(this.doPublic(a).toString(16).replace(/^1f+00/,""));return f.length==0?!1:(f[0],f[1]==s)},je.prototype.verifyPSS=function(s,i,a,f){var m=function(U){return _.crypto.Util.hashHex(U,a)}(Nt(s));return f===void 0&&(f=-1),this.verifyWithMessageHashPSS(m,i,a,f)},je.prototype.verifyWithMessageHashPSS=function(s,i,a,f){if(i.length!=Math.ceil(this.n.bitLength()/4))return!1;var m,P=new L(i,16),U=function(Q){return _.crypto.Util.hashHex(Q,a)},$=kt(s),H=$.length,q=this.n.bitLength()-1,J=Math.ceil(q/8);if(f===-1||f===void 0)f=H;else if(f===-2)f=J-H-2;else if(f<-2)throw new Error("invalid salt length");if(J<H+f+2)throw new Error("data too long");var z=this.doPublic(P).toByteArray();for(m=0;m<z.length;m+=1)z[m]&=255;for(;z.length<J;)z.unshift(0);if(z[J-1]!==188)throw new Error("encoded message does not end in 0xbc");var ee=(z=String.fromCharCode.apply(String,z)).substr(0,J-H-1),oe=z.substr(ee.length,H),le=65280>>8*J-q&255;if((ee.charCodeAt(0)&le)!=0)throw new Error("bits beyond keysize not zero");var we=lo(oe,ee.length,U),ve=[];for(m=0;m<ee.length;m+=1)ve[m]=ee.charCodeAt(m)^we.charCodeAt(m);ve[0]&=~le;var j=J-H-f-2;for(m=0;m<j;m+=1)if(ve[m]!==0)throw new Error("leftmost octets not zero");if(ve[j]!==1)throw new Error("0x01 marker not found");return oe===kt(U(Nt("\0\0\0\0\0\0\0\0"+$+String.fromCharCode.apply(String,ve.slice(-f)))))},je.SALT_LEN_HLEN=-1,je.SALT_LEN_MAX=-2,je.SALT_LEN_RECOVER=-2,pt.hex2dn=function(s,i){i===void 0&&(i=0);var a=new pt;return ce.getTLV(s,i),a.getX500Name(s).str},pt.hex2rdn=function(s,i){if(i===void 0&&(i=0),s.substr(i,2)!=="31")throw new Error("malformed RDN");for(var a=new Array,f=ce.getChildIdx(s,i),m=0;m<f.length;m++)a.push(pt.hex2attrTypeValue(s,f[m]));return(a=a.map(function(P){return P.replace("+","\\+")})).join("+")},pt.hex2attrTypeValue=function(s,i){var a=ce,f=a.getV;if(i===void 0&&(i=0),s.substr(i,2)!=="30")throw new Error("malformed attribute type and value");var m=a.getChildIdx(s,i);m.length!==2||s.substr(m[0],2);var P=f(s,m[0]),U=_.asn1.ASN1Util.oidHexToInt(P);return _.asn1.x509.OID.oid2atype(U)+"="+kt(f(s,m[1]))},pt.getPublicKeyFromCertHex=function(s){var i=new pt;return i.readCertHex(s),i.getPublicKey()},pt.getPublicKeyFromCertPEM=function(s){var i=new pt;return i.readCertPEM(s),i.getPublicKey()},pt.getPublicKeyInfoPropOfCertPEM=function(s){var i,a,f=ce.getVbyList,m={};return m.algparam=null,(i=new pt).readCertPEM(s),a=i.getPublicKeyHex(),m.keyhex=f(a,0,[1],"03").substr(2),m.algoid=f(a,0,[0,0],"06"),m.algoid==="2a8648ce3d0201"&&(m.algparam=f(a,0,[0,1],"06")),m},pt.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],_!==void 0&&_||(r.KJUR=_={}),_.jws!==void 0&&_.jws||(_.jws={}),_.jws.JWS=function(){var s=_.jws.JWS.isSafeJSONString;this.parseJWS=function(i,a){if(this.parsedJWS===void 0||!a&&this.parsedJWS.sigvalH===void 0){var f=i.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(f==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var m=f[1],P=f[2],U=f[3],$=m+"."+P;if(this.parsedJWS={},this.parsedJWS.headB64U=m,this.parsedJWS.payloadB64U=P,this.parsedJWS.sigvalB64U=U,this.parsedJWS.si=$,!a){var H=Ze(U),q=We(H,16);this.parsedJWS.sigvalH=H,this.parsedJWS.sigvalBI=q}var J=ge(m),z=ge(P);if(this.parsedJWS.headS=J,this.parsedJWS.payloadS=z,!s(J,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+J}}},_.jws.JWS.sign=function(s,i,a,f,m){var P,U,$,H=_,q=H.jws.JWS,J=q.readSafeJSONString,z=q.isSafeJSONString,ee=H.crypto,oe=(ee.ECDSA,ee.Mac),le=ee.Signature,we=JSON;if(typeof i!="string"&&(i===void 0?"undefined":b(i))!="object")throw"spHeader must be JSON string or object: "+i;if((i===void 0?"undefined":b(i))=="object"&&(U=i,P=we.stringify(U)),typeof i=="string"){if(!z(P=i))throw"JWS Head is not safe JSON string: "+P;U=J(P)}if($=a,(a===void 0?"undefined":b(a))=="object"&&($=we.stringify(a)),s!=""&&s!=null||U.alg===void 0||(s=U.alg),s!=""&&s!=null&&U.alg===void 0&&(U.alg=s,P=we.stringify(U)),s!==U.alg)throw"alg and sHeader.alg doesn't match: "+s+"!="+U.alg;var ve=null;if(q.jwsalg2sigalg[s]===void 0)throw"unsupported alg name: "+s;ve=q.jwsalg2sigalg[s];var j=ae(P)+"."+ae($),G="";if(ve.substr(0,4)=="Hmac"){if(f===void 0)throw"mac key shall be specified for HS* alg";var Q=new oe({alg:ve,prov:"cryptojs",pass:f});Q.updateString(j),G=Q.doFinal()}else if(ve.indexOf("withECDSA")!=-1){(de=new le({alg:ve})).init(f,m),de.updateString(j);var Z=de.sign();G=_.crypto.ECDSA.asn1SigToConcatSig(Z)}else{var de;ve!="none"&&((de=new le({alg:ve})).init(f,m),de.updateString(j),G=de.sign())}return j+"."+lt(G)},_.jws.JWS.verify=function(s,i,a){var f,m=_,P=m.jws.JWS,U=P.readSafeJSONString,$=m.crypto,H=$.ECDSA,q=$.Mac,J=$.Signature;b(je)!==void 0&&(f=je);var z=s.split(".");if(z.length!==3)return!1;var ee=z[0]+"."+z[1],oe=Ze(z[2]),le=U(ge(z[0])),we=null,ve=null;if(le.alg===void 0)throw"algorithm not specified in header";if(ve=(we=le.alg).substr(0,2),a!=null&&Object.prototype.toString.call(a)==="[object Array]"&&a.length>0&&(":"+a.join(":")+":").indexOf(":"+we+":")==-1)throw"algorithm '"+we+"' not accepted in the list";if(we!="none"&&i===null)throw"key shall be specified to verify.";if(typeof i=="string"&&i.indexOf("-----BEGIN ")!=-1&&(i=tt.getKey(i)),!(ve!="RS"&&ve!="PS"||i instanceof f))throw"key shall be a RSAKey obj for RS* and PS* algs";if(ve=="ES"&&!(i instanceof H))throw"key shall be a ECDSA obj for ES* algs";var j=null;if(P.jwsalg2sigalg[le.alg]===void 0)throw"unsupported alg name: "+we;if((j=P.jwsalg2sigalg[we])=="none")throw"not supported";if(j.substr(0,4)=="Hmac"){if(i===void 0)throw"hexadecimal key shall be specified for HMAC";var G=new q({alg:j,pass:i});return G.updateString(ee),oe==G.doFinal()}if(j.indexOf("withECDSA")!=-1){var Q,Z=null;try{Z=H.concatSigToASN1Sig(oe)}catch{return!1}return(Q=new J({alg:j})).init(i),Q.updateString(ee),Q.verify(Z)}return(Q=new J({alg:j})).init(i),Q.updateString(ee),Q.verify(oe)},_.jws.JWS.parse=function(s){var i,a,f,m=s.split("."),P={};if(m.length!=2&&m.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return i=m[0],a=m[1],m.length==3&&(f=m[2]),P.headerObj=_.jws.JWS.readSafeJSONString(ge(i)),P.payloadObj=_.jws.JWS.readSafeJSONString(ge(a)),P.headerPP=JSON.stringify(P.headerObj,null,"  "),P.payloadObj==null?P.payloadPP=ge(a):P.payloadPP=JSON.stringify(P.payloadObj,null,"  "),f!==void 0&&(P.sigHex=Ze(f)),P},_.jws.JWS.verifyJWT=function(s,i,a){var f=_.jws,m=f.JWS,P=m.readSafeJSONString,U=m.inArray,$=m.includedArray,H=s.split("."),q=H[0],J=H[1],z=(Ze(H[2]),P(ge(q))),ee=P(ge(J));if(z.alg===void 0)return!1;if(a.alg===void 0)throw"acceptField.alg shall be specified";if(!U(z.alg,a.alg)||ee.iss!==void 0&&b(a.iss)==="object"&&!U(ee.iss,a.iss)||ee.sub!==void 0&&b(a.sub)==="object"&&!U(ee.sub,a.sub))return!1;if(ee.aud!==void 0&&b(a.aud)==="object"){if(typeof ee.aud=="string"){if(!U(ee.aud,a.aud))return!1}else if(b(ee.aud)=="object"&&!$(ee.aud,a.aud))return!1}var oe=f.IntDate.getNow();return a.verifyAt!==void 0&&typeof a.verifyAt=="number"&&(oe=a.verifyAt),a.gracePeriod!==void 0&&typeof a.gracePeriod=="number"||(a.gracePeriod=0),!(ee.exp!==void 0&&typeof ee.exp=="number"&&ee.exp+a.gracePeriod<oe)&&!(ee.nbf!==void 0&&typeof ee.nbf=="number"&&oe<ee.nbf-a.gracePeriod)&&!(ee.iat!==void 0&&typeof ee.iat=="number"&&oe<ee.iat-a.gracePeriod)&&(ee.jti===void 0||a.jti===void 0||ee.jti===a.jti)&&!!m.verify(s,i,a.alg)},_.jws.JWS.includedArray=function(s,i){var a=_.jws.JWS.inArray;if(s===null||(s===void 0?"undefined":b(s))!=="object"||typeof s.length!="number")return!1;for(var f=0;f<s.length;f++)if(!a(s[f],i))return!1;return!0},_.jws.JWS.inArray=function(s,i){if(i===null||(i===void 0?"undefined":b(i))!=="object"||typeof i.length!="number")return!1;for(var a=0;a<i.length;a++)if(i[a]==s)return!0;return!1},_.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},_.jws.JWS.isSafeJSONString=function(s,i,a){var f=null;try{return((f=F(s))===void 0?"undefined":b(f))!="object"||f.constructor===Array?0:(i&&(i[a]=f),1)}catch{return 0}},_.jws.JWS.readSafeJSONString=function(s){var i=null;try{return((i=F(s))===void 0?"undefined":b(i))!="object"||i.constructor===Array?null:i}catch{return null}},_.jws.JWS.getEncodedSignatureValueFromJWS=function(s){var i=s.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(i==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return i[1]},_.jws.JWS.getJWKthumbprint=function(s){if(s.kty!=="RSA"&&s.kty!=="EC"&&s.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var i="{";if(s.kty==="RSA"){if(typeof s.n!="string"||typeof s.e!="string")throw"wrong n and e value for RSA key";i+='"e":"'+s.e+'",',i+='"kty":"'+s.kty+'",',i+='"n":"'+s.n+'"}'}else if(s.kty==="EC"){if(typeof s.crv!="string"||typeof s.x!="string"||typeof s.y!="string")throw"wrong crv, x and y value for EC key";i+='"crv":"'+s.crv+'",',i+='"kty":"'+s.kty+'",',i+='"x":"'+s.x+'",',i+='"y":"'+s.y+'"}'}else if(s.kty==="oct"){if(typeof s.k!="string")throw"wrong k value for oct(symmetric) key";i+='"kty":"'+s.kty+'",',i+='"k":"'+s.k+'"}'}var a=Nt(i);return lt(_.crypto.Util.hashHex(a,"sha256"))},_.jws.IntDate={},_.jws.IntDate.get=function(s){var i=_.jws.IntDate,a=i.getNow,f=i.getZulu;if(s=="now")return a();if(s=="now + 1hour")return a()+3600;if(s=="now + 1day")return a()+86400;if(s=="now + 1month")return a()+2592e3;if(s=="now + 1year")return a()+31536e3;if(s.match(/Z$/))return f(s);if(s.match(/^[0-9]+$/))return parseInt(s);throw"unsupported format: "+s},_.jws.IntDate.getZulu=function(s){return dt(s)},_.jws.IntDate.getNow=function(){return~~(new Date/1e3)},_.jws.IntDate.intDate2UTCString=function(s){return new Date(1e3*s).toUTCString()},_.jws.IntDate.intDate2Zulu=function(s){var i=new Date(1e3*s);return("0000"+i.getUTCFullYear()).slice(-4)+("00"+(i.getUTCMonth()+1)).slice(-2)+("00"+i.getUTCDate()).slice(-2)+("00"+i.getUTCHours()).slice(-2)+("00"+i.getUTCMinutes()).slice(-2)+("00"+i.getUTCSeconds()).slice(-2)+"Z"},r.SecureRandom=ye,r.rng_seed_time=X,r.BigInteger=L,r.RSAKey=je;var Gc=_.crypto.EDSA;r.EDSA=Gc;var zc=_.crypto.DSA;r.DSA=zc;var Qc=_.crypto.Signature;r.Signature=Qc;var Yc=_.crypto.MessageDigest;r.MessageDigest=Yc;var Xc=_.crypto.Mac;r.Mac=Xc;var Zc=_.crypto.Cipher;r.Cipher=Zc,r.KEYUTIL=tt,r.ASN1HEX=ce,r.X509=pt,r.CryptoJS=k,r.b64tohex=ie,r.b64toBA=he,r.stoBA=Ve,r.BAtos=rt,r.BAtohex=Ye,r.stohex=Qe,r.stob64=function(i){return M(Qe(i))},r.stob64u=function(i){return ze(M(Qe(i)))},r.b64utos=function(i){return rt(he(or(i)))},r.b64tob64u=ze,r.b64utob64=or,r.hex2b64=M,r.hextob64u=lt,r.b64utohex=Ze,r.utf8tob64u=ae,r.b64utoutf8=ge,r.utf8tob64=function(i){return M(_t(gr(i)))},r.b64toutf8=function(i){return decodeURIComponent(pr(ie(i)))},r.utf8tohex=dr,r.hextoutf8=ht,r.hextorstr=kt,r.rstrtohex=Nt,r.hextob64=Qr,r.hextob64nl=W,r.b64nltohex=Y,r.hextopem=Le,r.pemtohex=Ue,r.hextoArrayBuffer=function(i){if(i.length%2!=0)throw"input is not even length";if(i.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var a=new ArrayBuffer(i.length/2),f=new DataView(a),m=0;m<i.length/2;m++)f.setUint8(m,parseInt(i.substr(2*m,2),16));return a},r.ArrayBuffertohex=function(i){for(var a="",f=new DataView(i),m=0;m<i.byteLength;m++)a+=("00"+f.getUint8(m).toString(16)).slice(-2);return a},r.zulutomsec=Ke,r.zulutosec=dt,r.zulutodate=function(i){return new Date(Ke(i))},r.datetozulu=function(i,a,f){var m,P=i.getUTCFullYear();if(a){if(P<1950||2049<P)throw"not proper year for UTCTime: "+P;m=(""+P).slice(-2)}else m=("000"+P).slice(-4);if(m+=("0"+(i.getUTCMonth()+1)).slice(-2),m+=("0"+i.getUTCDate()).slice(-2),m+=("0"+i.getUTCHours()).slice(-2),m+=("0"+i.getUTCMinutes()).slice(-2),m+=("0"+i.getUTCSeconds()).slice(-2),f){var U=i.getUTCMilliseconds();U!==0&&(m+="."+(U=(U=("00"+U).slice(-3)).replace(/0+$/g,"")))}return m+="Z"},r.uricmptohex=_t,r.hextouricmp=pr,r.ipv6tohex=Gt,r.hextoipv6=Yr,r.hextoip=Xr,r.iptohex=function(i){var a="malformed IP address";if(!(i=i.toLowerCase(i)).match(/^[0-9.]+$/)){if(i.match(/^[0-9a-f:]+$/)&&i.indexOf(":")!==-1)return Gt(i);throw a}var f=i.split(".");if(f.length!==4)throw a;var m="";try{for(var P=0;P<4;P++)m+=("0"+parseInt(f[P]).toString(16)).slice(-2);return m}catch{throw a}},r.encodeURIComponentAll=gr,r.newline_toUnix=function(i){return i=i.replace(/\r\n/gm,`
`)},r.newline_toDos=function(i){return i=(i=i.replace(/\r\n/gm,`
`)).replace(/\n/gm,`\r
`)},r.hextoposhex=yr,r.intarystrtohex=function(i){i=(i=(i=i.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return i.split(/,/).map(function(a,f,m){var P=parseInt(a);if(P<0||255<P)throw"integer not in range 0-255";return("00"+P.toString(16)).slice(-2)}).join("")}catch(a){throw"malformed integer array string: "+a}},r.strdiffidx=function(i,a){var f=i.length;i.length>a.length&&(f=a.length);for(var m=0;m<f;m++)if(i.charCodeAt(m)!=a.charCodeAt(m))return m;return i.length!=a.length?f:-1},r.KJUR=_;var el=_.crypto;r.crypto=el;var tl=_.asn1;r.asn1=tl;var rl=_.jws;r.jws=rl;var nl=_.lang;r.lang=nl}).call(this,o(28).Buffer)},function(t,r,o){(function(u){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var c=o(30),l=o(31),g=o(32);function h(){return p.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function d(V,I){if(h()<I)throw new RangeError("Invalid typed array length");return p.TYPED_ARRAY_SUPPORT?(V=new Uint8Array(I)).__proto__=p.prototype:(V===null&&(V=new p(I)),V.length=I),V}function p(V,I,y){if(!(p.TYPED_ARRAY_SUPPORT||this instanceof p))return new p(V,I,y);if(typeof V=="number"){if(typeof I=="string")throw new Error("If encoding is specified then the first argument must be a string");return S(this,V)}return x(this,V,I,y)}function x(V,I,y,C){if(typeof I=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&I instanceof ArrayBuffer?function(X,se,_e,te){if(se.byteLength,_e<0||se.byteLength<_e)throw new RangeError("'offset' is out of bounds");if(se.byteLength<_e+(te||0))throw new RangeError("'length' is out of bounds");return se=_e===void 0&&te===void 0?new Uint8Array(se):te===void 0?new Uint8Array(se,_e):new Uint8Array(se,_e,te),p.TYPED_ARRAY_SUPPORT?(X=se).__proto__=p.prototype:X=v(X,se),X}(V,I,y,C):typeof I=="string"?function(X,se,_e){if(typeof _e=="string"&&_e!==""||(_e="utf8"),!p.isEncoding(_e))throw new TypeError('"encoding" must be a valid string encoding');var te=0|b(se,_e),Ee=(X=d(X,te)).write(se,_e);return Ee!==te&&(X=X.slice(0,Ee)),X}(V,I,y):function(X,se){if(p.isBuffer(se)){var _e=0|R(se.length);return(X=d(X,_e)).length===0||se.copy(X,0,0,_e),X}if(se){if(typeof ArrayBuffer<"u"&&se.buffer instanceof ArrayBuffer||"length"in se)return typeof se.length!="number"||function(Ee){return Ee!=Ee}(se.length)?d(X,0):v(X,se);if(se.type==="Buffer"&&g(se.data))return v(X,se.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(V,I)}function T(V){if(typeof V!="number")throw new TypeError('"size" argument must be a number');if(V<0)throw new RangeError('"size" argument must not be negative')}function S(V,I){if(T(I),V=d(V,I<0?0:0|R(I)),!p.TYPED_ARRAY_SUPPORT)for(var y=0;y<I;++y)V[y]=0;return V}function v(V,I){var y=I.length<0?0:0|R(I.length);V=d(V,y);for(var C=0;C<y;C+=1)V[C]=255&I[C];return V}function R(V){if(V>=h())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+h().toString(16)+" bytes");return 0|V}function b(V,I){if(p.isBuffer(V))return V.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(V)||V instanceof ArrayBuffer))return V.byteLength;typeof V!="string"&&(V=""+V);var y=V.length;if(y===0)return 0;for(var C=!1;;)switch(I){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":case void 0:return Se(V).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*y;case"hex":return y>>>1;case"base64":return Re(V).length;default:if(C)return Se(V).length;I=(""+I).toLowerCase(),C=!0}}function E(V,I,y){var C=!1;if((I===void 0||I<0)&&(I=0),I>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0)<=(I>>>=0))return"";for(V||(V="utf8");;)switch(V){case"hex":return Ne(this,I,y);case"utf8":case"utf-8":return ue(this,I,y);case"ascii":return ne(this,I,y);case"latin1":case"binary":return fe(this,I,y);case"base64":return be(this,I,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return pe(this,I,y);default:if(C)throw new TypeError("Unknown encoding: "+V);V=(V+"").toLowerCase(),C=!0}}function A(V,I,y){var C=V[I];V[I]=V[y],V[y]=C}function k(V,I,y,C,O){if(V.length===0)return-1;if(typeof y=="string"?(C=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,isNaN(y)&&(y=O?0:V.length-1),y<0&&(y=V.length+y),y>=V.length){if(O)return-1;y=V.length-1}else if(y<0){if(!O)return-1;y=0}if(typeof I=="string"&&(I=p.from(I,C)),p.isBuffer(I))return I.length===0?-1:D(V,I,y,C,O);if(typeof I=="number")return I&=255,p.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?O?Uint8Array.prototype.indexOf.call(V,I,y):Uint8Array.prototype.lastIndexOf.call(V,I,y):D(V,[I],y,C,O);throw new TypeError("val must be string, number or Buffer")}function D(V,I,y,C,O){var X,se=1,_e=V.length,te=I.length;if(C!==void 0&&((C=String(C).toLowerCase())==="ucs2"||C==="ucs-2"||C==="utf16le"||C==="utf-16le")){if(V.length<2||I.length<2)return-1;se=2,_e/=2,te/=2,y/=2}function Ee(Xe,je){return se===1?Xe[je]:Xe.readUInt16BE(je*se)}if(O){var Ae=-1;for(X=y;X<_e;X++)if(Ee(V,X)===Ee(I,Ae===-1?0:X-Ae)){if(Ae===-1&&(Ae=X),X-Ae+1===te)return Ae*se}else Ae!==-1&&(X-=X-Ae),Ae=-1}else for(y+te>_e&&(y=_e-te),X=y;X>=0;X--){for(var ye=!0,We=0;We<te;We++)if(Ee(V,X+We)!==Ee(I,We)){ye=!1;break}if(ye)return X}return-1}function B(V,I,y,C){y=Number(y)||0;var O=V.length-y;C?(C=Number(C))>O&&(C=O):C=O;var X=I.length;if(X%2!=0)throw new TypeError("Invalid hex string");C>X/2&&(C=X/2);for(var se=0;se<C;++se){var _e=parseInt(I.substr(2*se,2),16);if(isNaN(_e))return se;V[y+se]=_e}return se}function M(V,I,y,C){return Ce(Se(I,V.length-y),V,y,C)}function ie(V,I,y,C){return Ce(function(X){for(var se=[],_e=0;_e<X.length;++_e)se.push(255&X.charCodeAt(_e));return se}(I),V,y,C)}function he(V,I,y,C){return ie(V,I,y,C)}function L(V,I,y,C){return Ce(Re(I),V,y,C)}function re(V,I,y,C){return Ce(function(X,se){for(var _e,te,Ee,Ae=[],ye=0;ye<X.length&&!((se-=2)<0);++ye)te=(_e=X.charCodeAt(ye))>>8,Ee=_e%256,Ae.push(Ee),Ae.push(te);return Ae}(I,V.length-y),V,y,C)}function be(V,I,y){return I===0&&y===V.length?c.fromByteArray(V):c.fromByteArray(V.slice(I,y))}function ue(V,I,y){y=Math.min(V.length,y);for(var C=[],O=I;O<y;){var X,se,_e,te,Ee=V[O],Ae=null,ye=Ee>239?4:Ee>223?3:Ee>191?2:1;if(O+ye<=y)switch(ye){case 1:Ee<128&&(Ae=Ee);break;case 2:(192&(X=V[O+1]))==128&&(te=(31&Ee)<<6|63&X)>127&&(Ae=te);break;case 3:X=V[O+1],se=V[O+2],(192&X)==128&&(192&se)==128&&(te=(15&Ee)<<12|(63&X)<<6|63&se)>2047&&(te<55296||te>57343)&&(Ae=te);break;case 4:X=V[O+1],se=V[O+2],_e=V[O+3],(192&X)==128&&(192&se)==128&&(192&_e)==128&&(te=(15&Ee)<<18|(63&X)<<12|(63&se)<<6|63&_e)>65535&&te<1114112&&(Ae=te)}Ae===null?(Ae=65533,ye=1):Ae>65535&&(Ae-=65536,C.push(Ae>>>10&1023|55296),Ae=56320|1023&Ae),C.push(Ae),O+=ye}return function(Xe){var je=Xe.length;if(je<=ke)return String.fromCharCode.apply(String,Xe);for(var Je="",N=0;N<je;)Je+=String.fromCharCode.apply(String,Xe.slice(N,N+=ke));return Je}(C)}r.Buffer=p,r.SlowBuffer=function(I){return+I!=I&&(I=0),p.alloc(+I)},r.INSPECT_MAX_BYTES=50,p.TYPED_ARRAY_SUPPORT=u.TYPED_ARRAY_SUPPORT!==void 0?u.TYPED_ARRAY_SUPPORT:function(){try{var I=new Uint8Array(1);return I.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},I.foo()===42&&typeof I.subarray=="function"&&I.subarray(1,1).byteLength===0}catch{return!1}}(),r.kMaxLength=h(),p.poolSize=8192,p._augment=function(V){return V.__proto__=p.prototype,V},p.from=function(V,I,y){return x(null,V,I,y)},p.TYPED_ARRAY_SUPPORT&&(p.prototype.__proto__=Uint8Array.prototype,p.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&p[Symbol.species]===p&&Object.defineProperty(p,Symbol.species,{value:null,configurable:!0})),p.alloc=function(V,I,y){return function(O,X,se,_e){return T(X),X<=0?d(O,X):se!==void 0?typeof _e=="string"?d(O,X).fill(se,_e):d(O,X).fill(se):d(O,X)}(null,V,I,y)},p.allocUnsafe=function(V){return S(null,V)},p.allocUnsafeSlow=function(V){return S(null,V)},p.isBuffer=function(I){return!(I==null||!I._isBuffer)},p.compare=function(I,y){if(!p.isBuffer(I)||!p.isBuffer(y))throw new TypeError("Arguments must be Buffers");if(I===y)return 0;for(var C=I.length,O=y.length,X=0,se=Math.min(C,O);X<se;++X)if(I[X]!==y[X]){C=I[X],O=y[X];break}return C<O?-1:O<C?1:0},p.isEncoding=function(I){switch(String(I).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},p.concat=function(I,y){if(!g(I))throw new TypeError('"list" argument must be an Array of Buffers');if(I.length===0)return p.alloc(0);var C;if(y===void 0)for(y=0,C=0;C<I.length;++C)y+=I[C].length;var O=p.allocUnsafe(y),X=0;for(C=0;C<I.length;++C){var se=I[C];if(!p.isBuffer(se))throw new TypeError('"list" argument must be an Array of Buffers');se.copy(O,X),X+=se.length}return O},p.byteLength=b,p.prototype._isBuffer=!0,p.prototype.swap16=function(){var I=this.length;if(I%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var y=0;y<I;y+=2)A(this,y,y+1);return this},p.prototype.swap32=function(){var I=this.length;if(I%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var y=0;y<I;y+=4)A(this,y,y+3),A(this,y+1,y+2);return this},p.prototype.swap64=function(){var I=this.length;if(I%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var y=0;y<I;y+=8)A(this,y,y+7),A(this,y+1,y+6),A(this,y+2,y+5),A(this,y+3,y+4);return this},p.prototype.toString=function(){var I=0|this.length;return I===0?"":arguments.length===0?ue(this,0,I):E.apply(this,arguments)},p.prototype.equals=function(I){if(!p.isBuffer(I))throw new TypeError("Argument must be a Buffer");return this===I||p.compare(this,I)===0},p.prototype.inspect=function(){var I="",y=r.INSPECT_MAX_BYTES;return this.length>0&&(I=this.toString("hex",0,y).match(/.{2}/g).join(" "),this.length>y&&(I+=" ... ")),"<Buffer "+I+">"},p.prototype.compare=function(I,y,C,O,X){if(!p.isBuffer(I))throw new TypeError("Argument must be a Buffer");if(y===void 0&&(y=0),C===void 0&&(C=I?I.length:0),O===void 0&&(O=0),X===void 0&&(X=this.length),y<0||C>I.length||O<0||X>this.length)throw new RangeError("out of range index");if(O>=X&&y>=C)return 0;if(O>=X)return-1;if(y>=C)return 1;if(this===I)return 0;for(var se=(X>>>=0)-(O>>>=0),_e=(C>>>=0)-(y>>>=0),te=Math.min(se,_e),Ee=this.slice(O,X),Ae=I.slice(y,C),ye=0;ye<te;++ye)if(Ee[ye]!==Ae[ye]){se=Ee[ye],_e=Ae[ye];break}return se<_e?-1:_e<se?1:0},p.prototype.includes=function(I,y,C){return this.indexOf(I,y,C)!==-1},p.prototype.indexOf=function(I,y,C){return k(this,I,y,C,!0)},p.prototype.lastIndexOf=function(I,y,C){return k(this,I,y,C,!1)},p.prototype.write=function(I,y,C,O){if(y===void 0)O="utf8",C=this.length,y=0;else if(C===void 0&&typeof y=="string")O=y,C=this.length,y=0;else{if(!isFinite(y))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");y|=0,isFinite(C)?(C|=0,O===void 0&&(O="utf8")):(O=C,C=void 0)}var X=this.length-y;if((C===void 0||C>X)&&(C=X),I.length>0&&(C<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");O||(O="utf8");for(var se=!1;;)switch(O){case"hex":return B(this,I,y,C);case"utf8":case"utf-8":return M(this,I,y,C);case"ascii":return ie(this,I,y,C);case"latin1":case"binary":return he(this,I,y,C);case"base64":return L(this,I,y,C);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return re(this,I,y,C);default:if(se)throw new TypeError("Unknown encoding: "+O);O=(""+O).toLowerCase(),se=!0}},p.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ke=4096;function ne(V,I,y){var C="";y=Math.min(V.length,y);for(var O=I;O<y;++O)C+=String.fromCharCode(127&V[O]);return C}function fe(V,I,y){var C="";y=Math.min(V.length,y);for(var O=I;O<y;++O)C+=String.fromCharCode(V[O]);return C}function Ne(V,I,y){var C=V.length;(!I||I<0)&&(I=0),(!y||y<0||y>C)&&(y=C);for(var O="",X=I;X<y;++X)O+=He(V[X]);return O}function pe(V,I,y){for(var C=V.slice(I,y),O="",X=0;X<C.length;X+=2)O+=String.fromCharCode(C[X]+256*C[X+1]);return O}function Te(V,I,y){if(V%1!=0||V<0)throw new RangeError("offset is not uint");if(V+I>y)throw new RangeError("Trying to access beyond buffer length")}function K(V,I,y,C,O,X){if(!p.isBuffer(V))throw new TypeError('"buffer" argument must be a Buffer instance');if(I>O||I<X)throw new RangeError('"value" argument is out of bounds');if(y+C>V.length)throw new RangeError("Index out of range")}function me(V,I,y,C){I<0&&(I=65535+I+1);for(var O=0,X=Math.min(V.length-y,2);O<X;++O)V[y+O]=(I&255<<8*(C?O:1-O))>>>8*(C?O:1-O)}function Ie(V,I,y,C){I<0&&(I=4294967295+I+1);for(var O=0,X=Math.min(V.length-y,4);O<X;++O)V[y+O]=I>>>8*(C?O:3-O)&255}function Fe(V,I,y,C,O,X){if(y+C>V.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function De(V,I,y,C,O){return O||Fe(V,0,y,4),l.write(V,I,y,C,23,4),y+4}function Oe(V,I,y,C,O){return O||Fe(V,0,y,8),l.write(V,I,y,C,52,8),y+8}p.prototype.slice=function(I,y){var C,O=this.length;if((I=~~I)<0?(I+=O)<0&&(I=0):I>O&&(I=O),(y=y===void 0?O:~~y)<0?(y+=O)<0&&(y=0):y>O&&(y=O),y<I&&(y=I),p.TYPED_ARRAY_SUPPORT)(C=this.subarray(I,y)).__proto__=p.prototype;else{var X=y-I;C=new p(X,void 0);for(var se=0;se<X;++se)C[se]=this[se+I]}return C},p.prototype.readUIntLE=function(I,y,C){I|=0,y|=0,C||Te(I,y,this.length);for(var O=this[I],X=1,se=0;++se<y&&(X*=256);)O+=this[I+se]*X;return O},p.prototype.readUIntBE=function(I,y,C){I|=0,y|=0,C||Te(I,y,this.length);for(var O=this[I+--y],X=1;y>0&&(X*=256);)O+=this[I+--y]*X;return O},p.prototype.readUInt8=function(I,y){return y||Te(I,1,this.length),this[I]},p.prototype.readUInt16LE=function(I,y){return y||Te(I,2,this.length),this[I]|this[I+1]<<8},p.prototype.readUInt16BE=function(I,y){return y||Te(I,2,this.length),this[I]<<8|this[I+1]},p.prototype.readUInt32LE=function(I,y){return y||Te(I,4,this.length),(this[I]|this[I+1]<<8|this[I+2]<<16)+16777216*this[I+3]},p.prototype.readUInt32BE=function(I,y){return y||Te(I,4,this.length),16777216*this[I]+(this[I+1]<<16|this[I+2]<<8|this[I+3])},p.prototype.readIntLE=function(I,y,C){I|=0,y|=0,C||Te(I,y,this.length);for(var O=this[I],X=1,se=0;++se<y&&(X*=256);)O+=this[I+se]*X;return O>=(X*=128)&&(O-=Math.pow(2,8*y)),O},p.prototype.readIntBE=function(I,y,C){I|=0,y|=0,C||Te(I,y,this.length);for(var O=y,X=1,se=this[I+--O];O>0&&(X*=256);)se+=this[I+--O]*X;return se>=(X*=128)&&(se-=Math.pow(2,8*y)),se},p.prototype.readInt8=function(I,y){return y||Te(I,1,this.length),128&this[I]?-1*(255-this[I]+1):this[I]},p.prototype.readInt16LE=function(I,y){y||Te(I,2,this.length);var C=this[I]|this[I+1]<<8;return 32768&C?4294901760|C:C},p.prototype.readInt16BE=function(I,y){y||Te(I,2,this.length);var C=this[I+1]|this[I]<<8;return 32768&C?4294901760|C:C},p.prototype.readInt32LE=function(I,y){return y||Te(I,4,this.length),this[I]|this[I+1]<<8|this[I+2]<<16|this[I+3]<<24},p.prototype.readInt32BE=function(I,y){return y||Te(I,4,this.length),this[I]<<24|this[I+1]<<16|this[I+2]<<8|this[I+3]},p.prototype.readFloatLE=function(I,y){return y||Te(I,4,this.length),l.read(this,I,!0,23,4)},p.prototype.readFloatBE=function(I,y){return y||Te(I,4,this.length),l.read(this,I,!1,23,4)},p.prototype.readDoubleLE=function(I,y){return y||Te(I,8,this.length),l.read(this,I,!0,52,8)},p.prototype.readDoubleBE=function(I,y){return y||Te(I,8,this.length),l.read(this,I,!1,52,8)},p.prototype.writeUIntLE=function(I,y,C,O){I=+I,y|=0,C|=0,O||K(this,I,y,C,Math.pow(2,8*C)-1,0);var X=1,se=0;for(this[y]=255&I;++se<C&&(X*=256);)this[y+se]=I/X&255;return y+C},p.prototype.writeUIntBE=function(I,y,C,O){I=+I,y|=0,C|=0,O||K(this,I,y,C,Math.pow(2,8*C)-1,0);var X=C-1,se=1;for(this[y+X]=255&I;--X>=0&&(se*=256);)this[y+X]=I/se&255;return y+C},p.prototype.writeUInt8=function(I,y,C){return I=+I,y|=0,C||K(this,I,y,1,255,0),p.TYPED_ARRAY_SUPPORT||(I=Math.floor(I)),this[y]=255&I,y+1},p.prototype.writeUInt16LE=function(I,y,C){return I=+I,y|=0,C||K(this,I,y,2,65535,0),p.TYPED_ARRAY_SUPPORT?(this[y]=255&I,this[y+1]=I>>>8):me(this,I,y,!0),y+2},p.prototype.writeUInt16BE=function(I,y,C){return I=+I,y|=0,C||K(this,I,y,2,65535,0),p.TYPED_ARRAY_SUPPORT?(this[y]=I>>>8,this[y+1]=255&I):me(this,I,y,!1),y+2},p.prototype.writeUInt32LE=function(I,y,C){return I=+I,y|=0,C||K(this,I,y,4,4294967295,0),p.TYPED_ARRAY_SUPPORT?(this[y+3]=I>>>24,this[y+2]=I>>>16,this[y+1]=I>>>8,this[y]=255&I):Ie(this,I,y,!0),y+4},p.prototype.writeUInt32BE=function(I,y,C){return I=+I,y|=0,C||K(this,I,y,4,4294967295,0),p.TYPED_ARRAY_SUPPORT?(this[y]=I>>>24,this[y+1]=I>>>16,this[y+2]=I>>>8,this[y+3]=255&I):Ie(this,I,y,!1),y+4},p.prototype.writeIntLE=function(I,y,C,O){if(I=+I,y|=0,!O){var X=Math.pow(2,8*C-1);K(this,I,y,C,X-1,-X)}var se=0,_e=1,te=0;for(this[y]=255&I;++se<C&&(_e*=256);)I<0&&te===0&&this[y+se-1]!==0&&(te=1),this[y+se]=(I/_e>>0)-te&255;return y+C},p.prototype.writeIntBE=function(I,y,C,O){if(I=+I,y|=0,!O){var X=Math.pow(2,8*C-1);K(this,I,y,C,X-1,-X)}var se=C-1,_e=1,te=0;for(this[y+se]=255&I;--se>=0&&(_e*=256);)I<0&&te===0&&this[y+se+1]!==0&&(te=1),this[y+se]=(I/_e>>0)-te&255;return y+C},p.prototype.writeInt8=function(I,y,C){return I=+I,y|=0,C||K(this,I,y,1,127,-128),p.TYPED_ARRAY_SUPPORT||(I=Math.floor(I)),I<0&&(I=255+I+1),this[y]=255&I,y+1},p.prototype.writeInt16LE=function(I,y,C){return I=+I,y|=0,C||K(this,I,y,2,32767,-32768),p.TYPED_ARRAY_SUPPORT?(this[y]=255&I,this[y+1]=I>>>8):me(this,I,y,!0),y+2},p.prototype.writeInt16BE=function(I,y,C){return I=+I,y|=0,C||K(this,I,y,2,32767,-32768),p.TYPED_ARRAY_SUPPORT?(this[y]=I>>>8,this[y+1]=255&I):me(this,I,y,!1),y+2},p.prototype.writeInt32LE=function(I,y,C){return I=+I,y|=0,C||K(this,I,y,4,2147483647,-2147483648),p.TYPED_ARRAY_SUPPORT?(this[y]=255&I,this[y+1]=I>>>8,this[y+2]=I>>>16,this[y+3]=I>>>24):Ie(this,I,y,!0),y+4},p.prototype.writeInt32BE=function(I,y,C){return I=+I,y|=0,C||K(this,I,y,4,2147483647,-2147483648),I<0&&(I=4294967295+I+1),p.TYPED_ARRAY_SUPPORT?(this[y]=I>>>24,this[y+1]=I>>>16,this[y+2]=I>>>8,this[y+3]=255&I):Ie(this,I,y,!1),y+4},p.prototype.writeFloatLE=function(I,y,C){return De(this,I,y,!0,C)},p.prototype.writeFloatBE=function(I,y,C){return De(this,I,y,!1,C)},p.prototype.writeDoubleLE=function(I,y,C){return Oe(this,I,y,!0,C)},p.prototype.writeDoubleBE=function(I,y,C){return Oe(this,I,y,!1,C)},p.prototype.copy=function(I,y,C,O){if(C||(C=0),O||O===0||(O=this.length),y>=I.length&&(y=I.length),y||(y=0),O>0&&O<C&&(O=C),O===C||I.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(C<0||C>=this.length)throw new RangeError("sourceStart out of bounds");if(O<0)throw new RangeError("sourceEnd out of bounds");O>this.length&&(O=this.length),I.length-y<O-C&&(O=I.length-y+C);var X,se=O-C;if(this===I&&C<y&&y<O)for(X=se-1;X>=0;--X)I[X+y]=this[X+C];else if(se<1e3||!p.TYPED_ARRAY_SUPPORT)for(X=0;X<se;++X)I[X+y]=this[X+C];else Uint8Array.prototype.set.call(I,this.subarray(C,C+se),y);return se},p.prototype.fill=function(I,y,C,O){if(typeof I=="string"){if(typeof y=="string"?(O=y,y=0,C=this.length):typeof C=="string"&&(O=C,C=this.length),I.length===1){var X=I.charCodeAt(0);X<256&&(I=X)}if(O!==void 0&&typeof O!="string")throw new TypeError("encoding must be a string");if(typeof O=="string"&&!p.isEncoding(O))throw new TypeError("Unknown encoding: "+O)}else typeof I=="number"&&(I&=255);if(y<0||this.length<y||this.length<C)throw new RangeError("Out of range index");if(C<=y)return this;var se;if(y>>>=0,C=C===void 0?this.length:C>>>0,I||(I=0),typeof I=="number")for(se=y;se<C;++se)this[se]=I;else{var _e=p.isBuffer(I)?I:Se(new p(I,O).toString()),te=_e.length;for(se=0;se<C-y;++se)this[se+y]=_e[se%te]}return this};var $e=/[^+\/0-9A-Za-z-_]/g;function He(V){return V<16?"0"+V.toString(16):V.toString(16)}function Se(V,I){var y;I=I||1/0;for(var C=V.length,O=null,X=[],se=0;se<C;++se){if((y=V.charCodeAt(se))>55295&&y<57344){if(!O){if(y>56319){(I-=3)>-1&&X.push(239,191,189);continue}if(se+1===C){(I-=3)>-1&&X.push(239,191,189);continue}O=y;continue}if(y<56320){(I-=3)>-1&&X.push(239,191,189),O=y;continue}y=65536+(O-55296<<10|y-56320)}else O&&(I-=3)>-1&&X.push(239,191,189);if(O=null,y<128){if((I-=1)<0)break;X.push(y)}else if(y<2048){if((I-=2)<0)break;X.push(y>>6|192,63&y|128)}else if(y<65536){if((I-=3)<0)break;X.push(y>>12|224,y>>6&63|128,63&y|128)}else{if(!(y<1114112))throw new Error("Invalid code point");if((I-=4)<0)break;X.push(y>>18|240,y>>12&63|128,y>>6&63|128,63&y|128)}}return X}function Re(V){return c.toByteArray(function(y){if((y=function(O){return O.trim?O.trim():O.replace(/^\s+|\s+$/g,"")}(y).replace($e,"")).length<2)return"";for(;y.length%4!=0;)y+="=";return y}(V))}function Ce(V,I,y,C){for(var O=0;O<C&&!(O+y>=I.length||O>=V.length);++O)I[O+y]=V[O];return O}}).call(this,o(29))},function(t,r){var o;o=function(){return this}();try{o=o||new Function("return this")()}catch{typeof window=="object"&&(o=window)}t.exports=o},function(t,r,o){r.byteLength=function(S){var v=p(S),R=v[0],b=v[1];return 3*(R+b)/4-b},r.toByteArray=function(S){var v,R,b=p(S),E=b[0],A=b[1],k=new l(function(ie,he,L){return 3*(he+L)/4-L}(0,E,A)),D=0,B=A>0?E-4:E;for(R=0;R<B;R+=4)v=c[S.charCodeAt(R)]<<18|c[S.charCodeAt(R+1)]<<12|c[S.charCodeAt(R+2)]<<6|c[S.charCodeAt(R+3)],k[D++]=v>>16&255,k[D++]=v>>8&255,k[D++]=255&v;return A===2&&(v=c[S.charCodeAt(R)]<<2|c[S.charCodeAt(R+1)]>>4,k[D++]=255&v),A===1&&(v=c[S.charCodeAt(R)]<<10|c[S.charCodeAt(R+1)]<<4|c[S.charCodeAt(R+2)]>>2,k[D++]=v>>8&255,k[D++]=255&v),k},r.fromByteArray=function(S){for(var v,R=S.length,b=R%3,E=[],A=16383,k=0,D=R-b;k<D;k+=A)E.push(x(S,k,k+A>D?D:k+A));return b===1?(v=S[R-1],E.push(u[v>>2]+u[v<<4&63]+"==")):b===2&&(v=(S[R-2]<<8)+S[R-1],E.push(u[v>>10]+u[v>>4&63]+u[v<<2&63]+"=")),E.join("")};for(var u=[],c=[],l=typeof Uint8Array<"u"?Uint8Array:Array,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,d=g.length;h<d;++h)u[h]=g[h],c[g.charCodeAt(h)]=h;function p(T){var S=T.length;if(S%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var v=T.indexOf("=");return v===-1&&(v=S),[v,v===S?0:4-v%4]}function x(T,S,v){for(var R,b,E=[],A=S;A<v;A+=3)R=(T[A]<<16&16711680)+(T[A+1]<<8&65280)+(255&T[A+2]),E.push(u[(b=R)>>18&63]+u[b>>12&63]+u[b>>6&63]+u[63&b]);return E.join("")}c[45]=62,c[95]=63},function(t,r){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */r.read=function(o,u,c,l,g){var h,d,p=8*g-l-1,x=(1<<p)-1,T=x>>1,S=-7,v=c?g-1:0,R=c?-1:1,b=o[u+v];for(v+=R,h=b&(1<<-S)-1,b>>=-S,S+=p;S>0;h=256*h+o[u+v],v+=R,S-=8);for(d=h&(1<<-S)-1,h>>=-S,S+=l;S>0;d=256*d+o[u+v],v+=R,S-=8);if(h===0)h=1-T;else{if(h===x)return d?NaN:1/0*(b?-1:1);d+=Math.pow(2,l),h-=T}return(b?-1:1)*d*Math.pow(2,h-l)},r.write=function(o,u,c,l,g,h){var d,p,x,T=8*h-g-1,S=(1<<T)-1,v=S>>1,R=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=l?0:h-1,E=l?1:-1,A=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(p=isNaN(u)?1:0,d=S):(d=Math.floor(Math.log(u)/Math.LN2),u*(x=Math.pow(2,-d))<1&&(d--,x*=2),(u+=d+v>=1?R/x:R*Math.pow(2,1-v))*x>=2&&(d++,x/=2),d+v>=S?(p=0,d=S):d+v>=1?(p=(u*x-1)*Math.pow(2,g),d+=v):(p=u*Math.pow(2,v-1)*Math.pow(2,g),d=0));g>=8;o[c+b]=255&p,b+=E,p/=256,g-=8);for(d=d<<g|p,T+=g;T>0;o[c+b]=255&d,b+=E,d/=256,T-=8);o[c+b-E]|=128*A}},function(t,r){var o={}.toString;t.exports=Array.isArray||function(u){return o.call(u)=="[object Array]"}},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(l){var g=l.jws,h=l.KeyUtil,d=l.X509,p=l.crypto,x=l.hextob64u,T=l.b64tohex,S=l.AllowedSigningAlgs;return function(){function v(){(function(b,E){if(!(b instanceof E))throw new TypeError("Cannot call a class as a function")})(this,v)}return v.parseJwt=function(b){u.Log.debug("JoseUtil.parseJwt");try{var E=g.JWS.parse(b);return{header:E.headerObj,payload:E.payloadObj}}catch(A){u.Log.error(A)}},v.validateJwt=function(b,E,A,k,D,B,M){u.Log.debug("JoseUtil.validateJwt");try{if(E.kty==="RSA")if(E.e&&E.n)E=h.getKey(E);else{if(!E.x5c||!E.x5c.length)return u.Log.error("JoseUtil.validateJwt: RSA key missing key material",E),Promise.reject(new Error("RSA key missing key material"));var ie=T(E.x5c[0]);E=d.getPublicKeyFromCertHex(ie)}else{if(E.kty!=="EC")return u.Log.error("JoseUtil.validateJwt: Unsupported key type",E&&E.kty),Promise.reject(new Error(E.kty));if(!(E.crv&&E.x&&E.y))return u.Log.error("JoseUtil.validateJwt: EC key missing key material",E),Promise.reject(new Error("EC key missing key material"));E=h.getKey(E)}return v._validateJwt(b,E,A,k,D,B,M)}catch(he){return u.Log.error(he&&he.message||he),Promise.reject("JWT validation failed")}},v.validateJwtAttributes=function(b,E,A,k,D,B){k||(k=0),D||(D=parseInt(Date.now()/1e3));var M=v.parseJwt(b).payload;if(!M.iss)return u.Log.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(M.iss!==E)return u.Log.error("JoseUtil._validateJwt: Invalid issuer in token",M.iss),Promise.reject(new Error("Invalid issuer in token: "+M.iss));if(!M.aud)return u.Log.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(M.aud===A||Array.isArray(M.aud)&&M.aud.indexOf(A)>=0))return u.Log.error("JoseUtil._validateJwt: Invalid audience in token",M.aud),Promise.reject(new Error("Invalid audience in token: "+M.aud));if(M.azp&&M.azp!==A)return u.Log.error("JoseUtil._validateJwt: Invalid azp in token",M.azp),Promise.reject(new Error("Invalid azp in token: "+M.azp));if(!B){var ie=D+k,he=D-k;if(!M.iat)return u.Log.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if(ie<M.iat)return u.Log.error("JoseUtil._validateJwt: iat is in the future",M.iat),Promise.reject(new Error("iat is in the future: "+M.iat));if(M.nbf&&ie<M.nbf)return u.Log.error("JoseUtil._validateJwt: nbf is in the future",M.nbf),Promise.reject(new Error("nbf is in the future: "+M.nbf));if(!M.exp)return u.Log.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(M.exp<he)return u.Log.error("JoseUtil._validateJwt: exp is in the past",M.exp),Promise.reject(new Error("exp is in the past:"+M.exp))}return Promise.resolve(M)},v._validateJwt=function(b,E,A,k,D,B,M){return v.validateJwtAttributes(b,A,k,D,B,M).then(function(ie){try{return g.JWS.verify(b,E,S)?ie:(u.Log.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(he){return u.Log.error(he&&he.message||he),Promise.reject(new Error("signature validation failed"))}})},v.hashString=function(b,E){try{return p.Util.hashString(b,E)}catch(A){u.Log.error(A)}},v.hexToBase64Url=function(b){try{return x(b)}catch(E){u.Log.error(E)}},v}()};var u=o(0);t.exports=r.default},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.SigninResponse=void 0;var u=function(){function g(h,d){for(var p=0;p<d.length;p++){var x=d[p];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(h,x.key,x)}}return function(h,d,p){return d&&g(h.prototype,d),p&&g(h,p),h}}(),c=o(3);function l(g,h){if(!(g instanceof h))throw new TypeError("Cannot call a class as a function")}r.SigninResponse=function(){function g(h){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#";l(this,g);var p=c.UrlUtility.parseUrlFragment(h,d);this.error=p.error,this.error_description=p.error_description,this.error_uri=p.error_uri,this.code=p.code,this.state=p.state,this.id_token=p.id_token,this.session_state=p.session_state,this.access_token=p.access_token,this.token_type=p.token_type,this.scope=p.scope,this.profile=void 0,this.expires_in=p.expires_in}return u(g,[{key:"expires_in",get:function(){if(this.expires_at){var d=parseInt(Date.now()/1e3);return this.expires_at-d}},set:function(d){var p=parseInt(d);if(typeof p=="number"&&p>0){var x=parseInt(Date.now()/1e3);this.expires_at=x+p}}},{key:"expired",get:function(){var d=this.expires_in;if(d!==void 0)return d<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),g}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.SignoutRequest=void 0;var u=o(0),c=o(3),l=o(9);r.SignoutRequest=function g(h){var d=h.url,p=h.id_token_hint,x=h.post_logout_redirect_uri,T=h.data,S=h.extraQueryParams,v=h.request_type;if(function(E,A){if(!(E instanceof A))throw new TypeError("Cannot call a class as a function")}(this,g),!d)throw u.Log.error("SignoutRequest.ctor: No url passed"),new Error("url");for(var R in p&&(d=c.UrlUtility.addQueryParam(d,"id_token_hint",p)),x&&(d=c.UrlUtility.addQueryParam(d,"post_logout_redirect_uri",x),T&&(this.state=new l.State({data:T,request_type:v}),d=c.UrlUtility.addQueryParam(d,"state",this.state.id))),S)d=c.UrlUtility.addQueryParam(d,R,S[R]);this.url=d}},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.SignoutResponse=void 0;var u=o(3);r.SignoutResponse=function c(l){(function(d,p){if(!(d instanceof p))throw new TypeError("Cannot call a class as a function")})(this,c);var g=u.UrlUtility.parseUrlFragment(l,"?");this.error=g.error,this.error_description=g.error_description,this.error_uri=g.error_uri,this.state=g.state}},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.InMemoryWebStorage=void 0;var u=function(){function l(g,h){for(var d=0;d<h.length;d++){var p=h[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(g,p.key,p)}}return function(g,h,d){return h&&l(g.prototype,h),d&&l(g,d),g}}(),c=o(0);r.InMemoryWebStorage=function(){function l(){(function(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")})(this,l),this._data={}}return l.prototype.getItem=function(h){return c.Log.debug("InMemoryWebStorage.getItem",h),this._data[h]},l.prototype.setItem=function(h,d){c.Log.debug("InMemoryWebStorage.setItem",h),this._data[h]=d},l.prototype.removeItem=function(h){c.Log.debug("InMemoryWebStorage.removeItem",h),delete this._data[h]},l.prototype.key=function(h){return Object.getOwnPropertyNames(this._data)[h]},u(l,[{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}}]),l}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.UserManager=void 0;var u=function(){function A(k,D){for(var B=0;B<D.length;B++){var M=D[B];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(k,M.key,M)}}return function(k,D,B){return D&&A(k.prototype,D),B&&A(k,B),k}}(),c=o(0),l=o(10),g=o(39),h=o(15),d=o(45),p=o(47),x=o(18),T=o(8),S=o(20),v=o(11),R=o(4);function b(A,k){if(!(A instanceof k))throw new TypeError("Cannot call a class as a function")}function E(A,k){if(!A)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!k||typeof k!="object"&&typeof k!="function"?A:k}r.UserManager=function(A){function k(){var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p.SilentRenewService,M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:x.SessionMonitor,ie=arguments.length>3&&arguments[3]!==void 0?arguments[3]:S.TokenRevocationClient,he=arguments.length>4&&arguments[4]!==void 0?arguments[4]:v.TokenClient,L=arguments.length>5&&arguments[5]!==void 0?arguments[5]:R.JoseUtil;b(this,k),D instanceof g.UserManagerSettings||(D=new g.UserManagerSettings(D));var re=E(this,A.call(this,D));return re._events=new d.UserManagerEvents(D),re._silentRenewService=new B(re),re.settings.automaticSilentRenew&&(c.Log.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),re.startSilentRenew()),re.settings.monitorSession&&(c.Log.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),re._sessionMonitor=new M(re)),re._tokenRevocationClient=new ie(re._settings),re._tokenClient=new he(re._settings),re._joseUtil=L,re}return function(B,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof M);B.prototype=Object.create(M&&M.prototype,{constructor:{value:B,enumerable:!1,writable:!0,configurable:!0}}),M&&(Object.setPrototypeOf?Object.setPrototypeOf(B,M):B.__proto__=M)}(k,A),k.prototype.getUser=function(){var B=this;return this._loadUser().then(function(M){return M?(c.Log.info("UserManager.getUser: user loaded"),B._events.load(M,!1),M):(c.Log.info("UserManager.getUser: user not found in storage"),null)})},k.prototype.removeUser=function(){var B=this;return this.storeUser(null).then(function(){c.Log.info("UserManager.removeUser: user removed from storage"),B._events.unload()})},k.prototype.signinRedirect=function(){var B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(B=Object.assign({},B)).request_type="si:r";var M={useReplaceToNavigate:B.useReplaceToNavigate};return this._signinStart(B,this._redirectNavigator,M).then(function(){c.Log.info("UserManager.signinRedirect: successful")})},k.prototype.signinRedirectCallback=function(B){return this._signinEnd(B||this._redirectNavigator.url).then(function(M){return M.profile&&M.profile.sub?c.Log.info("UserManager.signinRedirectCallback: successful, signed in sub: ",M.profile.sub):c.Log.info("UserManager.signinRedirectCallback: no sub"),M})},k.prototype.signinPopup=function(){var B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(B=Object.assign({},B)).request_type="si:p";var M=B.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return M?(B.redirect_uri=M,B.display="popup",this._signin(B,this._popupNavigator,{startUrl:M,popupWindowFeatures:B.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:B.popupWindowTarget||this.settings.popupWindowTarget}).then(function(ie){return ie&&(ie.profile&&ie.profile.sub?c.Log.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",ie.profile.sub):c.Log.info("UserManager.signinPopup: no sub")),ie})):(c.Log.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))},k.prototype.signinPopupCallback=function(B){return this._signinCallback(B,this._popupNavigator).then(function(M){return M&&(M.profile&&M.profile.sub?c.Log.info("UserManager.signinPopupCallback: successful, signed in sub: ",M.profile.sub):c.Log.info("UserManager.signinPopupCallback: no sub")),M}).catch(function(M){c.Log.error(M.message)})},k.prototype.signinSilent=function(){var B=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return M=Object.assign({},M),this._loadUser().then(function(ie){return ie&&ie.refresh_token?(M.refresh_token=ie.refresh_token,B._useRefreshToken(M)):(M.request_type="si:s",M.id_token_hint=M.id_token_hint||B.settings.includeIdTokenInSilentRenew&&ie&&ie.id_token,ie&&B._settings.validateSubOnSilentRenew&&(c.Log.debug("UserManager.signinSilent, subject prior to silent renew: ",ie.profile.sub),M.current_sub=ie.profile.sub),B._signinSilentIframe(M))})},k.prototype._useRefreshToken=function(){var B=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._tokenClient.exchangeRefreshToken(M).then(function(ie){return ie?ie.access_token?B._loadUser().then(function(he){if(he){var L=Promise.resolve();return ie.id_token&&(L=B._validateIdTokenFromTokenRefreshToken(he.profile,ie.id_token)),L.then(function(){return c.Log.debug("UserManager._useRefreshToken: refresh token response success"),he.id_token=ie.id_token||he.id_token,he.access_token=ie.access_token,he.refresh_token=ie.refresh_token||he.refresh_token,he.expires_in=ie.expires_in,B.storeUser(he).then(function(){return B._events.load(he),he})})}return null}):(c.Log.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(c.Log.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))})},k.prototype._validateIdTokenFromTokenRefreshToken=function(B,M){var ie=this;return this._metadataService.getIssuer().then(function(he){return ie.settings.getEpochTime().then(function(L){return ie._joseUtil.validateJwtAttributes(M,he,ie._settings.client_id,ie._settings.clockSkew,L).then(function(re){return re?re.sub!==B.sub?(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):re.auth_time&&re.auth_time!==B.auth_time?(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):re.azp&&re.azp!==B.azp?(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!re.azp&&B.azp?(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))})})})},k.prototype._signinSilentIframe=function(){var B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=B.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return M?(B.redirect_uri=M,B.prompt=B.prompt||"none",this._signin(B,this._iframeNavigator,{startUrl:M,silentRequestTimeout:B.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(ie){return ie&&(ie.profile&&ie.profile.sub?c.Log.info("UserManager.signinSilent: successful, signed in sub: ",ie.profile.sub):c.Log.info("UserManager.signinSilent: no sub")),ie})):(c.Log.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},k.prototype.signinSilentCallback=function(B){return this._signinCallback(B,this._iframeNavigator).then(function(M){return M&&(M.profile&&M.profile.sub?c.Log.info("UserManager.signinSilentCallback: successful, signed in sub: ",M.profile.sub):c.Log.info("UserManager.signinSilentCallback: no sub")),M})},k.prototype.signinCallback=function(B){var M=this;return this.readSigninResponseState(B).then(function(ie){var he=ie.state;return ie.response,he.request_type==="si:r"?M.signinRedirectCallback(B):he.request_type==="si:p"?M.signinPopupCallback(B):he.request_type==="si:s"?M.signinSilentCallback(B):Promise.reject(new Error("invalid response_type in state"))})},k.prototype.signoutCallback=function(B,M){var ie=this;return this.readSignoutResponseState(B).then(function(he){var L=he.state,re=he.response;return L?L.request_type==="so:r"?ie.signoutRedirectCallback(B):L.request_type==="so:p"?ie.signoutPopupCallback(B,M):Promise.reject(new Error("invalid response_type in state")):re})},k.prototype.querySessionStatus=function(){var B=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(M=Object.assign({},M)).request_type="si:s";var ie=M.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return ie?(M.redirect_uri=ie,M.prompt="none",M.response_type=M.response_type||this.settings.query_status_response_type,M.scope=M.scope||"openid",M.skipUserInfo=!0,this._signinStart(M,this._iframeNavigator,{startUrl:ie,silentRequestTimeout:M.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(he){return B.processSigninResponse(he.url).then(function(L){if(c.Log.debug("UserManager.querySessionStatus: got signin response"),L.session_state&&L.profile.sub)return c.Log.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",L.profile.sub),{session_state:L.session_state,sub:L.profile.sub,sid:L.profile.sid};c.Log.info("querySessionStatus successful, user not authenticated")}).catch(function(L){if(L.session_state&&B.settings.monitorAnonymousSession&&(L.message=="login_required"||L.message=="consent_required"||L.message=="interaction_required"||L.message=="account_selection_required"))return c.Log.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:L.session_state};throw L})})):(c.Log.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},k.prototype._signin=function(B,M){var ie=this,he=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signinStart(B,M,he).then(function(L){return ie._signinEnd(L.url,B)})},k.prototype._signinStart=function(B,M){var ie=this,he=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return M.prepare(he).then(function(L){return c.Log.debug("UserManager._signinStart: got navigator window handle"),ie.createSigninRequest(B).then(function(re){return c.Log.debug("UserManager._signinStart: got signin request"),he.url=re.url,he.id=re.state.id,L.navigate(he)}).catch(function(re){throw L.close&&(c.Log.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),L.close()),re})})},k.prototype._signinEnd=function(B){var M=this,ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.processSigninResponse(B).then(function(he){c.Log.debug("UserManager._signinEnd: got signin response");var L=new h.User(he);if(ie.current_sub){if(ie.current_sub!==L.profile.sub)return c.Log.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",L.profile.sub),Promise.reject(new Error("login_required"));c.Log.debug("UserManager._signinEnd: current user matches user returned from signin")}return M.storeUser(L).then(function(){return c.Log.debug("UserManager._signinEnd: user stored"),M._events.load(L),L})})},k.prototype._signinCallback=function(B,M){c.Log.debug("UserManager._signinCallback");var ie=this._settings.response_mode==="query"||!this._settings.response_mode&&T.SigninRequest.isCode(this._settings.response_type)?"?":"#";return M.callback(B,void 0,ie)},k.prototype.signoutRedirect=function(){var B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(B=Object.assign({},B)).request_type="so:r";var M=B.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;M&&(B.post_logout_redirect_uri=M);var ie={useReplaceToNavigate:B.useReplaceToNavigate};return this._signoutStart(B,this._redirectNavigator,ie).then(function(){c.Log.info("UserManager.signoutRedirect: successful")})},k.prototype.signoutRedirectCallback=function(B){return this._signoutEnd(B||this._redirectNavigator.url).then(function(M){return c.Log.info("UserManager.signoutRedirectCallback: successful"),M})},k.prototype.signoutPopup=function(){var B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(B=Object.assign({},B)).request_type="so:p";var M=B.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return B.post_logout_redirect_uri=M,B.display="popup",B.post_logout_redirect_uri&&(B.state=B.state||{}),this._signout(B,this._popupNavigator,{startUrl:M,popupWindowFeatures:B.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:B.popupWindowTarget||this.settings.popupWindowTarget}).then(function(){c.Log.info("UserManager.signoutPopup: successful")})},k.prototype.signoutPopupCallback=function(B,M){return M===void 0&&typeof B=="boolean"&&(M=B,B=null),this._popupNavigator.callback(B,M,"?").then(function(){c.Log.info("UserManager.signoutPopupCallback: successful")})},k.prototype._signout=function(B,M){var ie=this,he=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signoutStart(B,M,he).then(function(L){return ie._signoutEnd(L.url)})},k.prototype._signoutStart=function(){var B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=this,ie=arguments[1],he=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return ie.prepare(he).then(function(L){return c.Log.debug("UserManager._signoutStart: got navigator window handle"),M._loadUser().then(function(re){return c.Log.debug("UserManager._signoutStart: loaded current user from storage"),(M._settings.revokeAccessTokenOnSignout?M._revokeInternal(re):Promise.resolve()).then(function(){var be=B.id_token_hint||re&&re.id_token;return be&&(c.Log.debug("UserManager._signoutStart: Setting id_token into signout request"),B.id_token_hint=be),M.removeUser().then(function(){return c.Log.debug("UserManager._signoutStart: user removed, creating signout request"),M.createSignoutRequest(B).then(function(ue){return c.Log.debug("UserManager._signoutStart: got signout request"),he.url=ue.url,ue.state&&(he.id=ue.state.id),L.navigate(he)})})})}).catch(function(re){throw L.close&&(c.Log.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),L.close()),re})})},k.prototype._signoutEnd=function(B){return this.processSignoutResponse(B).then(function(M){return c.Log.debug("UserManager._signoutEnd: got signout response"),M})},k.prototype.revokeAccessToken=function(){var B=this;return this._loadUser().then(function(M){return B._revokeInternal(M,!0).then(function(ie){if(ie)return c.Log.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),M.access_token=null,M.refresh_token=null,M.expires_at=null,M.token_type=null,B.storeUser(M).then(function(){c.Log.debug("UserManager.revokeAccessToken: user stored"),B._events.load(M)})})}).then(function(){c.Log.info("UserManager.revokeAccessToken: access token revoked successfully")})},k.prototype._revokeInternal=function(B,M){var ie=this;if(B){var he=B.access_token,L=B.refresh_token;return this._revokeAccessTokenInternal(he,M).then(function(re){return ie._revokeRefreshTokenInternal(L,M).then(function(be){return re||be||c.Log.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),re||be})})}return Promise.resolve(!1)},k.prototype._revokeAccessTokenInternal=function(B,M){return!B||B.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke(B,M).then(function(){return!0})},k.prototype._revokeRefreshTokenInternal=function(B,M){return B?this._tokenRevocationClient.revoke(B,M,"refresh_token").then(function(){return!0}):Promise.resolve(!1)},k.prototype.startSilentRenew=function(){this._silentRenewService.start()},k.prototype.stopSilentRenew=function(){this._silentRenewService.stop()},k.prototype._loadUser=function(){return this._userStore.get(this._userStoreKey).then(function(B){return B?(c.Log.debug("UserManager._loadUser: user storageString loaded"),h.User.fromStorageString(B)):(c.Log.debug("UserManager._loadUser: no user storageString"),null)})},k.prototype.storeUser=function(B){if(B){c.Log.debug("UserManager.storeUser: storing user");var M=B.toStorageString();return this._userStore.set(this._userStoreKey,M)}return c.Log.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)},u(k,[{key:"_redirectNavigator",get:function(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function(){return this.settings.iframeNavigator}},{key:"_userStore",get:function(){return this.settings.userStore}},{key:"events",get:function(){return this._events}},{key:"_userStoreKey",get:function(){return"user:"+this.settings.authority+":"+this.settings.client_id}}]),k}(l.OidcClient)},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.UserManagerSettings=void 0;var u=function(){function v(R,b){for(var E=0;E<b.length;E++){var A=b[E];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(R,A.key,A)}}return function(R,b,E){return b&&v(R.prototype,b),E&&v(R,E),R}}(),c=(o(0),o(5)),l=o(40),g=o(41),h=o(43),d=o(6),p=o(1),x=o(8);function T(v,R){if(!(v instanceof R))throw new TypeError("Cannot call a class as a function")}function S(v,R){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!R||typeof R!="object"&&typeof R!="function"?v:R}r.UserManagerSettings=function(v){function R(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},E=b.popup_redirect_uri,A=b.popup_post_logout_redirect_uri,k=b.popupWindowFeatures,D=b.popupWindowTarget,B=b.silent_redirect_uri,M=b.silentRequestTimeout,ie=b.automaticSilentRenew,he=ie!==void 0&&ie,L=b.validateSubOnSilentRenew,re=L!==void 0&&L,be=b.includeIdTokenInSilentRenew,ue=be===void 0||be,ke=b.monitorSession,ne=ke===void 0||ke,fe=b.monitorAnonymousSession,Ne=fe!==void 0&&fe,pe=b.checkSessionInterval,Te=pe===void 0?2e3:pe,K=b.stopCheckSessionOnError,me=K===void 0||K,Ie=b.query_status_response_type,Fe=b.revokeAccessTokenOnSignout,De=Fe!==void 0&&Fe,Oe=b.accessTokenExpiringNotificationTime,$e=Oe===void 0?60:Oe,He=b.redirectNavigator,Se=He===void 0?new l.RedirectNavigator:He,Re=b.popupNavigator,Ce=Re===void 0?new g.PopupNavigator:Re,V=b.iframeNavigator,I=V===void 0?new h.IFrameNavigator:V,y=b.userStore,C=y===void 0?new d.WebStorageStateStore({store:p.Global.sessionStorage}):y;T(this,R);var O=S(this,v.call(this,arguments[0]));return O._popup_redirect_uri=E,O._popup_post_logout_redirect_uri=A,O._popupWindowFeatures=k,O._popupWindowTarget=D,O._silent_redirect_uri=B,O._silentRequestTimeout=M,O._automaticSilentRenew=he,O._validateSubOnSilentRenew=re,O._includeIdTokenInSilentRenew=ue,O._accessTokenExpiringNotificationTime=$e,O._monitorSession=ne,O._monitorAnonymousSession=Ne,O._checkSessionInterval=Te,O._stopCheckSessionOnError=me,Ie?O._query_status_response_type=Ie:arguments[0]&&arguments[0].response_type?O._query_status_response_type=x.SigninRequest.isOidc(arguments[0].response_type)?"id_token":"code":O._query_status_response_type="id_token",O._revokeAccessTokenOnSignout=De,O._redirectNavigator=Se,O._popupNavigator=Ce,O._iframeNavigator=I,O._userStore=C,O}return function(E,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);E.prototype=Object.create(A&&A.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(E,A):E.__proto__=A)}(R,v),u(R,[{key:"popup_redirect_uri",get:function(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function(){return this._redirectNavigator}},{key:"popupNavigator",get:function(){return this._popupNavigator}},{key:"iframeNavigator",get:function(){return this._iframeNavigator}},{key:"userStore",get:function(){return this._userStore}}]),R}(c.OidcClientSettings)},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.RedirectNavigator=void 0;var u=function(){function l(g,h){for(var d=0;d<h.length;d++){var p=h[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(g,p.key,p)}}return function(g,h,d){return h&&l(g.prototype,h),d&&l(g,d),g}}(),c=o(0);r.RedirectNavigator=function(){function l(){(function(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.prototype.prepare=function(){return Promise.resolve(this)},l.prototype.navigate=function(h){return h&&h.url?(h.useReplaceToNavigate?window.location.replace(h.url):window.location=h.url,Promise.resolve()):(c.Log.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))},u(l,[{key:"url",get:function(){return window.location.href}}]),l}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.PopupNavigator=void 0;var u=o(0),c=o(42);r.PopupNavigator=function(){function l(){(function(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.prototype.prepare=function(h){var d=new c.PopupWindow(h);return Promise.resolve(d)},l.prototype.callback=function(h,d,p){u.Log.debug("PopupNavigator.callback");try{return c.PopupWindow.notifyOpener(h,d,p),Promise.resolve()}catch(x){return Promise.reject(x)}},l}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.PopupWindow=void 0;var u=function(){function g(h,d){for(var p=0;p<d.length;p++){var x=d[p];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(h,x.key,x)}}return function(h,d,p){return d&&g(h.prototype,d),p&&g(h,p),h}}(),c=o(0),l=o(3);r.PopupWindow=function(){function g(h){var d=this;(function(S,v){if(!(S instanceof v))throw new TypeError("Cannot call a class as a function")})(this,g),this._promise=new Promise(function(T,S){d._resolve=T,d._reject=S});var p=h.popupWindowTarget||"_blank",x=h.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",p,x),this._popup&&(c.Log.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}return g.prototype.navigate=function(d){return this._popup?d&&d.url?(c.Log.debug("PopupWindow.navigate: Setting URL in popup"),this._id=d.id,this._id&&(window["popupCallback_"+d.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=d.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise},g.prototype._success=function(d){c.Log.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(d)},g.prototype._error=function(d){c.Log.error("PopupWindow.error: ",d),this._cleanup(),this._reject(new Error(d))},g.prototype.close=function(){this._cleanup(!1)},g.prototype._cleanup=function(d){c.Log.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!d&&this._popup.close(),this._popup=null},g.prototype._checkForPopupClosed=function(){this._popup&&!this._popup.closed||this._error("Popup window closed")},g.prototype._callback=function(d,p){this._cleanup(p),d?(c.Log.debug("PopupWindow.callback success"),this._success({url:d})):(c.Log.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))},g.notifyOpener=function(d,p,x){if(window.opener){if(d=d||window.location.href){var T=l.UrlUtility.parseUrlFragment(d,x);if(T.state){var S="popupCallback_"+T.state,v=window.opener[S];v?(c.Log.debug("PopupWindow.notifyOpener: passing url message to opener"),v(d,p)):c.Log.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else c.Log.warn("PopupWindow.notifyOpener: no state found in response url")}}else c.Log.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")},u(g,[{key:"promise",get:function(){return this._promise}}]),g}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.IFrameNavigator=void 0;var u=o(0),c=o(44);r.IFrameNavigator=function(){function l(){(function(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.prototype.prepare=function(h){var d=new c.IFrameWindow(h);return Promise.resolve(d)},l.prototype.callback=function(h){u.Log.debug("IFrameNavigator.callback");try{return c.IFrameWindow.notifyParent(h),Promise.resolve()}catch(d){return Promise.reject(d)}},l}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.IFrameWindow=void 0;var u=function(){function l(g,h){for(var d=0;d<h.length;d++){var p=h[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(g,p.key,p)}}return function(g,h,d){return h&&l(g.prototype,h),d&&l(g,d),g}}(),c=o(0);r.IFrameWindow=function(){function l(g){var h=this;(function(p,x){if(!(p instanceof x))throw new TypeError("Cannot call a class as a function")})(this,l),this._promise=new Promise(function(d,p){h._resolve=d,h._reject=p}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.width=0,this._frame.height=0,window.document.body.appendChild(this._frame)}return l.prototype.navigate=function(h){if(h&&h.url){var d=h.silentRequestTimeout||1e4;c.Log.debug("IFrameWindow.navigate: Using timeout of:",d),this._timer=window.setTimeout(this._timeout.bind(this),d),this._frame.src=h.url}else this._error("No url provided");return this.promise},l.prototype._success=function(h){this._cleanup(),c.Log.debug("IFrameWindow: Successful response from frame window"),this._resolve(h)},l.prototype._error=function(h){this._cleanup(),c.Log.error(h),this._reject(new Error(h))},l.prototype.close=function(){this._cleanup()},l.prototype._cleanup=function(){this._frame&&(c.Log.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)},l.prototype._timeout=function(){c.Log.debug("IFrameWindow.timeout"),this._error("Frame window timed out")},l.prototype._message=function(h){if(c.Log.debug("IFrameWindow.message"),this._timer&&h.origin===this._origin&&h.source===this._frame.contentWindow&&typeof h.data=="string"&&(h.data.startsWith("http://")||h.data.startsWith("https://"))){var d=h.data;d?this._success({url:d}):this._error("Invalid response from frame")}},l.notifyParent=function(h){c.Log.debug("IFrameWindow.notifyParent"),(h=h||window.location.href)&&(c.Log.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(h,location.protocol+"//"+location.host))},u(l,[{key:"promise",get:function(){return this._promise}},{key:"_origin",get:function(){return location.protocol+"//"+location.host}}]),l}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.UserManagerEvents=void 0;var u=o(0),c=o(16),l=o(17);r.UserManagerEvents=function(g){function h(d){(function(T,S){if(!(T instanceof S))throw new TypeError("Cannot call a class as a function")})(this,h);var p=function(T,S){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!S||typeof S!="object"&&typeof S!="function"?T:S}(this,g.call(this,d));return p._userLoaded=new l.Event("User loaded"),p._userUnloaded=new l.Event("User unloaded"),p._silentRenewError=new l.Event("Silent renew error"),p._userSignedIn=new l.Event("User signed in"),p._userSignedOut=new l.Event("User signed out"),p._userSessionChanged=new l.Event("User session changed"),p}return function(p,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof x);p.prototype=Object.create(x&&x.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),x&&(Object.setPrototypeOf?Object.setPrototypeOf(p,x):p.__proto__=x)}(h,g),h.prototype.load=function(p){var x=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];u.Log.debug("UserManagerEvents.load"),g.prototype.load.call(this,p),x&&this._userLoaded.raise(p)},h.prototype.unload=function(){u.Log.debug("UserManagerEvents.unload"),g.prototype.unload.call(this),this._userUnloaded.raise()},h.prototype.addUserLoaded=function(p){this._userLoaded.addHandler(p)},h.prototype.removeUserLoaded=function(p){this._userLoaded.removeHandler(p)},h.prototype.addUserUnloaded=function(p){this._userUnloaded.addHandler(p)},h.prototype.removeUserUnloaded=function(p){this._userUnloaded.removeHandler(p)},h.prototype.addSilentRenewError=function(p){this._silentRenewError.addHandler(p)},h.prototype.removeSilentRenewError=function(p){this._silentRenewError.removeHandler(p)},h.prototype._raiseSilentRenewError=function(p){u.Log.debug("UserManagerEvents._raiseSilentRenewError",p.message),this._silentRenewError.raise(p)},h.prototype.addUserSignedIn=function(p){this._userSignedIn.addHandler(p)},h.prototype.removeUserSignedIn=function(p){this._userSignedIn.removeHandler(p)},h.prototype._raiseUserSignedIn=function(){u.Log.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()},h.prototype.addUserSignedOut=function(p){this._userSignedOut.addHandler(p)},h.prototype.removeUserSignedOut=function(p){this._userSignedOut.removeHandler(p)},h.prototype._raiseUserSignedOut=function(){u.Log.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()},h.prototype.addUserSessionChanged=function(p){this._userSessionChanged.addHandler(p)},h.prototype.removeUserSessionChanged=function(p){this._userSessionChanged.removeHandler(p)},h.prototype._raiseUserSessionChanged=function(){u.Log.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()},h}(c.AccessTokenEvents)},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.Timer=void 0;var u=function(){function p(x,T){for(var S=0;S<T.length;S++){var v=T[S];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(x,v.key,v)}}return function(x,T,S){return T&&p(x.prototype,T),S&&p(x,S),x}}(),c=o(0),l=o(1),g=o(17);function h(p,x){if(!(p instanceof x))throw new TypeError("Cannot call a class as a function")}function d(p,x){if(!p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!x||typeof x!="object"&&typeof x!="function"?p:x}r.Timer=function(p){function x(T){var S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.Global.timer,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;h(this,x);var R=d(this,p.call(this,T));return R._timer=S,R._nowFunc=v||function(){return Date.now()/1e3},R}return function(S,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);S.prototype=Object.create(v&&v.prototype,{constructor:{value:S,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(S,v):S.__proto__=v)}(x,p),x.prototype.init=function(S){S<=0&&(S=1),S=parseInt(S);var v=this.now+S;if(this.expiration===v&&this._timerHandle)c.Log.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),c.Log.debug("Timer.init timer "+this._name+" for duration:",S),this._expiration=v;var R=5;S<R&&(R=S),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*R)}},x.prototype.cancel=function(){this._timerHandle&&(c.Log.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)},x.prototype._callback=function(){var S=this._expiration-this.now;c.Log.debug("Timer.callback; "+this._name+" timer expires in:",S),this._expiration<=this.now&&(this.cancel(),p.prototype.raise.call(this))},u(x,[{key:"now",get:function(){return parseInt(this._nowFunc())}},{key:"expiration",get:function(){return this._expiration}}]),x}(g.Event)},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.SilentRenewService=void 0;var u=o(0);r.SilentRenewService=function(){function c(l){(function(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")})(this,c),this._userManager=l}return c.prototype.start=function(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then(function(g){}).catch(function(g){u.Log.error("SilentRenewService.start: Error from getUser:",g.message)}))},c.prototype.stop=function(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)},c.prototype._tokenExpiring=function(){var g=this;this._userManager.signinSilent().then(function(h){u.Log.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")},function(h){u.Log.error("SilentRenewService._tokenExpiring: Error from signinSilent:",h.message),g._userManager.events._raiseSilentRenewError(h)})},c}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.CordovaPopupNavigator=void 0;var u=o(21);r.CordovaPopupNavigator=function(){function c(){(function(g,h){if(!(g instanceof h))throw new TypeError("Cannot call a class as a function")})(this,c)}return c.prototype.prepare=function(g){var h=new u.CordovaPopupWindow(g);return Promise.resolve(h)},c}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.CordovaIFrameNavigator=void 0;var u=o(21);r.CordovaIFrameNavigator=function(){function c(){(function(g,h){if(!(g instanceof h))throw new TypeError("Cannot call a class as a function")})(this,c)}return c.prototype.prepare=function(g){g.popupWindowFeatures="hidden=yes";var h=new u.CordovaPopupWindow(g);return Promise.resolve(h)},c}()},function(t,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.Version="1.11.6"}])})}(Zn)),Zn.exports}var Ds=Dp();function Lp(n,e){throw n.error==="invalid_redirect_uri"?new Error(`Dynamic client registration failed: the provided redirect uri [${e.redirectUrl?.toString()}] is invalid - ${n.error_description??""}`):n.error==="invalid_client_metadata"?new Error(`Dynamic client registration failed: the provided client metadata ${JSON.stringify(e)} is invalid - ${n.error_description??""}`):new Error(`Dynamic client registration failed: ${n.error} - ${n.error_description??""}`)}function jp(n){return typeof n.client_id=="string"}function Up(n){return Array.isArray(n.redirect_uris)&&n.redirect_uris.every(e=>typeof e=="string")}function Op(n,e){if(!jp(n))throw new Error(`Dynamic client registration failed: no client_id has been found on ${JSON.stringify(n)}`);if(e.redirectUrl&&Up(n)&&n.redirect_uris[0]!==e.redirectUrl.toString())throw new Error(`Dynamic client registration failed: the returned redirect URIs ${JSON.stringify(n.redirect_uris)} don't match the provided ${JSON.stringify([e.redirectUrl.toString()])}`);return!0}async function Bp(n,e){if(!e.registrationEndpoint)throw new Error("Dynamic Registration could not be completed because the issuer has no registration endpoint.");if(!Array.isArray(e.idTokenSigningAlgValuesSupported))throw new Error("The OIDC issuer discovery profile is missing the 'id_token_signing_alg_values_supported' value, which is mandatory.");const t=mp(e.idTokenSigningAlgValuesSupported,ti),r={client_name:n.clientName,application_type:"web",redirect_uris:[n.redirectUrl?.toString()],subject_type:"public",token_endpoint_auth_method:"client_secret_basic",id_token_signed_response_alg:t,grant_types:["authorization_code","refresh_token"]},o={"Content-Type":"application/json"},u=await fetch(e.registrationEndpoint.toString(),{method:"POST",headers:o,body:JSON.stringify(r)});if(u.ok){const c=await u.json();return Op(c,n),{clientId:c.client_id,clientSecret:c.client_secret,expiresAt:c.client_secret_expires_at,idTokenSignedResponseAlg:c.id_token_signed_response_alg,clientType:"dynamic"}}throw u.status===400&&Lp(await u.json(),n),new Error(`Dynamic client registration failed: the server returned ${u.status} ${u.statusText} - ${await u.text()}`)}function Mp(n){return n.error!==void 0&&typeof n.error=="string"}function Va(n){return n.error_description!==void 0&&typeof n.error_description=="string"}function Hp(n){return n.error_uri!==void 0&&typeof n.error_uri=="string"}function Kp(n){return n.access_token!==void 0&&typeof n.access_token=="string"}function qp(n){return n.id_token!==void 0&&typeof n.id_token=="string"}function Wp(n){return n.refresh_token!==void 0&&typeof n.refresh_token=="string"}function $p(n){return n.token_type!==void 0&&typeof n.token_type=="string"}function Vp(n){return n.expires_in===void 0||typeof n.expires_in=="number"}function Jp(n,e){if(e.grantType&&(!n.grantTypesSupported||!n.grantTypesSupported.includes(e.grantType)))throw new Error(`The issuer [${n.issuer}] does not support the [${e.grantType}] grant`);if(!n.tokenEndpoint)throw new Error(`This issuer [${n.issuer}] does not have a token endpoint`)}function Jc(n,e){if(Mp(n))throw new $c(`Token endpoint returned error [${n.error}]${Va(n)?`: ${n.error_description}`:""}${Hp(n)?` (see ${n.error_uri})`:""}`,n.error,Va(n)?n.error_description:void 0);if(!Kp(n))throw new En(["access_token"]);if(!qp(n))throw new En(["id_token"]);if(!$p(n))throw new En(["token_type"]);if(!Vp(n))throw new En(["expires_in"]);if(!e&&n.token_type.toLowerCase()!=="bearer")throw new Error(`Invalid token endpoint response: requested a [Bearer] token, but got a 'token_type' value of [${n.token_type}].`);return n}async function Gp(n,e,t,r){Jp(n,t);const o={"content-type":"application/x-www-form-urlencoded"};let u;r&&(u=await Tp(),o.DPoP=await uo(n.tokenEndpoint,"POST",u)),e.clientSecret&&(o.Authorization=`Basic ${btoa(`${e.clientId}:${e.clientSecret}`)}`);const c={grant_type:t.grantType,redirect_uri:t.redirectUrl,code:t.code,code_verifier:t.codeVerifier,client_id:e.clientId},l={method:"POST",headers:o,body:new URLSearchParams(c).toString()},h=await(await fetch(n.tokenEndpoint,l)).json(),d=Jc(h,r),{webId:p,clientId:x}=await Oc(d.id_token,n.jwksUri,n.issuer,e.clientId);return{accessToken:d.access_token,idToken:d.id_token,refreshToken:Wp(d)?d.refresh_token:void 0,webId:p,clientId:x,dpopKey:u,expiresIn:d.expires_in}}const zp=n=>{try{return new URL(n),!0}catch{return!1}};async function Qp(n,e,t,r){if(t.clientId===void 0)throw new Error("No client ID available when trying to refresh the access token.");const o={grant_type:"refresh_token",refresh_token:n};let u={};r!==void 0&&(u={DPoP:await uo(e.tokenEndpoint,"POST",r)});let c={};t.clientSecret!==void 0?c={Authorization:`Basic ${btoa(`${t.clientId}:${t.clientSecret}`)}`}:zp(t.clientId)&&(o.client_id=t.clientId);const l=await fetch(e.tokenEndpoint,{method:"POST",body:new URLSearchParams(o).toString(),headers:{...u,...c,"Content-Type":"application/x-www-form-urlencoded"}});let g;try{g=await l.json()}catch{throw new Error(`The token endpoint of issuer ${e.issuer} returned a malformed response.`)}const h=Jc(g,r!==void 0),{webId:d}=await Oc(h.id_token,e.jwksUri,e.issuer,t.clientId);return{accessToken:h.access_token,idToken:h.id_token,refreshToken:typeof h.refresh_token=="string"?h.refresh_token:void 0,webId:d,dpopKey:r,expiresIn:h.expires_in}}function Yp(n){const e=Mc(n);return e.hash="",n.includes(`${e.origin}/`)?e.href:`${e.origin}${e.href.substring(e.origin.length+1)}`}async function Xp(){await new Ds.OidcClient({response_mode:"query"}).clearStaleState(new Ds.WebStorageStateStore({}));const e=window.localStorage,t=[];for(let r=0;r<=e.length;r+=1){const o=e.key(r);o&&(o.match(/^oidc\..+$/)||o.match(/^solidClientAuthenticationUser:.+$/))&&t.push(o)}t.forEach(r=>e.removeItem(r))}class Zp extends xp{constructor(e,t){super(e,t)}}class eg extends Sp{login=async(e,t)=>{e.prompt!=="none"&&await this.sessionInfoManager.clear(e.sessionId);const r=e.redirectUrl??Yp(window.location.href);if(!Bc(r))throw new Error(`${r} is not a valid redirect URL, it is either a malformed IRI, includes a hash fragment, or reserved query parameters ('code' or 'state').`);await this.loginHandler.handle({...e,redirectUrl:r,clientName:e.clientName??e.clientId,eventEmitter:t})};validateCurrentSession=async e=>{const t=await this.sessionInfoManager.get(e);return t===void 0||t.clientAppId===void 0||t.issuer===void 0?null:t};handleIncomingRedirect=async(e,t)=>{try{const r=await this.redirectHandler.handle(e,t,void 0);return this.fetch=r.fetch.bind(window),this.boundLogout=r.getLogoutUrl,await this.cleanUrlAfterRedirect(e),{isLoggedIn:r.isLoggedIn,webId:r.webId,sessionId:r.sessionId,expirationDate:r.expirationDate,clientAppId:r.clientAppId}}catch(r){await this.cleanUrlAfterRedirect(e),t.emit(wt.ERROR,"redirect",r);return}};async cleanUrlAfterRedirect(e){const t=Mc(e).href;for(window.history.replaceState(null,"",t);window.location.href!==t;)await new Promise(r=>{setTimeout(()=>r(),1)})}}function Ja(n){return typeof n.oidcIssuer=="string"}function Ga(n){return typeof n.redirectUrl=="string"}class tg{storageUtility;oidcHandler;issuerConfigFetcher;clientRegistrar;constructor(e,t,r,o){this.storageUtility=e,this.oidcHandler=t,this.issuerConfigFetcher=r,this.clientRegistrar=o,this.storageUtility=e,this.oidcHandler=t,this.issuerConfigFetcher=r,this.clientRegistrar=o}async canHandle(e){return Ja(e)&&Ga(e)}async handle(e){if(!Ja(e))throw new Ns(`OidcLoginHandler requires an OIDC issuer: missing property 'oidcIssuer' in ${JSON.stringify(e)}`);if(!Ga(e))throw new Ns(`OidcLoginHandler requires a redirect URL: missing property 'redirectUrl' in ${JSON.stringify(e)}`);const t=await this.issuerConfigFetcher.fetchConfig(e.oidcIssuer),r=await vp(e,t,this.storageUtility,this.clientRegistrar),o={issuer:t.issuer,dpop:e.tokenType.toLowerCase()==="dpop",...e,issuerConfiguration:t,client:r,scopes:ap(e.customScopes)};return this.oidcHandler.handle(o)}}class rg extends cp{async handle(e){const t={authority:e.issuer.toString(),client_id:e.client.clientId,client_secret:e.client.clientSecret,redirect_uri:e.redirectUrl,response_type:"code",scope:e.scopes.join(" "),filterProtocolClaims:!0,loadUserInfo:!1,code_verifier:!0,prompt:e.prompt??"consent"},r=new Ds.OidcClient(t);try{const o=await r.createSigninRequest();return await this.setupRedirectHandler({oidcLoginOptions:e,state:o.state._id,codeVerifier:o.state._code_verifier,targetUrl:o.url.toString()})}catch(o){console.error(o)}}}const ng=".well-known/openid-configuration",za={issuer:{toKey:"issuer",convertToUrl:!0},authorization_endpoint:{toKey:"authorizationEndpoint",convertToUrl:!0},token_endpoint:{toKey:"tokenEndpoint",convertToUrl:!0},userinfo_endpoint:{toKey:"userinfoEndpoint",convertToUrl:!0},jwks_uri:{toKey:"jwksUri",convertToUrl:!0},registration_endpoint:{toKey:"registrationEndpoint",convertToUrl:!0},end_session_endpoint:{toKey:"endSessionEndpoint",convertToUrl:!0},scopes_supported:{toKey:"scopesSupported"},response_types_supported:{toKey:"responseTypesSupported"},response_modes_supported:{toKey:"responseModesSupported"},grant_types_supported:{toKey:"grantTypesSupported"},acr_values_supported:{toKey:"acrValuesSupported"},subject_types_supported:{toKey:"subjectTypesSupported"},id_token_signing_alg_values_supported:{toKey:"idTokenSigningAlgValuesSupported"},id_token_encryption_alg_values_supported:{toKey:"idTokenEncryptionAlgValuesSupported"},id_token_encryption_enc_values_supported:{toKey:"idTokenEncryptionEncValuesSupported"},userinfo_signing_alg_values_supported:{toKey:"userinfoSigningAlgValuesSupported"},userinfo_encryption_alg_values_supported:{toKey:"userinfoEncryptionAlgValuesSupported"},userinfo_encryption_enc_values_supported:{toKey:"userinfoEncryptionEncValuesSupported"},request_object_signing_alg_values_supported:{toKey:"requestObjectSigningAlgValuesSupported"},request_object_encryption_alg_values_supported:{toKey:"requestObjectEncryptionAlgValuesSupported"},request_object_encryption_enc_values_supported:{toKey:"requestObjectEncryptionEncValuesSupported"},token_endpoint_auth_methods_supported:{toKey:"tokenEndpointAuthMethodsSupported"},token_endpoint_auth_signing_alg_values_supported:{toKey:"tokenEndpointAuthSigningAlgValuesSupported"},display_values_supported:{toKey:"displayValuesSupported"},claim_types_supported:{toKey:"claimTypesSupported"},claims_supported:{toKey:"claimsSupported"},service_documentation:{toKey:"serviceDocumentation"},claims_locales_supported:{toKey:"claimsLocalesSupported"},ui_locales_supported:{toKey:"uiLocalesSupported"},claims_parameter_supported:{toKey:"claimsParameterSupported"},request_parameter_supported:{toKey:"requestParameterSupported"},request_uri_parameter_supported:{toKey:"requestUriParameterSupported"},require_request_uri_registration:{toKey:"requireRequestUriRegistration"},op_policy_uri:{toKey:"opPolicyUri",convertToUrl:!0},op_tos_uri:{toKey:"opTosUri",convertToUrl:!0}};function ig(n){const e={};return Object.keys(n).forEach(t=>{za[t]&&(e[za[t].toKey]=n[t])}),Array.isArray(e.scopesSupported)||(e.scopesSupported=["openid"]),e}class co{storageUtility;constructor(e){this.storageUtility=e,this.storageUtility=e}static getLocalStorageKey(e){return`issuerConfig:${e}`}async fetchConfig(e){let t;const r=new URL(ng,e.endsWith("/")?e:`${e}/`).href,o=await fetch(r);try{t=ig(await o.json())}catch(u){throw new Ns(`[${e.toString()}] has an invalid configuration: ${u.message}`)}return await this.storageUtility.set(co.getLocalStorageKey(e),JSON.stringify(t)),t}}async function sg(n,e){await Kc(n,e),await Xp()}class og extends dp{async get(e){const[t,r,o,u,c,l,g,h]=await Promise.all([this.storageUtility.getForUser(e,"isLoggedIn",{secure:!0}),this.storageUtility.getForUser(e,"webId",{secure:!0}),this.storageUtility.getForUser(e,"clientId",{secure:!1}),this.storageUtility.getForUser(e,"clientSecret",{secure:!1}),this.storageUtility.getForUser(e,"redirectUrl",{secure:!1}),this.storageUtility.getForUser(e,"refreshToken",{secure:!0}),this.storageUtility.getForUser(e,"issuer",{secure:!1}),this.storageUtility.getForUser(e,"tokenType",{secure:!1})]);if(typeof c=="string"&&!Bc(c)){await Promise.all([this.storageUtility.deleteAllUserData(e,{secure:!1}),this.storageUtility.deleteAllUserData(e,{secure:!0})]);return}if(h!==void 0&&!yp(h))throw new Error(`Tokens of type [${h}] are not supported.`);if(!(o===void 0&&t===void 0&&r===void 0&&l===void 0))return{sessionId:e,webId:r,isLoggedIn:t==="true",redirectUrl:c,refreshToken:l,issuer:g,clientAppId:o,clientAppSecret:u,tokenType:h??"DPoP"}}async clear(e){return sg(e,this.storageUtility)}}class ag{async canHandle(e){try{return new URL(e),!0}catch(t){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${t}`)}}async handle(e){return Hc()}}class ug{storageUtility;sessionInfoManager;issuerConfigFetcher;clientRegistrar;tokerRefresher;constructor(e,t,r,o,u){this.storageUtility=e,this.sessionInfoManager=t,this.issuerConfigFetcher=r,this.clientRegistrar=o,this.tokerRefresher=u,this.storageUtility=e,this.sessionInfoManager=t,this.issuerConfigFetcher=r,this.clientRegistrar=o,this.tokerRefresher=u}async canHandle(e){try{const t=new URL(e);return t.searchParams.get("code")!==null&&t.searchParams.get("state")!==null}catch(t){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${t}`)}}async handle(e,t){if(!await this.canHandle(e))throw new Error(`AuthCodeRedirectHandler cannot handle [${e}]: it is missing one of [code, state].`);const r=new URL(e),o=r.searchParams.get("state"),u=await this.storageUtility.getForUser(o,"sessionId",{errorIfNull:!0}),{issuerConfig:c,codeVerifier:l,redirectUrl:g,dpop:h}=await Wc(u,this.storageUtility,this.issuerConfigFetcher),d=r.searchParams.get("iss");if(typeof d=="string"&&d!==c.issuer)throw new Error(`The value of the iss parameter (${d}) does not match the issuer identifier of the authorization server (${c.issuer}). See [rfc9207](https://www.rfc-editor.org/rfc/rfc9207.html#section-2.3-3.1.1)`);if(l===void 0)throw new Error(`The code verifier for session ${u} is missing from storage.`);if(g===void 0)throw new Error(`The redirect URL for session ${u} is missing from storage.`);const p=await this.clientRegistrar.getClient({sessionId:u},c),x=Date.now(),T=await Gp(c,p,{grantType:"authorization_code",code:r.searchParams.get("code"),codeVerifier:l,redirectUrl:g},h);window.localStorage.removeItem(`oidc.${o}`);let S;T.refreshToken!==void 0&&(S={sessionId:u,refreshToken:T.refreshToken,tokenRefresher:this.tokerRefresher});const v=kp(T.accessToken,{dpopKey:T.dpopKey,refreshOptions:S,eventEmitter:t,expiresIn:T.expiresIn});await Ep(this.storageUtility,u,T.webId,T.clientId,"true",void 0,!0);const R=await this.sessionInfoManager.get(u);if(!R)throw new Error(`Could not retrieve session: [${u}].`);return Object.assign(R,{fetch:v,getLogoutUrl:gp({idTokenHint:T.idToken,endSessionEndpoint:c.endSessionEndpoint}),expirationDate:typeof T.expiresIn=="number"?x+T.expiresIn*1e3:void 0})}}class cg extends op{constructor(e){super(e)}}class lg{get storage(){return window.localStorage}async get(e){return this.storage.getItem(e)||void 0}async set(e,t){this.storage.setItem(e,t)}async delete(e){this.storage.removeItem(e)}}class hg{redirect(e,t){t&&t.handleRedirect?t.handleRedirect(e):t&&t.redirectByReplacingState?window.history.replaceState({},"",e):window.location.href=e}}class fg{storageUtility;constructor(e){this.storageUtility=e,this.storageUtility=e}async getClient(e,t){const[r,o,u,c,l]=await Promise.all([this.storageUtility.getForUser(e.sessionId,"clientId",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"clientSecret",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"expiresAt",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"clientName",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"clientType",{secure:!1})]),g=u!==void 0?Number.parseInt(u,10):-1,h=o!==void 0&&g!==0&&Math.floor(Date.now()/1e3)>g;if(r&&bp(l)&&!h)return o!==void 0?{clientId:r,clientSecret:o,clientName:c,clientType:"dynamic",expiresAt:g}:{clientId:r,clientName:c,clientType:l};try{const d=await Bp(e,t),p={clientId:d.clientId,clientType:"dynamic"};return d.clientSecret!==void 0&&(p.clientSecret=d.clientSecret,p.expiresAt=String(d.expiresAt)),d.idTokenSignedResponseAlg&&(p.idTokenSignedResponseAlg=d.idTokenSignedResponseAlg),await this.storageUtility.setForUser(e.sessionId,p,{secure:!1}),d}catch(d){throw new Error("Client registration failed.",{cause:d})}}}class dg{async canHandle(e){try{return new URL(e).searchParams.has("error")}catch(t){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${t}`)}}async handle(e,t){if(t!==void 0){const r=new URL(e),o=r.searchParams.get("error"),u=r.searchParams.get("error_description");t.emit(wt.ERROR,o,u)}return Hc()}}class pg{storageUtility;issuerConfigFetcher;clientRegistrar;constructor(e,t,r){this.storageUtility=e,this.issuerConfigFetcher=t,this.clientRegistrar=r,this.storageUtility=e,this.issuerConfigFetcher=t,this.clientRegistrar=r}async refresh(e,t,r,o){const u=await Wc(e,this.storageUtility,this.issuerConfigFetcher),c=await this.clientRegistrar.getClient({sessionId:e},u.issuerConfig);if(t===void 0)throw new Error(`Session [${e}] has no refresh token to allow it to refresh its access token.`);if(u.dpop&&r===void 0)throw new Error(`For session [${e}], the key bound to the DPoP access token must be provided to refresh said access token.`);const l=await Qp(t,u.issuerConfig,c,r);return l.refreshToken!==void 0&&o?.emit(wt.NEW_REFRESH_TOKEN,l.refreshToken),l}}function Qa(n){const e=new Fp,t=n.secureStorage||e,r=n.insecureStorage||new lg,o=new Zp(t,r),u=new co(o),c=new fg(o),l=new og(o),g=new pg(o,u,c),h=new hg,d=new tg(o,new rg(o,h),u,c),p=new cg([new dg,new ug(o,l,u,c,g),new ag]);return new eg(d,p,new fp(l,h),l,u)}const _s=`${Uc}currentSession`,Ls=`${Uc}currentUrl`;async function gg(n,e,t){const r=await e.validateCurrentSession(n);return r!==null?(window.localStorage.setItem(Ls,window.location.href),await e.login({sessionId:n,prompt:"none",oidcIssuer:r.issuer,redirectUrl:r.redirectUrl,clientId:r.clientAppId,clientSecret:r.clientAppSecret,tokenType:r.tokenType??"DPoP"},t.events),!0):!1}function yg(n){return!!n?.isLoggedIn}class mg{info;events;clientAuthentication;tokenRequestInProgress=!1;constructor(e={},t=void 0){this.events=new $s,e.clientAuthentication?this.clientAuthentication=e.clientAuthentication:e.secureStorage&&e.insecureStorage?this.clientAuthentication=Qa({secureStorage:e.secureStorage,insecureStorage:e.insecureStorage}):this.clientAuthentication=Qa({}),e.sessionInfo?this.info={sessionId:e.sessionInfo.sessionId,isLoggedIn:!1,webId:e.sessionInfo.webId,clientAppId:e.sessionInfo.clientAppId}:this.info={sessionId:t??Ar(),isLoggedIn:!1},this.events.on(wt.LOGIN,()=>window.localStorage.setItem(_s,this.info.sessionId)),this.events.on(wt.SESSION_EXPIRED,()=>this.internalLogout(!1)),this.events.on(wt.ERROR,()=>this.internalLogout(!1))}login=async e=>(await this.clientAuthentication.login({sessionId:this.info.sessionId,...e,tokenType:e.tokenType??"DPoP"},this.events),new Promise(()=>{}));fetch=(e,t)=>this.clientAuthentication.fetch(e,t);internalLogout=async(e,t)=>{window.localStorage.removeItem(_s),await this.clientAuthentication.logout(this.info.sessionId,t),this.info.isLoggedIn=!1,e&&this.events.emit(wt.LOGOUT)};logout=async e=>this.internalLogout(!0,e);handleIncomingRedirect=async(e={})=>{if(this.info.isLoggedIn)return this.info;if(this.tokenRequestInProgress)return;const t=typeof e=="string"?{url:e}:e,r=t.url??window.location.href;this.tokenRequestInProgress=!0;const o=await this.clientAuthentication.handleIncomingRedirect(r,this.events);if(yg(o)){this.setSessionInfo(o);const u=window.localStorage.getItem(Ls);u===null?this.events.emit(wt.LOGIN):(window.localStorage.removeItem(Ls),this.events.emit(wt.SESSION_RESTORED,u))}else if(t.restorePreviousSession===!0){const u=window.localStorage.getItem(_s);if(u!==null&&await gg(u,this.clientAuthentication,this))return new Promise(()=>{})}return this.tokenRequestInProgress=!1,o};setSessionInfo(e){this.info.isLoggedIn=e.isLoggedIn,this.info.webId=e.webId,this.info.sessionId=e.sessionId,this.info.clientAppId=e.clientAppId,this.info.expirationDate=e.expirationDate,this.events.on(wt.SESSION_EXTENDED,t=>{this.info.expirationDate=Date.now()+t*1e3})}}let bs;function js(){return typeof bs>"u"&&(bs=new mg),bs}const Tg=(...n)=>js().logout(...n),Ag=ol(js(),n=>{const e=js(),t=()=>{n(e),hd.setContext("solid",{fetch:e.fetch})};return t(),e.events.addListener("login",t),e.events.addListener("logout",t),e.events.addListener("sessionRestore",t),e.events.addListener("sessionExtended",t),e.events.addListener("sessionExpired",t),e.events.addListener("newTokens",t),()=>{e.events.removeListener("login",t),e.events.removeListener("logout",t),e.events.removeListener("sessionRestore",t),e.events.removeListener("sessionExtended",t),e.events.removeListener("sessionExpired",t),e.events.removeListener("newTokens",t)}});export{tr as B,vg as G,Sg as a,xg as b,Fg as c,hd as d,kn as g,Tg as l,Ag as s,Eg as u};
